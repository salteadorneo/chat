var xr=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function h$(e){if(e.__esModule)return e;var n=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(e).forEach(function(r){var t=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(n,r,t.get?t:{enumerable:!0,get:function(){return e[r]}})}),n}var y$={},nu=function(e){return e&&e.Math==Math&&e},He=nu(typeof globalThis=="object"&&globalThis)||nu(typeof window=="object"&&window)||nu(typeof self=="object"&&self)||nu(typeof xr=="object"&&xr)||function(){return this}()||Function("return this")(),Vr={},Ne=function(e){try{return!!e()}catch{return!0}},g$=Ne,mt=!g$(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),m$=Ne,Is=!m$(function(){var e=function(){}.bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),b$=Is,au=Function.prototype.call,lt=b$?au.bind(au):function(){return au.apply(au,arguments)},Rs={},Ug={}.propertyIsEnumerable,jg=Object.getOwnPropertyDescriptor,w$=jg&&!Ug.call({1:2},1);Rs.f=w$?function(n){var r=jg(this,n);return!!r&&r.enumerable}:Ug;var Ra=function(e,n){return{enumerable:!(e&1),configurable:!(e&2),writable:!(e&4),value:n}},Dg=Is,Fg=Function.prototype,S$=Fg.bind,El=Fg.call,$$=Dg&&S$.bind(El,El),Le=Dg?function(e){return e&&$$(e)}:function(e){return e&&function(){return El.apply(e,arguments)}},Bg=Le,_$=Bg({}.toString),k$=Bg("".slice),Hn=function(e){return k$(_$(e),8,-1)},T$=Le,I$=Ne,R$=Hn,Ko=Object,E$=T$("".split),Es=I$(function(){return!Ko("z").propertyIsEnumerable(0)})?function(e){return R$(e)=="String"?E$(e,""):Ko(e)}:Ko,C$=TypeError,Kr=function(e){if(e==null)throw C$("Can't call method on "+e);return e},O$=Es,P$=Kr,sr=function(e){return O$(P$(e))},ft=function(e){return typeof e=="function"},A$=ft,_t=function(e){return typeof e=="object"?e!==null:A$(e)},Yo=He,M$=ft,N$=function(e){return M$(e)?e:void 0},kr=function(e,n){return arguments.length<2?N$(Yo[e]):Yo[e]&&Yo[e][n]},L$=Le,dn=L$({}.isPrototypeOf),x$=kr,Ea=x$("navigator","userAgent")||"",qg=He,Jo=Ea,pp=qg.process,vp=qg.Deno,hp=pp&&pp.versions||vp&&vp.version,yp=hp&&hp.v8,Nr,Bu;yp&&(Nr=yp.split("."),Bu=Nr[0]>0&&Nr[0]<4?1:+(Nr[0]+Nr[1]));!Bu&&Jo&&(Nr=Jo.match(/Edge\/(\d+)/),(!Nr||Nr[1]>=74)&&(Nr=Jo.match(/Chrome\/(\d+)/),Nr&&(Bu=+Nr[1])));var Ca=Bu,gp=Ca,U$=Ne,_i=!!Object.getOwnPropertySymbols&&!U$(function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&gp&&gp<41}),j$=_i,Wg=j$&&!Symbol.sham&&typeof Symbol.iterator=="symbol",D$=kr,F$=ft,B$=dn,q$=Wg,W$=Object,ki=q$?function(e){return typeof e=="symbol"}:function(e){var n=D$("Symbol");return F$(n)&&B$(n.prototype,W$(e))},G$=String,Oa=function(e){try{return G$(e)}catch{return"Object"}},H$=ft,z$=Oa,V$=TypeError,Dr=function(e){if(H$(e))return e;throw V$(z$(e)+" is not a function")},K$=Dr,Pa=function(e,n){var r=e[n];return r==null?void 0:K$(r)},Qo=lt,Xo=ft,Zo=_t,Y$=TypeError,J$=function(e,n){var r,t;if(n==="string"&&Xo(r=e.toString)&&!Zo(t=Qo(r,e))||Xo(r=e.valueOf)&&!Zo(t=Qo(r,e))||n!=="string"&&Xo(r=e.toString)&&!Zo(t=Qo(r,e)))return t;throw Y$("Can't convert object to primitive value")},Aa={exports:{}},Q$=!1,mp=He,X$=Object.defineProperty,Af=function(e,n){try{X$(mp,e,{value:n,configurable:!0,writable:!0})}catch{mp[e]=n}return n},Z$=He,e_=Af,bp="__core-js_shared__",t_=Z$[bp]||e_(bp,{}),Mf=t_,wp=Mf;(Aa.exports=function(e,n){return wp[e]||(wp[e]=n!==void 0?n:{})})("versions",[]).push({version:"3.23.3",mode:"global",copyright:"\xA9 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.23.3/LICENSE",source:"https://github.com/zloirock/core-js"});var r_=Kr,n_=Object,Dt=function(e){return n_(r_(e))},a_=Le,i_=Dt,s_=a_({}.hasOwnProperty),St=Object.hasOwn||function(n,r){return s_(i_(n),r)},u_=Le,o_=0,c_=Math.random(),l_=u_(1 .toString),Cs=function(e){return"Symbol("+(e===void 0?"":e)+")_"+l_(++o_+c_,36)},f_=He,d_=Aa.exports,Sp=St,p_=Cs,$p=_i,Gg=Wg,Ha=d_("wks"),Sa=f_.Symbol,_p=Sa&&Sa.for,v_=Gg?Sa:Sa&&Sa.withoutSetter||p_,st=function(e){if(!Sp(Ha,e)||!($p||typeof Ha[e]=="string")){var n="Symbol."+e;$p&&Sp(Sa,e)?Ha[e]=Sa[e]:Gg&&_p?Ha[e]=_p(n):Ha[e]=v_(n)}return Ha[e]},h_=lt,kp=_t,Tp=ki,y_=Pa,g_=J$,m_=st,b_=TypeError,w_=m_("toPrimitive"),Nf=function(e,n){if(!kp(e)||Tp(e))return e;var r=y_(e,w_),t;if(r){if(n===void 0&&(n="default"),t=h_(r,e,n),!kp(t)||Tp(t))return t;throw b_("Can't convert object to primitive value")}return n===void 0&&(n="number"),g_(e,n)},S_=Nf,$_=ki,Os=function(e){var n=S_(e,"string");return $_(n)?n:n+""},__=He,Ip=_t,Cl=__.document,k_=Ip(Cl)&&Ip(Cl.createElement),lo=function(e){return k_?Cl.createElement(e):{}},T_=mt,I_=Ne,R_=lo,Hg=!T_&&!I_(function(){return Object.defineProperty(R_("div"),"a",{get:function(){return 7}}).a!=7}),E_=mt,C_=lt,O_=Rs,P_=Ra,A_=sr,M_=Os,N_=St,L_=Hg,Rp=Object.getOwnPropertyDescriptor;Vr.f=E_?Rp:function(n,r){if(n=A_(n),r=M_(r),L_)try{return Rp(n,r)}catch{}if(N_(n,r))return P_(!C_(O_.f,n,r),n[r])};var Tt={},x_=mt,U_=Ne,zg=x_&&U_(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),j_=_t,D_=String,F_=TypeError,It=function(e){if(j_(e))return e;throw F_(D_(e)+" is not an object")},B_=mt,q_=Hg,W_=zg,iu=It,Ep=Os,G_=TypeError,ec=Object.defineProperty,H_=Object.getOwnPropertyDescriptor,tc="enumerable",rc="configurable",nc="writable";Tt.f=B_?W_?function(n,r,t){if(iu(n),r=Ep(r),iu(t),typeof n=="function"&&r==="prototype"&&"value"in t&&nc in t&&!t[nc]){var a=H_(n,r);a&&a[nc]&&(n[r]=t.value,t={configurable:rc in t?t[rc]:a[rc],enumerable:tc in t?t[tc]:a[tc],writable:!1})}return ec(n,r,t)}:ec:function(n,r,t){if(iu(n),r=Ep(r),iu(t),q_)try{return ec(n,r,t)}catch{}if("get"in t||"set"in t)throw G_("Accessors not supported");return"value"in t&&(n[r]=t.value),n};var z_=mt,V_=Tt,K_=Ra,pn=z_?function(e,n,r){return V_.f(e,n,K_(1,r))}:function(e,n,r){return e[n]=r,e},Lf={exports:{}},Ol=mt,Y_=St,Vg=Function.prototype,J_=Ol&&Object.getOwnPropertyDescriptor,xf=Y_(Vg,"name"),Q_=xf&&function(){}.name==="something",X_=xf&&(!Ol||Ol&&J_(Vg,"name").configurable),Ps={EXISTS:xf,PROPER:Q_,CONFIGURABLE:X_},Z_=Le,ek=ft,Pl=Mf,tk=Z_(Function.toString);ek(Pl.inspectSource)||(Pl.inspectSource=function(e){return tk(e)});var fo=Pl.inspectSource,rk=He,nk=ft,ak=fo,Cp=rk.WeakMap,ik=nk(Cp)&&/native code/.test(ak(Cp)),sk=Aa.exports,uk=Cs,Op=sk("keys"),po=function(e){return Op[e]||(Op[e]=uk(e))},As={},ok=ik,Kg=He,ac=Le,ck=_t,lk=pn,ic=St,sc=Mf,fk=po,dk=As,Pp="Object already initialized",Al=Kg.TypeError,pk=Kg.WeakMap,qu,ms,Wu,vk=function(e){return Wu(e)?ms(e):qu(e,{})},hk=function(e){return function(n){var r;if(!ck(n)||(r=ms(n)).type!==e)throw Al("Incompatible receiver, "+e+" required");return r}};if(ok||sc.state){var fa=sc.state||(sc.state=new pk),yk=ac(fa.get),Ap=ac(fa.has),gk=ac(fa.set);qu=function(e,n){if(Ap(fa,e))throw new Al(Pp);return n.facade=e,gk(fa,e,n),n},ms=function(e){return yk(fa,e)||{}},Wu=function(e){return Ap(fa,e)}}else{var za=fk("state");dk[za]=!0,qu=function(e,n){if(ic(e,za))throw new Al(Pp);return n.facade=e,lk(e,za,n),n},ms=function(e){return ic(e,za)?e[za]:{}},Wu=function(e){return ic(e,za)}}var Tr={set:qu,get:ms,has:Wu,enforce:vk,getterFor:hk},mk=Ne,bk=ft,su=St,Ml=mt,wk=Ps.CONFIGURABLE,Sk=fo,Yg=Tr,$k=Yg.enforce,_k=Yg.get,Mu=Object.defineProperty,kk=Ml&&!mk(function(){return Mu(function(){},"length",{value:8}).length!==8}),Tk=String(String).split("String"),Ik=Lf.exports=function(e,n,r){String(n).slice(0,7)==="Symbol("&&(n="["+String(n).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),r&&r.getter&&(n="get "+n),r&&r.setter&&(n="set "+n),(!su(e,"name")||wk&&e.name!==n)&&(Ml?Mu(e,"name",{value:n,configurable:!0}):e.name=n),kk&&r&&su(r,"arity")&&e.length!==r.arity&&Mu(e,"length",{value:r.arity});try{r&&su(r,"constructor")&&r.constructor?Ml&&Mu(e,"prototype",{writable:!1}):e.prototype&&(e.prototype=void 0)}catch{}var t=$k(e);return su(t,"source")||(t.source=Tk.join(typeof n=="string"?n:"")),e};Function.prototype.toString=Ik(function(){return bk(this)&&_k(this).source||Sk(this)},"toString");var Rk=ft,Ek=Tt,Ck=Lf.exports,Ok=Af,Ft=function(e,n,r,t){t||(t={});var a=t.enumerable,i=t.name!==void 0?t.name:n;if(Rk(r)&&Ck(r,i,t),t.global)a?e[n]=r:Ok(n,r);else{try{t.unsafe?e[n]&&(a=!0):delete e[n]}catch{}a?e[n]=r:Ek.f(e,n,{value:r,enumerable:!1,configurable:!t.nonConfigurable,writable:!t.nonWritable})}return e},zn={},Pk=Math.ceil,Ak=Math.floor,Mk=Math.trunc||function(n){var r=+n;return(r>0?Ak:Pk)(r)},Nk=Mk,vn=function(e){var n=+e;return n!==n||n===0?0:Nk(n)},Lk=vn,xk=Math.max,Uk=Math.min,Ma=function(e,n){var r=Lk(e);return r<0?xk(r+n,0):Uk(r,n)},jk=vn,Dk=Math.min,hn=function(e){return e>0?Dk(jk(e),9007199254740991):0},Fk=hn,Bt=function(e){return Fk(e.length)},Bk=sr,qk=Ma,Wk=Bt,Mp=function(e){return function(n,r,t){var a=Bk(n),i=Wk(a),s=qk(t,i),l;if(e&&r!=r){for(;i>s;)if(l=a[s++],l!=l)return!0}else for(;i>s;s++)if((e||s in a)&&a[s]===r)return e||s||0;return!e&&-1}},vo={includes:Mp(!0),indexOf:Mp(!1)},Gk=Le,uc=St,Hk=sr,zk=vo.indexOf,Vk=As,Np=Gk([].push),Jg=function(e,n){var r=Hk(e),t=0,a=[],i;for(i in r)!uc(Vk,i)&&uc(r,i)&&Np(a,i);for(;n.length>t;)uc(r,i=n[t++])&&(~zk(a,i)||Np(a,i));return a},Uf=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Kk=Jg,Yk=Uf,Jk=Yk.concat("length","prototype");zn.f=Object.getOwnPropertyNames||function(n){return Kk(n,Jk)};var Ms={};Ms.f=Object.getOwnPropertySymbols;var Qk=kr,Xk=Le,Zk=zn,e0=Ms,t0=It,r0=Xk([].concat),Qg=Qk("Reflect","ownKeys")||function(n){var r=Zk.f(t0(n)),t=e0.f;return t?r0(r,t(n)):r},Lp=St,n0=Qg,a0=Vr,i0=Tt,Xg=function(e,n,r){for(var t=n0(n),a=i0.f,i=a0.f,s=0;s<t.length;s++){var l=t[s];!Lp(e,l)&&!(r&&Lp(r,l))&&a(e,l,i(n,l))}},s0=Ne,u0=ft,o0=/#|\.prototype\./,Ns=function(e,n){var r=l0[c0(e)];return r==d0?!0:r==f0?!1:u0(n)?s0(n):!!n},c0=Ns.normalize=function(e){return String(e).replace(o0,".").toLowerCase()},l0=Ns.data={},f0=Ns.NATIVE="N",d0=Ns.POLYFILL="P",ho=Ns,oc=He,p0=Vr.f,v0=pn,h0=Ft,y0=Af,g0=Xg,m0=ho,We=function(e,n){var r=e.target,t=e.global,a=e.stat,i,s,l,c,h,g;if(t?s=oc:a?s=oc[r]||y0(r,{}):s=(oc[r]||{}).prototype,s)for(l in n){if(h=n[l],e.dontCallGetSet?(g=p0(s,l),c=g&&g.value):c=s[l],i=m0(t?l:r+(a?".":"#")+l,e.forced),!i&&c!==void 0){if(typeof h==typeof c)continue;g0(h,c)}(e.sham||c&&c.sham)&&v0(h,"sham",!0),h0(s,l,h,e)}},b0=Is,Zg=Function.prototype,xp=Zg.apply,Up=Zg.call,Vn=typeof Reflect=="object"&&Reflect.apply||(b0?Up.bind(xp):function(){return Up.apply(xp,arguments)}),w0=Le,Ti=w0([].slice),em=Le,S0=Dr,$0=_t,_0=St,jp=Ti,k0=Is,tm=Function,T0=em([].concat),I0=em([].join),cc={},R0=function(e,n,r){if(!_0(cc,n)){for(var t=[],a=0;a<n;a++)t[a]="a["+a+"]";cc[n]=tm("C,a","return new C("+I0(t,",")+")")}return cc[n](e,r)},E0=k0?tm.bind:function(n){var r=S0(this),t=r.prototype,a=jp(arguments,1),i=function(){var l=T0(a,jp(arguments));return this instanceof i?R0(r,l.length,l):r.apply(n,l)};return $0(t)&&(i.prototype=t),i},C0=st,O0=C0("toStringTag"),rm={};rm[O0]="z";var jf=String(rm)==="[object z]",P0=jf,A0=ft,Nu=Hn,M0=st,N0=M0("toStringTag"),L0=Object,x0=Nu(function(){return arguments}())=="Arguments",U0=function(e,n){try{return e[n]}catch{}},Kn=P0?Nu:function(e){var n,r,t;return e===void 0?"Undefined":e===null?"Null":typeof(r=U0(n=L0(e),N0))=="string"?r:x0?Nu(n):(t=Nu(n))=="Object"&&A0(n.callee)?"Arguments":t},j0=Le,D0=Ne,nm=ft,F0=Kn,B0=kr,q0=fo,am=function(){},W0=[],im=B0("Reflect","construct"),Df=/^\s*(?:class|function)\b/,G0=j0(Df.exec),H0=!Df.exec(am),zi=function(n){if(!nm(n))return!1;try{return im(am,W0,n),!0}catch{return!1}},sm=function(n){if(!nm(n))return!1;switch(F0(n)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return H0||!!G0(Df,q0(n))}catch{return!0}};sm.sham=!0;var yo=!im||D0(function(){var e;return zi(zi.call)||!zi(Object)||!zi(function(){e=!0})||e})?sm:zi,z0=yo,V0=Oa,K0=TypeError,Ff=function(e){if(z0(e))return e;throw K0(V0(e)+" is not a constructor")},Bf={},Y0=Jg,J0=Uf,Ls=Object.keys||function(n){return Y0(n,J0)},Q0=mt,X0=zg,Z0=Tt,eT=It,tT=sr,rT=Ls;Bf.f=Q0&&!X0?Object.defineProperties:function(n,r){eT(n);for(var t=tT(r),a=rT(r),i=a.length,s=0,l;i>s;)Z0.f(n,l=a[s++],t[l]);return n};var nT=kr,um=nT("document","documentElement"),aT=It,iT=Bf,Dp=Uf,sT=As,uT=um,oT=lo,cT=po,Fp=">",Bp="<",Nl="prototype",Ll="script",om=cT("IE_PROTO"),lc=function(){},cm=function(e){return Bp+Ll+Fp+e+Bp+"/"+Ll+Fp},qp=function(e){e.write(cm("")),e.close();var n=e.parentWindow.Object;return e=null,n},lT=function(){var e=oT("iframe"),n="java"+Ll+":",r;return e.style.display="none",uT.appendChild(e),e.src=String(n),r=e.contentWindow.document,r.open(),r.write(cm("document.F=Object")),r.close(),r.F},uu,Lu=function(){try{uu=new ActiveXObject("htmlfile")}catch{}Lu=typeof document!="undefined"?document.domain&&uu?qp(uu):lT():qp(uu);for(var e=Dp.length;e--;)delete Lu[Nl][Dp[e]];return Lu()};sT[om]=!0;var Yn=Object.create||function(n,r){var t;return n!==null?(lc[Nl]=aT(n),t=new lc,lc[Nl]=null,t[om]=n):t=Lu(),r===void 0?t:iT.f(t,r)},fT=We,dT=kr,fc=Vn,pT=E0,Wp=Ff,vT=It,Gp=_t,hT=Yn,lm=Ne,qf=dT("Reflect","construct"),yT=Object.prototype,gT=[].push,fm=lm(function(){function e(){}return!(qf(function(){},[],e)instanceof e)}),dm=!lm(function(){qf(function(){})}),Hp=fm||dm;fT({target:"Reflect",stat:!0,forced:Hp,sham:Hp},{construct:function(n,r){Wp(n),vT(r);var t=arguments.length<3?n:Wp(arguments[2]);if(dm&&!fm)return qf(n,r,t);if(n==t){switch(r.length){case 0:return new n;case 1:return new n(r[0]);case 2:return new n(r[0],r[1]);case 3:return new n(r[0],r[1],r[2]);case 4:return new n(r[0],r[1],r[2],r[3])}var a=[null];return fc(gT,a,r),new(fc(pT,n,a))}var i=t.prototype,s=hT(Gp(i)?i:yT),l=fc(n,s,r);return Gp(l)?l:s}});var mT=We,bT=Dt,pm=Ls,wT=Ne,ST=wT(function(){pm(1)});mT({target:"Object",stat:!0,forced:ST},{keys:function(n){return pm(bT(n))}});var $T=Kn,_T=String,Lt=function(e){if($T(e)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return _T(e)},Wf={},kT=Os,TT=Tt,IT=Ra,Ii=function(e,n,r){var t=kT(n);t in e?TT.f(e,t,IT(0,r)):e[t]=r},zp=Ma,RT=Bt,ET=Ii,CT=Array,OT=Math.max,xs=function(e,n,r){for(var t=RT(e),a=zp(n,t),i=zp(r===void 0?t:r,t),s=CT(OT(i-a,0)),l=0;a<i;a++,l++)ET(s,l,e[a]);return s.length=l,s},PT=Hn,AT=sr,vm=zn.f,MT=xs,hm=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],NT=function(e){try{return vm(e)}catch{return MT(hm)}};Wf.f=function(n){return hm&&PT(n)=="Window"?NT(n):vm(AT(n))};var Gf={},LT=st;Gf.f=LT;var xT=He,UT=xT,Vp=UT,jT=St,DT=Gf,FT=Tt.f,ym=function(e){var n=Vp.Symbol||(Vp.Symbol={});jT(n,e)||FT(n,e,{value:DT.f(e)})},BT=lt,qT=kr,WT=st,GT=Ft,HT=function(){var e=qT("Symbol"),n=e&&e.prototype,r=n&&n.valueOf,t=WT("toPrimitive");n&&!n[t]&&GT(n,t,function(a){return BT(r,this)},{arity:1})},zT=Tt.f,VT=St,KT=st,Kp=KT("toStringTag"),Jn=function(e,n,r){e&&!r&&(e=e.prototype),e&&!VT(e,Kp)&&zT(e,Kp,{configurable:!0,value:n})},Yp=Le,YT=Dr,JT=Is,QT=Yp(Yp.bind),yn=function(e,n){return YT(e),n===void 0?e:JT?QT(e,n):function(){return e.apply(n,arguments)}},XT=Hn,go=Array.isArray||function(n){return XT(n)=="Array"},Jp=go,ZT=yo,eI=_t,tI=st,rI=tI("species"),Qp=Array,nI=function(e){var n;return Jp(e)&&(n=e.constructor,ZT(n)&&(n===Qp||Jp(n.prototype))?n=void 0:eI(n)&&(n=n[rI],n===null&&(n=void 0))),n===void 0?Qp:n},aI=nI,Hf=function(e,n){return new(aI(e))(n===0?0:n)},iI=yn,sI=Le,uI=Es,oI=Dt,cI=Bt,lI=Hf,Xp=sI([].push),Cn=function(e){var n=e==1,r=e==2,t=e==3,a=e==4,i=e==6,s=e==7,l=e==5||i;return function(c,h,g,b){for(var $=oI(c),S=uI($),R=iI(h,g),N=cI(S),M=0,W=b||lI,z=n?W(c,N):r||s?W(c,0):void 0,me,le;N>M;M++)if((l||M in S)&&(me=S[M],le=R(me,M,$),e))if(n)z[M]=le;else if(le)switch(e){case 3:return!0;case 5:return me;case 6:return M;case 2:Xp(z,me)}else switch(e){case 4:return!1;case 7:Xp(z,me)}return i?-1:t||a?a:z}},ur={forEach:Cn(0),map:Cn(1),filter:Cn(2),some:Cn(3),every:Cn(4),find:Cn(5),findIndex:Cn(6),filterReject:Cn(7)},mo=We,zf=He,Vf=lt,fI=Le,yi=mt,gi=_i,dI=Ne,Mt=St,pI=dn,xl=It,bo=sr,Kf=Os,vI=Lt,Ul=Ra,bs=Yn,gm=Ls,hI=zn,mm=Wf,yI=Ms,bm=Vr,wm=Tt,gI=Bf,Sm=Rs,dc=Ft,Yf=Aa.exports,mI=po,$m=As,Zp=Cs,bI=st,wI=Gf,SI=ym,$I=HT,_I=Jn,_m=Tr,wo=ur.forEach,Jt=mI("hidden"),So="Symbol",ws="prototype",kI=_m.set,ev=_m.getterFor(So),_r=Object[ws],$a=zf.Symbol,us=$a&&$a[ws],TI=zf.TypeError,pc=zf.QObject,km=bm.f,Ln=wm.f,Tm=mm.f,II=Sm.f,Im=fI([].push),on=Yf("symbols"),Us=Yf("op-symbols"),RI=Yf("wks"),jl=!pc||!pc[ws]||!pc[ws].findChild,Dl=yi&&dI(function(){return bs(Ln({},"a",{get:function(){return Ln(this,"a",{value:7}).a}})).a!=7})?function(e,n,r){var t=km(_r,n);t&&delete _r[n],Ln(e,n,r),t&&e!==_r&&Ln(_r,n,t)}:Ln,vc=function(e,n){var r=on[e]=bs(us);return kI(r,{type:So,tag:e,description:n}),yi||(r.description=n),r},$o=function(n,r,t){n===_r&&$o(Us,r,t),xl(n);var a=Kf(r);return xl(t),Mt(on,a)?(t.enumerable?(Mt(n,Jt)&&n[Jt][a]&&(n[Jt][a]=!1),t=bs(t,{enumerable:Ul(0,!1)})):(Mt(n,Jt)||Ln(n,Jt,Ul(1,{})),n[Jt][a]=!0),Dl(n,a,t)):Ln(n,a,t)},Jf=function(n,r){xl(n);var t=bo(r),a=gm(t).concat(Cm(t));return wo(a,function(i){(!yi||Vf(Fl,t,i))&&$o(n,i,t[i])}),n},EI=function(n,r){return r===void 0?bs(n):Jf(bs(n),r)},Fl=function(n){var r=Kf(n),t=Vf(II,this,r);return this===_r&&Mt(on,r)&&!Mt(Us,r)?!1:t||!Mt(this,r)||!Mt(on,r)||Mt(this,Jt)&&this[Jt][r]?t:!0},Rm=function(n,r){var t=bo(n),a=Kf(r);if(!(t===_r&&Mt(on,a)&&!Mt(Us,a))){var i=km(t,a);return i&&Mt(on,a)&&!(Mt(t,Jt)&&t[Jt][a])&&(i.enumerable=!0),i}},Em=function(n){var r=Tm(bo(n)),t=[];return wo(r,function(a){!Mt(on,a)&&!Mt($m,a)&&Im(t,a)}),t},Cm=function(e){var n=e===_r,r=Tm(n?Us:bo(e)),t=[];return wo(r,function(a){Mt(on,a)&&(!n||Mt(_r,a))&&Im(t,on[a])}),t};gi||($a=function(){if(pI(us,this))throw TI("Symbol is not a constructor");var n=!arguments.length||arguments[0]===void 0?void 0:vI(arguments[0]),r=Zp(n),t=function(a){this===_r&&Vf(t,Us,a),Mt(this,Jt)&&Mt(this[Jt],r)&&(this[Jt][r]=!1),Dl(this,r,Ul(1,a))};return yi&&jl&&Dl(_r,r,{configurable:!0,set:t}),vc(r,n)},us=$a[ws],dc(us,"toString",function(){return ev(this).tag}),dc($a,"withoutSetter",function(e){return vc(Zp(e),e)}),Sm.f=Fl,wm.f=$o,gI.f=Jf,bm.f=Rm,hI.f=mm.f=Em,yI.f=Cm,wI.f=function(e){return vc(bI(e),e)},yi&&(Ln(us,"description",{configurable:!0,get:function(){return ev(this).description}}),dc(_r,"propertyIsEnumerable",Fl,{unsafe:!0})));mo({global:!0,constructor:!0,wrap:!0,forced:!gi,sham:!gi},{Symbol:$a});wo(gm(RI),function(e){SI(e)});mo({target:So,stat:!0,forced:!gi},{useSetter:function(){jl=!0},useSimple:function(){jl=!1}});mo({target:"Object",stat:!0,forced:!gi,sham:!yi},{create:EI,defineProperty:$o,defineProperties:Jf,getOwnPropertyDescriptor:Rm});mo({target:"Object",stat:!0,forced:!gi},{getOwnPropertyNames:Em});$I();_I($a,So);$m[Jt]=!0;var CI=_i,Om=CI&&!!Symbol.for&&!!Symbol.keyFor,OI=We,PI=kr,AI=St,MI=Lt,Pm=Aa.exports,NI=Om,hc=Pm("string-to-symbol-registry"),LI=Pm("symbol-to-string-registry");OI({target:"Symbol",stat:!0,forced:!NI},{for:function(e){var n=MI(e);if(AI(hc,n))return hc[n];var r=PI("Symbol")(n);return hc[n]=r,LI[r]=n,r}});var xI=We,UI=St,jI=ki,DI=Oa,FI=Aa.exports,BI=Om,tv=FI("symbol-to-string-registry");xI({target:"Symbol",stat:!0,forced:!BI},{keyFor:function(n){if(!jI(n))throw TypeError(DI(n)+" is not a symbol");if(UI(tv,n))return tv[n]}});var qI=We,Am=kr,Mm=Vn,WI=lt,js=Le,Nm=Ne,GI=go,HI=ft,zI=_t,rv=ki,Lm=Ti,VI=_i,Dn=Am("JSON","stringify"),ou=js(/./.exec),nv=js("".charAt),KI=js("".charCodeAt),YI=js("".replace),JI=js(1 .toString),QI=/[\uD800-\uDFFF]/g,av=/^[\uD800-\uDBFF]$/,iv=/^[\uDC00-\uDFFF]$/,sv=!VI||Nm(function(){var e=Am("Symbol")();return Dn([e])!="[null]"||Dn({a:e})!="{}"||Dn(Object(e))!="{}"}),uv=Nm(function(){return Dn("\uDF06\uD834")!=='"\\udf06\\ud834"'||Dn("\uDEAD")!=='"\\udead"'}),XI=function(e,n){var r=Lm(arguments),t=n;if(!(!zI(n)&&e===void 0||rv(e)))return GI(n)||(n=function(a,i){if(HI(t)&&(i=WI(t,this,a,i)),!rv(i))return i}),r[1]=n,Mm(Dn,null,r)},ZI=function(e,n,r){var t=nv(r,n-1),a=nv(r,n+1);return ou(av,e)&&!ou(iv,a)||ou(iv,e)&&!ou(av,t)?"\\u"+JI(KI(e,0),16):e};Dn&&qI({target:"JSON",stat:!0,arity:3,forced:sv||uv},{stringify:function(n,r,t){var a=Lm(arguments),i=Mm(sv?XI:Dn,null,a);return uv&&typeof i=="string"?YI(i,QI,ZI):i}});var eR=We,tR=_i,rR=Ne,xm=Ms,nR=Dt,aR=!tR||rR(function(){xm.f(1)});eR({target:"Object",stat:!0,forced:aR},{getOwnPropertySymbols:function(n){var r=xm.f;return r?r(nR(n)):[]}});var iR=Ne,sR=st,uR=Ca,oR=sR("species"),Ds=function(e){return uR>=51||!iR(function(){var n=[],r=n.constructor={};return r[oR]=function(){return{foo:1}},n[e](Boolean).foo!==1})},cR=We,lR=ur.filter,fR=Ds,dR=fR("filter");cR({target:"Array",proto:!0,forced:!dR},{filter:function(n){return lR(this,n,arguments.length>1?arguments[1]:void 0)}});var pR=We,vR=Ne,hR=sr,Um=Vr.f,jm=mt,yR=vR(function(){Um(1)}),gR=!jm||yR;pR({target:"Object",stat:!0,forced:gR,sham:!jm},{getOwnPropertyDescriptor:function(n,r){return Um(hR(n),r)}});var mR=We,bR=mt,wR=Qg,SR=sr,$R=Vr,_R=Ii;mR({target:"Object",stat:!0,sham:!bR},{getOwnPropertyDescriptors:function(n){for(var r=SR(n),t=$R.f,a=wR(r),i={},s=0,l,c;a.length>s;)c=t(r,l=a[s++]),c!==void 0&&_R(i,l,c);return i}});var Ri={exports:{}};(function(e){function n(t,a,i,s,l,c,h){try{var g=t[c](h),b=g.value}catch($){i($);return}g.done?a(b):Promise.resolve(b).then(s,l)}function r(t){return function(){var a=this,i=arguments;return new Promise(function(s,l){var c=t.apply(a,i);function h(b){n(c,s,l,h,g,"next",b)}function g(b){n(c,s,l,h,g,"throw",b)}h(void 0)})}}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports})(Ri);var Na={exports:{}};(function(e){function n(t,a){for(var i=0;i<a.length;i++){var s=a[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function r(t,a,i){return a&&n(t.prototype,a),i&&n(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports})(Na);var Qn={exports:{}};(function(e){function n(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports})(Qn);var Xn={exports:{}},_o={exports:{}};(function(e){function n(r,t){return e.exports=n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,s){return i.__proto__=s,i},e.exports.__esModule=!0,e.exports.default=e.exports,n(r,t)}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports})(_o);(function(e){var n=_o.exports;function r(t,a){if(typeof a!="function"&&a!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(a&&a.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),a&&n(t,a)}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports})(Xn);var Zn={exports:{}},ea={exports:{}};(function(e){function n(r){return e.exports=n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e.exports.__esModule=!0,e.exports.default=e.exports,n(r)}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports})(ea);(function(e){var n=ea.exports.default,r=Qn.exports;function t(a,i){if(i&&(n(i)==="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return r(a)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports})(Zn);var Yr={exports:{}};(function(e){function n(r){return e.exports=n=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},e.exports.__esModule=!0,e.exports.default=e.exports,n(r)}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports})(Yr);var ta={exports:{}};(function(e){function n(r,t,a){return t in r?Object.defineProperty(r,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):r[t]=a,r}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports})(ta);var ra={exports:{}};(function(e){function n(r,t){if(!(r instanceof t))throw new TypeError("Cannot call a class as a function")}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports})(ra);var kR=jf,TR=Kn,IR=kR?{}.toString:function(){return"[object "+TR(this)+"]"},RR=jf,ER=Ft,CR=IR;RR||ER(Object.prototype,"toString",CR,{unsafe:!0});var OR=Hn,PR=He,ko=OR(PR.process)=="process",AR=ft,MR=String,NR=TypeError,LR=function(e){if(typeof e=="object"||AR(e))return e;throw NR("Can't set "+MR(e)+" as a prototype")},xR=Le,UR=It,jR=LR,Ei=Object.setPrototypeOf||("__proto__"in{}?function(){var e=!1,n={},r;try{r=xR(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set),r(n,[]),e=n instanceof Array}catch{}return function(a,i){return UR(a),jR(i),e?r(a,i):a.__proto__=i,a}}():void 0),DR=kr,FR=Tt,BR=st,qR=mt,ov=BR("species"),To=function(e){var n=DR(e),r=FR.f;qR&&n&&!n[ov]&&r(n,ov,{configurable:!0,get:function(){return this}})},WR=dn,GR=TypeError,La=function(e,n){if(WR(n,e))return e;throw GR("Incorrect invocation")},cv=It,HR=Ff,zR=st,VR=zR("species"),Qf=function(e,n){var r=cv(e).constructor,t;return r===void 0||(t=cv(r)[VR])==null?n:HR(t)},KR=TypeError,Xf=function(e,n){if(e<n)throw KR("Not enough arguments");return e},YR=Ea,Dm=/(?:ipad|iphone|ipod).*applewebkit/i.test(YR),ir=He,JR=Vn,QR=yn,lv=ft,XR=St,ZR=Ne,fv=um,eE=Ti,dv=lo,tE=Xf,rE=Dm,nE=ko,Bl=ir.setImmediate,ql=ir.clearImmediate,aE=ir.process,yc=ir.Dispatch,iE=ir.Function,pv=ir.MessageChannel,sE=ir.String,gc=0,ds={},vv="onreadystatechange",Ss,da,mc,bc;try{Ss=ir.location}catch{}var Zf=function(e){if(XR(ds,e)){var n=ds[e];delete ds[e],n()}},wc=function(e){return function(){Zf(e)}},hv=function(e){Zf(e.data)},yv=function(e){ir.postMessage(sE(e),Ss.protocol+"//"+Ss.host)};(!Bl||!ql)&&(Bl=function(n){tE(arguments.length,1);var r=lv(n)?n:iE(n),t=eE(arguments,1);return ds[++gc]=function(){JR(r,void 0,t)},da(gc),gc},ql=function(n){delete ds[n]},nE?da=function(e){aE.nextTick(wc(e))}:yc&&yc.now?da=function(e){yc.now(wc(e))}:pv&&!rE?(mc=new pv,bc=mc.port2,mc.port1.onmessage=hv,da=QR(bc.postMessage,bc)):ir.addEventListener&&lv(ir.postMessage)&&!ir.importScripts&&Ss&&Ss.protocol!=="file:"&&!ZR(yv)?(da=yv,ir.addEventListener("message",hv,!1)):vv in dv("script")?da=function(e){fv.appendChild(dv("script"))[vv]=function(){fv.removeChild(this),Zf(e)}}:da=function(e){setTimeout(wc(e),0)});var Fm={set:Bl,clear:ql},uE=Ea,oE=He,cE=/ipad|iphone|ipod/i.test(uE)&&oE.Pebble!==void 0,lE=Ea,fE=/web0s(?!.*chrome)/i.test(lE),ka=He,gv=yn,dE=Vr.f,Sc=Fm.set,pE=Dm,vE=cE,hE=fE,$c=ko,mv=ka.MutationObserver||ka.WebKitMutationObserver,bv=ka.document,wv=ka.process,cu=ka.Promise,Sv=dE(ka,"queueMicrotask"),Bm=Sv&&Sv.value,Vi,ma,ps,ai,_c,kc,lu,$v;Bm||(Vi=function(){var e,n;for($c&&(e=wv.domain)&&e.exit();ma;){n=ma.fn,ma=ma.next;try{n()}catch(r){throw ma?ai():ps=void 0,r}}ps=void 0,e&&e.enter()},!pE&&!$c&&!hE&&mv&&bv?(_c=!0,kc=bv.createTextNode(""),new mv(Vi).observe(kc,{characterData:!0}),ai=function(){kc.data=_c=!_c}):!vE&&cu&&cu.resolve?(lu=cu.resolve(void 0),lu.constructor=cu,$v=gv(lu.then,lu),ai=function(){$v(Vi)}):$c?ai=function(){wv.nextTick(Vi)}:(Sc=gv(Sc,ka),ai=function(){Sc(Vi)}));var yE=Bm||function(e){var n={fn:e,next:void 0};ps&&(ps.next=n),ma||(ma=n,ai()),ps=n},gE=He,mE=function(e,n){var r=gE.console;r&&r.error&&(arguments.length==1?r.error(e):r.error(e,n))},ed=function(e){try{return{error:!1,value:e()}}catch(n){return{error:!0,value:n}}},qm=function(){this.head=null,this.tail=null};qm.prototype={add:function(e){var n={item:e,next:null};this.head?this.tail.next=n:this.head=n,this.tail=n},get:function(){var e=this.head;if(e)return this.head=e.next,this.tail===e&&(this.tail=null),e.item}};var bE=qm,wE=He,Io=wE.Promise,SE=typeof window=="object"&&typeof Deno!="object",$E=He,vs=Io,_E=ft,kE=ho,TE=fo,IE=st,RE=SE,_v=Ca;vs&&vs.prototype;var EE=IE("species"),Wl=!1,Wm=_E($E.PromiseRejectionEvent),CE=kE("Promise",function(){var e=TE(vs),n=e!==String(vs);if(!n&&_v===66)return!0;if(_v>=51&&/native code/.test(e))return!1;var r=new vs(function(i){i(1)}),t=function(i){i(function(){},function(){})},a=r.constructor={};return a[EE]=t,Wl=r.then(function(){})instanceof t,Wl?!n&&RE&&!Wm:!0}),Fs={CONSTRUCTOR:CE,REJECTION_EVENT:Wm,SUBCLASSING:Wl},Ci={},kv=Dr,OE=function(e){var n,r;this.promise=new e(function(t,a){if(n!==void 0||r!==void 0)throw TypeError("Bad Promise constructor");n=t,r=a}),this.resolve=kv(n),this.reject=kv(r)};Ci.f=function(e){return new OE(e)};var PE=We,Gu=ko,Wn=He,mi=lt,Tv=Ft,Iv=Ei,AE=Jn,ME=To,NE=Dr,xu=ft,LE=_t,xE=La,UE=Qf,Gm=Fm.set,td=yE,jE=mE,DE=ed,FE=bE,Hm=Tr,Hu=Io,rd=Fs,zm=Ci,Ro="Promise",Vm=rd.CONSTRUCTOR,BE=rd.REJECTION_EVENT,qE=rd.SUBCLASSING,Tc=Hm.getterFor(Ro),WE=Hm.set,ii=Hu&&Hu.prototype,ba=Hu,fu=ii,Km=Wn.TypeError,Gl=Wn.document,nd=Wn.process,Hl=zm.f,GE=Hl,HE=!!(Gl&&Gl.createEvent&&Wn.dispatchEvent),Ym="unhandledrejection",zE="rejectionhandled",Rv=0,Jm=1,VE=2,ad=1,Qm=2,du,Ev,KE,Cv,Xm=function(e){var n;return LE(e)&&xu(n=e.then)?n:!1},Zm=function(e,n){var r=n.value,t=n.state==Jm,a=t?e.ok:e.fail,i=e.resolve,s=e.reject,l=e.domain,c,h,g;try{a?(t||(n.rejection===Qm&&JE(n),n.rejection=ad),a===!0?c=r:(l&&l.enter(),c=a(r),l&&(l.exit(),g=!0)),c===e.promise?s(Km("Promise-chain cycle")):(h=Xm(c))?mi(h,c,i,s):i(c)):s(r)}catch(b){l&&!g&&l.exit(),s(b)}},eb=function(e,n){e.notified||(e.notified=!0,td(function(){for(var r=e.reactions,t;t=r.get();)Zm(t,e);e.notified=!1,n&&!e.rejection&&YE(e)}))},tb=function(e,n,r){var t,a;HE?(t=Gl.createEvent("Event"),t.promise=n,t.reason=r,t.initEvent(e,!1,!0),Wn.dispatchEvent(t)):t={promise:n,reason:r},!BE&&(a=Wn["on"+e])?a(t):e===Ym&&jE("Unhandled promise rejection",r)},YE=function(e){mi(Gm,Wn,function(){var n=e.facade,r=e.value,t=Ov(e),a;if(t&&(a=DE(function(){Gu?nd.emit("unhandledRejection",r,n):tb(Ym,n,r)}),e.rejection=Gu||Ov(e)?Qm:ad,a.error))throw a.value})},Ov=function(e){return e.rejection!==ad&&!e.parent},JE=function(e){mi(Gm,Wn,function(){var n=e.facade;Gu?nd.emit("rejectionHandled",n):tb(zE,n,e.value)})},oi=function(e,n,r){return function(t){e(n,t,r)}},fi=function(e,n,r){e.done||(e.done=!0,r&&(e=r),e.value=n,e.state=VE,eb(e,!0))},zl=function(e,n,r){if(!e.done){e.done=!0,r&&(e=r);try{if(e.facade===n)throw Km("Promise can't be resolved itself");var t=Xm(n);t?td(function(){var a={done:!1};try{mi(t,n,oi(zl,a,e),oi(fi,a,e))}catch(i){fi(a,i,e)}}):(e.value=n,e.state=Jm,eb(e,!1))}catch(a){fi({done:!1},a,e)}}};if(Vm&&(ba=function(n){xE(this,fu),NE(n),mi(du,this);var r=Tc(this);try{n(oi(zl,r),oi(fi,r))}catch(t){fi(r,t)}},fu=ba.prototype,du=function(n){WE(this,{type:Ro,done:!1,notified:!1,parent:!1,reactions:new FE,rejection:!1,state:Rv,value:void 0})},du.prototype=Tv(fu,"then",function(n,r){var t=Tc(this),a=Hl(UE(this,ba));return t.parent=!0,a.ok=xu(n)?n:!0,a.fail=xu(r)&&r,a.domain=Gu?nd.domain:void 0,t.state==Rv?t.reactions.add(a):td(function(){Zm(a,t)}),a.promise}),Ev=function(){var e=new du,n=Tc(e);this.promise=e,this.resolve=oi(zl,n),this.reject=oi(fi,n)},zm.f=Hl=function(e){return e===ba||e===KE?new Ev(e):GE(e)},xu(Hu)&&ii!==Object.prototype)){Cv=ii.then,qE||Tv(ii,"then",function(n,r){var t=this;return new ba(function(a,i){mi(Cv,t,a,i)}).then(n,r)},{unsafe:!0});try{delete ii.constructor}catch{}Iv&&Iv(ii,fu)}PE({global:!0,constructor:!0,wrap:!0,forced:Vm},{Promise:ba});AE(ba,Ro,!1);ME(Ro);var Bs={},QE=st,XE=Bs,ZE=QE("iterator"),e1=Array.prototype,id=function(e){return e!==void 0&&(XE.Array===e||e1[ZE]===e)},t1=Kn,Pv=Pa,r1=Bs,n1=st,a1=n1("iterator"),qs=function(e){if(e!=null)return Pv(e,a1)||Pv(e,"@@iterator")||r1[t1(e)]},i1=lt,s1=Dr,u1=It,o1=Oa,c1=qs,l1=TypeError,Eo=function(e,n){var r=arguments.length<2?c1(e):n;if(s1(r))return u1(i1(r,e));throw l1(o1(e)+" is not iterable")},f1=lt,Av=It,d1=Pa,rb=function(e,n,r){var t,a;Av(e);try{if(t=d1(e,"return"),!t){if(n==="throw")throw r;return r}t=f1(t,e)}catch(i){a=!0,t=i}if(n==="throw")throw r;if(a)throw t;return Av(t),r},p1=yn,v1=lt,h1=It,y1=Oa,g1=id,m1=Bt,Mv=dn,b1=Eo,w1=qs,Nv=rb,S1=TypeError,Uu=function(e,n){this.stopped=e,this.result=n},Lv=Uu.prototype,Co=function(e,n,r){var t=r&&r.that,a=!!(r&&r.AS_ENTRIES),i=!!(r&&r.IS_ITERATOR),s=!!(r&&r.INTERRUPTED),l=p1(n,t),c,h,g,b,$,S,R,N=function(W){return c&&Nv(c,"normal",W),new Uu(!0,W)},M=function(W){return a?(h1(W),s?l(W[0],W[1],N):l(W[0],W[1])):s?l(W,N):l(W)};if(i)c=e;else{if(h=w1(e),!h)throw S1(y1(e)+" is not iterable");if(g1(h)){for(g=0,b=m1(e);b>g;g++)if($=M(e[g]),$&&Mv(Lv,$))return $;return new Uu(!1)}c=b1(e,h)}for(S=c.next;!(R=v1(S,c)).done;){try{$=M(R.value)}catch(W){Nv(c,"throw",W)}if(typeof $=="object"&&$&&Mv(Lv,$))return $}return new Uu(!1)},$1=st,nb=$1("iterator"),ab=!1;try{var _1=0,xv={next:function(){return{done:!!_1++}},return:function(){ab=!0}};xv[nb]=function(){return this},Array.from(xv,function(){throw 2})}catch{}var Oo=function(e,n){if(!n&&!ab)return!1;var r=!1;try{var t={};t[nb]=function(){return{next:function(){return{done:r=!0}}}},e(t)}catch{}return r},k1=Io,T1=Oo,I1=Fs.CONSTRUCTOR,ib=I1||!T1(function(e){k1.all(e).then(void 0,function(){})}),R1=We,E1=lt,C1=Dr,O1=Ci,P1=ed,A1=Co,M1=ib;R1({target:"Promise",stat:!0,forced:M1},{all:function(n){var r=this,t=O1.f(r),a=t.resolve,i=t.reject,s=P1(function(){var l=C1(r.resolve),c=[],h=0,g=1;A1(n,function(b){var $=h++,S=!1;g++,E1(l,r,b).then(function(R){S||(S=!0,c[$]=R,--g||a(c))},i)}),--g||a(c)});return s.error&&i(s.value),t.promise}});var N1=We,L1=Fs.CONSTRUCTOR,Vl=Io,x1=kr,U1=ft,j1=Ft,Uv=Vl&&Vl.prototype;N1({target:"Promise",proto:!0,forced:L1,real:!0},{catch:function(e){return this.then(void 0,e)}});if(U1(Vl)){var jv=x1("Promise").prototype.catch;Uv.catch!==jv&&j1(Uv,"catch",jv,{unsafe:!0})}var D1=We,F1=lt,B1=Dr,q1=Ci,W1=ed,G1=Co,H1=ib;D1({target:"Promise",stat:!0,forced:H1},{race:function(n){var r=this,t=q1.f(r),a=t.reject,i=W1(function(){var s=B1(r.resolve);G1(n,function(l){F1(s,r,l).then(t.resolve,a)})});return i.error&&a(i.value),t.promise}});var z1=We,V1=lt,K1=Ci,Y1=Fs.CONSTRUCTOR;z1({target:"Promise",stat:!0,forced:Y1},{reject:function(n){var r=K1.f(this);return V1(r.reject,void 0,n),r.promise}});var J1=It,Q1=_t,X1=Ci,Z1=function(e,n){if(J1(e),Q1(n)&&n.constructor===e)return n;var r=X1.f(e),t=r.resolve;return t(n),r.promise},eC=We,tC=kr,rC=Fs.CONSTRUCTOR,nC=Z1;tC("Promise");eC({target:"Promise",stat:!0,forced:rC},{resolve:function(n){return nC(this,n)}});var sb={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},aC=lo,Ic=aC("span").classList,Dv=Ic&&Ic.constructor&&Ic.constructor.prototype,ub=Dv===Object.prototype?void 0:Dv,iC=Ne,Ws=function(e,n){var r=[][e];return!!r&&iC(function(){r.call(null,n||function(){return 1},1)})},sC=ur.forEach,uC=Ws,oC=uC("forEach"),cC=oC?[].forEach:function(n){return sC(this,n,arguments.length>1?arguments[1]:void 0)},Fv=He,Bv=sb,lC=ub,Rc=cC,fC=pn,ob=function(e){if(e&&e.forEach!==Rc)try{fC(e,"forEach",Rc)}catch{e.forEach=Rc}};for(var Ec in Bv)Bv[Ec]&&ob(Fv[Ec]&&Fv[Ec].prototype);ob(lC);var dC=ft,pC=_t,qv=Ei,sd=function(e,n,r){var t,a;return qv&&dC(t=n.constructor)&&t!==r&&pC(a=t.prototype)&&a!==r.prototype&&qv(e,a),e},vC=Le,hC=vC(1 .valueOf),yC=`	
\v\f\r \xA0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF`,gC=Le,mC=Kr,bC=Lt,wC=yC,Wv=gC("".replace),zu="["+wC+"]",SC=RegExp("^"+zu+zu+"*"),$C=RegExp(zu+zu+"*$"),Cc=function(e){return function(n){var r=bC(mC(n));return e&1&&(r=Wv(r,SC,"")),e&2&&(r=Wv(r,$C,"")),r}},_C={start:Cc(1),end:Cc(2),trim:Cc(3)},kC=mt,ud=He,cb=Le,TC=ho,IC=Ft,Gv=St,RC=sd,EC=dn,CC=ki,lb=Nf,OC=Ne,PC=zn.f,AC=Vr.f,MC=Tt.f,NC=hC,LC=_C.trim,Kl="Number",Mn=ud[Kl],Oc=Mn.prototype,xC=ud.TypeError,UC=cb("".slice),pu=cb("".charCodeAt),jC=function(e){var n=lb(e,"number");return typeof n=="bigint"?n:DC(n)},DC=function(e){var n=lb(e,"number"),r,t,a,i,s,l,c,h;if(CC(n))throw xC("Cannot convert a Symbol value to a number");if(typeof n=="string"&&n.length>2){if(n=LC(n),r=pu(n,0),r===43||r===45){if(t=pu(n,2),t===88||t===120)return NaN}else if(r===48){switch(pu(n,1)){case 66:case 98:a=2,i=49;break;case 79:case 111:a=8,i=55;break;default:return+n}for(s=UC(n,2),l=s.length,c=0;c<l;c++)if(h=pu(s,c),h<48||h>i)return NaN;return parseInt(s,a)}}return+n};if(TC(Kl,!Mn(" 0o1")||!Mn("0b1")||Mn("+0x1"))){for(var Va=function(n){var r=arguments.length<1?0:Mn(jC(n)),t=this;return EC(Oc,t)&&OC(function(){NC(t)})?RC(Object(r),t,Va):r},Hv=kC?PC(Mn):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),Pc=0,vu;Hv.length>Pc;Pc++)Gv(Mn,vu=Hv[Pc])&&!Gv(Va,vu)&&MC(Va,vu,AC(Mn,vu));Va.prototype=Oc,Oc.constructor=Va,IC(ud,Kl,Va,{constructor:!0})}var fb={exports:{}};(function(e){var n=ea.exports.default;function r(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */e.exports=r=function(){return t},e.exports.__esModule=!0,e.exports.default=e.exports;var t={},a=Object.prototype,i=a.hasOwnProperty,s=typeof Symbol=="function"?Symbol:{},l=s.iterator||"@@iterator",c=s.asyncIterator||"@@asyncIterator",h=s.toStringTag||"@@toStringTag";function g(Q,H,J){return Object.defineProperty(Q,H,{value:J,enumerable:!0,configurable:!0,writable:!0}),Q[H]}try{g({},"")}catch{g=function(J,K,he){return J[K]=he}}function b(Q,H,J,K){var he=H&&H.prototype instanceof R?H:R,E=Object.create(he.prototype),Te=new x(K||[]);return E._invoke=function(ut,ze,re){var F="suspendedStart";return function(q,I){if(F==="executing")throw new Error("Generator is already running");if(F==="completed"){if(q==="throw")throw I;return ge()}for(re.method=q,re.arg=I;;){var O=re.delegate;if(O){var pe=Pe(O,re);if(pe){if(pe===S)continue;return pe}}if(re.method==="next")re.sent=re._sent=re.arg;else if(re.method==="throw"){if(F==="suspendedStart")throw F="completed",re.arg;re.dispatchException(re.arg)}else re.method==="return"&&re.abrupt("return",re.arg);F="executing";var se=$(ut,ze,re);if(se.type==="normal"){if(F=re.done?"completed":"suspendedYield",se.arg===S)continue;return{value:se.arg,done:re.done}}se.type==="throw"&&(F="completed",re.method="throw",re.arg=se.arg)}}}(Q,J,Te),E}function $(Q,H,J){try{return{type:"normal",arg:Q.call(H,J)}}catch(K){return{type:"throw",arg:K}}}t.wrap=b;var S={};function R(){}function N(){}function M(){}var W={};g(W,l,function(){return this});var z=Object.getPrototypeOf,me=z&&z(z(ye([])));me&&me!==a&&i.call(me,l)&&(W=me);var le=M.prototype=R.prototype=Object.create(W);function De(Q){["next","throw","return"].forEach(function(H){g(Q,H,function(J){return this._invoke(H,J)})})}function $e(Q,H){function J(he,E,Te,ut){var ze=$(Q[he],Q,E);if(ze.type!=="throw"){var re=ze.arg,F=re.value;return F&&n(F)=="object"&&i.call(F,"__await")?H.resolve(F.__await).then(function(q){J("next",q,Te,ut)},function(q){J("throw",q,Te,ut)}):H.resolve(F).then(function(q){re.value=q,Te(re)},function(q){return J("throw",q,Te,ut)})}ut(ze.arg)}var K;this._invoke=function(he,E){function Te(){return new H(function(ut,ze){J(he,E,ut,ze)})}return K=K?K.then(Te,Te):Te()}}function Pe(Q,H){var J=Q.iterator[H.method];if(J===void 0){if(H.delegate=null,H.method==="throw"){if(Q.iterator.return&&(H.method="return",H.arg=void 0,Pe(Q,H),H.method==="throw"))return S;H.method="throw",H.arg=new TypeError("The iterator does not provide a 'throw' method")}return S}var K=$(J,Q.iterator,H.arg);if(K.type==="throw")return H.method="throw",H.arg=K.arg,H.delegate=null,S;var he=K.arg;return he?he.done?(H[Q.resultName]=he.value,H.next=Q.nextLoc,H.method!=="return"&&(H.method="next",H.arg=void 0),H.delegate=null,S):he:(H.method="throw",H.arg=new TypeError("iterator result is not an object"),H.delegate=null,S)}function L(Q){var H={tryLoc:Q[0]};1 in Q&&(H.catchLoc=Q[1]),2 in Q&&(H.finallyLoc=Q[2],H.afterLoc=Q[3]),this.tryEntries.push(H)}function ue(Q){var H=Q.completion||{};H.type="normal",delete H.arg,Q.completion=H}function x(Q){this.tryEntries=[{tryLoc:"root"}],Q.forEach(L,this),this.reset(!0)}function ye(Q){if(Q){var H=Q[l];if(H)return H.call(Q);if(typeof Q.next=="function")return Q;if(!isNaN(Q.length)){var J=-1,K=function he(){for(;++J<Q.length;)if(i.call(Q,J))return he.value=Q[J],he.done=!1,he;return he.value=void 0,he.done=!0,he};return K.next=K}}return{next:ge}}function ge(){return{value:void 0,done:!0}}return N.prototype=M,g(le,"constructor",M),g(M,"constructor",N),N.displayName=g(M,h,"GeneratorFunction"),t.isGeneratorFunction=function(Q){var H=typeof Q=="function"&&Q.constructor;return!!H&&(H===N||(H.displayName||H.name)==="GeneratorFunction")},t.mark=function(Q){return Object.setPrototypeOf?Object.setPrototypeOf(Q,M):(Q.__proto__=M,g(Q,h,"GeneratorFunction")),Q.prototype=Object.create(le),Q},t.awrap=function(Q){return{__await:Q}},De($e.prototype),g($e.prototype,c,function(){return this}),t.AsyncIterator=$e,t.async=function(Q,H,J,K,he){he===void 0&&(he=Promise);var E=new $e(b(Q,H,J,K),he);return t.isGeneratorFunction(H)?E:E.next().then(function(Te){return Te.done?Te.value:E.next()})},De(le),g(le,h,"Generator"),g(le,l,function(){return this}),g(le,"toString",function(){return"[object Generator]"}),t.keys=function(Q){var H=[];for(var J in Q)H.push(J);return H.reverse(),function K(){for(;H.length;){var he=H.pop();if(he in Q)return K.value=he,K.done=!1,K}return K.done=!0,K}},t.values=ye,x.prototype={constructor:x,reset:function(H){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(ue),!H)for(var J in this)J.charAt(0)==="t"&&i.call(this,J)&&!isNaN(+J.slice(1))&&(this[J]=void 0)},stop:function(){this.done=!0;var H=this.tryEntries[0].completion;if(H.type==="throw")throw H.arg;return this.rval},dispatchException:function(H){if(this.done)throw H;var J=this;function K(re,F){return Te.type="throw",Te.arg=H,J.next=re,F&&(J.method="next",J.arg=void 0),!!F}for(var he=this.tryEntries.length-1;he>=0;--he){var E=this.tryEntries[he],Te=E.completion;if(E.tryLoc==="root")return K("end");if(E.tryLoc<=this.prev){var ut=i.call(E,"catchLoc"),ze=i.call(E,"finallyLoc");if(ut&&ze){if(this.prev<E.catchLoc)return K(E.catchLoc,!0);if(this.prev<E.finallyLoc)return K(E.finallyLoc)}else if(ut){if(this.prev<E.catchLoc)return K(E.catchLoc,!0)}else{if(!ze)throw new Error("try statement without catch or finally");if(this.prev<E.finallyLoc)return K(E.finallyLoc)}}}},abrupt:function(H,J){for(var K=this.tryEntries.length-1;K>=0;--K){var he=this.tryEntries[K];if(he.tryLoc<=this.prev&&i.call(he,"finallyLoc")&&this.prev<he.finallyLoc){var E=he;break}}E&&(H==="break"||H==="continue")&&E.tryLoc<=J&&J<=E.finallyLoc&&(E=null);var Te=E?E.completion:{};return Te.type=H,Te.arg=J,E?(this.method="next",this.next=E.finallyLoc,S):this.complete(Te)},complete:function(H,J){if(H.type==="throw")throw H.arg;return H.type==="break"||H.type==="continue"?this.next=H.arg:H.type==="return"?(this.rval=this.arg=H.arg,this.method="return",this.next="end"):H.type==="normal"&&J&&(this.next=J),S},finish:function(H){for(var J=this.tryEntries.length-1;J>=0;--J){var K=this.tryEntries[J];if(K.finallyLoc===H)return this.complete(K.completion,K.afterLoc),ue(K),S}},catch:function(H){for(var J=this.tryEntries.length-1;J>=0;--J){var K=this.tryEntries[J];if(K.tryLoc===H){var he=K.completion;if(he.type==="throw"){var E=he.arg;ue(K)}return E}}throw new Error("illegal catch attempt")},delegateYield:function(H,J,K){return this.delegate={iterator:ye(H),resultName:J,nextLoc:K},this.method==="next"&&(this.arg=void 0),S}},t}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports})(fb);var ju=fb.exports(),Gs=ju;try{regeneratorRuntime=ju}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=ju:Function("r","regeneratorRuntime = r")(ju)}var FC=TypeError,BC=9007199254740991,db=function(e){if(e>BC)throw FC("Maximum allowed index exceeded");return e},qC=We,WC=Ne,GC=go,HC=_t,zC=Dt,VC=Bt,zv=db,Vv=Ii,KC=Hf,YC=Ds,JC=st,QC=Ca,pb=JC("isConcatSpreadable"),XC=QC>=51||!WC(function(){var e=[];return e[pb]=!1,e.concat()[0]!==e}),ZC=YC("concat"),eO=function(e){if(!HC(e))return!1;var n=e[pb];return n!==void 0?!!n:GC(e)},tO=!XC||!ZC;qC({target:"Array",proto:!0,arity:1,forced:tO},{concat:function(n){var r=zC(this),t=KC(r,0),a=0,i,s,l,c,h;for(i=-1,l=arguments.length;i<l;i++)if(h=i===-1?r:arguments[i],eO(h))for(c=VC(h),zv(a+c),s=0;s<c;s++,a++)s in h&&Vv(t,a,h[s]);else zv(a+1),Vv(t,a++,h);return t.length=a,t}});var rO=It,nO=rb,aO=function(e,n,r,t){try{return t?n(rO(r)[0],r[1]):n(r)}catch(a){nO(e,"throw",a)}},iO=yn,sO=lt,uO=Dt,oO=aO,cO=id,lO=yo,fO=Bt,Kv=Ii,dO=Eo,pO=qs,Yv=Array,vb=function(n){var r=uO(n),t=lO(this),a=arguments.length,i=a>1?arguments[1]:void 0,s=i!==void 0;s&&(i=iO(i,a>2?arguments[2]:void 0));var l=pO(r),c=0,h,g,b,$,S,R;if(l&&!(this===Yv&&cO(l)))for($=dO(r,l),S=$.next,g=t?new this:[];!(b=sO(S,$)).done;c++)R=s?oO($,i,[b.value,c],!0):b.value,Kv(g,c,R);else for(h=fO(r),g=t?new this(h):Yv(h);h>c;c++)R=s?i(r[c],c):r[c],Kv(g,c,R);return g.length=c,g},vO=We,hO=vb,yO=Oo,gO=!yO(function(e){Array.from(e)});vO({target:"Array",stat:!0,forced:gO},{from:hO});var od=Le,mO=vn,bO=Lt,wO=Kr,SO=od("".charAt),Jv=od("".charCodeAt),$O=od("".slice),Qv=function(e){return function(n,r){var t=bO(wO(n)),a=mO(r),i=t.length,s,l;return a<0||a>=i?e?"":void 0:(s=Jv(t,a),s<55296||s>56319||a+1===i||(l=Jv(t,a+1))<56320||l>57343?e?SO(t,a):s:e?$O(t,a,a+2):(s-55296<<10)+(l-56320)+65536)}},cd={codeAt:Qv(!1),charAt:Qv(!0)},_O=Ne,kO=!_O(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),TO=St,IO=ft,RO=Dt,EO=po,CO=kO,Xv=EO("IE_PROTO"),Yl=Object,OO=Yl.prototype,Po=CO?Yl.getPrototypeOf:function(e){var n=RO(e);if(TO(n,Xv))return n[Xv];var r=n.constructor;return IO(r)&&n instanceof r?r.prototype:n instanceof Yl?OO:null},PO=Ne,AO=ft,Zv=Po,MO=Ft,NO=st,Jl=NO("iterator"),hb=!1,Ta,Ac,Mc;[].keys&&(Mc=[].keys(),"next"in Mc?(Ac=Zv(Zv(Mc)),Ac!==Object.prototype&&(Ta=Ac)):hb=!0);var LO=Ta==null||PO(function(){var e={};return Ta[Jl].call(e)!==e});LO&&(Ta={});AO(Ta[Jl])||MO(Ta,Jl,function(){return this});var yb={IteratorPrototype:Ta,BUGGY_SAFARI_ITERATORS:hb},xO=yb.IteratorPrototype,UO=Yn,jO=Ra,DO=Jn,FO=Bs,BO=function(){return this},gb=function(e,n,r,t){var a=n+" Iterator";return e.prototype=UO(xO,{next:jO(+!t,r)}),DO(e,a,!1),FO[a]=BO,e},qO=We,WO=lt,mb=Ps,GO=ft,HO=gb,eh=Po,th=Ei,zO=Jn,VO=pn,Nc=Ft,KO=st,YO=Bs,bb=yb,JO=mb.PROPER,QO=mb.CONFIGURABLE,rh=bb.IteratorPrototype,hu=bb.BUGGY_SAFARI_ITERATORS,Ki=KO("iterator"),nh="keys",Yi="values",ah="entries",XO=function(){return this},ld=function(e,n,r,t,a,i,s){HO(r,n,t);var l=function(W){if(W===a&&$)return $;if(!hu&&W in g)return g[W];switch(W){case nh:return function(){return new r(this,W)};case Yi:return function(){return new r(this,W)};case ah:return function(){return new r(this,W)}}return function(){return new r(this)}},c=n+" Iterator",h=!1,g=e.prototype,b=g[Ki]||g["@@iterator"]||a&&g[a],$=!hu&&b||l(a),S=n=="Array"&&g.entries||b,R,N,M;if(S&&(R=eh(S.call(new e)),R!==Object.prototype&&R.next&&(eh(R)!==rh&&(th?th(R,rh):GO(R[Ki])||Nc(R,Ki,XO)),zO(R,c,!0))),JO&&a==Yi&&b&&b.name!==Yi&&(QO?VO(g,"name",Yi):(h=!0,$=function(){return WO(b,this)})),a)if(N={values:l(Yi),keys:i?$:l(nh),entries:l(ah)},s)for(M in N)(hu||h||!(M in g))&&Nc(g,M,N[M]);else qO({target:n,proto:!0,forced:hu||h},N);return g[Ki]!==$&&Nc(g,Ki,$,{name:a}),YO[n]=$,N},ZO=cd.charAt,eP=Lt,wb=Tr,tP=ld,Sb="String Iterator",rP=wb.set,nP=wb.getterFor(Sb);tP(String,"String",function(e){rP(this,{type:Sb,string:eP(e),index:0})},function(){var n=nP(this),r=n.string,t=n.index,a;return t>=r.length?{value:void 0,done:!0}:(a=ZO(r,t),n.index+=a.length,{value:a,done:!1})});var Oi={exports:{}};(function(e){(function(n,r){e.exports?e.exports=r():n.log=r()})(xr,function(){var n=function(){},r="undefined",t=typeof window!==r&&typeof window.navigator!==r&&/Trident\/|MSIE /.test(window.navigator.userAgent),a=["trace","debug","info","warn","error"];function i(N,M){var W=N[M];if(typeof W.bind=="function")return W.bind(N);try{return Function.prototype.bind.call(W,N)}catch{return function(){return Function.prototype.apply.apply(W,[N,arguments])}}}function s(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function l(N){return N==="debug"&&(N="log"),typeof console===r?!1:N==="trace"&&t?s:console[N]!==void 0?i(console,N):console.log!==void 0?i(console,"log"):n}function c(N,M){for(var W=0;W<a.length;W++){var z=a[W];this[z]=W<N?n:this.methodFactory(z,N,M)}this.log=this.debug}function h(N,M,W){return function(){typeof console!==r&&(c.call(this,M,W),this[N].apply(this,arguments))}}function g(N,M,W){return l(N)||h.apply(this,arguments)}function b(N,M,W){var z=this,me;M=M==null?"WARN":M;var le="loglevel";typeof N=="string"?le+=":"+N:typeof N=="symbol"&&(le=void 0);function De(ue){var x=(a[ue]||"silent").toUpperCase();if(!(typeof window===r||!le)){try{window.localStorage[le]=x;return}catch{}try{window.document.cookie=encodeURIComponent(le)+"="+x+";"}catch{}}}function $e(){var ue;if(!(typeof window===r||!le)){try{ue=window.localStorage[le]}catch{}if(typeof ue===r)try{var x=window.document.cookie,ye=x.indexOf(encodeURIComponent(le)+"=");ye!==-1&&(ue=/^([^;]+)/.exec(x.slice(ye))[1])}catch{}return z.levels[ue]===void 0&&(ue=void 0),ue}}function Pe(){if(!(typeof window===r||!le)){try{window.localStorage.removeItem(le);return}catch{}try{window.document.cookie=encodeURIComponent(le)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}z.name=N,z.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},z.methodFactory=W||g,z.getLevel=function(){return me},z.setLevel=function(ue,x){if(typeof ue=="string"&&z.levels[ue.toUpperCase()]!==void 0&&(ue=z.levels[ue.toUpperCase()]),typeof ue=="number"&&ue>=0&&ue<=z.levels.SILENT){if(me=ue,x!==!1&&De(ue),c.call(z,ue,N),typeof console===r&&ue<z.levels.SILENT)return"No console available for logging"}else throw"log.setLevel() called with invalid level: "+ue},z.setDefaultLevel=function(ue){M=ue,$e()||z.setLevel(ue,!1)},z.resetLevel=function(){z.setLevel(M,!1),Pe()},z.enableAll=function(ue){z.setLevel(z.levels.TRACE,ue)},z.disableAll=function(ue){z.setLevel(z.levels.SILENT,ue)};var L=$e();L==null&&(L=M),z.setLevel(L,!1)}var $=new b,S={};$.getLogger=function(M){if(typeof M!="symbol"&&typeof M!="string"||M==="")throw new TypeError("You must supply a name when creating a logger.");var W=S[M];return W||(W=S[M]=new b(M,$.getLevel(),$.methodFactory)),W};var R=typeof window!==r?window.log:void 0;return $.noConflict=function(){return typeof window!==r&&window.log===$&&(window.log=R),$},$.getLoggers=function(){return S},$.default=$,$})})(Oi);const _a="\\d+(?:[\\.,]\\d+)?",aP=`(${_a}W)`,iP=`(${_a}Y)?(${_a}M)?(${_a}D)?`,sP=`T(${_a}H)?(${_a}M)?(${_a}S)?`,uP=`P(?:${aP}|${iP}(?:${sP})?)`,oP=["weeks","years","months","days","hours","minutes","seconds"],fd=new RegExp(uP),$b=e=>e.match(fd).slice(1).reduce((n,r,t)=>(n[oP[t]]=parseFloat(r)||0,n),{}),dd=(e,n)=>{const r=n?n.getTime():Date.now(),t=new Date(r);return t.setFullYear(t.getFullYear()+e.years),t.setMonth(t.getMonth()+e.months),t.setDate(t.getDate()+e.days),t.setHours(t.getHours()+e.hours),t.setMinutes(t.getMinutes()+e.minutes),t.setMilliseconds(t.getMilliseconds()+e.seconds*1e3),t.setDate(t.getDate()+e.weeks*7),t},_b=(e,n)=>{const r=n?n.getTime():Date.now(),t=new Date(r);return(dd(e,t).getTime()-t.getTime())/1e3};var cP={end:dd,toSeconds:_b,pattern:fd,parse:$b},lP=Object.freeze(Object.defineProperty({__proto__:null,pattern:fd,parse:$b,end:dd,toSeconds:_b,default:cP},Symbol.toStringTag,{value:"Module"})),fP=h$(lP),dP=We,pP=ur.map,vP=Ds,hP=vP("map");dP({target:"Array",proto:!0,forced:!hP},{map:function(n){return pP(this,n,arguments.length>1?arguments[1]:void 0)}});var yP=st,gP=Yn,mP=Tt.f,Ql=yP("unscopables"),Xl=Array.prototype;Xl[Ql]==null&&mP(Xl,Ql,{configurable:!0,value:gP(null)});var pd=function(e){Xl[Ql][e]=!0},bP=sr,vd=pd,ih=Bs,kb=Tr,wP=Tt.f,SP=ld,$P=mt,Tb="Array Iterator",_P=kb.set,kP=kb.getterFor(Tb),Ib=SP(Array,"Array",function(e,n){_P(this,{type:Tb,target:bP(e),index:0,kind:n})},function(){var e=kP(this),n=e.target,r=e.kind,t=e.index++;return!n||t>=n.length?(e.target=void 0,{value:void 0,done:!0}):r=="keys"?{value:t,done:!1}:r=="values"?{value:n[t],done:!1}:{value:[t,n[t]],done:!1}},"values"),sh=ih.Arguments=ih.Array;vd("keys");vd("values");vd("entries");if($P&&sh.name!=="values")try{wP(sh,"name",{value:"values"})}catch{}var uh=He,Rb=sb,TP=ub,os=Ib,Lc=pn,Eb=st,xc=Eb("iterator"),oh=Eb("toStringTag"),Uc=os.values,Cb=function(e,n){if(e){if(e[xc]!==Uc)try{Lc(e,xc,Uc)}catch{e[xc]=Uc}if(e[oh]||Lc(e,oh,n),Rb[n]){for(var r in os)if(e[r]!==os[r])try{Lc(e,r,os[r])}catch{e[r]=os[r]}}}};for(var jc in Rb)Cb(uh[jc]&&uh[jc].prototype,jc);Cb(TP,"DOMTokenList");var IP=It,Ob=function(){var e=IP(this),n="";return e.hasIndices&&(n+="d"),e.global&&(n+="g"),e.ignoreCase&&(n+="i"),e.multiline&&(n+="m"),e.dotAll&&(n+="s"),e.unicode&&(n+="u"),e.unicodeSets&&(n+="v"),e.sticky&&(n+="y"),n},hd=Ne,RP=He,yd=RP.RegExp,gd=hd(function(){var e=yd("a","y");return e.lastIndex=2,e.exec("abcd")!=null}),EP=gd||hd(function(){return!yd("a","y").sticky}),CP=gd||hd(function(){var e=yd("^r","gy");return e.lastIndex=2,e.exec("str")!=null}),Pb={BROKEN_CARET:CP,MISSED_STICKY:EP,UNSUPPORTED_Y:gd},OP=Ne,PP=He,AP=PP.RegExp,MP=OP(function(){var e=AP(".","s");return!(e.dotAll&&e.exec(`
`)&&e.flags==="s")}),NP=Ne,LP=He,xP=LP.RegExp,UP=NP(function(){var e=xP("(?<a>b)","g");return e.exec("b").groups.a!=="b"||"b".replace(e,"$<a>c")!=="bc"}),ci=lt,Ao=Le,jP=Lt,DP=Ob,FP=Pb,BP=Aa.exports,qP=Yn,WP=Tr.get,GP=MP,HP=UP,zP=BP("native-string-replace",String.prototype.replace),Vu=RegExp.prototype.exec,Zl=Vu,VP=Ao("".charAt),KP=Ao("".indexOf),YP=Ao("".replace),Dc=Ao("".slice),ef=function(){var e=/a/,n=/b*/g;return ci(Vu,e,"a"),ci(Vu,n,"a"),e.lastIndex!==0||n.lastIndex!==0}(),Ab=FP.BROKEN_CARET,tf=/()??/.exec("")[1]!==void 0,JP=ef||tf||Ab||GP||HP;JP&&(Zl=function(n){var r=this,t=WP(r),a=jP(n),i=t.raw,s,l,c,h,g,b,$;if(i)return i.lastIndex=r.lastIndex,s=ci(Zl,i,a),r.lastIndex=i.lastIndex,s;var S=t.groups,R=Ab&&r.sticky,N=ci(DP,r),M=r.source,W=0,z=a;if(R&&(N=YP(N,"y",""),KP(N,"g")===-1&&(N+="g"),z=Dc(a,r.lastIndex),r.lastIndex>0&&(!r.multiline||r.multiline&&VP(a,r.lastIndex-1)!==`
`)&&(M="(?: "+M+")",z=" "+z,W++),l=new RegExp("^(?:"+M+")",N)),tf&&(l=new RegExp("^"+M+"$(?!\\s)",N)),ef&&(c=r.lastIndex),h=ci(Vu,R?l:r,z),R?h?(h.input=Dc(h.input,W),h[0]=Dc(h[0],W),h.index=r.lastIndex,r.lastIndex+=h[0].length):r.lastIndex=0:ef&&h&&(r.lastIndex=r.global?h.index+h[0].length:c),tf&&h&&h.length>1&&ci(zP,h[0],l,function(){for(g=1;g<arguments.length-2;g++)arguments[g]===void 0&&(h[g]=void 0)}),h&&S)for(h.groups=b=qP(null),g=0;g<S.length;g++)$=S[g],b[$[0]]=h[$[1]];return h});var Mo=Zl,QP=We,ch=Mo;QP({target:"RegExp",proto:!0,forced:/./.exec!==ch},{exec:ch});var lh=Le,fh=Ft,XP=Mo,dh=Ne,Mb=st,ZP=pn,eA=Mb("species"),Fc=RegExp.prototype,No=function(e,n,r,t){var a=Mb(e),i=!dh(function(){var h={};return h[a]=function(){return 7},""[e](h)!=7}),s=i&&!dh(function(){var h=!1,g=/a/;return e==="split"&&(g={},g.constructor={},g.constructor[eA]=function(){return g},g.flags="",g[a]=/./[a]),g.exec=function(){return h=!0,null},g[a](""),!h});if(!i||!s||r){var l=lh(/./[a]),c=n(a,""[e],function(h,g,b,$,S){var R=lh(h),N=g.exec;return N===XP||N===Fc.exec?i&&!S?{done:!0,value:l(g,b,$)}:{done:!0,value:R(b,g,$)}:{done:!1}});fh(String.prototype,e,c[0]),fh(Fc,a,c[1])}t&&ZP(Fc[a],"sham",!0)},tA=cd.charAt,md=function(e,n,r){return n+(r?tA(e,n).length:1)},bd=Le,rA=Dt,nA=Math.floor,Bc=bd("".charAt),aA=bd("".replace),qc=bd("".slice),iA=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,sA=/\$([$&'`]|\d{1,2})/g,uA=function(e,n,r,t,a,i){var s=r+e.length,l=t.length,c=sA;return a!==void 0&&(a=rA(a),c=iA),aA(i,c,function(h,g){var b;switch(Bc(g,0)){case"$":return"$";case"&":return e;case"`":return qc(n,0,r);case"'":return qc(n,s);case"<":b=a[qc(g,1,-1)];break;default:var $=+g;if($===0)return h;if($>l){var S=nA($/10);return S===0?h:S<=l?t[S-1]===void 0?Bc(g,1):t[S-1]+Bc(g,1):h}b=t[$-1]}return b===void 0?"":b})},ph=lt,oA=It,cA=ft,lA=Hn,fA=Mo,dA=TypeError,Lo=function(e,n){var r=e.exec;if(cA(r)){var t=ph(r,e,n);return t!==null&&oA(t),t}if(lA(e)==="RegExp")return ph(fA,e,n);throw dA("RegExp#exec called on incompatible receiver")},pA=Vn,vh=lt,xo=Le,vA=No,hA=Ne,yA=It,gA=ft,mA=vn,bA=hn,Ka=Lt,wA=Kr,SA=md,$A=Pa,_A=uA,kA=Lo,TA=st,rf=TA("replace"),IA=Math.max,RA=Math.min,EA=xo([].concat),Wc=xo([].push),hh=xo("".indexOf),yh=xo("".slice),CA=function(e){return e===void 0?e:String(e)},OA=function(){return"a".replace(/./,"$0")==="$0"}(),gh=function(){return/./[rf]?/./[rf]("a","$0")==="":!1}(),PA=!hA(function(){var e=/./;return e.exec=function(){var n=[];return n.groups={a:"7"},n},"".replace(e,"$<a>")!=="7"});vA("replace",function(e,n,r){var t=gh?"$":"$0";return[function(i,s){var l=wA(this),c=i==null?void 0:$A(i,rf);return c?vh(c,i,l,s):vh(n,Ka(l),i,s)},function(a,i){var s=yA(this),l=Ka(a);if(typeof i=="string"&&hh(i,t)===-1&&hh(i,"$<")===-1){var c=r(n,s,l,i);if(c.done)return c.value}var h=gA(i);h||(i=Ka(i));var g=s.global;if(g){var b=s.unicode;s.lastIndex=0}for(var $=[];;){var S=kA(s,l);if(S===null||(Wc($,S),!g))break;var R=Ka(S[0]);R===""&&(s.lastIndex=SA(l,bA(s.lastIndex),b))}for(var N="",M=0,W=0;W<$.length;W++){S=$[W];for(var z=Ka(S[0]),me=IA(RA(mA(S.index),l.length),0),le=[],De=1;De<S.length;De++)Wc(le,CA(S[De]));var $e=S.groups;if(h){var Pe=EA([z],le,me,l);$e!==void 0&&Wc(Pe,$e);var L=Ka(pA(i,void 0,Pe))}else L=_A(z,l,me,le,$e,i);me>=M&&(N+=yh(l,M,me)+L,M=me+z.length)}return N+yh(l,M)}]},!PA||!OA||gh);var AA=We,MA=Le,NA=Es,LA=sr,xA=Ws,UA=MA([].join),jA=NA!=Object,DA=xA("join",",");AA({target:"Array",proto:!0,forced:jA||!DA},{join:function(n){return UA(LA(this),n===void 0?",":n)}});var Pt={},FA=We,mh=go,BA=yo,qA=_t,bh=Ma,WA=Bt,GA=sr,HA=Ii,zA=st,VA=Ds,KA=Ti,YA=VA("slice"),JA=zA("species"),Gc=Array,QA=Math.max;FA({target:"Array",proto:!0,forced:!YA},{slice:function(n,r){var t=GA(this),a=WA(t),i=bh(n,a),s=bh(r===void 0?a:r,a),l,c,h;if(mh(t)&&(l=t.constructor,BA(l)&&(l===Gc||mh(l.prototype))?l=void 0:qA(l)&&(l=l[JA],l===null&&(l=void 0)),l===Gc||l===void 0))return KA(t,i,s);for(c=new(l===void 0?Gc:l)(QA(s-i,0)),h=0;i<s;i++,h++)i in t&&HA(c,h,t[i]);return c.length=h,c}});var XA=We,ZA=mt,eM=He,yu=Le,tM=St,rM=ft,nM=dn,aM=Lt,iM=Tt.f,sM=Xg,rn=eM.Symbol,pa=rn&&rn.prototype;if(ZA&&rM(rn)&&(!("description"in pa)||rn().description!==void 0)){var wh={},gu=function(){var n=arguments.length<1||arguments[0]===void 0?void 0:aM(arguments[0]),r=nM(pa,this)?new rn(n):n===void 0?rn():rn(n);return n===""&&(wh[r]=!0),r};sM(gu,rn),gu.prototype=pa,pa.constructor=gu;var uM=String(rn("test"))=="Symbol(test)",oM=yu(pa.toString),cM=yu(pa.valueOf),lM=/^Symbol\((.*)\)[^)]+$/,fM=yu("".replace),dM=yu("".slice);iM(pa,"description",{configurable:!0,get:function(){var n=cM(this),r=oM(n);if(tM(wh,n))return"";var t=uM?dM(r,7,-1):fM(r,lM,"$1");return t===""?void 0:t}}),XA({global:!0,constructor:!0,forced:!0},{Symbol:gu})}var pM=ym;pM("iterator");var vM=mt,hM=Ps.EXISTS,Nb=Le,yM=Tt.f,Lb=Function.prototype,gM=Nb(Lb.toString),xb=/function\b(?:\s|\/\*[\S\s]*?\*\/|\/\/[^\n\r]*[\n\r]+)*([^\s(/]*)/,mM=Nb(xb.exec),bM="name";vM&&!hM&&yM(Lb,bM,{configurable:!0,get:function(){try{return mM(xb,gM(this))[1]}catch{return""}}});var wM=_t,SM=Math.floor,Ub=Number.isInteger||function(n){return!wM(n)&&isFinite(n)&&SM(n)===n},$M=We,_M=Ub;$M({target:"Number",stat:!0},{isInteger:_M});var Hs={exports:{}},jb={exports:{}};(function(e){function n(r){if(Array.isArray(r))return r}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports})(jb);var Db={exports:{}};(function(e){function n(r,t){var a=r==null?null:typeof Symbol!="undefined"&&r[Symbol.iterator]||r["@@iterator"];if(a!=null){var i=[],s=!0,l=!1,c,h;try{for(a=a.call(r);!(s=(c=a.next()).done)&&(i.push(c.value),!(t&&i.length===t));s=!0);}catch(g){l=!0,h=g}finally{try{!s&&a.return!=null&&a.return()}finally{if(l)throw h}}return i}}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports})(Db);var wd={exports:{}},Sd={exports:{}};(function(e){function n(r,t){(t==null||t>r.length)&&(t=r.length);for(var a=0,i=new Array(t);a<t;a++)i[a]=r[a];return i}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports})(Sd);(function(e){var n=Sd.exports;function r(t,a){if(!!t){if(typeof t=="string")return n(t,a);var i=Object.prototype.toString.call(t).slice(8,-1);if(i==="Object"&&t.constructor&&(i=t.constructor.name),i==="Map"||i==="Set")return Array.from(t);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return n(t,a)}}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports})(wd);var Fb={exports:{}};(function(e){function n(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports})(Fb);(function(e){var n=jb.exports,r=Db.exports,t=wd.exports,a=Fb.exports;function i(s,l){return n(s)||r(s,l)||t(s,l)||a()}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports})(Hs);var kM=mt,Bb=Le,TM=Ls,IM=sr,RM=Rs.f,EM=Bb(RM),CM=Bb([].push),Sh=function(e){return function(n){for(var r=IM(n),t=TM(r),a=t.length,i=0,s=[],l;a>i;)l=t[i++],(!kM||EM(r,l))&&CM(s,e?[l,r[l]]:r[l]);return s}},OM={entries:Sh(!0),values:Sh(!1)},PM=We,AM=OM.entries;PM({target:"Object",stat:!0},{entries:function(n){return AM(n)}});var zs={exports:{}},qb={exports:{}};(function(e){var n=Sd.exports;function r(t){if(Array.isArray(t))return n(t)}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports})(qb);var Wb={exports:{}};(function(e){function n(r){if(typeof Symbol!="undefined"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports})(Wb);var Gb={exports:{}};(function(e){function n(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports})(Gb);(function(e){var n=qb.exports,r=Wb.exports,t=wd.exports,a=Gb.exports;function i(s){return n(s)||r(s)||t(s)||a()}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports})(zs);var MM=We,NM=vo.includes,LM=Ne,xM=pd,UM=LM(function(){return!Array(1).includes()});MM({target:"Array",proto:!0,forced:UM},{includes:function(n){return NM(this,n,arguments.length>1?arguments[1]:void 0)}});xM("includes");/*
@license
Copyright (c) 2021 Twilio Inc.

Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.


*/Object.defineProperty(Pt,"__esModule",{value:!0});var jM=ea.exports,DM=Hs.exports,FM=zs.exports,BM=ra.exports,qM=Xn.exports,WM=Zn.exports,GM=Yr.exports;function xa(e){return e&&typeof e=="object"&&"default"in e?e:{default:e}}var di=xa(jM),Ia=xa(DM),Hc=xa(FM),HM=xa(BM),zM=xa(qM),VM=xa(WM),$h=xa(GM),na=function(){for(var n=arguments.length,r=new Array(n),t=0;t<n;t++)r[t]=arguments[t];return{checks:r}};function KM(e,n){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=YM(e))||n&&e&&typeof e.length=="number"){r&&(e=r);var t=0,a=function(){};return{s:a,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(h){throw h},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,s=!1,l;return{s:function(){r=r.call(e)},n:function(){var h=r.next();return i=h.done,h},e:function(h){s=!0,l=h},f:function(){try{!i&&r.return!=null&&r.return()}finally{if(s)throw l}}}}function YM(e,n){if(!!e){if(typeof e=="string")return _h(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return _h(e,n)}}function _h(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,t=new Array(n);r<n;r++)t[r]=e[r];return t}var Hb=function(){for(var n=arguments.length,r=new Array(n),t=0;t<n;t++)r[t]=arguments[t];return na(function(a){var i=!1,s=[],l=KM(r),c;try{for(l.s();!(c=l.n()).done;){var h=c.value;if(typeof h=="string"){i=i||di.default(a)===h,s.push("of type ".concat(h));continue}i=i||a instanceof h,s.push("an instance of ".concat(h.name))}}catch(g){l.e(g)}finally{l.f()}return[i,s]})};function JM(e,n){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=QM(e))||n&&e&&typeof e.length=="number"){r&&(e=r);var t=0,a=function(){};return{s:a,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(h){throw h},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,s=!1,l;return{s:function(){r=r.call(e)},n:function(){var h=r.next();return i=h.done,h},e:function(h){s=!0,l=h},f:function(){try{!i&&r.return!=null&&r.return()}finally{if(s)throw l}}}}function QM(e,n){if(!!e){if(typeof e=="string")return kh(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return kh(e,n)}}function kh(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,t=new Array(n);r<n;r++)t[r]=e[r];return t}var XM=function(){for(var n=arguments.length,r=new Array(n),t=0;t<n;t++)r[t]=arguments[t];return na(function(a){var i=!1,s=[],l=JM(r),c;try{for(l.s();!(c=l.n()).done;){var h=c.value;i=i||a===h,s.push(typeof h=="string"?'"'.concat(h,'"'):"".concat(h))}}catch(g){l.e(g)}finally{l.f()}return[i,s]})},ZM=na(function(e){return[typeof e=="string"&&e.length>0,"a non-empty string"]}),eN=na(function(e){return[typeof e=="number"&&Number.isInteger(e)&&e>=0,"a non-negative integer"]}),tN=na(function(e){return[di.default(e)==="object"&&e!==null&&!Array.isArray(e),"a pure object (non-null and non-array)"]});function rN(e){var n=nN();return function(){var t=$h.default(e),a;if(n){var i=$h.default(this).constructor;a=Reflect.construct(t,arguments,i)}else a=t.apply(this,arguments);return VM.default(this,a)}}function nN(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function $s(e,n){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=aN(e))||n&&e&&typeof e.length=="number"){r&&(e=r);var t=0,a=function(){};return{s:a,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(h){throw h},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,s=!1,l;return{s:function(){r=r.call(e)},n:function(){var h=r.next();return i=h.done,h},e:function(h){s=!0,l=h},f:function(){try{!i&&r.return!=null&&r.return()}finally{if(s)throw l}}}}function aN(e,n){if(!!e){if(typeof e=="string")return Th(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Th(e,n)}}function Th(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,t=new Array(n);r<n;r++)t[r]=e[r];return t}var Uo=function(n,r){if(r.length>n.length)throw new Error("Expected at most ".concat(n.length," argument(s), but got ").concat(r.length));for(;r.length<n.length;)r.push(void 0);var t=$s(r.entries()),a;try{for(t.s();!(a=t.n()).done;){var i=Ia.default(a.value,2),s=i[0],l=i[1],c=kd(n[s],l),h=Ia.default(c,4),g=h[0],b=h[1],$=h[2],S=h[3];if(!g){var R=s+1;throw new Error("Argument ".concat(R," is expected to be ").concat($).concat(S," but got ").concat(b))}}}catch(N){t.e(N)}finally{t.f()}},zb=function(n){var r,t,a=["undefined","boolean","number","bigint","string"];if(a.includes(di.default(n))&&(t=typeof n=="string"?'"'.concat(n,'"'):"".concat(n)),di.default(n)==="object"&&(n==null||(r=n.constructor)===null||r===void 0?void 0:r.name)!=="Object"){var i;t=n===null?"null":"instance of ".concat(n==null||(i=n.constructor)===null||i===void 0?void 0:i.name)}return t||(t=di.default(n)),t},iN=function(){for(var n=arguments.length,r=new Array(n),t=0;t<n;t++)r[t]=arguments[t];var a=$d(r);return function(i){return function(s){zM.default(c,s);var l=rN(c);function c(){HM.default(this,c);for(var h=arguments.length,g=new Array(h),b=0;b<h;b++)g[b]=arguments[b];return Uo(a,g),l.call.apply(l,[this].concat(g))}return c}(i)}},sN=function(){for(var n=arguments.length,r=new Array(n),t=0;t<n;t++)r[t]=arguments[t];var a=$d(r);return function(i,s,l){if(typeof l.value!="function")throw new Error("The validateTypes decorator can only be applied to methods");var c=l.value;l.value=function(){for(var h=arguments.length,g=new Array(h),b=0;b<h;b++)g[b]=arguments[b];return Uo(a,g),c.apply(this,g)}}},uN=function(){for(var n=arguments.length,r=new Array(n),t=0;t<n;t++)r[t]=arguments[t];var a=$d(r);return function(i,s,l){if(typeof l.value!="function")throw new Error("The validateTypesAsync decorator can only be applied to methods");var c=l.value;l.value=function(){for(var h=arguments.length,g=new Array(h),b=0;b<h;b++)g[b]=arguments[b];try{Uo(a,g)}catch($){return Promise.reject($)}return c.apply(this,g)}}},$d=function(n){var r=[],t=$s(n),a;try{for(t.s();!(a=t.n()).done;){var i=a.value;r.push(_d(i))}}catch(s){t.e(s)}finally{t.f()}return r},_d=function(n){var r=[],t=Array.isArray(n)?n:[n],a=$s(t),i;try{for(a.s();!(i=a.n()).done;){var s=i.value;if(typeof s=="string"||typeof s=="function"){r.push(Hb(s));continue}r.push(s)}}catch(l){a.e(l)}finally{a.f()}return r},kd=function(n,r){var t=[],a,i=!1,s=$s(n),l;try{for(s.s();!(l=s.n()).done;){var c=l.value,h=$s(c.checks),g;try{for(h.s();!(g=h.n()).done;){var b=g.value,$=b(r),S=Ia.default($,3),R=S[0],N=S[1],M=S[2];i=i||R,!a&&M&&(a=M),N&&(t=typeof N=="string"?[].concat(Hc.default(t),[N]):[].concat(Hc.default(t),Hc.default(N)))}}catch(le){h.e(le)}finally{h.f()}}}catch(le){s.e(le)}finally{s.f()}if(i)return[!0];var W=a||zb(r),z=t.length-1,me=z>0?"".concat(t.slice(0,z).join(", ")," or ").concat(t[z]):t.join(", ");return[!1,W,me,z>1?";":","]},oN=function(n,r){return na(function(t){if(di.default(t)!=="object"||t===null||Array.isArray(t))return[!1,"valid ".concat(n," (should be a pure object)")];for(var a=0,i=Object.entries(r);a<i.length;a++){var s=Ia.default(i[a],2),l=s[0],c=s[1],h=kd(_d(c),t[l]),g=Ia.default(h,3),b=g[0],$=g[1],S=g[2];if(!b)return[!1,"valid ".concat(n,' (key "').concat(l,'" should be ').concat(S,")"),"malformed ".concat(n,' (key "').concat(l,'" is ').concat($,")")]}return[!0]})};function cN(e,n){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=lN(e))||n&&e&&typeof e.length=="number"){r&&(e=r);var t=0,a=function(){};return{s:a,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(h){throw h},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,s=!1,l;return{s:function(){r=r.call(e)},n:function(){var h=r.next();return i=h.done,h},e:function(h){s=!0,l=h},f:function(){try{!i&&r.return!=null&&r.return()}finally{if(s)throw l}}}}function lN(e,n){if(!!e){if(typeof e=="string")return Ih(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ih(e,n)}}function Ih(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,t=new Array(n);r<n;r++)t[r]=e[r];return t}var fN=function(n,r){return na(function(t){if(!Array.isArray(t))return[!1,"an array of ".concat(n)];var a=cN(t.entries()),i;try{for(a.s();!(i=a.n()).done;){var s=Ia.default(i.value,2),l=s[0],c=s[1],h=kd(_d(r),c),g=Ia.default(h,3),b=g[0],$=g[1],S=g[2];if(!b)return[!1,"a valid array of ".concat(n," (index ").concat(l," should be ").concat(S,")"),"malformed array of ".concat(n," (index ").concat(l," is ").concat($,")")]}}catch(R){a.e(R)}finally{a.f()}return[!0]})};Pt.array=fN;Pt.custom=na;Pt.literal=XM;Pt.nonEmptyString=ZM;Pt.nonNegativeInteger=eN;Pt.objectSchema=oN;Pt.pureObject=tN;Pt.runtimeTypeValidation=Uo;Pt.stringifyReceivedType=zb;Pt.type=Hb;Pt.validateConstructorTypes=iN;Pt.validateTypes=sN;Pt.validateTypesAsync=uN;var Td={},jo={exports:{}},Vb={exports:{}};(function(e){var n=Yr.exports;function r(t,a){for(;!Object.prototype.hasOwnProperty.call(t,a)&&(t=n(t),t!==null););return t}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports})(Vb);(function(e){var n=Vb.exports;function r(){return typeof Reflect!="undefined"&&Reflect.get?(e.exports=r=Reflect.get.bind(),e.exports.__esModule=!0,e.exports.default=e.exports):(e.exports=r=function(a,i,s){var l=n(a,i);if(!!l){var c=Object.getOwnPropertyDescriptor(l,i);return c.get?c.get.call(arguments.length<3?a:s):c.value}},e.exports.__esModule=!0,e.exports.default=e.exports),r.apply(this,arguments)}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports})(jo);/*
@license
Copyright (c) 2021 Twilio Inc.

Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

*/Object.defineProperty(Td,"__esModule",{value:!0});var dN=zs.exports,pN=ra.exports,vN=Na.exports,hN=Qn.exports,yN=jo.exports,gN=Xn.exports,mN=Zn.exports,bN=Yr.exports,wN=ta.exports;function gn(e){return e&&typeof e=="object"&&"default"in e?e:{default:e}}var SN=gn(dN),$N=gn(pN),_N=gn(vN),kN=gn(hN),Ya=gn(yN),TN=gn(gN),IN=gn(mN),Nn=gn(bN),RN=gn(wN),EN;function Fn(){}Fn.prototype=Object.create(null);function ct(){ct.init.call(this)}ct.EventEmitter=ct;ct.usingDomains=!1;ct.prototype.domain=void 0;ct.prototype._events=void 0;ct.prototype._maxListeners=void 0;ct.defaultMaxListeners=10;ct.init=function(){this.domain=null,ct.usingDomains&&EN.active,(!this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=new Fn,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};ct.prototype.setMaxListeners=function(n){if(typeof n!="number"||n<0||isNaN(n))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=n,this};function Kb(e){return e._maxListeners===void 0?ct.defaultMaxListeners:e._maxListeners}ct.prototype.getMaxListeners=function(){return Kb(this)};function CN(e,n,r){if(n)e.call(r);else for(var t=e.length,a=Vs(e,t),i=0;i<t;++i)a[i].call(r)}function ON(e,n,r,t){if(n)e.call(r,t);else for(var a=e.length,i=Vs(e,a),s=0;s<a;++s)i[s].call(r,t)}function PN(e,n,r,t,a){if(n)e.call(r,t,a);else for(var i=e.length,s=Vs(e,i),l=0;l<i;++l)s[l].call(r,t,a)}function AN(e,n,r,t,a,i){if(n)e.call(r,t,a,i);else for(var s=e.length,l=Vs(e,s),c=0;c<s;++c)l[c].call(r,t,a,i)}function MN(e,n,r,t){if(n)e.apply(r,t);else for(var a=e.length,i=Vs(e,a),s=0;s<a;++s)i[s].apply(r,t)}ct.prototype.emit=function(n){var r,t,a,i,s,l,c,h=n==="error";if(l=this._events,l)h=h&&l.error==null;else if(!h)return!1;if(c=this.domain,h){if(r=arguments[1],c)r||(r=new Error('Uncaught, unspecified "error" event')),r.domainEmitter=this,r.domain=c,r.domainThrown=!1,c.emit("error",r);else{if(r instanceof Error)throw r;var g=new Error('Uncaught, unspecified "error" event. ('+r+")");throw g.context=r,g}return!1}if(t=l[n],!t)return!1;var b=typeof t=="function";switch(a=arguments.length,a){case 1:CN(t,b,this);break;case 2:ON(t,b,this,arguments[1]);break;case 3:PN(t,b,this,arguments[1],arguments[2]);break;case 4:AN(t,b,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(a-1),s=1;s<a;s++)i[s-1]=arguments[s];MN(t,b,this,i)}return!0};function Yb(e,n,r,t){var a,i,s;if(typeof r!="function")throw new TypeError('"listener" argument must be a function');if(i=e._events,i?(i.newListener&&(e.emit("newListener",n,r.listener?r.listener:r),i=e._events),s=i[n]):(i=e._events=new Fn,e._eventsCount=0),!s)s=i[n]=r,++e._eventsCount;else if(typeof s=="function"?s=i[n]=t?[r,s]:[s,r]:t?s.unshift(r):s.push(r),!s.warned&&(a=Kb(e),a&&a>0&&s.length>a)){s.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+n+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=e,l.type=n,l.count=s.length,NN(l)}return e}function NN(e){typeof console.warn=="function"?console.warn(e):console.log(e)}ct.prototype.addListener=function(n,r){return Yb(this,n,r,!1)};ct.prototype.on=ct.prototype.addListener;ct.prototype.prependListener=function(n,r){return Yb(this,n,r,!0)};function Jb(e,n,r){var t=!1;function a(){e.removeListener(n,a),t||(t=!0,r.apply(e,arguments))}return a.listener=r,a}ct.prototype.once=function(n,r){if(typeof r!="function")throw new TypeError('"listener" argument must be a function');return this.on(n,Jb(this,n,r)),this};ct.prototype.prependOnceListener=function(n,r){if(typeof r!="function")throw new TypeError('"listener" argument must be a function');return this.prependListener(n,Jb(this,n,r)),this};ct.prototype.removeListener=function(n,r){var t,a,i,s,l;if(typeof r!="function")throw new TypeError('"listener" argument must be a function');if(a=this._events,!a)return this;if(t=a[n],!t)return this;if(t===r||t.listener&&t.listener===r)--this._eventsCount===0?this._events=new Fn:(delete a[n],a.removeListener&&this.emit("removeListener",n,t.listener||r));else if(typeof t!="function"){for(i=-1,s=t.length;s-- >0;)if(t[s]===r||t[s].listener&&t[s].listener===r){l=t[s].listener,i=s;break}if(i<0)return this;if(t.length===1){if(t[0]=void 0,--this._eventsCount===0)return this._events=new Fn,this;delete a[n]}else LN(t,i);a.removeListener&&this.emit("removeListener",n,l||r)}return this};ct.prototype.off=function(e,n){return this.removeListener(e,n)};ct.prototype.removeAllListeners=function(n){var r,t;if(t=this._events,!t)return this;if(!t.removeListener)return arguments.length===0?(this._events=new Fn,this._eventsCount=0):t[n]&&(--this._eventsCount===0?this._events=new Fn:delete t[n]),this;if(arguments.length===0){for(var a=Object.keys(t),i=0,s;i<a.length;++i)s=a[i],s!=="removeListener"&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=new Fn,this._eventsCount=0,this}if(r=t[n],typeof r=="function")this.removeListener(n,r);else if(r)do this.removeListener(n,r[r.length-1]);while(r[0]);return this};ct.prototype.listeners=function(n){var r,t,a=this._events;return a?(r=a[n],r?typeof r=="function"?t=[r.listener||r]:t=xN(r):t=[]):t=[],t};ct.listenerCount=function(e,n){return typeof e.listenerCount=="function"?e.listenerCount(n):Qb.call(e,n)};ct.prototype.listenerCount=Qb;function Qb(e){var n=this._events;if(n){var r=n[e];if(typeof r=="function")return 1;if(r)return r.length}return 0}ct.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};function LN(e,n){for(var r=n,t=r+1,a=e.length;t<a;r+=1,t+=1)e[r]=e[t];e.pop()}function Vs(e,n){for(var r=new Array(n);n--;)r[n]=e[n];return r}function xN(e){for(var n=new Array(e.length),r=0;r<n.length;++r)n[r]=e[r].listener||e[r];return n}function UN(e){var n=jN();return function(){var t=Nn.default(e),a;if(n){var i=Nn.default(this).constructor;a=Reflect.construct(t,arguments,i)}else a=t.apply(this,arguments);return IN.default(this,a)}}function jN(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var DN=function(e){TN.default(r,e);var n=UN(r);function r(){var t;return $N.default(this,r),t=n.call(this),RN.default(kN.default(t),"eventHistory",new Map),t}return _N.default(r,[{key:"on",value:function(a,i){return Ya.default(Nn.default(r.prototype),"on",this).call(this,a,i)}},{key:"once",value:function(a,i){return Ya.default(Nn.default(r.prototype),"once",this).call(this,a,i)}},{key:"off",value:function(a,i){return Ya.default(Nn.default(r.prototype),"off",this).call(this,a,i)}},{key:"emit",value:function(a){for(var i,s=arguments.length,l=new Array(s>1?s-1:0),c=1;c<s;c++)l[c-1]=arguments[c];return this.eventHistory.set(a,l),(i=Ya.default(Nn.default(r.prototype),"emit",this)).call.apply(i,[this,a].concat(l))}},{key:"addListener",value:function(a,i){return Ya.default(Nn.default(r.prototype),"addListener",this).call(this,a,i)}},{key:"removeListener",value:function(a,i){return Ya.default(Nn.default(r.prototype),"removeListener",this).call(this,a,i)}},{key:"addListenerWithReplay",value:function(a,i){var s=this.eventHistory.get(a);return s!==void 0&&i.apply(void 0,SN.default(s)),this.addListener(a,i)}},{key:"onWithReplay",value:function(a,i){return this.addListenerWithReplay(a,i)}}]),r}(ct);Td.ReplayEventEmitter=DN;var nf={exports:{}};(function(e,n){var r=200,t="__lodash_hash_undefined__",a=1,i=2,s=9007199254740991,l="[object Arguments]",c="[object Array]",h="[object AsyncFunction]",g="[object Boolean]",b="[object Date]",$="[object Error]",S="[object Function]",R="[object GeneratorFunction]",N="[object Map]",M="[object Number]",W="[object Null]",z="[object Object]",me="[object Promise]",le="[object Proxy]",De="[object RegExp]",$e="[object Set]",Pe="[object String]",L="[object Symbol]",ue="[object Undefined]",x="[object WeakMap]",ye="[object ArrayBuffer]",ge="[object DataView]",Q="[object Float32Array]",H="[object Float64Array]",J="[object Int8Array]",K="[object Int16Array]",he="[object Int32Array]",E="[object Uint8Array]",Te="[object Uint8ClampedArray]",ut="[object Uint16Array]",ze="[object Uint32Array]",re=/[\\^$.*+?()[\]{}|]/g,F=/^\[object .+?Constructor\]$/,q=/^(?:0|[1-9]\d*)$/,I={};I[Q]=I[H]=I[J]=I[K]=I[he]=I[E]=I[Te]=I[ut]=I[ze]=!0,I[l]=I[c]=I[ye]=I[g]=I[ge]=I[b]=I[$]=I[S]=I[N]=I[M]=I[z]=I[De]=I[$e]=I[Pe]=I[x]=!1;var O=typeof xr=="object"&&xr&&xr.Object===Object&&xr,pe=typeof self=="object"&&self&&self.Object===Object&&self,se=O||pe||Function("return this")(),_e=n&&!n.nodeType&&n,Ge=_e&&!0&&e&&!e.nodeType&&e,fe=Ge&&Ge.exports===_e,Ee=fe&&O.process,ke=function(){try{return Ee&&Ee.binding&&Ee.binding("util")}catch{}}(),Z=ke&&ke.isTypedArray;function Ce(k,j){for(var X=-1,we=k==null?0:k.length,gt=0,qe=[];++X<we;){var $t=k[X];j($t,X,k)&&(qe[gt++]=$t)}return qe}function Ie(k,j){for(var X=-1,we=j.length,gt=k.length;++X<we;)k[gt+X]=j[X];return k}function oe(k,j){for(var X=-1,we=k==null?0:k.length;++X<we;)if(j(k[X],X,k))return!0;return!1}function lr(k,j){for(var X=-1,we=Array(k);++X<k;)we[X]=j(X);return we}function xe(k){return function(j){return k(j)}}function Rt(k,j){return k.has(j)}function fr(k,j){return k==null?void 0:k[j]}function ve(k){var j=-1,X=Array(k.size);return k.forEach(function(we,gt){X[++j]=[gt,we]}),X}function qt(k,j){return function(X){return k(j(X))}}function xt(k){var j=-1,X=Array(k.size);return k.forEach(function(we){X[++j]=we}),X}var Je=Array.prototype,pt=Function.prototype,Ve=Object.prototype,je=se["__core-js_shared__"],vt=pt.toString,Et=Ve.hasOwnProperty,bn=function(){var k=/[^.]+$/.exec(je&&je.keys&&je.keys.IE_PROTO||"");return k?"Symbol(src)_1."+k:""}(),wn=Ve.toString,Sn=RegExp("^"+vt.call(Et).replace(re,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),$n=fe?se.Buffer:void 0,at=se.Symbol,Rr=se.Uint8Array,V=Ve.propertyIsEnumerable,Y=Je.splice,D=at?at.toStringTag:void 0,G=Object.getOwnPropertySymbols,B=$n?$n.isBuffer:void 0,te=qt(Object.keys,Object),ae=ot(se,"DataView"),de=ot(se,"Map"),Ae=ot(se,"Promise"),Fe=ot(se,"Set"),Me=ot(se,"WeakMap"),be=ot(Object,"create"),Wt=f(ae),Oe=f(de),bt=f(Ae),ht=f(Fe),_n=f(Me),Jr=at?at.prototype:void 0,Fr=Jr?Jr.valueOf:void 0;function it(k){var j=-1,X=k==null?0:k.length;for(this.clear();++j<X;){var we=k[j];this.set(we[0],we[1])}}function yt(){this.__data__=be?be(null):{},this.size=0}function er(k){var j=this.has(k)&&delete this.__data__[k];return this.size-=j?1:0,j}function Kt(k){var j=this.__data__;if(be){var X=j[k];return X===t?void 0:X}return Et.call(j,k)?j[k]:void 0}function ia(k){var j=this.__data__;return be?j[k]!==void 0:Et.call(j,k)}function Da(k,j){var X=this.__data__;return this.size+=this.has(k)?0:1,X[k]=be&&j===void 0?t:j,this}it.prototype.clear=yt,it.prototype.delete=er,it.prototype.get=Kt,it.prototype.has=ia,it.prototype.set=Da;function tr(k){var j=-1,X=k==null?0:k.length;for(this.clear();++j<X;){var we=k[j];this.set(we[0],we[1])}}function Fa(){this.__data__=[],this.size=0}function Mi(k){var j=this.__data__,X=Tn(j,k);if(X<0)return!1;var we=j.length-1;return X==we?j.pop():Y.call(j,X,1),--this.size,!0}function Ni(k){var j=this.__data__,X=Tn(j,k);return X<0?void 0:j[X][1]}function Ut(k){return Tn(this.__data__,k)>-1}function Er(k,j){var X=this.__data__,we=Tn(X,k);return we<0?(++this.size,X.push([k,j])):X[we][1]=j,this}tr.prototype.clear=Fa,tr.prototype.delete=Mi,tr.prototype.get=Ni,tr.prototype.has=Ut,tr.prototype.set=Er;function dr(k){var j=-1,X=k==null?0:k.length;for(this.clear();++j<X;){var we=k[j];this.set(we[0],we[1])}}function Ze(){this.size=0,this.__data__={hash:new it,map:new(de||tr),string:new it}}function Li(k){var j=Xr(this,k).delete(k);return this.size-=j?1:0,j}function xi(k){return Xr(this,k).get(k)}function Ui(k){return Xr(this,k).has(k)}function Ba(k,j){var X=Xr(this,k),we=X.size;return X.set(k,j),this.size+=X.size==we?0:1,this}dr.prototype.clear=Ze,dr.prototype.delete=Li,dr.prototype.get=xi,dr.prototype.has=Ui,dr.prototype.set=Ba;function Qr(k){var j=-1,X=k==null?0:k.length;for(this.__data__=new dr;++j<X;)this.add(k[j])}function ji(k){return this.__data__.set(k,t),this}function Di(k){return this.__data__.has(k)}Qr.prototype.add=Qr.prototype.push=ji,Qr.prototype.has=Di;function pr(k){var j=this.__data__=new tr(k);this.size=j.size}function Gt(){this.__data__=new tr,this.size=0}function Fi(k){var j=this.__data__,X=j.delete(k);return this.size=j.size,X}function Bi(k){return this.__data__.get(k)}function qi(k){return this.__data__.has(k)}function Wi(k,j){var X=this.__data__;if(X instanceof tr){var we=X.__data__;if(!de||we.length<r-1)return we.push([k,j]),this.size=++X.size,this;X=this.__data__=new dr(we)}return X.set(k,j),this.size=X.size,this}pr.prototype.clear=Gt,pr.prototype.delete=Fi,pr.prototype.get=Bi,pr.prototype.has=qi,pr.prototype.set=Wi;function kn(k,j){var X=d(k),we=!X&&v(k),gt=!X&&!we&&w(k),qe=!X&&!we&&!gt&&Ue(k),$t=X||we||gt||qe,At=$t?lr(k.length,String):[],Nt=At.length;for(var wt in k)(j||Et.call(k,wt))&&!($t&&(wt=="length"||gt&&(wt=="offset"||wt=="parent")||qe&&(wt=="buffer"||wt=="byteLength"||wt=="byteOffset")||_(wt,Nt)))&&At.push(wt);return At}function Tn(k,j){for(var X=k.length;X--;)if(o(k[X][0],j))return X;return-1}function In(k,j,X){var we=j(k);return d(k)?we:Ie(we,X(k))}function Cr(k){return k==null?k===void 0?ue:W:D&&D in Object(k)?vr(k):u(k)}function sa(k){return Se(k)&&Cr(k)==l}function qa(k,j,X,we,gt){return k===j?!0:k==null||j==null||!Se(k)&&!Se(j)?k!==k&&j!==j:Wa(k,j,X,we,qa,gt)}function Wa(k,j,X,we,gt,qe){var $t=d(k),At=d(j),Nt=$t?c:hr(k),wt=At?c:hr(j);Nt=Nt==l?z:Nt,wt=wt==l?z:wt;var rr=Nt==z,Or=wt==z,jt=Nt==wt;if(jt&&w(k)){if(!w(j))return!1;$t=!0,rr=!1}if(jt&&!rr)return qe||(qe=new pr),$t||Ue(k)?ua(k,j,X,we,gt,qe):Ga(k,j,Nt,X,we,gt,qe);if(!(X&a)){var yr=rr&&Et.call(k,"__wrapped__"),gr=Or&&Et.call(j,"__wrapped__");if(yr||gr){var En=yr?k.value():k,Zr=gr?j.value():j;return qe||(qe=new pr),gt(En,Zr,X,we,qe)}}return jt?(qe||(qe=new pr),Rn(k,j,X,we,gt,qe)):!1}function Gi(k){if(!ee(k)||y(k))return!1;var j=P(k)?Sn:F;return j.test(f(k))}function Hi(k){return Se(k)&&U(k.length)&&!!I[Cr(k)]}function et(k){if(!p(k))return te(k);var j=[];for(var X in Object(k))Et.call(k,X)&&X!="constructor"&&j.push(X);return j}function ua(k,j,X,we,gt,qe){var $t=X&a,At=k.length,Nt=j.length;if(At!=Nt&&!($t&&Nt>At))return!1;var wt=qe.get(k);if(wt&&qe.get(j))return wt==j;var rr=-1,Or=!0,jt=X&i?new Qr:void 0;for(qe.set(k,j),qe.set(j,k);++rr<At;){var yr=k[rr],gr=j[rr];if(we)var En=$t?we(gr,yr,rr,j,k,qe):we(yr,gr,rr,k,j,qe);if(En!==void 0){if(En)continue;Or=!1;break}if(jt){if(!oe(j,function(Zr,la){if(!Rt(jt,la)&&(yr===Zr||gt(yr,Zr,X,we,qe)))return jt.push(la)})){Or=!1;break}}else if(!(yr===gr||gt(yr,gr,X,we,qe))){Or=!1;break}}return qe.delete(k),qe.delete(j),Or}function Ga(k,j,X,we,gt,qe,$t){switch(X){case ge:if(k.byteLength!=j.byteLength||k.byteOffset!=j.byteOffset)return!1;k=k.buffer,j=j.buffer;case ye:return!(k.byteLength!=j.byteLength||!qe(new Rr(k),new Rr(j)));case g:case b:case M:return o(+k,+j);case $:return k.name==j.name&&k.message==j.message;case De:case Pe:return k==j+"";case N:var At=ve;case $e:var Nt=we&a;if(At||(At=xt),k.size!=j.size&&!Nt)return!1;var wt=$t.get(k);if(wt)return wt==j;we|=i,$t.set(k,j);var rr=ua(At(k),At(j),we,gt,qe,$t);return $t.delete(k),rr;case L:if(Fr)return Fr.call(k)==Fr.call(j)}return!1}function Rn(k,j,X,we,gt,qe){var $t=X&a,At=oa(k),Nt=At.length,wt=oa(j),rr=wt.length;if(Nt!=rr&&!$t)return!1;for(var Or=Nt;Or--;){var jt=At[Or];if(!($t?jt in j:Et.call(j,jt)))return!1}var yr=qe.get(k);if(yr&&qe.get(j))return yr==j;var gr=!0;qe.set(k,j),qe.set(j,k);for(var En=$t;++Or<Nt;){jt=At[Or];var Zr=k[jt],la=j[jt];if(we)var dp=$t?we(la,Zr,jt,j,k,qe):we(Zr,la,jt,k,j,qe);if(!(dp===void 0?Zr===la||gt(Zr,la,X,we,qe):dp)){gr=!1;break}En||(En=jt=="constructor")}if(gr&&!En){var tu=k.constructor,ru=j.constructor;tu!=ru&&"constructor"in k&&"constructor"in j&&!(typeof tu=="function"&&tu instanceof tu&&typeof ru=="function"&&ru instanceof ru)&&(gr=!1)}return qe.delete(k),qe.delete(j),gr}function oa(k){return In(k,Re,ca)}function Xr(k,j){var X=k.__data__;return T(j)?X[typeof j=="string"?"string":"hash"]:X.map}function ot(k,j){var X=fr(k,j);return Gi(X)?X:void 0}function vr(k){var j=Et.call(k,D),X=k[D];try{k[D]=void 0;var we=!0}catch{}var gt=wn.call(k);return we&&(j?k[D]=X:delete k[D]),gt}var ca=G?function(k){return k==null?[]:(k=Object(k),Ce(G(k),function(j){return V.call(k,j)}))}:Be,hr=Cr;(ae&&hr(new ae(new ArrayBuffer(1)))!=ge||de&&hr(new de)!=N||Ae&&hr(Ae.resolve())!=me||Fe&&hr(new Fe)!=$e||Me&&hr(new Me)!=x)&&(hr=function(k){var j=Cr(k),X=j==z?k.constructor:void 0,we=X?f(X):"";if(we)switch(we){case Wt:return ge;case Oe:return N;case bt:return me;case ht:return $e;case _n:return x}return j});function _(k,j){return j=j==null?s:j,!!j&&(typeof k=="number"||q.test(k))&&k>-1&&k%1==0&&k<j}function T(k){var j=typeof k;return j=="string"||j=="number"||j=="symbol"||j=="boolean"?k!=="__proto__":k===null}function y(k){return!!bn&&bn in k}function p(k){var j=k&&k.constructor,X=typeof j=="function"&&j.prototype||Ve;return k===X}function u(k){return wn.call(k)}function f(k){if(k!=null){try{return vt.call(k)}catch{}try{return k+""}catch{}}return""}function o(k,j){return k===j||k!==k&&j!==j}var v=sa(function(){return arguments}())?sa:function(k){return Se(k)&&Et.call(k,"callee")&&!V.call(k,"callee")},d=Array.isArray;function m(k){return k!=null&&U(k.length)&&!P(k)}var w=B||Yt;function C(k,j){return qa(k,j)}function P(k){if(!ee(k))return!1;var j=Cr(k);return j==S||j==R||j==h||j==le}function U(k){return typeof k=="number"&&k>-1&&k%1==0&&k<=s}function ee(k){var j=typeof k;return k!=null&&(j=="object"||j=="function")}function Se(k){return k!=null&&typeof k=="object"}var Ue=Z?xe(Z):Hi;function Re(k){return m(k)?kn(k):et(k)}function Be(){return[]}function Yt(){return!1}e.exports=C})(nf,nf.exports);var Id={exports:{}},FN=Ne,BN=FN(function(){if(typeof ArrayBuffer=="function"){var e=new ArrayBuffer(8);Object.isExtensible(e)&&Object.defineProperty(e,"a",{value:8})}}),qN=Ne,WN=_t,GN=Hn,Rh=BN,Du=Object.isExtensible,HN=qN(function(){Du(1)}),zN=HN||Rh?function(n){return!WN(n)||Rh&&GN(n)=="ArrayBuffer"?!1:Du?Du(n):!0}:Du,VN=Ne,KN=!VN(function(){return Object.isExtensible(Object.preventExtensions({}))}),YN=We,JN=Le,QN=As,XN=_t,Rd=St,ZN=Tt.f,Eh=zn,e2=Wf,Ed=zN,t2=Cs,r2=KN,Xb=!1,cn=t2("meta"),n2=0,Cd=function(e){ZN(e,cn,{value:{objectID:"O"+n2++,weakData:{}}})},a2=function(e,n){if(!XN(e))return typeof e=="symbol"?e:(typeof e=="string"?"S":"P")+e;if(!Rd(e,cn)){if(!Ed(e))return"F";if(!n)return"E";Cd(e)}return e[cn].objectID},i2=function(e,n){if(!Rd(e,cn)){if(!Ed(e))return!0;if(!n)return!1;Cd(e)}return e[cn].weakData},s2=function(e){return r2&&Xb&&Ed(e)&&!Rd(e,cn)&&Cd(e),e},u2=function(){o2.enable=function(){},Xb=!0;var e=Eh.f,n=JN([].splice),r={};r[cn]=1,e(r).length&&(Eh.f=function(t){for(var a=e(t),i=0,s=a.length;i<s;i++)if(a[i]===cn){n(a,i,1);break}return a},YN({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:e2.f}))},o2=Id.exports={enable:u2,fastKey:a2,getWeakData:i2,onFreeze:s2};QN[cn]=!0;var c2=We,l2=He,f2=Le,Ch=ho,d2=Ft,p2=Id.exports,v2=Co,h2=La,y2=ft,zc=_t,Vc=Ne,g2=Oo,m2=Jn,b2=sd,Zb=function(e,n,r){var t=e.indexOf("Map")!==-1,a=e.indexOf("Weak")!==-1,i=t?"set":"add",s=l2[e],l=s&&s.prototype,c=s,h={},g=function(W){var z=f2(l[W]);d2(l,W,W=="add"?function(le){return z(this,le===0?0:le),this}:W=="delete"?function(me){return a&&!zc(me)?!1:z(this,me===0?0:me)}:W=="get"?function(le){return a&&!zc(le)?void 0:z(this,le===0?0:le)}:W=="has"?function(le){return a&&!zc(le)?!1:z(this,le===0?0:le)}:function(le,De){return z(this,le===0?0:le,De),this})},b=Ch(e,!y2(s)||!(a||l.forEach&&!Vc(function(){new s().entries().next()})));if(b)c=r.getConstructor(n,e,t,i),p2.enable();else if(Ch(e,!0)){var $=new c,S=$[i](a?{}:-0,1)!=$,R=Vc(function(){$.has(1)}),N=g2(function(W){new s(W)}),M=!a&&Vc(function(){for(var W=new s,z=5;z--;)W[i](z,z);return!W.has(-0)});N||(c=n(function(W,z){h2(W,l);var me=b2(new s,W,c);return z!=null&&v2(z,me[i],{that:me,AS_ENTRIES:t}),me}),c.prototype=l,l.constructor=c),(R||M)&&(g("delete"),g("has"),t&&g("get")),(M||S)&&g(i),a&&l.clear&&delete l.clear}return h[e]=c,c2({global:!0,constructor:!0,forced:c!=s},h),m2(c,e),a||r.setStrong(c,e,t),c},w2=Ft,Od=function(e,n,r){for(var t in n)w2(e,t,n[t],r);return e},S2=Tt.f,$2=Yn,Oh=Od,_2=yn,k2=La,T2=Co,I2=ld,R2=To,Ji=mt,Ph=Id.exports.fastKey,ew=Tr,Ah=ew.set,Kc=ew.getterFor,tw={getConstructor:function(e,n,r,t){var a=e(function(h,g){k2(h,i),Ah(h,{type:n,index:$2(null),first:void 0,last:void 0,size:0}),Ji||(h.size=0),g!=null&&T2(g,h[t],{that:h,AS_ENTRIES:r})}),i=a.prototype,s=Kc(n),l=function(h,g,b){var $=s(h),S=c(h,g),R,N;return S?S.value=b:($.last=S={index:N=Ph(g,!0),key:g,value:b,previous:R=$.last,next:void 0,removed:!1},$.first||($.first=S),R&&(R.next=S),Ji?$.size++:h.size++,N!=="F"&&($.index[N]=S)),h},c=function(h,g){var b=s(h),$=Ph(g),S;if($!=="F")return b.index[$];for(S=b.first;S;S=S.next)if(S.key==g)return S};return Oh(i,{clear:function(){for(var g=this,b=s(g),$=b.index,S=b.first;S;)S.removed=!0,S.previous&&(S.previous=S.previous.next=void 0),delete $[S.index],S=S.next;b.first=b.last=void 0,Ji?b.size=0:g.size=0},delete:function(h){var g=this,b=s(g),$=c(g,h);if($){var S=$.next,R=$.previous;delete b.index[$.index],$.removed=!0,R&&(R.next=S),S&&(S.previous=R),b.first==$&&(b.first=S),b.last==$&&(b.last=R),Ji?b.size--:g.size--}return!!$},forEach:function(g){for(var b=s(this),$=_2(g,arguments.length>1?arguments[1]:void 0),S;S=S?S.next:b.first;)for($(S.value,S.key,this);S&&S.removed;)S=S.previous},has:function(g){return!!c(this,g)}}),Oh(i,r?{get:function(g){var b=c(this,g);return b&&b.value},set:function(g,b){return l(this,g===0?0:g,b)}}:{add:function(g){return l(this,g=g===0?0:g,g)}}),Ji&&S2(i,"size",{get:function(){return s(this).size}}),a},setStrong:function(e,n,r){var t=n+" Iterator",a=Kc(n),i=Kc(t);I2(e,n,function(s,l){Ah(this,{type:t,target:s,state:a(s),kind:l,last:void 0})},function(){for(var s=i(this),l=s.kind,c=s.last;c&&c.removed;)c=c.previous;return!s.target||!(s.last=c=c?c.next:s.state.first)?(s.target=void 0,{value:void 0,done:!0}):l=="keys"?{value:c.key,done:!1}:l=="values"?{value:c.value,done:!1}:{value:[c.key,c.value],done:!1}},r?"entries":"values",!r,!0),R2(n)}},E2=Zb,C2=tw;E2("Map",function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},C2);var mn={};/*
@license
Copyright (c) 2016, Twilio, Inc.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted, provided that the above
copyright notice and this permission notice appear in all copies.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY
SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION
OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN
CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.

*/Object.defineProperty(mn,"__esModule",{value:!0});var O2=ra.exports,P2=Na.exports,A2=Qn.exports,M2=Xn.exports,N2=Zn.exports,L2=Yr.exports,x2=ta.exports;function Ua(e){return e&&typeof e=="object"&&"default"in e?e:{default:e}}var Pd=Ua(O2),Ad=Ua(P2),an=Ua(A2),Md=Ua(M2),rw=Ua(N2),Ku=Ua(L2),sn=Ua(x2),U2;function Bn(){}Bn.prototype=Object.create(null);function rt(){rt.init.call(this)}rt.EventEmitter=rt;rt.usingDomains=!1;rt.prototype.domain=void 0;rt.prototype._events=void 0;rt.prototype._maxListeners=void 0;rt.defaultMaxListeners=10;rt.init=function(){this.domain=null,rt.usingDomains&&U2.active,(!this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=new Bn,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};rt.prototype.setMaxListeners=function(n){if(typeof n!="number"||n<0||isNaN(n))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=n,this};function nw(e){return e._maxListeners===void 0?rt.defaultMaxListeners:e._maxListeners}rt.prototype.getMaxListeners=function(){return nw(this)};function j2(e,n,r){if(n)e.call(r);else for(var t=e.length,a=Ks(e,t),i=0;i<t;++i)a[i].call(r)}function D2(e,n,r,t){if(n)e.call(r,t);else for(var a=e.length,i=Ks(e,a),s=0;s<a;++s)i[s].call(r,t)}function F2(e,n,r,t,a){if(n)e.call(r,t,a);else for(var i=e.length,s=Ks(e,i),l=0;l<i;++l)s[l].call(r,t,a)}function B2(e,n,r,t,a,i){if(n)e.call(r,t,a,i);else for(var s=e.length,l=Ks(e,s),c=0;c<s;++c)l[c].call(r,t,a,i)}function q2(e,n,r,t){if(n)e.apply(r,t);else for(var a=e.length,i=Ks(e,a),s=0;s<a;++s)i[s].apply(r,t)}rt.prototype.emit=function(n){var r,t,a,i,s,l,c,h=n==="error";if(l=this._events,l)h=h&&l.error==null;else if(!h)return!1;if(c=this.domain,h){if(r=arguments[1],c)r||(r=new Error('Uncaught, unspecified "error" event')),r.domainEmitter=this,r.domain=c,r.domainThrown=!1,c.emit("error",r);else{if(r instanceof Error)throw r;var g=new Error('Uncaught, unspecified "error" event. ('+r+")");throw g.context=r,g}return!1}if(t=l[n],!t)return!1;var b=typeof t=="function";switch(a=arguments.length,a){case 1:j2(t,b,this);break;case 2:D2(t,b,this,arguments[1]);break;case 3:F2(t,b,this,arguments[1],arguments[2]);break;case 4:B2(t,b,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(a-1),s=1;s<a;s++)i[s-1]=arguments[s];q2(t,b,this,i)}return!0};function aw(e,n,r,t){var a,i,s;if(typeof r!="function")throw new TypeError('"listener" argument must be a function');if(i=e._events,i?(i.newListener&&(e.emit("newListener",n,r.listener?r.listener:r),i=e._events),s=i[n]):(i=e._events=new Bn,e._eventsCount=0),!s)s=i[n]=r,++e._eventsCount;else if(typeof s=="function"?s=i[n]=t?[r,s]:[s,r]:t?s.unshift(r):s.push(r),!s.warned&&(a=nw(e),a&&a>0&&s.length>a)){s.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+n+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=e,l.type=n,l.count=s.length,W2(l)}return e}function W2(e){typeof console.warn=="function"?console.warn(e):console.log(e)}rt.prototype.addListener=function(n,r){return aw(this,n,r,!1)};rt.prototype.on=rt.prototype.addListener;rt.prototype.prependListener=function(n,r){return aw(this,n,r,!0)};function iw(e,n,r){var t=!1;function a(){e.removeListener(n,a),t||(t=!0,r.apply(e,arguments))}return a.listener=r,a}rt.prototype.once=function(n,r){if(typeof r!="function")throw new TypeError('"listener" argument must be a function');return this.on(n,iw(this,n,r)),this};rt.prototype.prependOnceListener=function(n,r){if(typeof r!="function")throw new TypeError('"listener" argument must be a function');return this.prependListener(n,iw(this,n,r)),this};rt.prototype.removeListener=function(n,r){var t,a,i,s,l;if(typeof r!="function")throw new TypeError('"listener" argument must be a function');if(a=this._events,!a)return this;if(t=a[n],!t)return this;if(t===r||t.listener&&t.listener===r)--this._eventsCount===0?this._events=new Bn:(delete a[n],a.removeListener&&this.emit("removeListener",n,t.listener||r));else if(typeof t!="function"){for(i=-1,s=t.length;s-- >0;)if(t[s]===r||t[s].listener&&t[s].listener===r){l=t[s].listener,i=s;break}if(i<0)return this;if(t.length===1){if(t[0]=void 0,--this._eventsCount===0)return this._events=new Bn,this;delete a[n]}else G2(t,i);a.removeListener&&this.emit("removeListener",n,l||r)}return this};rt.prototype.off=function(e,n){return this.removeListener(e,n)};rt.prototype.removeAllListeners=function(n){var r,t;if(t=this._events,!t)return this;if(!t.removeListener)return arguments.length===0?(this._events=new Bn,this._eventsCount=0):t[n]&&(--this._eventsCount===0?this._events=new Bn:delete t[n]),this;if(arguments.length===0){for(var a=Object.keys(t),i=0,s;i<a.length;++i)s=a[i],s!=="removeListener"&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=new Bn,this._eventsCount=0,this}if(r=t[n],typeof r=="function")this.removeListener(n,r);else if(r)do this.removeListener(n,r[r.length-1]);while(r[0]);return this};rt.prototype.listeners=function(n){var r,t,a=this._events;return a?(r=a[n],r?typeof r=="function"?t=[r.listener||r]:t=H2(r):t=[]):t=[],t};rt.listenerCount=function(e,n){return typeof e.listenerCount=="function"?e.listenerCount(n):sw.call(e,n)};rt.prototype.listenerCount=sw;function sw(e){var n=this._events;if(n){var r=n[e];if(typeof r=="function")return 1;if(r)return r.length}return 0}rt.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};function G2(e,n){for(var r=n,t=r+1,a=e.length;t<a;r+=1,t+=1)e[r]=e[t];e.pop()}function Ks(e,n){for(var r=new Array(n);n--;)r[n]=e[n];return r}function H2(e){for(var n=new Array(e.length),r=0;r<n.length;++r)n[r]=e[r].listener||e[r];return n}function uw(e){var n=z2();return function(){var t=Ku.default(e),a;if(n){var i=Ku.default(this).constructor;a=Reflect.construct(t,arguments,i)}else a=t.apply(this,arguments);return rw.default(this,a)}}function z2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var ow=function(e){Md.default(r,e);var n=uw(r);function r(t){var a;return Pd.default(this,r),a=n.call(this),sn.default(an.default(a),"timeout",null),sn.default(an.default(a),"startTimestamp",-1),a.minDelay=t.min,a.maxDelay=t.max,a.initialDelay=t.initial||0,a.maxAttemptsCount=t.maxAttemptsCount||0,a.maxAttemptsTime=t.maxAttemptsTime||0,a.randomness=t.randomness||0,a.inProgress=!1,a.attemptNum=0,a.prevDelay=0,a.currDelay=0,a}return Ad.default(r,[{key:"attempt",value:function(){this.timeout&&(clearTimeout(this.timeout),this.timeout=null),this.attemptNum++,this.emit("attempt",this)}},{key:"nextDelay",value:function(a){if(typeof a=="number")return this.prevDelay=0,this.currDelay=a,a;if(this.attemptNum==0)return this.initialDelay;if(this.attemptNum==1)return this.currDelay=this.minDelay,this.currDelay;this.prevDelay=this.currDelay;var i=this.currDelay+this.prevDelay;return this.maxDelay&&i>this.maxDelay&&(this.currDelay=this.maxDelay,i=this.maxDelay),this.currDelay=i,i}},{key:"randomize",value:function(a){var i=a*this.randomness,s=Math.round(Math.random()*i*2-i);return Math.max(0,a+s)}},{key:"scheduleAttempt",value:function(a){var i=this;if(this.maxAttemptsCount&&this.attemptNum>=this.maxAttemptsCount){this.cleanup(),this.emit("failed",new Error("Maximum attempt count limit reached"));return}var s=this.nextDelay(a);if(s=this.randomize(s),this.maxAttemptsTime&&this.startTimestamp+this.maxAttemptsTime<Date.now()+s){this.cleanup(),this.emit("failed",new Error("Maximum attempt time limit reached"));return}this.timeout=setTimeout(function(){return i.attempt()},s)}},{key:"cleanup",value:function(){this.timeout&&(clearTimeout(this.timeout),this.timeout=null),this.inProgress=!1,this.attemptNum=0,this.prevDelay=0,this.currDelay=0}},{key:"start",value:function(){if(this.inProgress)throw new Error("Retrier is already in progress");this.inProgress=!0,this.startTimestamp=Date.now(),this.scheduleAttempt(this.initialDelay)}},{key:"cancel",value:function(){this.timeout&&(clearTimeout(this.timeout),this.timeout=null,this.inProgress=!1,this.emit("cancelled"))}},{key:"succeeded",value:function(a){this.emit("succeeded",a)}},{key:"failed",value:function(a,i){if(this.timeout)throw new Error("Retrier attempt is already in progress");this.scheduleAttempt(i)}}]),r}(rt),V2=function(e){Md.default(r,e);var n=uw(r);function r(t){var a;return Pd.default(this,r),a=n.call(this),sn.default(an.default(a),"resolve",function(){}),sn.default(an.default(a),"reject",function(){}),a.retrier=new ow(t),a}return Ad.default(r,[{key:"run",value:function(a){var i=this;return this.retrier.on("attempt",function(){a().then(function(s){return i.retrier.succeeded(s)}).catch(function(s){return i.retrier.failed(s)})}),this.retrier.on("succeeded",function(s){return i.resolve(s)}),this.retrier.on("cancelled",function(){return i.reject(new Error("Cancelled"))}),this.retrier.on("failed",function(s){return i.reject(s)}),new Promise(function(s,l){i.resolve=s,i.reject=l,i.retrier.start()})}},{key:"cancel",value:function(){this.retrier.cancel()}}]),r}(rt);function K2(e){var n=Y2();return function(){var t=Ku.default(e),a;if(n){var i=Ku.default(this).constructor;a=Reflect.construct(t,arguments,i)}else a=t.apply(this,arguments);return rw.default(this,a)}}function Y2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function mu(e){return e!=null}var J2=function(e){Md.default(r,e);var n=K2(r);function r(t){var a;Pd.default(this,r),a=n.call(this),sn.default(an.default(a),"backoffDelay",0),sn.default(an.default(a),"nextBackoffDelay",0),sn.default(an.default(a),"backoffNumber",0),sn.default(an.default(a),"timeoutID",null),sn.default(an.default(a),"maxNumberOfRetry",-1),t=t||{};var i=t,s=i.initialDelay,l=i.maxDelay,c=i.randomisationFactor,h=i.factor;if(mu(s)&&s<1)throw new Error("The initial timeout must be equal to or greater than 1.");if(mu(l)&&l<=1)throw new Error("The maximal timeout must be greater than 1.");if(mu(c)&&(c<0||c>1))throw new Error("The randomisation factor must be between 0 and 1.");if(mu(h)&&h<=1)throw new Error("Exponential factor should be greater than 1.");if(a.initialDelay=s||100,a.maxDelay=l||1e4,a.maxDelay<=a.initialDelay)throw new Error("The maximal backoff delay must be greater than the initial backoff delay.");return a.randomisationFactor=c||0,a.factor=h||2,a.reset(),a}return Ad.default(r,[{key:"backoff",value:function(a){this.timeoutID==null&&(this.backoffNumber===this.maxNumberOfRetry?(this.emit("fail",a),this.reset()):(this.backoffDelay=this.next(),this.timeoutID=setTimeout(this.onBackoff.bind(this),this.backoffDelay),this.emit("backoff",this.backoffNumber,this.backoffDelay,a)))}},{key:"reset",value:function(){this.backoffDelay=0,this.nextBackoffDelay=this.initialDelay,this.backoffNumber=0,this.timeoutID&&clearTimeout(this.timeoutID),this.timeoutID=null}},{key:"failAfter",value:function(a){if(a<=0)throw new Error("Expected a maximum number of retry greater than 0 but got ".concat(a));this.maxNumberOfRetry=a}},{key:"next",value:function(){this.backoffDelay=Math.min(this.nextBackoffDelay,this.maxDelay),this.nextBackoffDelay=this.backoffDelay*this.factor;var a=1+Math.random()*this.randomisationFactor;return Math.min(this.maxDelay,Math.round(this.backoffDelay*a))}},{key:"onBackoff",value:function(){this.timeoutID=null,this.emit("ready",this.backoffNumber,this.backoffDelay),this.backoffNumber++}}],[{key:"exponential",value:function(a){return new r(a)}}]),r}(rt);mn.AsyncRetrier=V2;mn.Backoff=J2;mn.Retrier=ow;var Do={},Q2=lt,X2=St,Z2=dn,eL=Ob,Mh=RegExp.prototype,tL=function(e){var n=e.flags;return n===void 0&&!("flags"in Mh)&&!X2(e,"flags")&&Z2(Mh,e)?Q2(eL,e):n},rL=Ps.PROPER,nL=Ft,aL=It,Nh=Lt,iL=Ne,sL=tL,Nd="toString",uL=RegExp.prototype,cw=uL[Nd],oL=iL(function(){return cw.call({source:"a",flags:"b"})!="/a/b"}),cL=rL&&cw.name!=Nd;(oL||cL)&&nL(RegExp.prototype,Nd,function(){var n=aL(this),r=Nh(n.source),t=Nh(sL(n));return"/"+r+"/"+t},{unsafe:!0});var lL=Zb,fL=tw;lL("Set",function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},fL);var lw={exports:{}};(function(e,n){(function(t,a){e.exports=a()})(xr,function(){return function(r){var t={};function a(i){if(t[i])return t[i].exports;var s=t[i]={i,l:!1,exports:{}};return r[i].call(s.exports,s,s.exports,a),s.l=!0,s.exports}return a.m=r,a.c=t,a.i=function(i){return i},a.d=function(i,s,l){a.o(i,s)||Object.defineProperty(i,s,{configurable:!1,enumerable:!0,get:l})},a.n=function(i){var s=i&&i.__esModule?function(){return i.default}:function(){return i};return a.d(s,"a",s),s},a.o=function(i,s){return Object.prototype.hasOwnProperty.call(i,s)},a.p="",a(a.s=5)}([function(r,t,a){r.exports=function(i,s){var l,c,h;for(l=1;l<arguments.length;l++){c=arguments[l];for(h in c)c.hasOwnProperty(h)&&(i[h]=c[h])}return i}},function(r,t,a){var i=a(0);r.exports={build:function(s,l){var c,h,g,b=l.plugins;for(c=0,h=b.length;c<h;c++)g=b[c],g.methods&&i(s,g.methods),g.properties&&Object.defineProperties(s,g.properties)},hook:function(s,l,c){var h,g,b,$,S=s.config.plugins,R=[s.context];for(c&&(R=R.concat(c)),h=0,g=S.length;h<g;h++)$=S[h],b=S[h][l],b&&b.apply($,R)}}},function(r,t,a){function i(s){if(s.length===0)return s;var l,c,h=s.split(/[_-]/);if(h.length===1&&h[0][0].toLowerCase()===h[0][0])return s;for(c=h[0].toLowerCase(),l=1;l<h.length;l++)c=c+h[l].charAt(0).toUpperCase()+h[l].substring(1).toLowerCase();return c}i.prepended=function(s,l){return l=i(l),s+l[0].toUpperCase()+l.substring(1)},r.exports=i},function(r,t,a){var i=a(0),s=a(2);function l(c,h){c=c||{},this.options=c,this.defaults=h.defaults,this.states=[],this.transitions=[],this.map={},this.lifecycle=this.configureLifecycle(),this.init=this.configureInitTransition(c.init),this.data=this.configureData(c.data),this.methods=this.configureMethods(c.methods),this.map[this.defaults.wildcard]={},this.configureTransitions(c.transitions||[]),this.plugins=this.configurePlugins(c.plugins,h.plugin)}i(l.prototype,{addState:function(c){this.map[c]||(this.states.push(c),this.addStateLifecycleNames(c),this.map[c]={})},addStateLifecycleNames:function(c){this.lifecycle.onEnter[c]=s.prepended("onEnter",c),this.lifecycle.onLeave[c]=s.prepended("onLeave",c),this.lifecycle.on[c]=s.prepended("on",c)},addTransition:function(c){this.transitions.indexOf(c)<0&&(this.transitions.push(c),this.addTransitionLifecycleNames(c))},addTransitionLifecycleNames:function(c){this.lifecycle.onBefore[c]=s.prepended("onBefore",c),this.lifecycle.onAfter[c]=s.prepended("onAfter",c),this.lifecycle.on[c]=s.prepended("on",c)},mapTransition:function(c){var h=c.name,g=c.from,b=c.to;return this.addState(g),typeof b!="function"&&this.addState(b),this.addTransition(h),this.map[g][h]=c,c},configureLifecycle:function(){return{onBefore:{transition:"onBeforeTransition"},onAfter:{transition:"onAfterTransition"},onEnter:{state:"onEnterState"},onLeave:{state:"onLeaveState"},on:{transition:"onTransition"}}},configureInitTransition:function(c){return typeof c=="string"?this.mapTransition(i({},this.defaults.init,{to:c,active:!0})):typeof c=="object"?this.mapTransition(i({},this.defaults.init,c,{active:!0})):(this.addState(this.defaults.init.from),this.defaults.init)},configureData:function(c){return typeof c=="function"?c:typeof c=="object"?function(){return c}:function(){return{}}},configureMethods:function(c){return c||{}},configurePlugins:function(c,h){c=c||[];var g,b,$;for(g=0,b=c.length;g<b;g++)$=c[g],typeof $=="function"&&(c[g]=$=$()),$.configure&&$.configure(this);return c},configureTransitions:function(c){var h,g,b,$,S,R=this.defaults.wildcard;for(g=0;g<c.length;g++)for(b=c[g],$=Array.isArray(b.from)?b.from:[b.from||R],S=b.to||R,h=0;h<$.length;h++)this.mapTransition({name:b.name,from:$[h],to:S})},transitionFor:function(c,h){var g=this.defaults.wildcard;return this.map[c][h]||this.map[g][h]},transitionsFor:function(c){var h=this.defaults.wildcard;return Object.keys(this.map[c]).concat(Object.keys(this.map[h]))},allStates:function(){return this.states},allTransitions:function(){return this.transitions}}),r.exports=l},function(r,t,a){var i=a(0),s=a(6),l=a(1),c=[null,[]];function h(g,b){this.context=g,this.config=b,this.state=b.init.from,this.observers=[g]}i(h.prototype,{init:function(g){if(i(this.context,this.config.data.apply(this.context,g)),l.hook(this,"init"),this.config.init.active)return this.fire(this.config.init.name,[])},is:function(g){return Array.isArray(g)?g.indexOf(this.state)>=0:this.state===g},isPending:function(){return this.pending},can:function(g){return!this.isPending()&&!!this.seek(g)},cannot:function(g){return!this.can(g)},allStates:function(){return this.config.allStates()},allTransitions:function(){return this.config.allTransitions()},transitions:function(){return this.config.transitionsFor(this.state)},seek:function(g,b){var $=this.config.defaults.wildcard,S=this.config.transitionFor(this.state,g),R=S&&S.to;return typeof R=="function"?R.apply(this.context,b):R===$?this.state:R},fire:function(g,b){return this.transit(g,this.state,this.seek(g,b),b)},transit:function(g,b,$,S){var R=this.config.lifecycle,N=this.config.options.observeUnchangedState||b!==$;return $?this.isPending()?this.context.onPendingTransition(g,b,$):(this.config.addState($),this.beginTransit(),S.unshift({transition:g,from:b,to:$,fsm:this.context}),this.observeEvents([this.observersForEvent(R.onBefore.transition),this.observersForEvent(R.onBefore[g]),N?this.observersForEvent(R.onLeave.state):c,N?this.observersForEvent(R.onLeave[b]):c,this.observersForEvent(R.on.transition),N?["doTransit",[this]]:c,N?this.observersForEvent(R.onEnter.state):c,N?this.observersForEvent(R.onEnter[$]):c,N?this.observersForEvent(R.on[$]):c,this.observersForEvent(R.onAfter.transition),this.observersForEvent(R.onAfter[g]),this.observersForEvent(R.on[g])],S)):this.context.onInvalidTransition(g,b,$)},beginTransit:function(){this.pending=!0},endTransit:function(g){return this.pending=!1,g},failTransit:function(g){throw this.pending=!1,g},doTransit:function(g){this.state=g.to},observe:function(g){if(g.length===2){var b={};b[g[0]]=g[1],this.observers.push(b)}else this.observers.push(g[0])},observersForEvent:function(g){for(var b=0,$=this.observers.length,S,R=[];b<$;b++)S=this.observers[b],S[g]&&R.push(S);return[g,R,!0]},observeEvents:function(g,b,$,S){if(g.length===0)return this.endTransit(S===void 0?!0:S);var R=g[0][0],N=g[0][1],M=g[0][2];if(b[0].event=R,R&&M&&R!==$&&l.hook(this,"lifecycle",b),N.length===0)return g.shift(),this.observeEvents(g,b,R,S);var W=N.shift(),z=W[R].apply(W,b);return z&&typeof z.then=="function"?z.then(this.observeEvents.bind(this,g,b,R)).catch(this.failTransit.bind(this)):z===!1?this.endTransit(!1):this.observeEvents(g,b,R,z)},onInvalidTransition:function(g,b,$){throw new s("transition is invalid in current state",g,b,$,this.state)},onPendingTransition:function(g,b,$){throw new s("transition is invalid while previous transition is still in progress",g,b,$,this.state)}}),r.exports=h},function(r,t,a){var i=a(0),s=a(2),l=a(1),c=a(3),h=a(4),g={is:function(M){return this._fsm.is(M)},can:function(M){return this._fsm.can(M)},cannot:function(M){return this._fsm.cannot(M)},observe:function(){return this._fsm.observe(arguments)},transitions:function(){return this._fsm.transitions()},allTransitions:function(){return this._fsm.allTransitions()},allStates:function(){return this._fsm.allStates()},onInvalidTransition:function(M,W,z){return this._fsm.onInvalidTransition(M,W,z)},onPendingTransition:function(M,W,z){return this._fsm.onPendingTransition(M,W,z)}},b={state:{configurable:!1,enumerable:!0,get:function(){return this._fsm.state},set:function(M){throw Error("use transitions to change state")}}};function $(M){return R(this||{},M)}function S(){var M,W;typeof arguments[0]=="function"?(M=arguments[0],W=arguments[1]||{}):(M=function(){this._fsm.apply(this,arguments)},W=arguments[0]||{});var z=new c(W,$);return N(M.prototype,z),M.prototype._fsm.config=z,M}function R(M,W){var z=new c(W,$);return N(M,z),M._fsm(),M}function N(M,W){if(typeof M!="object"||Array.isArray(M))throw Error("StateMachine can only be applied to objects");l.build(M,W),Object.defineProperties(M,b),i(M,g),i(M,W.methods),W.allTransitions().forEach(function(z){M[s(z)]=function(){return this._fsm.fire(z,[].slice.call(arguments))}}),M._fsm=function(){this._fsm=new h(this,W),this._fsm.init(arguments)}}$.version="3.0.1",$.factory=S,$.apply=R,$.defaults={wildcard:"*",init:{name:"init",from:"none"}},r.exports=$},function(r,t,a){r.exports=function(i,s,l,c,h){this.message=i,this.transition=s,this.from=l,this.to=c,this.current=h}}])})})(lw);var Yu={exports:{}},Lh=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto!="undefined"&&typeof window.msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto);if(Lh){var xh=new Uint8Array(16);Yu.exports=function(){return Lh(xh),xh}}else{var Uh=new Array(16);Yu.exports=function(){for(var n=0,r;n<16;n++)(n&3)===0&&(r=Math.random()*4294967296),Uh[n]=r>>>((n&3)<<3)&255;return Uh}}var fw=[];for(var bu=0;bu<256;++bu)fw[bu]=(bu+256).toString(16).substr(1);function dL(e,n){var r=n||0,t=fw;return[t[e[r++]],t[e[r++]],t[e[r++]],t[e[r++]],"-",t[e[r++]],t[e[r++]],"-",t[e[r++]],t[e[r++]],"-",t[e[r++]],t[e[r++]],"-",t[e[r++]],t[e[r++]],t[e[r++]],t[e[r++]],t[e[r++]],t[e[r++]]].join("")}var dw=dL,pL=Yu.exports,vL=dw,jh,Yc,Jc=0,Qc=0;function hL(e,n,r){var t=n&&r||0,a=n||[];e=e||{};var i=e.node||jh,s=e.clockseq!==void 0?e.clockseq:Yc;if(i==null||s==null){var l=pL();i==null&&(i=jh=[l[0]|1,l[1],l[2],l[3],l[4],l[5]]),s==null&&(s=Yc=(l[6]<<8|l[7])&16383)}var c=e.msecs!==void 0?e.msecs:new Date().getTime(),h=e.nsecs!==void 0?e.nsecs:Qc+1,g=c-Jc+(h-Qc)/1e4;if(g<0&&e.clockseq===void 0&&(s=s+1&16383),(g<0||c>Jc)&&e.nsecs===void 0&&(h=0),h>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");Jc=c,Qc=h,Yc=s,c+=122192928e5;var b=((c&268435455)*1e4+h)%4294967296;a[t++]=b>>>24&255,a[t++]=b>>>16&255,a[t++]=b>>>8&255,a[t++]=b&255;var $=c/4294967296*1e4&268435455;a[t++]=$>>>8&255,a[t++]=$&255,a[t++]=$>>>24&15|16,a[t++]=$>>>16&255,a[t++]=s>>>8|128,a[t++]=s&255;for(var S=0;S<6;++S)a[t+S]=i[S];return n||vL(a)}var yL=hL,gL=Yu.exports,mL=dw;function bL(e,n,r){var t=n&&r||0;typeof e=="string"&&(n=e==="binary"?new Array(16):null,e=null),e=e||{};var a=e.random||(e.rng||gL)();if(a[6]=a[6]&15|64,a[8]=a[8]&63|128,n)for(var i=0;i<16;++i)n[t+i]=a[i];return n||mL(a)}var wL=bL,SL=yL,pw=wL,Ld=pw;Ld.v1=SL;Ld.v4=pw;var Fo=Ld,af={exports:{}},vw=typeof ArrayBuffer!="undefined"&&typeof DataView!="undefined",$L=vw,xd=mt,zt=He,hw=ft,Bo=_t,Gn=St,Ud=Kn,_L=Oa,kL=pn,sf=Ft,TL=Tt.f,IL=dn,qo=Po,Pi=Ei,RL=st,EL=Cs,yw=Tr,gw=yw.enforce,CL=yw.get,Ju=zt.Int8Array,uf=Ju&&Ju.prototype,Dh=zt.Uint8ClampedArray,Fh=Dh&&Dh.prototype,Gr=Ju&&qo(Ju),Ur=uf&&qo(uf),OL=Object.prototype,jd=zt.TypeError,Bh=RL("toStringTag"),of=EL("TYPED_ARRAY_TAG"),Qu="TypedArrayConstructor",ln=$L&&!!Pi&&Ud(zt.opera)!=="Opera",mw=!1,Qt,xn,pi,fn={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},Dd={BigInt64Array:8,BigUint64Array:8},PL=function(n){if(!Bo(n))return!1;var r=Ud(n);return r==="DataView"||Gn(fn,r)||Gn(Dd,r)},bw=function(e){var n=qo(e);if(!!Bo(n)){var r=CL(n);return r&&Gn(r,Qu)?r[Qu]:bw(n)}},ww=function(e){if(!Bo(e))return!1;var n=Ud(e);return Gn(fn,n)||Gn(Dd,n)},AL=function(e){if(ww(e))return e;throw jd("Target is not a typed array")},ML=function(e){if(hw(e)&&(!Pi||IL(Gr,e)))return e;throw jd(_L(e)+" is not a typed array constructor")},NL=function(e,n,r,t){if(!!xd){if(r)for(var a in fn){var i=zt[a];if(i&&Gn(i.prototype,e))try{delete i.prototype[e]}catch{try{i.prototype[e]=n}catch{}}}(!Ur[e]||r)&&sf(Ur,e,r?n:ln&&uf[e]||n,t)}},LL=function(e,n,r){var t,a;if(!!xd){if(Pi){if(r){for(t in fn)if(a=zt[t],a&&Gn(a,e))try{delete a[e]}catch{}}if(!Gr[e]||r)try{return sf(Gr,e,r?n:ln&&Gr[e]||n)}catch{}else return}for(t in fn)a=zt[t],a&&(!a[e]||r)&&sf(a,e,n)}};for(Qt in fn)xn=zt[Qt],pi=xn&&xn.prototype,pi?gw(pi)[Qu]=xn:ln=!1;for(Qt in Dd)xn=zt[Qt],pi=xn&&xn.prototype,pi&&(gw(pi)[Qu]=xn);if((!ln||!hw(Gr)||Gr===Function.prototype)&&(Gr=function(){throw jd("Incorrect invocation")},ln))for(Qt in fn)zt[Qt]&&Pi(zt[Qt],Gr);if((!ln||!Ur||Ur===OL)&&(Ur=Gr.prototype,ln))for(Qt in fn)zt[Qt]&&Pi(zt[Qt].prototype,Ur);ln&&qo(Fh)!==Ur&&Pi(Fh,Ur);if(xd&&!Gn(Ur,Bh)){mw=!0,TL(Ur,Bh,{get:function(){return Bo(this)?this[of]:void 0}});for(Qt in fn)zt[Qt]&&kL(zt[Qt],of,Qt)}var dt={NATIVE_ARRAY_BUFFER_VIEWS:ln,TYPED_ARRAY_TAG:mw&&of,aTypedArray:AL,aTypedArrayConstructor:ML,exportTypedArrayMethod:NL,exportTypedArrayStaticMethod:LL,getTypedArrayConstructor:bw,isView:PL,isTypedArray:ww,TypedArray:Gr,TypedArrayPrototype:Ur},Sw=He,Xc=Ne,xL=Oo,UL=dt.NATIVE_ARRAY_BUFFER_VIEWS,jL=Sw.ArrayBuffer,va=Sw.Int8Array,DL=!UL||!Xc(function(){va(1)})||!Xc(function(){new va(-1)})||!xL(function(e){new va,new va(null),new va(1.5),new va(e)},!0)||Xc(function(){return new va(new jL(2),1,void 0).length!==1}),FL=vn,BL=hn,qL=RangeError,$w=function(e){if(e===void 0)return 0;var n=FL(e),r=BL(n);if(n!==r)throw qL("Wrong length or index");return r},WL=Array,GL=Math.abs,nn=Math.pow,HL=Math.floor,zL=Math.log,VL=Math.LN2,KL=function(e,n,r){var t=WL(r),a=r*8-n-1,i=(1<<a)-1,s=i>>1,l=n===23?nn(2,-24)-nn(2,-77):0,c=e<0||e===0&&1/e<0?1:0,h=0,g,b,$;for(e=GL(e),e!=e||e===1/0?(b=e!=e?1:0,g=i):(g=HL(zL(e)/VL),$=nn(2,-g),e*$<1&&(g--,$*=2),g+s>=1?e+=l/$:e+=l*nn(2,1-s),e*$>=2&&(g++,$/=2),g+s>=i?(b=0,g=i):g+s>=1?(b=(e*$-1)*nn(2,n),g=g+s):(b=e*nn(2,s-1)*nn(2,n),g=0));n>=8;)t[h++]=b&255,b/=256,n-=8;for(g=g<<n|b,a+=n;a>0;)t[h++]=g&255,g/=256,a-=8;return t[--h]|=c*128,t},YL=function(e,n){var r=e.length,t=r*8-n-1,a=(1<<t)-1,i=a>>1,s=t-7,l=r-1,c=e[l--],h=c&127,g;for(c>>=7;s>0;)h=h*256+e[l--],s-=8;for(g=h&(1<<-s)-1,h>>=-s,s+=n;s>0;)g=g*256+e[l--],s-=8;if(h===0)h=1-i;else{if(h===a)return g?NaN:c?-1/0:1/0;g=g+nn(2,n),h=h-i}return(c?-1:1)*g*nn(2,h-n)},JL={pack:KL,unpack:YL},QL=Dt,qh=Ma,XL=Bt,_w=function(n){for(var r=QL(this),t=XL(r),a=arguments.length,i=qh(a>1?arguments[1]:void 0,t),s=a>2?arguments[2]:void 0,l=s===void 0?t:qh(s,t);l>i;)r[i++]=n;return r},Wo=He,Fd=Le,Zc=mt,ZL=vw,kw=Ps,Wh=pn,Gh=Od,el=Ne,wu=La,ex=vn,tx=hn,Xu=$w,Tw=JL,rx=Po,Hh=Ei,nx=zn.f,ax=Tt.f,ix=_w,sx=xs,Iw=Jn,Rw=Tr,ux=kw.PROPER,zh=kw.CONFIGURABLE,bi=Rw.get,Vh=Rw.set,Zu="ArrayBuffer",Ew="DataView",vi="prototype",ox="Wrong length",Cw="Wrong index",Ar=Wo[Zu],nr=Ar,Ja=nr&&nr[vi],qr=Wo[Ew],ha=qr&&qr[vi],Kh=Object.prototype,cx=Wo.Array,eo=Wo.RangeError,lx=Fd(ix),fx=Fd([].reverse),Ow=Tw.pack,Yh=Tw.unpack,Jh=function(e){return[e&255]},Qh=function(e){return[e&255,e>>8&255]},Xh=function(e){return[e&255,e>>8&255,e>>16&255,e>>24&255]},Zh=function(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]},dx=function(e){return Ow(e,23,4)},px=function(e){return Ow(e,52,8)},Su=function(e,n){ax(e[vi],n,{get:function(){return bi(this)[n]}})},On=function(e,n,r,t){var a=Xu(r),i=bi(e);if(a+n>i.byteLength)throw eo(Cw);var s=bi(i.buffer).bytes,l=a+i.byteOffset,c=sx(s,l,l+n);return t?c:fx(c)},Pn=function(e,n,r,t,a,i){var s=Xu(r),l=bi(e);if(s+n>l.byteLength)throw eo(Cw);for(var c=bi(l.buffer).bytes,h=s+l.byteOffset,g=t(+a),b=0;b<n;b++)c[h+b]=g[i?b:n-b-1]};if(!ZL)nr=function(n){wu(this,Ja);var r=Xu(n);Vh(this,{bytes:lx(cx(r),0),byteLength:r}),Zc||(this.byteLength=r)},Ja=nr[vi],qr=function(n,r,t){wu(this,ha),wu(n,Ja);var a=bi(n).byteLength,i=ex(r);if(i<0||i>a)throw eo("Wrong offset");if(t=t===void 0?a-i:tx(t),i+t>a)throw eo(ox);Vh(this,{buffer:n,byteLength:t,byteOffset:i}),Zc||(this.buffer=n,this.byteLength=t,this.byteOffset=i)},ha=qr[vi],Zc&&(Su(nr,"byteLength"),Su(qr,"buffer"),Su(qr,"byteLength"),Su(qr,"byteOffset")),Gh(ha,{getInt8:function(n){return On(this,1,n)[0]<<24>>24},getUint8:function(n){return On(this,1,n)[0]},getInt16:function(n){var r=On(this,2,n,arguments.length>1?arguments[1]:void 0);return(r[1]<<8|r[0])<<16>>16},getUint16:function(n){var r=On(this,2,n,arguments.length>1?arguments[1]:void 0);return r[1]<<8|r[0]},getInt32:function(n){return Zh(On(this,4,n,arguments.length>1?arguments[1]:void 0))},getUint32:function(n){return Zh(On(this,4,n,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(n){return Yh(On(this,4,n,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(n){return Yh(On(this,8,n,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(n,r){Pn(this,1,n,Jh,r)},setUint8:function(n,r){Pn(this,1,n,Jh,r)},setInt16:function(n,r){Pn(this,2,n,Qh,r,arguments.length>2?arguments[2]:void 0)},setUint16:function(n,r){Pn(this,2,n,Qh,r,arguments.length>2?arguments[2]:void 0)},setInt32:function(n,r){Pn(this,4,n,Xh,r,arguments.length>2?arguments[2]:void 0)},setUint32:function(n,r){Pn(this,4,n,Xh,r,arguments.length>2?arguments[2]:void 0)},setFloat32:function(n,r){Pn(this,4,n,dx,r,arguments.length>2?arguments[2]:void 0)},setFloat64:function(n,r){Pn(this,8,n,px,r,arguments.length>2?arguments[2]:void 0)}});else{var ey=ux&&Ar.name!==Zu;if(!el(function(){Ar(1)})||!el(function(){new Ar(-1)})||el(function(){return new Ar,new Ar(1.5),new Ar(NaN),ey&&!zh})){nr=function(n){return wu(this,Ja),new Ar(Xu(n))},nr[vi]=Ja;for(var ty=nx(Ar),ry=0,tl;ty.length>ry;)(tl=ty[ry++])in nr||Wh(nr,tl,Ar[tl]);Ja.constructor=nr}else ey&&zh&&Wh(Ar,"name",Zu);Hh&&rx(ha)!==Kh&&Hh(ha,Kh);var $u=new qr(new nr(2)),ny=Fd(ha.setInt8);$u.setInt8(0,2147483648),$u.setInt8(1,2147483649),($u.getInt8(0)||!$u.getInt8(1))&&Gh(ha,{setInt8:function(n,r){ny(this,n,r<<24>>24)},setUint8:function(n,r){ny(this,n,r<<24>>24)}},{unsafe:!0})}Iw(nr,Zu);Iw(qr,Ew);var Pw={ArrayBuffer:nr,DataView:qr},vx=vn,hx=RangeError,yx=function(e){var n=vx(e);if(n<0)throw hx("The argument can't be less than 0");return n},gx=yx,mx=RangeError,Aw=function(e,n){var r=gx(e);if(r%n)throw mx("Wrong offset");return r},bx=yn,wx=lt,Sx=Ff,$x=Dt,_x=Bt,kx=Eo,Tx=qs,Ix=id,Rx=dt.aTypedArrayConstructor,Ex=function(n){var r=Sx(this),t=$x(n),a=arguments.length,i=a>1?arguments[1]:void 0,s=i!==void 0,l=Tx(t),c,h,g,b,$,S;if(l&&!Ix(l))for($=kx(t,l),S=$.next,t=[];!(b=wx(S,$)).done;)t.push(b.value);for(s&&a>2&&(i=bx(i,arguments[2])),h=_x(t),g=new(Rx(r))(h),c=0;h>c;c++)g[c]=s?i(t[c],c):t[c];return g},ay=We,Mw=He,iy=lt,Cx=mt,Ox=DL,Ai=dt,Nw=Pw,sy=La,Px=Ra,Qi=pn,Ax=Ub,Mx=hn,uy=$w,rl=Aw,Lw=Os,Xi=St,Nx=Kn,cf=_t,Lx=ki,xx=Yn,Ux=dn,_u=Ei,jx=zn.f,oy=Ex,Dx=ur.forEach,Fx=To,xw=Tt,Uw=Vr,Bd=Tr,Bx=sd,lf=Bd.get,qx=Bd.set,Wx=Bd.enforce,qd=xw.f,Gx=Uw.f,Hx=Math.round,nl=Mw.RangeError,jw=Nw.ArrayBuffer,zx=jw.prototype,Vx=Nw.DataView,ku=Ai.NATIVE_ARRAY_BUFFER_VIEWS,cy=Ai.TYPED_ARRAY_TAG,ly=Ai.TypedArray,Zi=Ai.TypedArrayPrototype,Kx=Ai.aTypedArrayConstructor,ff=Ai.isTypedArray,Tu="BYTES_PER_ELEMENT",al="Wrong length",fy=function(e,n){Kx(e);for(var r=0,t=n.length,a=new e(t);t>r;)a[r]=n[r++];return a},Iu=function(e,n){qd(e,n,{get:function(){return lf(this)[n]}})},dy=function(e){var n;return Ux(zx,e)||(n=Nx(e))=="ArrayBuffer"||n=="SharedArrayBuffer"},Dw=function(e,n){return ff(e)&&!Lx(n)&&n in e&&Ax(+n)&&n>=0},py=function(n,r){return r=Lw(r),Dw(n,r)?Px(2,n[r]):Gx(n,r)},vy=function(n,r,t){return r=Lw(r),Dw(n,r)&&cf(t)&&Xi(t,"value")&&!Xi(t,"get")&&!Xi(t,"set")&&!t.configurable&&(!Xi(t,"writable")||t.writable)&&(!Xi(t,"enumerable")||t.enumerable)?(n[r]=t.value,n):qd(n,r,t)};Cx?(ku||(Uw.f=py,xw.f=vy,Iu(Zi,"buffer"),Iu(Zi,"byteOffset"),Iu(Zi,"byteLength"),Iu(Zi,"length")),ay({target:"Object",stat:!0,forced:!ku},{getOwnPropertyDescriptor:py,defineProperty:vy}),af.exports=function(e,n,r){var t=e.match(/\d+$/)[0]/8,a=e+(r?"Clamped":"")+"Array",i="get"+e,s="set"+e,l=Mw[a],c=l,h=c&&c.prototype,g={},b=function(N,M){var W=lf(N);return W.view[i](M*t+W.byteOffset,!0)},$=function(N,M,W){var z=lf(N);r&&(W=(W=Hx(W))<0?0:W>255?255:W&255),z.view[s](M*t+z.byteOffset,W,!0)},S=function(N,M){qd(N,M,{get:function(){return b(this,M)},set:function(W){return $(this,M,W)},enumerable:!0})};ku?Ox&&(c=n(function(N,M,W,z){return sy(N,h),Bx(function(){return cf(M)?dy(M)?z!==void 0?new l(M,rl(W,t),z):W!==void 0?new l(M,rl(W,t)):new l(M):ff(M)?fy(c,M):iy(oy,c,M):new l(uy(M))}(),N,c)}),_u&&_u(c,ly),Dx(jx(l),function(N){N in c||Qi(c,N,l[N])}),c.prototype=h):(c=n(function(N,M,W,z){sy(N,h);var me=0,le=0,De,$e,Pe;if(!cf(M))Pe=uy(M),$e=Pe*t,De=new jw($e);else if(dy(M)){De=M,le=rl(W,t);var L=M.byteLength;if(z===void 0){if(L%t||($e=L-le,$e<0))throw nl(al)}else if($e=Mx(z)*t,$e+le>L)throw nl(al);Pe=$e/t}else return ff(M)?fy(c,M):iy(oy,c,M);for(qx(N,{buffer:De,byteOffset:le,byteLength:$e,length:Pe,view:new Vx(De)});me<Pe;)S(N,me++)}),_u&&_u(c,ly),h=c.prototype=xx(Zi)),h.constructor!==c&&Qi(h,"constructor",c),Wx(h).TypedArrayConstructor=c,cy&&Qi(h,cy,a);var R=c!=l;g[a]=c,ay({global:!0,constructor:!0,forced:R,sham:!ku},g),Tu in c||Qi(c,Tu,t),Tu in h||Qi(h,Tu,t),Fx(a)}):af.exports=function(){};var Yx=af.exports;Yx("Uint8",function(e){return function(r,t,a){return e(this,r,t,a)}});var hy=Oa,Jx=TypeError,Wd=function(e,n){if(!delete e[n])throw Jx("Cannot delete property "+hy(n)+" of "+hy(e))},Qx=Dt,il=Ma,Xx=Bt,Zx=Wd,eU=Math.min,tU=[].copyWithin||function(n,r){var t=Qx(this),a=Xx(t),i=il(n,a),s=il(r,a),l=arguments.length>2?arguments[2]:void 0,c=eU((l===void 0?a:il(l,a))-s,a-i),h=1;for(s<i&&i<s+c&&(h=-1,s+=c-1,i+=c-1);c-- >0;)s in t?t[i]=t[s]:Zx(t,i),i+=h,s+=h;return t},rU=Le,Fw=dt,nU=tU,aU=rU(nU),iU=Fw.aTypedArray,sU=Fw.exportTypedArrayMethod;sU("copyWithin",function(n,r){return aU(iU(this),n,r,arguments.length>2?arguments[2]:void 0)});var Bw=dt,uU=ur.every,oU=Bw.aTypedArray,cU=Bw.exportTypedArrayMethod;cU("every",function(n){return uU(oU(this),n,arguments.length>1?arguments[1]:void 0)});var lU=Nf,fU=TypeError,dU=function(e){var n=lU(e,"number");if(typeof n=="number")throw fU("Can't convert number to bigint");return BigInt(n)},qw=dt,pU=_w,vU=dU,hU=Kn,yU=lt,gU=Le,mU=Ne,bU=qw.aTypedArray,wU=qw.exportTypedArrayMethod,SU=gU("".slice),$U=mU(function(){var e=0;return new Int8Array(2).fill({valueOf:function(){return e++}}),e!==1});wU("fill",function(n){var r=arguments.length;bU(this);var t=SU(hU(this),0,3)==="Big"?vU(n):+n;return yU(pU,this,t,r>1?arguments[1]:void 0,r>2?arguments[2]:void 0)},$U);var _U=Bt,kU=function(e,n){for(var r=0,t=_U(n),a=new e(t);t>r;)a[r]=n[r++];return a},Ww=dt,TU=Qf,IU=Ww.aTypedArrayConstructor,RU=Ww.getTypedArrayConstructor,Go=function(e){return IU(TU(e,RU(e)))},EU=kU,CU=Go,OU=function(e,n){return EU(CU(e),n)},Gw=dt,PU=ur.filter,AU=OU,MU=Gw.aTypedArray,NU=Gw.exportTypedArrayMethod;NU("filter",function(n){var r=PU(MU(this),n,arguments.length>1?arguments[1]:void 0);return AU(this,r)});var Hw=dt,LU=ur.find,xU=Hw.aTypedArray,UU=Hw.exportTypedArrayMethod;UU("find",function(n){return LU(xU(this),n,arguments.length>1?arguments[1]:void 0)});var zw=dt,jU=ur.findIndex,DU=zw.aTypedArray,FU=zw.exportTypedArrayMethod;FU("findIndex",function(n){return jU(DU(this),n,arguments.length>1?arguments[1]:void 0)});var Vw=dt,BU=ur.forEach,qU=Vw.aTypedArray,WU=Vw.exportTypedArrayMethod;WU("forEach",function(n){BU(qU(this),n,arguments.length>1?arguments[1]:void 0)});var Kw=dt,GU=vo.includes,HU=Kw.aTypedArray,zU=Kw.exportTypedArrayMethod;zU("includes",function(n){return GU(HU(this),n,arguments.length>1?arguments[1]:void 0)});var Yw=dt,VU=vo.indexOf,KU=Yw.aTypedArray,YU=Yw.exportTypedArrayMethod;YU("indexOf",function(n){return VU(KU(this),n,arguments.length>1?arguments[1]:void 0)});var JU=He,QU=Ne,Gd=Le,Jw=dt,Hd=Ib,XU=st,zd=XU("iterator"),yy=JU.Uint8Array,ZU=Gd(Hd.values),ej=Gd(Hd.keys),tj=Gd(Hd.entries),Vd=Jw.aTypedArray,Ho=Jw.exportTypedArrayMethod,si=yy&&yy.prototype,zo=!QU(function(){si[zd].call([1])}),Qw=!!si&&si.values&&si[zd]===si.values&&si.values.name==="values",Xw=function(){return ZU(Vd(this))};Ho("entries",function(){return tj(Vd(this))},zo);Ho("keys",function(){return ej(Vd(this))},zo);Ho("values",Xw,zo||!Qw,{name:"values"});Ho(zd,Xw,zo||!Qw,{name:"values"});var Zw=dt,rj=Le,nj=Zw.aTypedArray,aj=Zw.exportTypedArrayMethod,ij=rj([].join);aj("join",function(n){return ij(nj(this),n)});var sj=Vn,uj=sr,oj=vn,cj=Bt,lj=Ws,fj=Math.min,df=[].lastIndexOf,eS=!!df&&1/[1].lastIndexOf(1,-0)<0,dj=lj("lastIndexOf"),pj=eS||!dj,vj=pj?function(n){if(eS)return sj(df,this,arguments)||0;var r=uj(this),t=cj(r),a=t-1;for(arguments.length>1&&(a=fj(a,oj(arguments[1]))),a<0&&(a=t+a);a>=0;a--)if(a in r&&r[a]===n)return a||0;return-1}:df,tS=dt,hj=Vn,yj=vj,gj=tS.aTypedArray,mj=tS.exportTypedArrayMethod;mj("lastIndexOf",function(n){var r=arguments.length;return hj(yj,gj(this),r>1?[n,arguments[1]]:[n])});var rS=dt,bj=ur.map,wj=Go,Sj=rS.aTypedArray,$j=rS.exportTypedArrayMethod;$j("map",function(n){return bj(Sj(this),n,arguments.length>1?arguments[1]:void 0,function(r,t){return new(wj(r))(t)})});var _j=Dr,kj=Dt,Tj=Es,Ij=Bt,Rj=TypeError,gy=function(e){return function(n,r,t,a){_j(r);var i=kj(n),s=Tj(i),l=Ij(i),c=e?l-1:0,h=e?-1:1;if(t<2)for(;;){if(c in s){a=s[c],c+=h;break}if(c+=h,e?c<0:l<=c)throw Rj("Reduce of empty array with no initial value")}for(;e?c>=0:l>c;c+=h)c in s&&(a=r(a,s[c],c,i));return a}},Kd={left:gy(!1),right:gy(!0)},nS=dt,Ej=Kd.left,Cj=nS.aTypedArray,Oj=nS.exportTypedArrayMethod;Oj("reduce",function(n){var r=arguments.length;return Ej(Cj(this),n,r,r>1?arguments[1]:void 0)});var aS=dt,Pj=Kd.right,Aj=aS.aTypedArray,Mj=aS.exportTypedArrayMethod;Mj("reduceRight",function(n){var r=arguments.length;return Pj(Aj(this),n,r,r>1?arguments[1]:void 0)});var iS=dt,Nj=iS.aTypedArray,Lj=iS.exportTypedArrayMethod,xj=Math.floor;Lj("reverse",function(){for(var n=this,r=Nj(n).length,t=xj(r/2),a=0,i;a<t;)i=n[a],n[a++]=n[--r],n[r]=i;return n});var sS=He,uS=lt,Yd=dt,Uj=Bt,jj=Aw,Dj=Dt,oS=Ne,Fj=sS.RangeError,pf=sS.Int8Array,my=pf&&pf.prototype,cS=my&&my.set,Bj=Yd.aTypedArray,qj=Yd.exportTypedArrayMethod,vf=!oS(function(){var e=new Uint8ClampedArray(2);return uS(cS,e,{length:1,0:3},1),e[1]!==3}),Wj=vf&&Yd.NATIVE_ARRAY_BUFFER_VIEWS&&oS(function(){var e=new pf(2);return e.set(1),e.set("2",1),e[0]!==0||e[1]!==2});qj("set",function(n){Bj(this);var r=jj(arguments.length>1?arguments[1]:void 0,1),t=Dj(n);if(vf)return uS(cS,this,t,r);var a=this.length,i=Uj(t),s=0;if(i+r>a)throw Fj("Wrong length");for(;s<i;)this[r+s]=t[s++]},!vf||Wj);var lS=dt,Gj=Go,Hj=Ne,zj=Ti,Vj=lS.aTypedArray,Kj=lS.exportTypedArrayMethod,Yj=Hj(function(){new Int8Array(1).slice()});Kj("slice",function(n,r){for(var t=zj(Vj(this),n,r),a=Gj(this),i=0,s=t.length,l=new a(s);s>i;)l[i]=t[i++];return l},Yj);var fS=dt,Jj=ur.some,Qj=fS.aTypedArray,Xj=fS.exportTypedArrayMethod;Xj("some",function(n){return Jj(Qj(this),n,arguments.length>1?arguments[1]:void 0)});var by=xs,Zj=Math.floor,hf=function(e,n){var r=e.length,t=Zj(r/2);return r<8?eD(e,n):tD(e,hf(by(e,0,t),n),hf(by(e,t),n),n)},eD=function(e,n){for(var r=e.length,t=1,a,i;t<r;){for(i=t,a=e[t];i&&n(e[i-1],a)>0;)e[i]=e[--i];i!==t++&&(e[i]=a)}return e},tD=function(e,n,r,t){for(var a=n.length,i=r.length,s=0,l=0;s<a||l<i;)e[s+l]=s<a&&l<i?t(n[s],r[l])<=0?n[s++]:r[l++]:s<a?n[s++]:r[l++];return e},Jd=hf,rD=Ea,wy=rD.match(/firefox\/(\d+)/i),dS=!!wy&&+wy[1],nD=Ea,pS=/MSIE|Trident/.test(nD),aD=Ea,Sy=aD.match(/AppleWebKit\/(\d+)\./),vS=!!Sy&&+Sy[1],iD=He,sD=Le,yf=Ne,uD=Dr,oD=Jd,hS=dt,$y=dS,cD=pS,_y=Ca,ky=vS,lD=hS.aTypedArray,fD=hS.exportTypedArrayMethod,_s=iD.Uint16Array,hi=_s&&sD(_s.prototype.sort),dD=!!hi&&!(yf(function(){hi(new _s(2),null)})&&yf(function(){hi(new _s(2),{})})),Ty=!!hi&&!yf(function(){if(_y)return _y<74;if($y)return $y<67;if(cD)return!0;if(ky)return ky<602;var e=new _s(516),n=Array(516),r,t;for(r=0;r<516;r++)t=r%4,e[r]=515-r,n[r]=r-2*t+3;for(hi(e,function(a,i){return(a/4|0)-(i/4|0)}),r=0;r<516;r++)if(e[r]!==n[r])return!0}),pD=function(e){return function(n,r){return e!==void 0?+e(n,r)||0:r!==r?-1:n!==n?1:n===0&&r===0?1/n>0&&1/r<0?1:-1:n>r}};fD("sort",function(n){return n!==void 0&&uD(n),Ty?hi(this,n):oD(lD(this),pD(n))},!Ty||dD);var yS=dt,vD=hn,Iy=Ma,hD=Go,yD=yS.aTypedArray,gD=yS.exportTypedArrayMethod;gD("subarray",function(n,r){var t=yD(this),a=t.length,i=Iy(n,a),s=hD(t);return new s(t.buffer,t.byteOffset+i*t.BYTES_PER_ELEMENT,vD((r===void 0?a:Iy(r,a))-i))});var mD=He,bD=Vn,gS=dt,gf=Ne,Ry=Ti,to=mD.Int8Array,Ey=gS.aTypedArray,wD=gS.exportTypedArrayMethod,mS=[].toLocaleString,SD=!!to&&gf(function(){mS.call(new to(1))}),$D=gf(function(){return[1,2].toLocaleString()!=new to([1,2]).toLocaleString()})||!gf(function(){to.prototype.toLocaleString.call([1,2])});wD("toLocaleString",function(){return bD(mS,SD?Ry(Ey(this)):Ey(this),Ry(arguments))},$D);var _D=dt.exportTypedArrayMethod,kD=Ne,TD=He,ID=Le,Cy=TD.Uint8Array,RD=Cy&&Cy.prototype||{},ro=[].toString,ED=ID([].join);kD(function(){ro.call({})})&&(ro=function(){return ED(this)});var CD=RD.toString!=ro;_D("toString",ro,CD);var OD=_t,PD=Hn,AD=st,MD=AD("match"),bS=function(e){var n;return OD(e)&&((n=e[MD])!==void 0?!!n:PD(e)=="RegExp")},ND=Vn,es=lt,Qd=Le,LD=No,xD=bS,UD=It,Oy=Kr,jD=Qf,DD=md,FD=hn,sl=Lt,BD=Pa,Py=xs,Ay=Lo,qD=Mo,WD=Pb,GD=Ne,Qa=WD.UNSUPPORTED_Y,My=4294967295,HD=Math.min,wS=[].push,zD=Qd(/./.exec),Xa=Qd(wS),ts=Qd("".slice),VD=!GD(function(){var e=/(?:)/,n=e.exec;e.exec=function(){return n.apply(this,arguments)};var r="ab".split(e);return r.length!==2||r[0]!=="a"||r[1]!=="b"});LD("split",function(e,n,r){var t;return"abbc".split(/(b)*/)[1]=="c"||"test".split(/(?:)/,-1).length!=4||"ab".split(/(?:ab)*/).length!=2||".".split(/(.?)(.?)/).length!=4||".".split(/()()/).length>1||"".split(/.?/).length?t=function(a,i){var s=sl(Oy(this)),l=i===void 0?My:i>>>0;if(l===0)return[];if(a===void 0)return[s];if(!xD(a))return es(n,s,a,l);for(var c=[],h=(a.ignoreCase?"i":"")+(a.multiline?"m":"")+(a.unicode?"u":"")+(a.sticky?"y":""),g=0,b=new RegExp(a.source,h+"g"),$,S,R;($=es(qD,b,s))&&(S=b.lastIndex,!(S>g&&(Xa(c,ts(s,g,$.index)),$.length>1&&$.index<s.length&&ND(wS,c,Py($,1)),R=$[0].length,g=S,c.length>=l)));)b.lastIndex===$.index&&b.lastIndex++;return g===s.length?(R||!zD(b,""))&&Xa(c,""):Xa(c,ts(s,g)),c.length>l?Py(c,0,l):c}:"0".split(void 0,0).length?t=function(a,i){return a===void 0&&i===0?[]:es(n,this,a,i)}:t=n,[function(i,s){var l=Oy(this),c=i==null?void 0:BD(i,e);return c?es(c,i,l,s):es(t,sl(l),i,s)},function(a,i){var s=UD(this),l=sl(a),c=r(t,s,l,i,t!==n);if(c.done)return c.value;var h=jD(s,RegExp),g=s.unicode,b=(s.ignoreCase?"i":"")+(s.multiline?"m":"")+(s.unicode?"u":"")+(Qa?"g":"y"),$=new h(Qa?"^(?:"+s.source+")":s,b),S=i===void 0?My:i>>>0;if(S===0)return[];if(l.length===0)return Ay($,l)===null?[l]:[];for(var R=0,N=0,M=[];N<l.length;){$.lastIndex=Qa?0:N;var W=Ay($,Qa?ts(l,N):l),z;if(W===null||(z=HD(FD($.lastIndex+(Qa?N:0)),l.length))===R)N=DD(l,N,g);else{if(Xa(M,ts(l,R,N)),M.length===S)return M;for(var me=1;me<=W.length-1;me++)if(Xa(M,W[me]),M.length===S)return M;N=R=z}}return Xa(M,ts(l,R)),M}]},!VD,Qa);var Xd={exports:{}},SS={exports:{}};(function(e){function n(r){return Function.toString.call(r).indexOf("[native code]")!==-1}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports})(SS);var $S={exports:{}},_S={exports:{}};(function(e){function n(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports})(_S);(function(e){var n=_o.exports,r=_S.exports;function t(a,i,s){return r()?(e.exports=t=Reflect.construct.bind(),e.exports.__esModule=!0,e.exports.default=e.exports):(e.exports=t=function(c,h,g){var b=[null];b.push.apply(b,h);var $=Function.bind.apply(c,b),S=new $;return g&&n(S,g.prototype),S},e.exports.__esModule=!0,e.exports.default=e.exports),t.apply(null,arguments)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports})($S);(function(e){var n=Yr.exports,r=_o.exports,t=SS.exports,a=$S.exports;function i(s){var l=typeof Map=="function"?new Map:void 0;return e.exports=i=function(h){if(h===null||!t(h))return h;if(typeof h!="function")throw new TypeError("Super expression must either be null or a function");if(typeof l!="undefined"){if(l.has(h))return l.get(h);l.set(h,g)}function g(){return a(h,arguments,n(this).constructor)}return g.prototype=Object.create(h.prototype,{constructor:{value:g,enumerable:!1,writable:!0,configurable:!0}}),r(g,h)},e.exports.__esModule=!0,e.exports.default=e.exports,i(s)}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports})(Xd);var no={exports:{}};/*!
 * Platform.js v1.3.6
 * Copyright 2014-2020 Benjamin Tan
 * Copyright 2011-2013 John-David Dalton
 * Available under MIT license
 */(function(e,n){(function(){var r={function:!0,object:!0},t=r[typeof window]&&window||this,a=n,i=e&&!e.nodeType&&e,s=a&&i&&typeof xr=="object"&&xr;s&&(s.global===s||s.window===s||s.self===s)&&(t=s);var l=Math.pow(2,53)-1,c=/\bOpera/,h=Object.prototype,g=h.hasOwnProperty,b=h.toString;function $(L){return L=String(L),L.charAt(0).toUpperCase()+L.slice(1)}function S(L,ue,x){var ye={"10.0":"10","6.4":"10 Technical Preview","6.3":"8.1","6.2":"8","6.1":"Server 2008 R2 / 7","6.0":"Server 2008 / Vista","5.2":"Server 2003 / XP 64-bit","5.1":"XP","5.01":"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};return ue&&x&&/^Win/i.test(L)&&!/^Windows Phone /i.test(L)&&(ye=ye[/[\d.]+$/.exec(L)])&&(L="Windows "+ye),L=String(L),ue&&x&&(L=L.replace(RegExp(ue,"i"),x)),L=N(L.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0]),L}function R(L,ue){var x=-1,ye=L?L.length:0;if(typeof ye=="number"&&ye>-1&&ye<=l)for(;++x<ye;)ue(L[x],x,L);else M(L,ue)}function N(L){return L=De(L),/^(?:webOS|i(?:OS|P))/.test(L)?L:$(L)}function M(L,ue){for(var x in L)g.call(L,x)&&ue(L[x],x,L)}function W(L){return L==null?$(L):b.call(L).slice(8,-1)}function z(L,ue){var x=L!=null?typeof L[ue]:"number";return!/^(?:boolean|number|string|undefined)$/.test(x)&&(x=="object"?!!L[ue]:!0)}function me(L){return String(L).replace(/([ -])(?!$)/g,"$1?")}function le(L,ue){var x=null;return R(L,function(ye,ge){x=ue(x,ye,ge,L)}),x}function De(L){return String(L).replace(/^ +| +$/g,"")}function $e(L){var ue=t,x=L&&typeof L=="object"&&W(L)!="String";x&&(ue=L,L=null);var ye=ue.navigator||{},ge=ye.userAgent||"";L||(L=ge);var Q=x?!!ye.likeChrome:/\bChrome\b/.test(L)&&!/internal|\n/i.test(b.toString()),H="Object",J=x?H:"ScriptBridgingProxyObject",K=x?H:"Environment",he=x&&ue.java?"JavaPackage":W(ue.java),E=x?H:"RuntimeObject",Te=/\bJava/.test(he)&&ue.java,ut=Te&&W(ue.environment)==K,ze=Te?"a":"\u03B1",re=Te?"b":"\u03B2",F=ue.document||{},q=ue.operamini||ue.opera,I=c.test(I=x&&q?q["[[Class]]"]:W(q))?I:q=null,O,pe=L,se=[],_e=null,Ge=L==ge,fe=Ge&&q&&typeof q.version=="function"&&q.version(),Ee,ke=lr([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"]),Z=Rt(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"(?:Edge|Edg|EdgA|EdgiOS)"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Vivaldi","Waterfox","WebPositive",{label:"Yandex Browser",pattern:"YaBrowser"},{label:"UC Browser",pattern:"UCBrowser"},"Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chromium","Chrome",{label:"Chrome",pattern:"(?:HeadlessChrome)"},{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),Ce=ve([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),Ie=xe({Apple:{iPad:1,iPhone:1,iPod:1},Alcatel:{},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},Huawei:{},Lenovo:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Oppo:{},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1},Xiaomi:{Mi:1,Redmi:1}}),oe=fr(["Windows Phone","KaiOS","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian",{label:"DragonFly BSD",pattern:"DragonFly"},"Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "]);function lr(pt){return le(pt,function(Ve,je){return Ve||RegExp("\\b"+(je.pattern||me(je))+"\\b","i").exec(L)&&(je.label||je)})}function xe(pt){return le(pt,function(Ve,je,vt){return Ve||(je[Ce]||je[/^[a-z]+(?: +[a-z]+\b)*/i.exec(Ce)]||RegExp("\\b"+me(vt)+"(?:\\b|\\w*\\d)","i").exec(L))&&vt})}function Rt(pt){return le(pt,function(Ve,je){return Ve||RegExp("\\b"+(je.pattern||me(je))+"\\b","i").exec(L)&&(je.label||je)})}function fr(pt){return le(pt,function(Ve,je){var vt=je.pattern||me(je);return!Ve&&(Ve=RegExp("\\b"+vt+"(?:/[\\d.]+|[ \\w.]*)","i").exec(L))&&(Ve=S(Ve,vt,je.label||je)),Ve})}function ve(pt){return le(pt,function(Ve,je){var vt=je.pattern||me(je);return!Ve&&(Ve=RegExp("\\b"+vt+" *\\d+[.\\w_]*","i").exec(L)||RegExp("\\b"+vt+" *\\w+-[\\w]*","i").exec(L)||RegExp("\\b"+vt+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(L))&&((Ve=String(je.label&&!RegExp(vt,"i").test(je.label)?je.label:Ve).split("/"))[1]&&!/[\d.]+/.test(Ve[0])&&(Ve[0]+=" "+Ve[1]),je=je.label||je,Ve=N(Ve[0].replace(RegExp(vt,"i"),je).replace(RegExp("; *(?:"+je+"[_-])?","i")," ").replace(RegExp("("+je+")[-_.]?(\\w)","i"),"$1 $2"))),Ve})}function qt(pt){return le(pt,function(Ve,je){return Ve||(RegExp(je+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(L)||0)[1]||null})}function xt(){return this.description||""}if(ke&&(ke=[ke]),/\bAndroid\b/.test(oe)&&!Ce&&(O=/\bAndroid[^;]*;(.*?)(?:Build|\) AppleWebKit)\b/i.exec(L))&&(Ce=De(O[1]).replace(/^[a-z]{2}-[a-z]{2};\s*/i,"")||null),Ie&&!Ce?Ce=ve([Ie]):Ie&&Ce&&(Ce=Ce.replace(RegExp("^("+me(Ie)+")[-_.\\s]","i"),Ie+" ").replace(RegExp("^("+me(Ie)+")[-_.]?(\\w)","i"),Ie+" $2")),(O=/\bGoogle TV\b/.exec(Ce))&&(Ce=O[0]),/\bSimulator\b/i.test(L)&&(Ce=(Ce?Ce+" ":"")+"Simulator"),Z=="Opera Mini"&&/\bOPiOS\b/.test(L)&&se.push("running in Turbo/Uncompressed mode"),Z=="IE"&&/\blike iPhone OS\b/.test(L)?(O=$e(L.replace(/like iPhone OS/,"")),Ie=O.manufacturer,Ce=O.product):/^iP/.test(Ce)?(Z||(Z="Safari"),oe="iOS"+((O=/ OS ([\d_]+)/i.exec(L))?" "+O[1].replace(/_/g,"."):"")):Z=="Konqueror"&&/^Linux\b/i.test(oe)?oe="Kubuntu":Ie&&Ie!="Google"&&(/Chrome/.test(Z)&&!/\bMobile Safari\b/i.test(L)||/\bVita\b/.test(Ce))||/\bAndroid\b/.test(oe)&&/^Chrome/.test(Z)&&/\bVersion\//i.test(L)?(Z="Android Browser",oe=/\bAndroid\b/.test(oe)?oe:"Android"):Z=="Silk"?(/\bMobi/i.test(L)||(oe="Android",se.unshift("desktop mode")),/Accelerated *= *true/i.test(L)&&se.unshift("accelerated")):Z=="UC Browser"&&/\bUCWEB\b/.test(L)?se.push("speed mode"):Z=="PaleMoon"&&(O=/\bFirefox\/([\d.]+)\b/.exec(L))?se.push("identifying as Firefox "+O[1]):Z=="Firefox"&&(O=/\b(Mobile|Tablet|TV)\b/i.exec(L))?(oe||(oe="Firefox OS"),Ce||(Ce=O[1])):!Z||(O=!/\bMinefield\b/i.test(L)&&/\b(?:Firefox|Safari)\b/.exec(Z))?(Z&&!Ce&&/[\/,]|^[^(]+?\)/.test(L.slice(L.indexOf(O+"/")+8))&&(Z=null),(O=Ce||Ie||oe)&&(Ce||Ie||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(oe))&&(Z=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(oe)?oe:O)+" Browser")):Z=="Electron"&&(O=(/\bChrome\/([\d.]+)\b/.exec(L)||0)[1])&&se.push("Chromium "+O),fe||(fe=qt(["(?:Cloud9|CriOS|CrMo|Edge|Edg|EdgA|EdgiOS|FxiOS|HeadlessChrome|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$)|UCBrowser|YaBrowser)","Version",me(Z),"(?:Firefox|Minefield|NetFront)"])),(O=ke=="iCab"&&parseFloat(fe)>3&&"WebKit"||/\bOpera\b/.test(Z)&&(/\bOPR\b/.test(L)?"Blink":"Presto")||/\b(?:Midori|Nook|Safari)\b/i.test(L)&&!/^(?:Trident|EdgeHTML)$/.test(ke)&&"WebKit"||!ke&&/\bMSIE\b/i.test(L)&&(oe=="Mac OS"?"Tasman":"Trident")||ke=="WebKit"&&/\bPlayStation\b(?! Vita\b)/i.test(Z)&&"NetFront")&&(ke=[O]),Z=="IE"&&(O=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(L)||0)[1])?(Z+=" Mobile",oe="Windows Phone "+(/\+$/.test(O)?O:O+".x"),se.unshift("desktop mode")):/\bWPDesktop\b/i.test(L)?(Z="IE Mobile",oe="Windows Phone 8.x",se.unshift("desktop mode"),fe||(fe=(/\brv:([\d.]+)/.exec(L)||0)[1])):Z!="IE"&&ke=="Trident"&&(O=/\brv:([\d.]+)/.exec(L))&&(Z&&se.push("identifying as "+Z+(fe?" "+fe:"")),Z="IE",fe=O[1]),Ge){if(z(ue,"global"))if(Te&&(O=Te.lang.System,pe=O.getProperty("os.arch"),oe=oe||O.getProperty("os.name")+" "+O.getProperty("os.version")),ut){try{fe=ue.require("ringo/engine").version.join("."),Z="RingoJS"}catch{(O=ue.system)&&O.global.system==ue.system&&(Z="Narwhal",oe||(oe=O[0].os||null))}Z||(Z="Rhino")}else typeof ue.process=="object"&&!ue.process.browser&&(O=ue.process)&&(typeof O.versions=="object"&&(typeof O.versions.electron=="string"?(se.push("Node "+O.versions.node),Z="Electron",fe=O.versions.electron):typeof O.versions.nw=="string"&&(se.push("Chromium "+fe,"Node "+O.versions.node),Z="NW.js",fe=O.versions.nw)),Z||(Z="Node.js",pe=O.arch,oe=O.platform,fe=/[\d.]+/.exec(O.version),fe=fe?fe[0]:null));else W(O=ue.runtime)==J?(Z="Adobe AIR",oe=O.flash.system.Capabilities.os):W(O=ue.phantom)==E?(Z="PhantomJS",fe=(O=O.version||null)&&O.major+"."+O.minor+"."+O.patch):typeof F.documentMode=="number"&&(O=/\bTrident\/(\d+)/i.exec(L))?(fe=[fe,F.documentMode],(O=+O[1]+4)!=fe[1]&&(se.push("IE "+fe[1]+" mode"),ke&&(ke[1]=""),fe[1]=O),fe=Z=="IE"?String(fe[1].toFixed(1)):fe[0]):typeof F.documentMode=="number"&&/^(?:Chrome|Firefox)\b/.test(Z)&&(se.push("masking as "+Z+" "+fe),Z="IE",fe="11.0",ke=["Trident"],oe="Windows");oe=oe&&N(oe)}if(fe&&(O=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(fe)||/(?:alpha|beta)(?: ?\d)?/i.exec(L+";"+(Ge&&ye.appMinorVersion))||/\bMinefield\b/i.test(L)&&"a")&&(_e=/b/i.test(O)?"beta":"alpha",fe=fe.replace(RegExp(O+"\\+?$"),"")+(_e=="beta"?re:ze)+(/\d+\+?/.exec(O)||"")),Z=="Fennec"||Z=="Firefox"&&/\b(?:Android|Firefox OS|KaiOS)\b/.test(oe))Z="Firefox Mobile";else if(Z=="Maxthon"&&fe)fe=fe.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(Ce))Ce=="Xbox 360"&&(oe=null),Ce=="Xbox 360"&&/\bIEMobile\b/.test(L)&&se.unshift("mobile mode");else if((/^(?:Chrome|IE|Opera)$/.test(Z)||Z&&!Ce&&!/Browser|Mobi/.test(Z))&&(oe=="Windows CE"||/Mobi/i.test(L)))Z+=" Mobile";else if(Z=="IE"&&Ge)try{ue.external===null&&se.unshift("platform preview")}catch{se.unshift("embedded")}else(/\bBlackBerry\b/.test(Ce)||/\bBB10\b/.test(L))&&(O=(RegExp(Ce.replace(/ +/g," *")+"/([.\\d]+)","i").exec(L)||0)[1]||fe)?(O=[O,/BB10/.test(L)],oe=(O[1]?(Ce=null,Ie="BlackBerry"):"Device Software")+" "+O[0],fe=null):this!=M&&Ce!="Wii"&&(Ge&&q||/Opera/.test(Z)&&/\b(?:MSIE|Firefox)\b/i.test(L)||Z=="Firefox"&&/\bOS X (?:\d+\.){2,}/.test(oe)||Z=="IE"&&(oe&&!/^Win/.test(oe)&&fe>5.5||/\bWindows XP\b/.test(oe)&&fe>8||fe==8&&!/\bTrident\b/.test(L)))&&!c.test(O=$e.call(M,L.replace(c,"")+";"))&&O.name&&(O="ing as "+O.name+((O=O.version)?" "+O:""),c.test(Z)?(/\bIE\b/.test(O)&&oe=="Mac OS"&&(oe=null),O="identify"+O):(O="mask"+O,I?Z=N(I.replace(/([a-z])([A-Z])/g,"$1 $2")):Z="Opera",/\bIE\b/.test(O)&&(oe=null),Ge||(fe=null)),ke=["Presto"],se.push(O));(O=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(L)||0)[1])&&(O=[parseFloat(O.replace(/\.(\d)$/,".0$1")),O],Z=="Safari"&&O[1].slice(-1)=="+"?(Z="WebKit Nightly",_e="alpha",fe=O[1].slice(0,-1)):(fe==O[1]||fe==(O[2]=(/\bSafari\/([\d.]+\+?)/i.exec(L)||0)[1]))&&(fe=null),O[1]=(/\b(?:Headless)?Chrome\/([\d.]+)/i.exec(L)||0)[1],O[0]==537.36&&O[2]==537.36&&parseFloat(O[1])>=28&&ke=="WebKit"&&(ke=["Blink"]),!Ge||!Q&&!O[1]?(ke&&(ke[1]="like Safari"),O=(O=O[0],O<400?1:O<500?2:O<526?3:O<533?4:O<534?"4+":O<535?5:O<537?6:O<538?7:O<601?8:O<602?9:O<604?10:O<606?11:O<608?12:"12")):(ke&&(ke[1]="like Chrome"),O=O[1]||(O=O[0],O<530?1:O<532?2:O<532.05?3:O<533?4:O<534.03?5:O<534.07?6:O<534.1?7:O<534.13?8:O<534.16?9:O<534.24?10:O<534.3?11:O<535.01?12:O<535.02?"13+":O<535.07?15:O<535.11?16:O<535.19?17:O<536.05?18:O<536.1?19:O<537.01?20:O<537.11?"21+":O<537.13?23:O<537.18?24:O<537.24?25:O<537.36?26:ke!="Blink"?"27":"28")),ke&&(ke[1]+=" "+(O+=typeof O=="number"?".x":/[.+]/.test(O)?"":"+")),Z=="Safari"&&(!fe||parseInt(fe)>45)?fe=O:Z=="Chrome"&&/\bHeadlessChrome/i.test(L)&&se.unshift("headless")),Z=="Opera"&&(O=/\bzbov|zvav$/.exec(oe))?(Z+=" ",se.unshift("desktop mode"),O=="zvav"?(Z+="Mini",fe=null):Z+="Mobile",oe=oe.replace(RegExp(" *"+O+"$"),"")):Z=="Safari"&&/\bChrome\b/.exec(ke&&ke[1])?(se.unshift("desktop mode"),Z="Chrome Mobile",fe=null,/\bOS X\b/.test(oe)?(Ie="Apple",oe="iOS 4.3+"):oe=null):/\bSRWare Iron\b/.test(Z)&&!fe&&(fe=qt("Chrome")),fe&&fe.indexOf(O=/[\d.]+$/.exec(oe))==0&&L.indexOf("/"+O+"-")>-1&&(oe=De(oe.replace(O,""))),oe&&oe.indexOf(Z)!=-1&&!RegExp(Z+" OS").test(oe)&&(oe=oe.replace(RegExp(" *"+me(Z)+" *"),"")),ke&&!/\b(?:Avant|Nook)\b/.test(Z)&&(/Browser|Lunascape|Maxthon/.test(Z)||Z!="Safari"&&/^iOS/.test(oe)&&/\bSafari\b/.test(ke[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|SRWare Iron|Vivaldi|Web)/.test(Z)&&ke[1])&&(O=ke[ke.length-1])&&se.push(O),se.length&&(se=["("+se.join("; ")+")"]),Ie&&Ce&&Ce.indexOf(Ie)<0&&se.push("on "+Ie),Ce&&se.push((/^on /.test(se[se.length-1])?"":"on ")+Ce),oe&&(O=/ ([\d.+]+)$/.exec(oe),Ee=O&&oe.charAt(oe.length-O[0].length-1)=="/",oe={architecture:32,family:O&&!Ee?oe.replace(O[0],""):oe,version:O?O[1]:null,toString:function(){var pt=this.version;return this.family+(pt&&!Ee?" "+pt:"")+(this.architecture==64?" 64-bit":"")}}),(O=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(pe))&&!/\bi686\b/i.test(pe)?(oe&&(oe.architecture=64,oe.family=oe.family.replace(RegExp(" *"+O),"")),Z&&(/\bWOW64\b/i.test(L)||Ge&&/\w(?:86|32)$/.test(ye.cpuClass||ye.platform)&&!/\bWin64; x64\b/i.test(L))&&se.unshift("32-bit")):oe&&/^OS X/.test(oe.family)&&Z=="Chrome"&&parseFloat(fe)>=39&&(oe.architecture=64),L||(L=null);var Je={};return Je.description=L,Je.layout=ke&&ke[0],Je.manufacturer=Ie,Je.name=Z,Je.prerelease=_e,Je.product=Ce,Je.ua=L,Je.version=Z&&fe,Je.os=oe||{architecture:null,family:null,version:null,toString:function(){return"null"}},Je.parse=$e,Je.toString=xt,Je.version&&se.unshift(fe),Je.name&&se.unshift(Z),oe&&Z&&!(oe==String(oe).split(" ")[0]&&(oe==Z.split(" ")[0]||Ce))&&se.push(Ce?"("+oe+")":"on "+oe),se.length&&(Je.description=se.join(" ")),Je}var Pe=$e();a&&i?M(Pe,function(L,ue){a[ue]=L}):t.platform=Pe}).call(xr)})(no,no.exports);var KD=lt,YD=No,JD=It,QD=hn,ul=Lt,XD=Kr,ZD=Pa,eF=md,Ny=Lo;YD("match",function(e,n,r){return[function(a){var i=XD(this),s=a==null?void 0:ZD(a,e);return s?KD(s,a,i):new RegExp(a)[e](ul(i))},function(t){var a=JD(this),i=ul(t),s=r(n,a,i);if(s.done)return s.value;if(!a.global)return Ny(a,i);var l=a.unicode;a.lastIndex=0;for(var c=[],h=0,g;(g=Ny(a,i))!==null;){var b=ul(g[0]);c[h]=b,b===""&&(a.lastIndex=eF(i,QD(a.lastIndex),l)),h++}return h===0?null:c}]});var tF=Object.is||function(n,r){return n===r?n!==0||1/n===1/r:n!=n&&r!=r},rF=lt,nF=No,aF=It,iF=Kr,Ly=tF,xy=Lt,sF=Pa,uF=Lo;nF("search",function(e,n,r){return[function(a){var i=iF(this),s=a==null?void 0:sF(a,e);return s?rF(s,a,i):new RegExp(a)[e](xy(i))},function(t){var a=aF(this),i=xy(t),s=r(n,a,i);if(s.done)return s.value;var l=a.lastIndex;Ly(l,0)||(a.lastIndex=0);var c=uF(a,i);return Ly(a.lastIndex,l)||(a.lastIndex=l),c===null?-1:c.index}]});var oF=We,cF=Dt,lF=Ma,fF=vn,dF=Bt,pF=db,vF=Hf,hF=Ii,ol=Wd,yF=Ds,gF=yF("splice"),mF=Math.max,bF=Math.min;oF({target:"Array",proto:!0,forced:!gF},{splice:function(n,r){var t=cF(this),a=dF(t),i=lF(n,a),s=arguments.length,l,c,h,g,b,$;for(s===0?l=c=0:s===1?(l=0,c=a-i):(l=s-2,c=bF(mF(fF(r),0),a-i)),pF(a+l-c),h=vF(t,c),g=0;g<c;g++)b=i+g,b in t&&hF(h,g,t[b]);if(h.length=c,l<c){for(g=i;g<a-c;g++)b=g+c,$=g+l,b in t?t[$]=t[b]:ol(t,$);for(g=a;g>a-c+l;g--)ol(t,g-1)}else if(l>c)for(g=a-c;g>i;g--)b=g+c-1,$=g+l-1,b in t?t[$]=t[b]:ol(t,$);for(g=0;g<l;g++)t[g+i]=arguments[g+2];return t.length=a-c+l,h}});/*
@license
The following license applies to all parts of this software except as
documented below.

    Copyright (c) 2016, Twilio, inc.
    All rights reserved.

    Redistribution and use in source and binary forms, with or without
    modification, are permitted provided that the following conditions are
    met:

      1. Redistributions of source code must retain the above copyright
         notice, this list of conditions and the following disclaimer.

      2. Redistributions in binary form must reproduce the above copyright
         notice, this list of conditions and the following disclaimer in
         the documentation and/or other materials provided with the
         distribution.

      3. Neither the name of Twilio nor the names of its contributors may
         be used to endorse or promote products derived from this software
         without specific prior written permission.

    THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
    "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
    LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
    A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
    HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
    SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
    LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
    DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
    THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
    (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
    OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

This software includes javascript-state-machine under the following license.

    Copyright (c) 2012, 2013, 2014, 2015, Jake Gordon and contributors

    Permission is hereby granted, free of charge, to any person obtaining a copy
    of this software and associated documentation files (the "Software"), to deal
    in the Software without restriction, including without limitation the rights
    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
    copies of the Software, and to permit persons to whom the Software is
    furnished to do so, subject to the following conditions:

    The above copyright notice and this permission notice shall be included in all
    copies or substantial portions of the Software.

    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE

This software includes loglevel under the following license.

    Copyright (c) 2013 Tim Perry

    Permission is hereby granted, free of charge, to any person
    obtaining a copy of this software and associated documentation
    files (the "Software"), to deal in the Software without
    restriction, including without limitation the rights to use,
    copy, modify, merge, publish, distribute, sublicense, and/or sell
    copies of the Software, and to permit persons to whom the
    Software is furnished to do so, subject to the following
    conditions:

    The above copyright notice and this permission notice shall be
    included in all copies or substantial portions of the Software.

    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
    EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
    OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
    NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
    HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
    WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
    FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
    OTHER DEALINGS IN THE SOFTWARE.


*/(function(e){var n=typeof n!="undefined"?n:typeof self!="undefined"?self:typeof window!="undefined"?window:{};Object.defineProperty(e,"__esModule",{value:!0});var r=Ri.exports,t=Na.exports,a=Qn.exports,i=jo.exports,s=Xn.exports,l=Zn.exports,c=Yr.exports,h=ra.exports,g=ta.exports,b=Gs,$=ea.exports,S=Pt,R=Oi.exports,N=lw.exports,M=Fo,W=Xd.exports,z=mn,me=no.exports;function le(y){return y&&typeof y=="object"&&"default"in y?y:{default:y}}function De(y){if(y&&y.__esModule)return y;var p=Object.create(null);return y&&Object.keys(y).forEach(function(u){if(u!=="default"){var f=Object.getOwnPropertyDescriptor(y,u);Object.defineProperty(p,u,f.get?f:{enumerable:!0,get:function(){return y[u]}})}}),p.default=y,Object.freeze(p)}var $e=le(r),Pe=le(t),L=le(a),ue=le(i),x=le(s),ye=le(l),ge=le(c),Q=le(h),H=le(g),J=le(b),K=le($),he=De(R),E=De(N),Te=le(W),ut=De(me);function ze(y,p,u,f){var o=arguments.length,v=o<3?p:f===null?f=Object.getOwnPropertyDescriptor(p,u):f,d;if((typeof Reflect=="undefined"?"undefined":K.default(Reflect))==="object"&&typeof Reflect.decorate=="function")v=Reflect.decorate(y,p,u,f);else for(var m=y.length-1;m>=0;m--)(d=y[m])&&(v=(o<3?d(v):o>3?d(p,u,v):d(p,u))||v);return o>3&&v&&Object.defineProperty(p,u,v),v}function re(y,p){if((typeof Reflect=="undefined"?"undefined":K.default(Reflect))==="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(y,p)}var F;function q(){}q.prototype=Object.create(null);function I(){I.init.call(this)}I.EventEmitter=I,I.usingDomains=!1,I.prototype.domain=void 0,I.prototype._events=void 0,I.prototype._maxListeners=void 0,I.defaultMaxListeners=10,I.init=function(){this.domain=null,I.usingDomains&&F.active,(!this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=new q,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},I.prototype.setMaxListeners=function(p){if(typeof p!="number"||p<0||isNaN(p))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=p,this};function O(y){return y._maxListeners===void 0?I.defaultMaxListeners:y._maxListeners}I.prototype.getMaxListeners=function(){return O(this)};function pe(y,p,u){if(p)y.call(u);else for(var f=y.length,o=oe(y,f),v=0;v<f;++v)o[v].call(u)}function se(y,p,u,f){if(p)y.call(u,f);else for(var o=y.length,v=oe(y,o),d=0;d<o;++d)v[d].call(u,f)}function _e(y,p,u,f,o){if(p)y.call(u,f,o);else for(var v=y.length,d=oe(y,v),m=0;m<v;++m)d[m].call(u,f,o)}function Ge(y,p,u,f,o,v){if(p)y.call(u,f,o,v);else for(var d=y.length,m=oe(y,d),w=0;w<d;++w)m[w].call(u,f,o,v)}function fe(y,p,u,f){if(p)y.apply(u,f);else for(var o=y.length,v=oe(y,o),d=0;d<o;++d)v[d].apply(u,f)}I.prototype.emit=function(p){var u,f,o,v,d,m,w,C=p==="error";if(m=this._events,m)C=C&&m.error==null;else if(!C)return!1;if(w=this.domain,C){if(u=arguments[1],w)u||(u=new Error('Uncaught, unspecified "error" event')),u.domainEmitter=this,u.domain=w,u.domainThrown=!1,w.emit("error",u);else{if(u instanceof Error)throw u;var P=new Error('Uncaught, unspecified "error" event. ('+u+")");throw P.context=u,P}return!1}if(f=m[p],!f)return!1;var U=typeof f=="function";switch(o=arguments.length,o){case 1:pe(f,U,this);break;case 2:se(f,U,this,arguments[1]);break;case 3:_e(f,U,this,arguments[1],arguments[2]);break;case 4:Ge(f,U,this,arguments[1],arguments[2],arguments[3]);break;default:for(v=new Array(o-1),d=1;d<o;d++)v[d-1]=arguments[d];fe(f,U,this,v)}return!0};function Ee(y,p,u,f){var o,v,d;if(typeof u!="function")throw new TypeError('"listener" argument must be a function');if(v=y._events,v?(v.newListener&&(y.emit("newListener",p,u.listener?u.listener:u),v=y._events),d=v[p]):(v=y._events=new q,y._eventsCount=0),!d)d=v[p]=u,++y._eventsCount;else if(typeof d=="function"?d=v[p]=f?[u,d]:[d,u]:f?d.unshift(u):d.push(u),!d.warned&&(o=O(y),o&&o>0&&d.length>o)){d.warned=!0;var m=new Error("Possible EventEmitter memory leak detected. "+d.length+" "+p+" listeners added. Use emitter.setMaxListeners() to increase limit");m.name="MaxListenersExceededWarning",m.emitter=y,m.type=p,m.count=d.length,ke(m)}return y}function ke(y){typeof console.warn=="function"?console.warn(y):console.log(y)}I.prototype.addListener=function(p,u){return Ee(this,p,u,!1)},I.prototype.on=I.prototype.addListener,I.prototype.prependListener=function(p,u){return Ee(this,p,u,!0)};function Z(y,p,u){var f=!1;function o(){y.removeListener(p,o),f||(f=!0,u.apply(y,arguments))}return o.listener=u,o}I.prototype.once=function(p,u){if(typeof u!="function")throw new TypeError('"listener" argument must be a function');return this.on(p,Z(this,p,u)),this},I.prototype.prependOnceListener=function(p,u){if(typeof u!="function")throw new TypeError('"listener" argument must be a function');return this.prependListener(p,Z(this,p,u)),this},I.prototype.removeListener=function(p,u){var f,o,v,d,m;if(typeof u!="function")throw new TypeError('"listener" argument must be a function');if(o=this._events,!o)return this;if(f=o[p],!f)return this;if(f===u||f.listener&&f.listener===u)--this._eventsCount===0?this._events=new q:(delete o[p],o.removeListener&&this.emit("removeListener",p,f.listener||u));else if(typeof f!="function"){for(v=-1,d=f.length;d-- >0;)if(f[d]===u||f[d].listener&&f[d].listener===u){m=f[d].listener,v=d;break}if(v<0)return this;if(f.length===1){if(f[0]=void 0,--this._eventsCount===0)return this._events=new q,this;delete o[p]}else Ie(f,v);o.removeListener&&this.emit("removeListener",p,m||u)}return this},I.prototype.off=function(y,p){return this.removeListener(y,p)},I.prototype.removeAllListeners=function(p){var u,f;if(f=this._events,!f)return this;if(!f.removeListener)return arguments.length===0?(this._events=new q,this._eventsCount=0):f[p]&&(--this._eventsCount===0?this._events=new q:delete f[p]),this;if(arguments.length===0){for(var o=Object.keys(f),v=0,d;v<o.length;++v)d=o[v],d!=="removeListener"&&this.removeAllListeners(d);return this.removeAllListeners("removeListener"),this._events=new q,this._eventsCount=0,this}if(u=f[p],typeof u=="function")this.removeListener(p,u);else if(u)do this.removeListener(p,u[u.length-1]);while(u[0]);return this},I.prototype.listeners=function(p){var u,f,o=this._events;return o?(u=o[p],u?typeof u=="function"?f=[u.listener||u]:f=lr(u):f=[]):f=[],f},I.listenerCount=function(y,p){return typeof y.listenerCount=="function"?y.listenerCount(p):Ce.call(y,p)},I.prototype.listenerCount=Ce;function Ce(y){var p=this._events;if(p){var u=p[y];if(typeof u=="function")return 1;if(u)return u.length}return 0}I.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};function Ie(y,p){for(var u=p,f=u+1,o=y.length;f<o;u+=1,f+=1)y[u]=y[f];y.pop()}function oe(y,p){for(var u=new Array(p);p--;)u[p]=y[p];return u}function lr(y){for(var p=new Array(y.length),u=0;u<p.length;++u)p[u]=y[u].listener||y[u];return p}var xe=he.getLogger("twilsock");function Rt(y,p){return["".concat(new Date().toISOString()," Twilsock ").concat(y,":")].concat(Array.from(p))}var fr=function(){function y(p){Q.default(this,y),H.default(this,"prefix",""),this.prefix=p!=null&&p.length>0?" "+p+":":""}return Pe.default(y,[{key:"setLevel",value:function(u){xe.setLevel(u)}},{key:"trace",value:function(){for(var u=arguments.length,f=new Array(u),o=0;o<u;o++)f[o]=arguments[o];xe.trace.apply(null,Rt("T",f))}},{key:"debug",value:function(){for(var u=arguments.length,f=new Array(u),o=0;o<u;o++)f[o]=arguments[o];xe.debug.apply(null,Rt("D",f))}},{key:"info",value:function(){for(var u=arguments.length,f=new Array(u),o=0;o<u;o++)f[o]=arguments[o];xe.info.apply(null,Rt("I",f))}},{key:"warn",value:function(){for(var u=arguments.length,f=new Array(u),o=0;o<u;o++)f[o]=arguments[o];xe.warn.apply(null,Rt("W",f))}},{key:"error",value:function(){for(var u=arguments.length,f=new Array(u),o=0;o<u;o++)f[o]=arguments[o];xe.error.apply(null,Rt("E",f))}}],[{key:"setLevel",value:function(u){xe.setLevel(u)}},{key:"trace",value:function(){for(var u=arguments.length,f=new Array(u),o=0;o<u;o++)f[o]=arguments[o];xe.trace.apply(null,Rt("T",f))}},{key:"debug",value:function(){for(var u=arguments.length,f=new Array(u),o=0;o<u;o++)f[o]=arguments[o];xe.debug.apply(null,Rt("D",f))}},{key:"info",value:function(){for(var u=arguments.length,f=new Array(u),o=0;o<u;o++)f[o]=arguments[o];xe.info.apply(null,Rt("I",f))}},{key:"warn",value:function(){for(var u=arguments.length,f=new Array(u),o=0;o<u;o++)f[o]=arguments[o];xe.warn.apply(null,Rt("W",f))}},{key:"error",value:function(){for(var u=arguments.length,f=new Array(u),o=0;o<u;o++)f[o]=arguments[o];xe.error.apply(null,Rt("E",f))}}]),y}(),ve=new fr(""),qt="0.12.2",xt=function(){function y(p,u,f){Q.default(this,y),H.default(this,"confirmedCapabilities",new Set),this.activeGrant=u,this._token=p;var o=f.region||"us1",v="wss://tsock.".concat(o,".twilio.com/v3/wsconnect"),d=f.twilsock||f.Twilsock||{};this.url=d.uri||v,this._continuationToken=f.continuationToken?f.continuationToken:null,this.logLevel=f.logLevel?f.logLevel:"error",this.retryPolicy=f.retryPolicy?f.retryPolicy:{min:1*1e3,max:2*60*1e3,randomness:.2},this.clientMetadata=f.clientMetadata?f.clientMetadata:{},this.clientMetadata.ver=qt,this.initRegistrations=f.initRegistrations?f.initRegistrations:null,this.tweaks=f.tweaks?f.tweaks:null}return Pe.default(y,[{key:"token",get:function(){return this._token}},{key:"continuationToken",get:function(){return this._continuationToken}},{key:"updateToken",value:function(u){this._token=u}},{key:"updateContinuationToken",value:function(u){this._continuationToken=u}}]),y}(),Je=function y(p){Q.default(this,y),this.id=p||"TM".concat(M.v4())};function pt(y){var p=Ve();return function(){var f=ge.default(y),o;if(p){var v=ge.default(this).constructor;o=Reflect.construct(f,arguments,v)}else o=f.apply(this,arguments);return ye.default(this,o)}}function Ve(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var je=function(y){x.default(u,y);var p=pt(u);function u(f,o,v,d,m){var w;return Q.default(this,u),w=p.call(this),H.default(L.default(w),"method","init"),w.token=f,w.continuation_token=o,w.metadata=v,w.registrations=d,w.tweaks=m,w.capabilities=["client_update","offline_storage","telemetry.v1"],w}return u}(Je);function vt(y){var p=Et();return function(){var f=ge.default(y),o;if(p){var v=ge.default(this).constructor;o=Reflect.construct(f,arguments,v)}else o=f.apply(this,arguments);return ye.default(this,o)}}function Et(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var bn=function(y){x.default(u,y);var p=vt(u);function u(f,o,v,d,m,w,C){var P;return Q.default(this,u),P=p.call(this,f),P.continuationToken=o,P.continuationTokenStatus=d,P.offlineStorage=m,P.initRegistrations=w,P.debugInfo=C,P.confirmedCapabilities=v,P}return u}(Je);function wn(y){var p=Sn();return function(){var f=ge.default(y),o;if(p){var v=ge.default(this).constructor;o=Reflect.construct(f,arguments,v)}else o=f.apply(this,arguments);return ye.default(this,o)}}function Sn(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var $n=function(y){x.default(u,y);var p=wn(u);function u(f){var o;return Q.default(this,u),o=p.call(this),H.default(L.default(o),"method","update"),o.token=f,o}return u}(Je);function at(y){var p=Rr();return function(){var f=ge.default(y),o;if(p){var v=ge.default(this).constructor;o=Reflect.construct(f,arguments,v)}else o=f.apply(this,arguments);return ye.default(this,o)}}function Rr(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var V=function(y){x.default(u,y);var p=at(u);function u(f,o,v){var d;return Q.default(this,u),d=p.call(this),H.default(L.default(d),"method","message"),d.active_grant=f,d.payload_type=o,d.http_request=v,d}return u}(Je);function Y(y){var p=D();return function(){var f=ge.default(y),o;if(p){var v=ge.default(this).constructor;o=Reflect.construct(f,arguments,v)}else o=f.apply(this,arguments);return ye.default(this,o)}}function D(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var G=function(y){x.default(u,y);var p=Y(u);function u(f){var o;return Q.default(this,u),o=p.call(this,f),H.default(L.default(o),"method","reply"),H.default(L.default(o),"payload_type","application/json"),H.default(L.default(o),"status",{code:200,status:"OK"}),o}return u}(Je);function B(y){var p=te();return function(){var f=ge.default(y),o;if(p){var v=ge.default(this).constructor;o=Reflect.construct(f,arguments,v)}else o=f.apply(this,arguments);return ye.default(this,o)}}function te(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var ae=function(y){x.default(u,y);var p=B(u);function u(){var f;return Q.default(this,u),f=p.call(this),H.default(L.default(f),"method","close"),f}return u}(Je);function de(y){var p=Ae();return function(){var f=ge.default(y),o;if(p){var v=ge.default(this).constructor;o=Reflect.construct(f,arguments,v)}else o=f.apply(this,arguments);return ye.default(this,o)}}function Ae(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Fe=function y(p,u,f,o,v,d){Q.default(this,y),this.start=p,this.end=u,this.title=f,this.details=o,this.id=v,this.type=d},Me=function(y){x.default(u,y);var p=de(u);function u(f){var o;return Q.default(this,u),o=p.call(this),H.default(L.default(o),"method","telemetry.v1"),o.events=f,o}return u}(Je);function be(y){var p=encodeURIComponent(y),u=p.replace(/%([0-9A-F]{2})/g,function(f,o){return String.fromCharCode(Number("0x"+o))});return u.length}function Wt(y){var p=encodeURIComponent(y),u=p.replace(/%([0-9A-F]{2})/g,function(o,v){return String.fromCharCode(Number("0x"+v))}),f=new Uint8Array(u.length);return Array.prototype.forEach.call(u,function(o,v){f[v]=o.charCodeAt(0)}),f}function Oe(y){var p=Array.prototype.map.call(y,function(f){return String.fromCharCode(f)}).join(""),u=p.replace(/(.)/g,function(f,o){var v=o.charCodeAt(0).toString(16).toUpperCase();return v.length<2&&(v="0"+v),"%"+v});return decodeURIComponent(u)}function bt(y){return JSON.parse(Oe(y))}function ht(y){for(var p="",u=0;u<y.length;++u){var f=String.fromCharCode(y[u]);if(p+=f,f==="\r"){u+=2;break}}var o=p.split(" ");return{size:u,protocol:o[0],version:o[1],headerSize:Number(o[2])}}var _n=function(){function y(){Q.default(this,y)}return Pe.default(y,null,[{key:"parse",value:function(u){var f=2,o=new Uint8Array(u),v=ht(o);if(v.protocol!=="TWILSOCK"||v.version!=="V3.0")return ve.error("unsupported protocol: ".concat(v.protocol," ver ").concat(v.version)),null;var d;try{d=bt(o.subarray(v.size,v.size+v.headerSize))}catch(P){return ve.error("failed to parse message header",P,u),null}ve.debug("message received: ",d.method),ve.trace("message received: ",d);var m;if(d.payload_size>0){var w=f+v.size+v.headerSize,C=d.payload_size;if(!d.hasOwnProperty("payload_type")||d.payload_type.indexOf("application/json")===0)try{m=bt(o.subarray(w,w+C))}catch(P){return ve.error("failed to parse message body",P,u),null}else d.payload_type.indexOf("text/plain")===0&&(m=Oe(o.subarray(w,w+C)))}return{method:d.method,header:d,payload:m}}},{key:"createPacket",value:function(u){var f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";u.payload_size=be(f);var o=JSON.stringify(u),v="TWILSOCK V3.0 "+be(o);ve.debug("send request:",v+o+f);var d=Wt(v+`\r
`+o+`\r
`+f);return d.buffer}}]),y}();function Jr(y){var p=Fr();return function(){var f=ge.default(y),o;if(p){var v=ge.default(this).constructor;o=Reflect.construct(f,arguments,v)}else o=f.apply(this,arguments);return ye.default(this,o)}}function Fr(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var it=function(y){x.default(u,y);var p=Jr(u);function u(f){return Q.default(this,u),p.call(this,f)}return u}(Te.default(Error));function yt(y){var p=er();return function(){var f=ge.default(y),o;if(p){var v=ge.default(this).constructor;o=Reflect.construct(f,arguments,v)}else o=f.apply(this,arguments);return ye.default(this,o)}}function er(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Kt=function(y){x.default(u,y);var p=yt(u);function u(f,o){var v;return Q.default(this,u),v=p.call(this,f),v.reply=o,v}return u}(it);function ia(y,p){var u=Object.keys(y);if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(y);p&&(f=f.filter(function(o){return Object.getOwnPropertyDescriptor(y,o).enumerable})),u.push.apply(u,f)}return u}function Da(y){for(var p=1;p<arguments.length;p++){var u=arguments[p]!=null?arguments[p]:{};p%2?ia(Object(u),!0).forEach(function(f){H.default(y,f,u[f])}):Object.getOwnPropertyDescriptors?Object.defineProperties(y,Object.getOwnPropertyDescriptors(u)):ia(Object(u)).forEach(function(f){Object.defineProperty(y,f,Object.getOwnPropertyDescriptor(u,f))})}return y}function tr(y){var p=Fa();return function(){var f=ge.default(y),o;if(p){var v=ge.default(this).constructor;o=Reflect.construct(f,arguments,v)}else o=f.apply(this,arguments);return ye.default(this,o)}}function Fa(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Mi=function(y){x.default(u,y);var p=tr(u);function u(f){var o;return Q.default(this,u),o=p.call(this),H.default(L.default(o),"newBackoff",null),H.default(L.default(o),"usedBackoff",null),H.default(L.default(o),"retrier",null),o.options=f?Da({},f):{},o}return Pe.default(u,[{key:"inProgress",get:function(){return!!this.retrier}},{key:"start",value:function(){if(this.inProgress)throw new Error("Already waiting for next attempt, call finishAttempt(success : boolean) to finish it");this.createRetrier()}},{key:"stop",value:function(){this.cleanRetrier(),this.newBackoff=null,this.usedBackoff=null}},{key:"modifyBackoff",value:function(o){this.newBackoff=o}},{key:"attemptFailed",value:function(){if(!this.inProgress)throw new Error("No attempt is in progress");if(this.newBackoff){var o=!this.usedBackoff||this.usedBackoff<this.newBackoff;if(o)this.createRetrier();else{var v;(v=this.retrier)===null||v===void 0||v.failed(new Error)}}else{var d;(d=this.retrier)===null||d===void 0||d.failed(new Error)}}},{key:"cancel",value:function(){var o;(o=this.retrier)===null||o===void 0||o.cancel()}},{key:"cleanRetrier",value:function(){var o,v;(o=this.retrier)===null||o===void 0||o.removeAllListeners(),(v=this.retrier)===null||v===void 0||v.cancel(),this.retrier=null}},{key:"getRetryPolicy",value:function(){var o=Da({},this.options);return this.newBackoff&&(o.min=this.newBackoff,o.max=this.options.max&&this.options.max>this.newBackoff?this.options.max:this.newBackoff),o.maxAttemptsCount=this.options.maxAttemptsCount?this.options.maxAttemptsCount+1:void 0,o}},{key:"createRetrier",value:function(){var o=this;this.cleanRetrier();var v=this.getRetryPolicy();this.retrier=new z.Retrier(v),this.retrier.once("attempt",function(){var d,m;(d=o.retrier)===null||d===void 0||d.on("attempt",function(){return o.emit("attempt")}),(m=o.retrier)===null||m===void 0||m.failed(new Error("Skipping first attempt"))}),this.retrier.on("failed",function(d){return o.emit("failed",d)}),this.usedBackoff=this.newBackoff,this.newBackoff=null,this.retrier.start()}}]),u}(I);function Ni(y){var p=Ut();return function(){var f=ge.default(y),o;if(p){var v=ge.default(this).constructor;o=Reflect.construct(f,arguments,v)}else o=f.apply(this,arguments);return ye.default(this,o)}}function Ut(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Er=3e3;function dr(y){setTimeout(y,0)}var Ze=function(y){x.default(u,y);var p=Ni(u);function u(f,o,v){var d;Q.default(this,u),d=p.call(this),H.default(L.default(d),"disconnectingTimer",null),H.default(L.default(d),"disconnectedPromiseResolve",null),H.default(L.default(d),"terminalStates",["disconnected","rejected"]),H.default(L.default(d),"tokenExpiredSasCode",20104),H.default(L.default(d),"terminationReason","Connection is not initialized"),d.websocket=f,d.websocket.on("connected",function(){return d.fsm.socketConnected()}),d.websocket.on("disconnected",function(){return d.fsm.socketClosed()}),d.websocket.on("message",function(w){return d.onIncomingMessage(w)}),d.websocket.on("socketError",function(w){return d.emit("connectionError",{terminal:!1,message:"Socket error: ".concat(w.message),httpStatusCode:null,errorCode:null})}),d.transport=o,d.config=v,d.retrier=new Mi(v.retryPolicy),d.retrier.on("attempt",function(){return d.retry()}),d.retrier.on("failed",function(w){ve.warn("Retrying failed: ".concat(w.message)),d.disconnect()}),typeof window!="undefined"&&typeof window.addEventListener!="undefined"&&(window.addEventListener("online",function(){ve.debug("Browser reported connectivity state: online"),d.resetBackoff(),d.fsm.systemOnline()}),window.addEventListener("offline",function(){ve.debug("Browser reported connectivity state: offline"),d.websocket.close(),d.fsm.socketClosed()}));var m=E.factory({init:"disconnected",transitions:[{name:"userConnect",from:["disconnected","rejected"],to:"connecting"},{name:"userConnect",from:["connecting","connected"]},{name:"userDisconnect",from:["connecting","initialising","connected","updating","retrying","rejected","waitSocketClosed","waitOffloadSocketClosed"],to:"disconnecting"},{name:"userRetry",from:["retrying"],to:"connecting"},{name:"socketConnected",from:["connecting"],to:"initialising"},{name:"socketClosed",from:["connecting","initialising","connected","updating","error","waitOffloadSocketClosed"],to:"retrying"},{name:"socketClosed",from:["disconnecting"],to:"disconnected"},{name:"socketClosed",from:["waitSocketClosed"],to:"disconnected"},{name:"socketClosed",from:["rejected"],to:"rejected"},{name:"initSuccess",from:["initialising"],to:"connected"},{name:"initError",from:["initialising"],to:"error"},{name:"tokenRejected",from:["initialising","updating"],to:"rejected"},{name:"protocolError",from:["initialising","connected","updating"],to:"error"},{name:"receiveClose",from:["initialising","connected","updating"],to:"waitSocketClosed"},{name:"receiveOffload",from:["initialising","connected","updating"],to:"waitOffloadSocketClosed"},{name:"unsupportedProtocol",from:["initialising","connected","updating"],to:"unsupported"},{name:"receiveFatalClose",from:["initialising","connected","updating"],to:"unsupported"},{name:"userUpdateToken",from:["disconnected","rejected","connecting","retrying"],to:"connecting"},{name:"userUpdateToken",from:["connected"],to:"updating"},{name:"updateSuccess",from:["updating"],to:"connected"},{name:"updateError",from:["updating"],to:"error"},{name:"userSend",from:["connected"],to:"connected"},{name:"systemOnline",from:["retrying"],to:"connecting"}],methods:{onConnecting:function(){d.setupSocket(),d.emit("connecting")},onEnterInitialising:function(){d.sendInit()},onLeaveInitialising:function(){d.cancelInit()},onEnterUpdating:function(){d.sendUpdate()},onLeaveUpdating:function(){d.cancelUpdate()},onEnterRetrying:function(){d.initRetry(),d.emit("connecting")},onEnterConnected:function(){d.resetBackoff(),d.onConnected()},onUserUpdateToken:function(){d.resetBackoff()},onTokenRejected:function(){d.resetBackoff(),d.closeSocket(!0),d.finalizeSocket()},onUserDisconnect:function(){d.closeSocket(!0)},onEnterDisconnecting:function(){d.startDisconnectTimer()},onLeaveDisconnecting:function(){d.cancelDisconnectTimer()},onEnterWaitSocketClosed:function(){d.startDisconnectTimer()},onLeaveWaitSocketClosed:function(){d.cancelDisconnectTimer()},onEnterWaitOffloadSocketClosed:function(){d.startDisconnectTimer()},onLeaveWaitOffloadSocketClosed:function(){d.cancelDisconnectTimer()},onDisconnected:function(){d.resetBackoff(),d.finalizeSocket()},onReceiveClose:function(){d.onCloseReceived()},onReceiveOffload:function(C,P){ve.debug("onreceiveoffload: ",P),d.modifyBackoff(P.body),d.onCloseReceived()},onUnsupported:function(){d.closeSocket(!0),d.finalizeSocket()},onError:function(C,P){d.closeSocket(P),d.finalizeSocket()},onEnterState:function(C){C.from!=="none"&&d.changeState(C)},onInvalidTransition:function(C,P,U){ve.warn("FSM: unexpected transition",P,U)}}});return d.fsm=new m,d}return Pe.default(u,[{key:"changeState",value:function(o){ve.debug("FSM: ".concat(o.transition,": ").concat(o.from," --> ").concat(o.to)),this.lastEmittedState!==this.state&&(this.lastEmittedState=this.state,this.emit("stateChanged",this.state))}},{key:"resetBackoff",value:function(){ve.trace("resetBackoff"),this.retrier.stop()}},{key:"modifyBackoff",value:function(o){ve.trace("modifyBackoff",o);var v=o?o.backoff_policy:null;v&&typeof v.reconnect_min_ms=="number"&&this.retrier.modifyBackoff(v.reconnect_min_ms)}},{key:"startDisconnectTimer",value:function(){var o=this;ve.trace("startDisconnectTimer"),this.disconnectingTimer&&(clearTimeout(this.disconnectingTimer),this.disconnectingTimer=null),this.disconnectingTimer=setTimeout(function(){ve.debug("disconnecting is timed out"),o.closeSocket(!0)},Er)}},{key:"cancelDisconnectTimer",value:function(){ve.trace("cancelDisconnectTimer"),this.disconnectingTimer&&(clearTimeout(this.disconnectingTimer),this.disconnectingTimer=null)}},{key:"isConnected",get:function(){return this.state==="connected"&&this.websocket.isConnected}},{key:"state",get:function(){switch(this.fsm.state){case"connecting":case"initialising":case"retrying":case"error":return"connecting";case"updating":case"connected":return"connected";case"rejected":return"denied";case"disconnecting":case"waitSocketClosed":case"waitOffloadSocketClosed":return"disconnecting";case"disconnected":default:return"disconnected"}}},{key:"initRetry",value:function(){ve.debug("initRetry"),this.retrier.inProgress?this.retrier.attemptFailed():this.retrier.start()}},{key:"retry",value:function(){this.fsm.state!="connecting"?(ve.trace("retry"),this.websocket.close(),this.fsm.userRetry()):ve.trace("can	 retry as already connecting")}},{key:"onConnected",value:function(){this.emit("connected")}},{key:"finalizeSocket",value:function(){ve.trace("finalizeSocket"),this.websocket.close(),this.emit("disconnected"),this.disconnectedPromiseResolve&&(this.disconnectedPromiseResolve(),this.disconnectedPromiseResolve=null)}},{key:"setupSocket",value:function(){ve.trace("setupSocket:",this.config.token),this.emit("beforeConnect"),this.websocket.connect()}},{key:"onIncomingMessage",value:function(o){var v=_n.parse(o);if(!!v){var d=v.method,m=v.header,w=v.payload;if(d!=="reply"&&this.confirmReceiving(m),d==="notification")this.emit("message",m.message_type,w);else if(m.method==="reply")this.transport.processReply({id:m.id,status:m.status,header:m,body:w});else if(m.method==="client_update")m.client_update_type==="token_about_to_expire"&&this.emit("tokenAboutToExpire");else if(m.method==="close")if(m.status.code===308)ve.debug("Connection has been offloaded"),this.fsm.receiveOffload({status:m.status.status,body:w});else if(m.status.code===406){var C="Server closed connection because can't parse protocol: ".concat(JSON.stringify(m.status));this.emitReplyConnectionError(C,m,!0),ve.error(C),this.fsm.receiveFatalClose()}else m.status.code===417?(ve.error("Server closed connection because can't parse client reply: ".concat(JSON.stringify(m.status))),this.fsm.receiveFatalClose(m.status.status)):m.status.code===410?(ve.warn("Server closed connection: ".concat(JSON.stringify(m.status))),this.fsm.receiveClose(m.status.status),this.emit("tokenExpired")):m.status.code===401?(ve.error("Server closed connection: ".concat(JSON.stringify(m.status))),this.fsm.receiveClose(m.status.status)):(ve.warn("unexpected message: ",m.status),this.fsm.receiveOffload({status:m.status.status,body:null}))}}},{key:"sendInit",value:function(){var f=$e.default(J.default.mark(function v(){var d,m;return J.default.wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return ve.trace("sendInit"),C.prev=1,this.emit("beforeSendInit"),C.next=5,this.transport.sendInit();case 5:d=C.sent,this.config.updateContinuationToken(d.continuationToken),this.config.confirmedCapabilities=d.confirmedCapabilities,this.fsm.initSuccess(d),this.emit("initialized",d),this.emit("tokenUpdated"),C.next=17;break;case 13:C.prev=13,C.t0=C.catch(1),C.t0 instanceof Kt?(m=!1,ve.warn("Init rejected by server: ".concat(JSON.stringify(C.t0.reply.status))),this.emit("sendInitFailed"),C.t0.reply.status.code===401||C.t0.reply.status.code===403?(m=!0,this.fsm.tokenRejected(C.t0.reply.status),C.t0.reply.status.errorCode===this.tokenExpiredSasCode&&this.emit("tokenExpired")):C.t0.reply.status.code===429?(this.modifyBackoff(C.t0.reply.body),this.fsm.initError(!0)):C.t0.reply.status.code===500?this.fsm.initError(!1):this.fsm.initError(!0),this.emitReplyConnectionError(C.t0.message,C.t0.reply,m)):(this.terminationReason=C.t0.message,this.emit("connectionError",{terminal:!0,message:"Unknown error during connection initialisation: ".concat(C.t0.message,`
`).concat(JSON.stringify(C.t0,null,2)),httpStatusCode:null,errorCode:null}),this.fsm.initError(!0)),this.emit("tokenUpdated",C.t0);case 17:case"end":return C.stop()}},v,this,[[1,13]])}));function o(){return f.apply(this,arguments)}return o}()},{key:"sendUpdate",value:function(){var f=$e.default(J.default.mark(function v(){var d,m,w;return J.default.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return ve.trace("sendUpdate"),d=new $n(this.config.token),P.prev=2,P.next=5,this.transport.sendWithReply(d);case 5:m=P.sent,this.fsm.updateSuccess(m.body),this.emit("tokenUpdated"),P.next=14;break;case 10:P.prev=10,P.t0=P.catch(2),P.t0 instanceof Kt?(w=!1,ve.warn("Token update rejected by server: ".concat(JSON.stringify(P.t0.reply.status))),P.t0.reply.status.code===401||P.t0.reply.status.code===403?(w=!0,this.fsm.tokenRejected(P.t0.reply.status),P.t0.reply.status.errorCode===this.tokenExpiredSasCode&&this.emit("tokenExpired")):P.t0.reply.status.code===429?(this.modifyBackoff(P.t0.reply.body),this.fsm.updateError(P.t0.reply.status)):this.fsm.updateError(P.t0.reply.status),this.emitReplyConnectionError(P.t0.message,P.t0.reply,w)):(this.emit("error",!1,P.t0.message,null,null),this.fsm.updateError(P.t0)),this.emit("tokenUpdated",P.t0);case 14:case"end":return P.stop()}},v,this,[[2,10]])}));function o(){return f.apply(this,arguments)}return o}()},{key:"emitReplyConnectionError",value:function(o,v,d){var m=v.status&&v.status.description?v.status.description:o,w=v.status.code,C=v.status&&v.status.errorCode?v.status.errorCode:null;d&&(this.terminationReason=m),this.emit("connectionError",{terminal:d,message:"Connection error: ".concat(m),httpStatusCode:w,errorCode:C})}},{key:"cancelInit",value:function(){ve.trace("cancelInit")}},{key:"cancelUpdate",value:function(){ve.trace("cancelUpdate")}},{key:"confirmReceiving",value:function(o){ve.trace("confirmReceiving");try{this.transport.send(new G(o.id))}catch(v){ve.debug("failed to confirm packet receiving",v)}}},{key:"closeSocket",value:function(o){var v=this;ve.trace("closeSocket (graceful: ".concat(o,")")),o&&this.transport.isConnected&&this.transport.sendClose(),this.websocket.close(),dr(function(){return v.fsm.socketClosed()})}},{key:"connect",value:function(){ve.trace("connect"),this.fsm.userConnect()}},{key:"disconnect",value:function(){var o=this;return ve.trace("disconnect"),this.fsm.is("disconnected")?Promise.resolve():new Promise(function(v){o.disconnectedPromiseResolve=v,o.fsm.userDisconnect()})}},{key:"updateToken",value:function(o){var v=this;return ve.trace("updateToken:",o),new Promise(function(d,m){v.once("tokenUpdated",function(w){w?m(w):d()}),v.fsm.userUpdateToken()})}},{key:"isTerminalState",get:function(){return this.terminalStates.indexOf(this.fsm.state)!==-1}},{key:"getTerminationReason",get:function(){return this.terminationReason}},{key:"onCloseReceived",value:function(){this.websocket.close()}}]),u}(I),Li=function(){function y(){Q.default(this,y)}return Pe.default(y,null,[{key:"getMetadata",value:function(u){var f,o,v,d,m,w,C,P,U=u&&u.clientMetadata?u.clientMetadata:{},ee=["ver","env","envv","os","osv","osa","type","sdk","sdkv","dev","devv","devt","app","appv"],Se={env:(f=ut.name)!==null&&f!==void 0?f:"unknown",envv:(o=ut.version)!==null&&o!==void 0?o:"unknown",os:(v=(d=ut.os)===null||d===void 0?void 0:d.family)!==null&&v!==void 0?v:"unknown",osv:(m=(w=ut.os)===null||w===void 0?void 0:w.version)!==null&&m!==void 0?m:"unknown",osa:(C=(P=ut.os)===null||P===void 0?void 0:P.architecture)!==null&&C!==void 0?C:"unknown",sdk:"js-default"},Ue={};return ee.filter(function(Re){return Re in U||Re in Se}).forEach(function(Re){return Ue[Re]=Re in U?U[Re]:Se[Re]}),Ue}}]),y}(),xi=3e4;function Ui(y){return y>=200&&y<300}function Ba(y){switch(K.default(y)){case"undefined":return"";case"object":return JSON.stringify(y);default:return y}}var Qr=function(){function y(p,u){var f=this;Q.default(this,y),this.config=u,this.activeRequests=new Map,this.channel=p,this.channel.on("reply",function(o){return f.processReply(o)}),this.channel.on("disconnected",function(){f.activeRequests.forEach(function(o){clearTimeout(o.timeout),o.reject(new it("disconnected"))}),f.activeRequests.clear()})}return Pe.default(y,[{key:"isConnected",get:function(){return this.channel.isConnected}},{key:"processReply",value:function(u){var f=this.activeRequests.get(u.id);f&&(clearTimeout(f.timeout),this.activeRequests.delete(u.id),Ui(u.status.code)?f.resolve(u):(f.reject(new Kt("Transport failure: "+u.status.status,u)),ve.trace("message rejected")))}},{key:"storeRequest",value:function(u,f,o){var v={resolve:f,reject:o,timeout:setTimeout(function(){ve.trace("request",u,"is timed out"),o(new it("Twilsock: request timeout: "+u))},xi)};this.activeRequests.set(u,v)}},{key:"shutdown",value:function(){this.activeRequests.forEach(function(u){clearTimeout(u.timeout),u.reject(new it("Twilsock: request cancelled by user"))}),this.activeRequests.clear()}},{key:"sendInit",value:function(){var p=$e.default(J.default.mark(function f(){var o,v,d;return J.default.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return ve.trace("sendInit"),o=Li.getMetadata(this.config),v=new je(this.config.token,this.config.continuationToken,o,this.config.initRegistrations,this.config.tweaks),w.next=5,this.sendWithReply(v);case 5:return d=w.sent,w.abrupt("return",new bn(d.id,d.header.continuation_token,new Set(d.header.capabilities),d.header.continuation_token_status,d.header.offline_storage,d.header.init_registrations,d.header.debug_info));case 7:case"end":return w.stop()}},f,this)}));function u(){return p.apply(this,arguments)}return u}()},{key:"sendClose",value:function(){var u=new ae;this.send(u)}},{key:"sendWithReply",value:function(u,f){var o=this;return new Promise(function(v,d){var m=o.send(u,f);o.storeRequest(m,v,d)})}},{key:"send",value:function(u,f){u.id=u.id||"TM".concat(M.v4());var o=_n.createPacket(u,Ba(f));try{return this.channel.send(o),u.id}catch(v){throw ve.debug("failed to send ",u,v),ve.trace(v.stack),v}}}]),y}();function ji(y){var p=Di();return function(){var f=ge.default(y),o;if(p){var v=ge.default(this).constructor;o=Reflect.construct(f,arguments,v)}else o=f.apply(this,arguments);return ye.default(this,o)}}function Di(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var pr=function(y){x.default(u,y);var p=ji(u);function u(f){var o;return Q.default(this,u),o=p.call(this),H.default(L.default(o),"socket",null),o.url=f,o.url=f,o.WebSocket=n.WebSocket||n.MozWebSocket||{},o}return Pe.default(u,[{key:"isConnected",get:function(){return!!this.socket&&this.socket.readyState===1}},{key:"connect",value:function(){var o=this;ve.trace("connecting to socket");var v;try{v=new this.WebSocket(this.url)}catch(d){ve.debug("Socket error: ".concat(this.url)),this.emit("socketError",d);return}v.binaryType="arraybuffer",v.onopen=function(){ve.debug("socket opened ".concat(o.url)),o.emit("connected")},v.onclose=function(d){ve.debug("socket closed",d),o.emit("disconnected",d)},v.onerror=function(d){ve.debug("Socket error:",d),o.emit("socketError",d)},v.onmessage=function(d){o.emit("message",d.data)},this.socket=v}},{key:"send",value:function(o){return this.socket&&this.socket.send(o)}},{key:"close",value:function(){if(ve.trace("closing socket"),this.socket){this.socket.onopen=null,this.socket.onclose=null,this.socket.onerror=null,this.socket.onmessage=null;try{this.socket.close()}finally{}}}}]),u}(I);function Gt(y){var p=Fi();return function(){var f=ge.default(y),o;if(p){var v=ge.default(this).constructor;o=Reflect.construct(f,arguments,v)}else o=f.apply(this,arguments);return ye.default(this,o)}}function Fi(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Bi=function(y){x.default(u,y);var p=Gt(u);function u(f){var o;return Q.default(this,u),o=p.call(this),o.transport=f,o.registrations=new Map,o.registrationsInProgress=new Map,o}return Pe.default(u,[{key:"putNotificationContext",value:function(){var f=$e.default(J.default.mark(function v(d,m){var w;return J.default.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return w={method:"put_notification_ctx",notification_ctx_id:d},P.next=3,this.transport.sendWithReply(w,m);case 3:case"end":return P.stop()}},v,this)}));function o(v,d){return f.apply(this,arguments)}return o}()},{key:"deleteNotificationContext",value:function(){var f=$e.default(J.default.mark(function v(d){var m;return J.default.wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return m={method:"delete_notification_ctx",notification_ctx_id:d},C.next=3,this.transport.sendWithReply(m);case 3:case"end":return C.stop()}},v,this)}));function o(v){return f.apply(this,arguments)}return o}()},{key:"updateRegistration",value:function(){var f=$e.default(J.default.mark(function v(d,m){var w,C;return J.default.wrap(function(U){for(;;)switch(U.prev=U.next){case 0:return ve.debug("update registration for context",d),w=this.registrationsInProgress.get(d),w||(w=new Set,this.registrationsInProgress.set(d,w)),C=M.v4(),w.add(C),U.prev=5,U.next=8,this.putNotificationContext(d,m);case 8:ve.debug("registration attempt succeeded for context",m),w.delete(C),w.size===0&&(this.registrationsInProgress.delete(d),this.emit("registered",d)),U.next=19;break;case 13:U.prev=13,U.t0=U.catch(5),ve.warn("registration attempt failed for context",m),ve.debug(U.t0),w.delete(C),w.size===0&&(this.registrationsInProgress.delete(d),this.emit("registrationFailed",d,U.t0));case 19:case"end":return U.stop()}},v,this,[[5,13]])}));function o(v,d){return f.apply(this,arguments)}return o}()},{key:"updateRegistrations",value:function(){var f=$e.default(J.default.mark(function v(){var d=this,m;return J.default.wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return ve.trace("refreshing ".concat(this.registrations.size," registrations")),m=[],this.registrations.forEach(function(P,U){m.push(d.updateRegistration(U,P))}),C.next=5,Promise.all(m);case 5:case"end":return C.stop()}},v,this)}));function o(){return f.apply(this,arguments)}return o}()},{key:"setNotificationsContext",value:function(){var f=$e.default(J.default.mark(function v(d,m){return J.default.wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(!(!d||!m)){C.next=2;break}throw new it("Invalid arguments provided");case 2:return this.registrations.set(d,m),C.next=5,this.updateRegistration(d,m);case 5:return C.abrupt("return",C.sent);case 6:case"end":return C.stop()}},v,this)}));function o(v,d){return f.apply(this,arguments)}return o}()},{key:"removeNotificationsContext",value:function(){var f=$e.default(J.default.mark(function v(d){return J.default.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:if(this.registrations.has(d)){w.next=2;break}return w.abrupt("return");case 2:return w.next=4,this.deleteNotificationContext(d);case 4:this.transport.isConnected&&this.registrations.delete(d);case 5:case"end":return w.stop()}},v,this)}));function o(v){return f.apply(this,arguments)}return o}()}]),u}(I);function qi(y){var p=Wi();return function(){var f=ge.default(y),o;if(p){var v=ge.default(this).constructor;o=Reflect.construct(f,arguments,v)}else o=f.apply(this,arguments);return ye.default(this,o)}}function Wi(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var kn=function(y){x.default(u,y);var p=qi(u);function u(f,o,v){var d;return Q.default(this,u),d=p.call(this,o),d.status=f,d.description=o,d.body=v,d}return u}(it);function Tn(y){var p=In();return function(){var f=ge.default(y),o;if(p){var v=ge.default(this).constructor;o=Reflect.construct(f,arguments,v)}else o=f.apply(this,arguments);return ye.default(this,o)}}function In(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Cr=function(y){x.default(u,y);var p=Tn(u);function u(f){return Q.default(this,u),p.call(this,f)}return u}(it),sa=2e4;function qa(y){return y>=200&&y<300}function Wa(y){return y&&y.header&&y.header.http_status}function Gi(y){var p=y.match(/^(https?\:)\/\/(([^:\/?#]*)(?:\:([0-9]+))?)(\/[^?#]*)(\?[^#]*|)(#.*|)$/);if(p){var u={protocol:p[1],host:p[2],hostname:p[3],port:p[4],pathname:p[5],search:p[6],hash:p[7],params:{}};if(u.search.length>0){var f=u.search.substring(1);u.params=f.split("&").map(function(o){return o.split("=")}).reduce(function(o,v){return o.hasOwnProperty(v[0])?Array.isArray(o[v[0]])?o[v[0]].push(v[1]):o[v[0]]=[o[v[0]],v[1]]:o[v[0]]=v[1],o},{})}return u}throw new it("Incorrect URI: "+y)}function Hi(y,p){var u=Gi(p),f={method:y,host:u.host,path:u.pathname};return u.params&&(f.params=u.params),f}function et(y,p,u,f,o){return{to:Hi(y,p),headers:u,body:f,grant:o}}var ua=function(){function y(p,u,f){Q.default(this,y),this.config=f,this.transport=p,this.pendingMessages=[],this.twilsock=u}return Pe.default(y,[{key:"saveMessage",value:function(u){var f=this;return new Promise(function(o,v){var d={message:u,resolve:o,reject:v,alreadyRejected:!1,timeout:setTimeout(function(){ve.debug("request is timed out"),v(new it("request '".concat(u.to.method,"' to '").concat(u.to.host,"' timed out"))),d.alreadyRejected=!0},sa)};f.pendingMessages.push(d)})}},{key:"sendPendingMessages",value:function(){for(var u=this,f=function(){var d=u.pendingMessages[0];if(!d.alreadyRejected)try{var m=d.message;u.actualSend(m).then(function(w){return d.resolve(w)}).catch(function(w){return d.reject(w)}),clearTimeout(d.timeout)}catch(w){return ve.debug("Failed to send pending message",w),"break"}u.pendingMessages.splice(0,1)};this.pendingMessages.length>0;){var o=f();if(o==="break")break}}},{key:"rejectPendingMessages",value:function(){var u=this;this.pendingMessages.forEach(function(f){f.reject(new Cr("Unable to connect: "+u.twilsock.getTerminationReason)),f.alreadyRejected=!0,clearTimeout(f.timeout)}),this.pendingMessages.splice(0,this.pendingMessages.length)}},{key:"actualSend",value:function(){var p=$e.default(J.default.mark(function f(o){var v,d,m,w,C,P,U,ee;return J.default.wrap(function(Ue){for(;;)switch(Ue.prev=Ue.next){case 0:return d=o.to,m=o.headers,w=o.body,C=(v=o.grant)!==null&&v!==void 0?v:this.config.activeGrant,P={host:d.host,path:d.path,method:d.method,params:d.params,headers:m},U=new V(C,m["Content-Type"]||"application/json",P),ve.trace("Sending upstream message",U),Ue.next=9,this.transport.sendWithReply(U,w);case 9:if(ee=Ue.sent,ve.trace("Received upstream message response",ee),!(Wa(ee)&&!qa(ee.header.http_status.code))){Ue.next=13;break}throw new kn(ee.header.http_status.code,ee.header.http_status.status,ee.body);case 13:return Ue.abrupt("return",{status:ee.header.http_status,headers:ee.header.http_headers,body:ee.body});case 14:case"end":return Ue.stop()}},f,this)}));function u(f){return p.apply(this,arguments)}return u}()},{key:"send",value:function(u,f){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},v=arguments.length>3?arguments[3]:void 0,d=arguments.length>4?arguments[4]:void 0;if(this.twilsock.isTerminalState)return Promise.reject(new Cr("Unable to connect: "+this.twilsock.getTerminationReason));var m=et(u,f,o,v,d);return this.twilsock.isConnected?this.actualSend(m):this.saveMessage(m)}}]),y}(),Ga=function(){function y(){var p=this;Q.default(this,y),this._promise=new Promise(function(u,f){p._resolve=u,p._reject=f})}return Pe.default(y,[{key:"promise",get:function(){return this._promise}},{key:"update",value:function(u){this._resolve(u)}},{key:"set",value:function(u){this._resolve(u)}},{key:"fail",value:function(u){this._reject(u)}}]),y}(),Rn=function(){function y(p){Q.default(this,y),this.id=p}return Pe.default(y,null,[{key:"create",value:function(u){if(u instanceof Object&&"storage_id"in u)return new y(u.storage_id);throw new it('Field "storage_id" is missing')}}]),y}(),oa=function(){function y(){return Q.default(this,y),H.default(this,"initializedFlag","twilio_twilsock_token_storage"),H.default(this,"tokenStoragePrefix","twilio_continuation_token_"),y._instance||(this.initialize(),y._instance=this),y._instance}return Pe.default(y,[{key:"sessionStorage",value:function(){try{return n.sessionStorage}catch{return null}}},{key:"window",value:function(){try{return n.window}catch{return null}}},{key:"storeToken",value:function(u,f){this.canStore()&&this.sessionStorage.setItem(this.getKeyName(f),u)}},{key:"getStoredToken",value:function(u){return this.canStore()?this.sessionStorage.getItem(this.getKeyName(u)):null}},{key:"initialize",value:function(){var u=this;if(this.canStore()){var f=this.sessionStorage.getItem(this.initializedFlag);f&&this.clear(),this.sessionStorage.setItem(this.initializedFlag,"true");var o=this.sessionStorage.removeItem;this.window.addEventListener("unload",function(){o(u.initializedFlag)})}}},{key:"clear",value:function(){if(this.canStore()){for(var u=[],f=0;f<this.sessionStorage.length;f++){var o=this.sessionStorage.key(f);o&&o.indexOf(this.tokenStoragePrefix)===0&&u.push(o)}var v=this.sessionStorage.removeItem;u.forEach(function(d){return v(d)}),v(this.initializedFlag)}}},{key:"getKeyName",value:function(u){return"".concat(this.tokenStoragePrefix).concat(u)}},{key:"canStore",value:function(){return!!(this.sessionStorage&&this.sessionStorage.length&&this.window)}}]),y}();H.default(oa,"_instance",null);var Xr=new oa,ot=function(){function y(p,u,f,o,v,d){Q.default(this,y),this.title=p,this.details=u,this.start=f,this.type=v,this.id=d,this.end=o}return Pe.default(y,[{key:"toTelemetryEvent",value:function(){var u=new Date,f=this.start,o=this.end?this.end:u;if(o<f){var v=o;o=f,f=v}var d=f.getTime()-u.getTime(),m=o.getTime()-u.getTime(),w=new Fe(d,m,this.title,this.details,this.id,this.type);return w}}]),y}();e.TelemetryPoint=void 0,function(y){y[y.Start=0]="Start",y[y.End=1]="End"}(e.TelemetryPoint||(e.TelemetryPoint={})),e.EventSendingLimitation=void 0,function(y){y[y.MinEventsPortion=0]="MinEventsPortion",y[y.AnyEvents=1]="AnyEvents",y[y.AnyEventsIncludingUnfinished=2]="AnyEventsIncludingUnfinished"}(e.EventSendingLimitation||(e.EventSendingLimitation={}));var vr=function(){function y(p,u){Q.default(this,y),H.default(this,"minEventsPortionToSend",50),H.default(this,"maxEventsPortionToSend",100),H.default(this,"pendingEvents",new Map),H.default(this,"readyEvents",[]),H.default(this,"hasInitializationFinished",!1),H.default(this,"_canSendTelemetry",!1),this.config=p,this.packetInterface=u}return Pe.default(y,[{key:"isTelemetryEnabled",get:function(){return this.config.confirmedCapabilities.has("telemetry.v1")}},{key:"canSendTelemetry",get:function(){return this._canSendTelemetry&&this.isTelemetryEnabled},set:function(u){ve.debug("TelemetryTracker.canSendTelemetry: ".concat(u," TelemetryTracker.isTelemetryEnabled: ").concat(this.isTelemetryEnabled)),this._canSendTelemetry&&!u&&(this.pendingEvents.clear(),this.readyEvents=[]),this._canSendTelemetry=u,u&&this.sendTelemetry(e.EventSendingLimitation.AnyEvents),u&&!this.hasInitializationFinished&&(this.hasInitializationFinished=!0)}},{key:"addTelemetryEvent",value:function(u){!this.canSendTelemetry&&this.hasInitializationFinished||this.readyEvents.push(u)}},{key:"addPartialEvent",value:function(u,f,o){ve.debug("Adding ".concat(o===e.TelemetryPoint.Start?"starting":"ending"," timepoint for '").concat(f,"' event"));var v=this.pendingEvents.has(f);if(o===e.TelemetryPoint.Start)v&&ve.debug("Overwriting starting point for '".concat(f,"' event")),this.pendingEvents.set(f,u);else{if(!v){ve.info("Could not find started event for '".concat(f,"' event"));return}this.addTelemetryEvent(this.merge(this.pendingEvents.get(f),u)),this.pendingEvents.delete(f)}}},{key:"getTelemetryToSend",value:function(u){return!this.canSendTelemetry||this.readyEvents.length==0?[]:u==e.EventSendingLimitation.MinEventsPortion&&this.readyEvents.length<this.minEventsPortionToSend?[]:this.getTelemetryPortion(u==e.EventSendingLimitation.AnyEventsIncludingUnfinished)}},{key:"getTelemetryPortion",value:function(u){var f=this,o=Math.min(this.readyEvents.length,this.maxEventsPortionToSend),v=this.readyEvents.splice(0,o);return u&&v.length<this.maxEventsPortionToSend&&this.pendingEvents.forEach(function(d,m){if(!(v.length>=f.maxEventsPortionToSend)){var w=f.pendingEvents.get(m);f.pendingEvents.delete(m),v.push(new ot("[UNFINISHED] ".concat(w.title),w.details,w.start,null,w.type,w.id))}}),v}},{key:"merge",value:function(u,f){return new ot(f.title?f.title:u.title,f.details?f.details:u.details,u.start,f.end,f.type?f.type:u.type,f.id?f.id:u.id)}},{key:"sendTelemetryIfMinimalPortionCollected",value:function(){this.sendTelemetry(e.EventSendingLimitation.MinEventsPortion)}},{key:"sendTelemetry",value:function(u){var f=this.getTelemetryToSend(u);if(f.length!==0)try{this.packetInterface.send(new Me(f.map(function(o){return o.toTelemetryEvent()})))}catch(o){ve.debug("Error while sending ".concat(f.length," telemetry events due to ").concat(o,"; they will be resubmitted")),this.readyEvents=this.readyEvents.concat(f)}}}]),y}();function ca(y){var p=hr();return function(){var f=ge.default(y),o;if(p){var v=ge.default(this).constructor;o=Reflect.construct(f,arguments,v)}else o=f.apply(this,arguments);return ye.default(this,o)}}function hr(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var _=function y(){Q.default(this,y)};H.default(_,"TWILSOCK_CONNECT","twilsock.sdk.connect"),H.default(_,"TWILSOCK_INIT","twilsock.sdk.init"),e.TwilsockClient=function(y){x.default(u,y);var p=ca(u);function u(f,o,v){var d;Q.default(this,u),d=p.call(this),H.default(L.default(d),"version",qt),H.default(L.default(d),"offlineStorageDeferred",new Ga),v.continuationToken=v.continuationToken?v.continuationToken:Xr.getStoredToken(o);var m=d.config=new xt(f,o,v);ve.setLevel(m.logLevel);var w=new pr(m.url),C=new Qr(w,m);return d.channel=new Ze(w,C,m),d.registrations=new Bi(C),d.upstream=new ua(C,d.channel,m),d.telemetryTracker=new vr(m,C),d.channel.on("initialized",function(){return d.telemetryTracker.canSendTelemetry=!0}),w.on("disconnected",function(){return d.telemetryTracker.canSendTelemetry=!1}),d.registrations.on("registered",function(P){return d.emit("registered",P)}),d.channel.on("message",function(P,U){return setTimeout(function(){return d.emit("message",P,U)},0)}),d.channel.on("stateChanged",function(P){return setTimeout(function(){return d.emit("stateChanged",P)},0)}),d.channel.on("connectionError",function(P){return setTimeout(function(){return d.emit("connectionError",P)},0)}),d.channel.on("tokenAboutToExpire",function(){return setTimeout(function(){return d.emit("tokenAboutToExpire")},0)}),d.channel.on("tokenExpired",function(){return setTimeout(function(){return d.emit("tokenExpired")},0)}),d.channel.on("connected",function(){return d.registrations.updateRegistrations()}),d.channel.on("connected",function(){return d.upstream.sendPendingMessages()}),d.channel.on("connected",function(){return setTimeout(function(){return d.emit("connected")},0)}),d.channel.on("beforeConnect",function(){return d.telemetryTracker.addPartialEvent(new ot("Establish WebSocket connection","",new Date),_.TWILSOCK_CONNECT,e.TelemetryPoint.Start)}),d.channel.on("connected",function(){return d.telemetryTracker.addPartialEvent(new ot("Establish WebSocket connection","",new Date,new Date),_.TWILSOCK_CONNECT,e.TelemetryPoint.End)}),d.channel.on("beforeSendInit",function(){return d.telemetryTracker.addPartialEvent(new ot("Send Twilsock init","",new Date),_.TWILSOCK_INIT,e.TelemetryPoint.Start)}),d.channel.on("initialized",function(){return d.telemetryTracker.addPartialEvent(new ot("Send Twilsock init","Succeeded",new Date,new Date),_.TWILSOCK_INIT,e.TelemetryPoint.End)}),d.channel.on("sendInitFailed",function(){return d.telemetryTracker.addPartialEvent(new ot("Send Twilsock init","Failed",new Date,new Date),_.TWILSOCK_INIT,e.TelemetryPoint.End)}),d.channel.on("initialized",function(P){d.handleStorageId(o,P),Xr.storeToken(P.continuationToken,o),setTimeout(function(){return d.emit("initialized",P)},0)}),d.channel.on("disconnected",function(){return setTimeout(function(){return d.emit("disconnected")},0)}),d.channel.on("disconnected",function(){return d.upstream.rejectPendingMessages()}),d.channel.on("disconnected",function(){return d.offlineStorageDeferred.fail(new it("Client disconnected"))}),d.offlineStorageDeferred.promise.catch(function(){}),d}return Pe.default(u,[{key:"emit",value:function(o){for(var v,d=arguments.length,m=new Array(d>1?d-1:0),w=1;w<d;w++)m[w-1]=arguments[w];return ve.debug("Emitting ".concat(o.toString(),"(").concat(m.map(function(C){return JSON.stringify(C)}).join(", "),")")),(v=ue.default(ge.default(u.prototype),"emit",this)).call.apply(v,[this,o].concat(m))}},{key:"handleStorageId",value:function(o,v){if(!v.offlineStorage)this.offlineStorageDeferred.fail(new it("No offline storage id"));else if(v.offlineStorage.hasOwnProperty(o))try{this.offlineStorageDeferred.set(Rn.create(v.offlineStorage[o])),ve.debug("Offline storage for '".concat(o,"' product: ").concat(JSON.stringify(v.offlineStorage[o]),"."))}catch(d){this.offlineStorageDeferred.fail(new it("Failed to parse offline storage for ".concat(o," ").concat(JSON.stringify(v.offlineStorage[o]),". ").concat(d,".")))}else this.offlineStorageDeferred.fail(new it("No offline storage id for '".concat(o,"' product: ").concat(JSON.stringify(v.offlineStorage))))}},{key:"storageId",value:function(){return this.offlineStorageDeferred.promise}},{key:"isConnected",get:function(){return this.channel.isConnected}},{key:"state",get:function(){return this.channel.state}},{key:"updateToken",value:function(){var f=$e.default(J.default.mark(function v(d){return J.default.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:if(ve.trace("updating token '".concat(d,"'")),this.config.token!==d){w.next=3;break}return w.abrupt("return");case 3:return this.config.updateToken(d),w.next=6,this.channel.updateToken(d);case 6:return w.abrupt("return",w.sent);case 7:case"end":return w.stop()}},v,this)}));function o(v){return f.apply(this,arguments)}return o}()},{key:"setNotificationsContext",value:function(){var f=$e.default(J.default.mark(function v(d,m){return J.default.wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return C.next=2,this.registrations.setNotificationsContext(d,m);case 2:case"end":return C.stop()}},v,this)}));function o(v,d){return f.apply(this,arguments)}return o}()},{key:"removeNotificationsContext",value:function(){var f=$e.default(J.default.mark(function v(d){return J.default.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return w.next=2,this.registrations.removeNotificationsContext(d);case 2:case"end":return w.stop()}},v,this)}));function o(v){return f.apply(this,arguments)}return o}()},{key:"connect",value:function(){return this.channel.connect()}},{key:"disconnect",value:function(){var f=$e.default(J.default.mark(function v(){return J.default.wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return this.telemetryTracker.sendTelemetry(e.EventSendingLimitation.AnyEventsIncludingUnfinished),m.next=3,this.channel.disconnect();case 3:return m.abrupt("return",m.sent);case 4:case"end":return m.stop()}},v,this)}));function o(){return f.apply(this,arguments)}return o}()},{key:"get",value:function(){var f=$e.default(J.default.mark(function v(d,m,w){return J.default.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return this.telemetryTracker.sendTelemetry(e.EventSendingLimitation.AnyEvents),P.next=3,this.upstream.send("GET",d,m,void 0,w);case 3:return P.abrupt("return",P.sent);case 4:case"end":return P.stop()}},v,this)}));function o(v,d,m){return f.apply(this,arguments)}return o}()},{key:"post",value:function(){var f=$e.default(J.default.mark(function v(d,m,w,C){return J.default.wrap(function(U){for(;;)switch(U.prev=U.next){case 0:return this.telemetryTracker.sendTelemetry(e.EventSendingLimitation.AnyEvents),U.next=3,this.upstream.send("POST",d,m,w,C);case 3:return U.abrupt("return",U.sent);case 4:case"end":return U.stop()}},v,this)}));function o(v,d,m,w){return f.apply(this,arguments)}return o}()},{key:"put",value:function(){var f=$e.default(J.default.mark(function v(d,m,w,C){return J.default.wrap(function(U){for(;;)switch(U.prev=U.next){case 0:return this.telemetryTracker.sendTelemetry(e.EventSendingLimitation.AnyEvents),U.next=3,this.upstream.send("PUT",d,m,w,C);case 3:return U.abrupt("return",U.sent);case 4:case"end":return U.stop()}},v,this)}));function o(v,d,m,w){return f.apply(this,arguments)}return o}()},{key:"delete",value:function(){var f=$e.default(J.default.mark(function v(d,m,w,C){return J.default.wrap(function(U){for(;;)switch(U.prev=U.next){case 0:return this.telemetryTracker.sendTelemetry(e.EventSendingLimitation.AnyEvents),U.next=3,this.upstream.send("DELETE",d,m,w,C);case 3:return U.abrupt("return",U.sent);case 4:case"end":return U.stop()}},v,this)}));function o(v,d,m,w){return f.apply(this,arguments)}return o}()},{key:"addTelemetryEvent",value:function(o){this.telemetryTracker.addTelemetryEvent(o),this.telemetryTracker.sendTelemetryIfMinimalPortionCollected()}},{key:"addPartialTelemetryEvent",value:function(o,v,d){this.telemetryTracker.addPartialEvent(o,v,d),d===e.TelemetryPoint.End&&this.telemetryTracker.sendTelemetryIfMinimalPortionCollected()}}]),u}(I),e.TwilsockClient=ze([S.validateConstructorTypes(S.nonEmptyString,S.nonEmptyString,[S.pureObject,"undefined",S.literal(null)]),re("design:paramtypes",[String,String,Object])],e.TwilsockClient);var T=function(){function y(p){Q.default(this,y),this.product=p,this.type="ers",this.notification_protocol_version=0,this.message_types=[]}return Pe.default(y,[{key:"populateInitRegistrations",value:function(u){var f=new Set(this.message_types);for(var o in u)f.add(u[o]);this.message_types=Array.from(f)}}]),y}();e.InitRegistration=T,e.TelemetryEventDescription=ot,e.TelemetryTracker=vr,e.TransportUnavailableError=Cr,e.Twilsock=e.TwilsockClient,e.TwilsockError=it})(Do);var kS={},Uy=mt,wF=Le,SF=lt,$F=Ne,cl=Ls,_F=Ms,kF=Rs,TF=Dt,IF=Es,Za=Object.assign,jy=Object.defineProperty,RF=wF([].concat),TS=!Za||$F(function(){if(Uy&&Za({b:1},Za(jy({},"a",{enumerable:!0,get:function(){jy(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e={},n={},r=Symbol(),t="abcdefghijklmnopqrst";return e[r]=7,t.split("").forEach(function(a){n[a]=a}),Za({},e)[r]!=7||cl(Za({},n)).join("")!=t})?function(n,r){for(var t=TF(n),a=arguments.length,i=1,s=_F.f,l=kF.f;a>i;)for(var c=IF(arguments[i++]),h=s?RF(cl(c),s(c)):cl(c),g=h.length,b=0,$;g>b;)$=h[b++],(!Uy||SF(l,c,$))&&(t[$]=c[$]);return t}:Za,EF=We,Dy=TS;EF({target:"Object",stat:!0,arity:2,forced:Object.assign!==Dy},{assign:Dy});/*
@license
The MIT License (MIT)

Copyright (c) 2016 Twilio Inc.

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.

*/(function(e){Object.defineProperty(e,"__esModule",{value:!0});var n=Ri.exports,r=ra.exports,t=Na.exports,a=Xn.exports,i=Zn.exports,s=Yr.exports,l=Gs,c=ea.exports,h=Do,g=Qn.exports,b=ta.exports,$=mn,S=Hs.exports,R=zs.exports,N=Oi.exports,M=Fo,W=Pt;function z(V){return V&&typeof V=="object"&&"default"in V?V:{default:V}}function me(V){if(V&&V.__esModule)return V;var Y=Object.create(null);return V&&Object.keys(V).forEach(function(D){if(D!=="default"){var G=Object.getOwnPropertyDescriptor(V,D);Object.defineProperty(Y,D,G.get?G:{enumerable:!0,get:function(){return V[D]}})}}),Y.default=V,Object.freeze(Y)}var le=z(n),De=z(r),$e=z(t),Pe=z(a),L=z(i),ue=z(s),x=z(l),ye=z(c),ge=z(g),Q=z(b),H=z(S),J=z(R),K=me(N),he=me(M);function E(V,Y,D,G){var B=arguments.length,te=B<3?Y:G===null?G=Object.getOwnPropertyDescriptor(Y,D):G,ae;if((typeof Reflect=="undefined"?"undefined":ye.default(Reflect))==="object"&&typeof Reflect.decorate=="function")te=Reflect.decorate(V,Y,D,G);else for(var de=V.length-1;de>=0;de--)(ae=V[de])&&(te=(B<3?ae(te):B>3?ae(Y,D,te):ae(Y,D))||te);return B>3&&te&&Object.defineProperty(Y,D,te),te}function Te(V,Y){if((typeof Reflect=="undefined"?"undefined":ye.default(Reflect))==="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(V,Y)}var ut;function ze(){}ze.prototype=Object.create(null);function re(){re.init.call(this)}re.EventEmitter=re,re.usingDomains=!1,re.prototype.domain=void 0,re.prototype._events=void 0,re.prototype._maxListeners=void 0,re.defaultMaxListeners=10,re.init=function(){this.domain=null,re.usingDomains&&ut.active,(!this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=new ze,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},re.prototype.setMaxListeners=function(Y){if(typeof Y!="number"||Y<0||isNaN(Y))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=Y,this};function F(V){return V._maxListeners===void 0?re.defaultMaxListeners:V._maxListeners}re.prototype.getMaxListeners=function(){return F(this)};function q(V,Y,D){if(Y)V.call(D);else for(var G=V.length,B=Z(V,G),te=0;te<G;++te)B[te].call(D)}function I(V,Y,D,G){if(Y)V.call(D,G);else for(var B=V.length,te=Z(V,B),ae=0;ae<B;++ae)te[ae].call(D,G)}function O(V,Y,D,G,B){if(Y)V.call(D,G,B);else for(var te=V.length,ae=Z(V,te),de=0;de<te;++de)ae[de].call(D,G,B)}function pe(V,Y,D,G,B,te){if(Y)V.call(D,G,B,te);else for(var ae=V.length,de=Z(V,ae),Ae=0;Ae<ae;++Ae)de[Ae].call(D,G,B,te)}function se(V,Y,D,G){if(Y)V.apply(D,G);else for(var B=V.length,te=Z(V,B),ae=0;ae<B;++ae)te[ae].apply(D,G)}re.prototype.emit=function(Y){var D,G,B,te,ae,de,Ae,Fe=Y==="error";if(de=this._events,de)Fe=Fe&&de.error==null;else if(!Fe)return!1;if(Ae=this.domain,Fe){if(D=arguments[1],Ae)D||(D=new Error('Uncaught, unspecified "error" event')),D.domainEmitter=this,D.domain=Ae,D.domainThrown=!1,Ae.emit("error",D);else{if(D instanceof Error)throw D;var Me=new Error('Uncaught, unspecified "error" event. ('+D+")");throw Me.context=D,Me}return!1}if(G=de[Y],!G)return!1;var be=typeof G=="function";switch(B=arguments.length,B){case 1:q(G,be,this);break;case 2:I(G,be,this,arguments[1]);break;case 3:O(G,be,this,arguments[1],arguments[2]);break;case 4:pe(G,be,this,arguments[1],arguments[2],arguments[3]);break;default:for(te=new Array(B-1),ae=1;ae<B;ae++)te[ae-1]=arguments[ae];se(G,be,this,te)}return!0};function _e(V,Y,D,G){var B,te,ae;if(typeof D!="function")throw new TypeError('"listener" argument must be a function');if(te=V._events,te?(te.newListener&&(V.emit("newListener",Y,D.listener?D.listener:D),te=V._events),ae=te[Y]):(te=V._events=new ze,V._eventsCount=0),!ae)ae=te[Y]=D,++V._eventsCount;else if(typeof ae=="function"?ae=te[Y]=G?[D,ae]:[ae,D]:G?ae.unshift(D):ae.push(D),!ae.warned&&(B=F(V),B&&B>0&&ae.length>B)){ae.warned=!0;var de=new Error("Possible EventEmitter memory leak detected. "+ae.length+" "+Y+" listeners added. Use emitter.setMaxListeners() to increase limit");de.name="MaxListenersExceededWarning",de.emitter=V,de.type=Y,de.count=ae.length,Ge(de)}return V}function Ge(V){typeof console.warn=="function"?console.warn(V):console.log(V)}re.prototype.addListener=function(Y,D){return _e(this,Y,D,!1)},re.prototype.on=re.prototype.addListener,re.prototype.prependListener=function(Y,D){return _e(this,Y,D,!0)};function fe(V,Y,D){var G=!1;function B(){V.removeListener(Y,B),G||(G=!0,D.apply(V,arguments))}return B.listener=D,B}re.prototype.once=function(Y,D){if(typeof D!="function")throw new TypeError('"listener" argument must be a function');return this.on(Y,fe(this,Y,D)),this},re.prototype.prependOnceListener=function(Y,D){if(typeof D!="function")throw new TypeError('"listener" argument must be a function');return this.prependListener(Y,fe(this,Y,D)),this},re.prototype.removeListener=function(Y,D){var G,B,te,ae,de;if(typeof D!="function")throw new TypeError('"listener" argument must be a function');if(B=this._events,!B)return this;if(G=B[Y],!G)return this;if(G===D||G.listener&&G.listener===D)--this._eventsCount===0?this._events=new ze:(delete B[Y],B.removeListener&&this.emit("removeListener",Y,G.listener||D));else if(typeof G!="function"){for(te=-1,ae=G.length;ae-- >0;)if(G[ae]===D||G[ae].listener&&G[ae].listener===D){de=G[ae].listener,te=ae;break}if(te<0)return this;if(G.length===1){if(G[0]=void 0,--this._eventsCount===0)return this._events=new ze,this;delete B[Y]}else ke(G,te);B.removeListener&&this.emit("removeListener",Y,de||D)}return this},re.prototype.off=function(V,Y){return this.removeListener(V,Y)},re.prototype.removeAllListeners=function(Y){var D,G;if(G=this._events,!G)return this;if(!G.removeListener)return arguments.length===0?(this._events=new ze,this._eventsCount=0):G[Y]&&(--this._eventsCount===0?this._events=new ze:delete G[Y]),this;if(arguments.length===0){for(var B=Object.keys(G),te=0,ae;te<B.length;++te)ae=B[te],ae!=="removeListener"&&this.removeAllListeners(ae);return this.removeAllListeners("removeListener"),this._events=new ze,this._eventsCount=0,this}if(D=G[Y],typeof D=="function")this.removeListener(Y,D);else if(D)do this.removeListener(Y,D[D.length-1]);while(D[0]);return this},re.prototype.listeners=function(Y){var D,G,B=this._events;return B?(D=B[Y],D?typeof D=="function"?G=[D.listener||D]:G=Ce(D):G=[]):G=[],G},re.listenerCount=function(V,Y){return typeof V.listenerCount=="function"?V.listenerCount(Y):Ee.call(V,Y)},re.prototype.listenerCount=Ee;function Ee(V){var Y=this._events;if(Y){var D=Y[V];if(typeof D=="function")return 1;if(D)return D.length}return 0}re.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};function ke(V,Y){for(var D=Y,G=D+1,B=V.length;G<B;D+=1,G+=1)V[D]=V[G];V.pop()}function Z(V,Y){for(var D=new Array(Y);Y--;)D[Y]=V[Y];return D}function Ce(V){for(var Y=new Array(V.length),D=0;D<Y.length;++D)Y[D]=V[D].listener||V[D];return Y}var Ie=K.getLogger("twilio-notificatiions");function oe(V,Y){return["".concat(new Date().toISOString()," Twilio.Notifications ").concat(V,":")].concat(Array.from(Y))}var lr=function(){function V(){De.default(this,V)}return $e.default(V,[{key:"setLevel",value:function(D){Ie.setLevel(D)}},{key:"trace",value:function(){for(var D=arguments.length,G=new Array(D),B=0;B<D;B++)G[B]=arguments[B];Ie.trace.apply(null,oe("T",G))}},{key:"debug",value:function(){for(var D=arguments.length,G=new Array(D),B=0;B<D;B++)G[B]=arguments[B];Ie.debug.apply(null,oe("D",G))}},{key:"info",value:function(){for(var D=arguments.length,G=new Array(D),B=0;B<D;B++)G[B]=arguments[B];Ie.info.apply(null,oe("I",G))}},{key:"warn",value:function(){for(var D=arguments.length,G=new Array(D),B=0;B<D;B++)G[B]=arguments[B];Ie.warn.apply(null,oe("W",G))}},{key:"error",value:function(){for(var D=arguments.length,G=new Array(D),B=0;B<D;B++)G[B]=arguments[B];Ie.error.apply(null,oe("E",G))}}]),V}(),xe=new lr;function Rt(V){var Y=fr();return function(){var G=ue.default(V),B;if(Y){var te=ue.default(this).constructor;B=Reflect.construct(G,arguments,te)}else B=G.apply(this,arguments);return L.default(this,B)}}function fr(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var ve=function V(){var Y=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",D=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",G=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new Set;De.default(this,V),this.token=Y,this.notificationId=D,this.messageTypes=G};function qt(V,Y){return[].concat(J.default(J.default(V).filter(function(D){return!Y.has(D)})),J.default(J.default(Y).filter(function(D){return!V.has(D)})))}function xt(V,Y){var D=new Set;return V.notificationId!==Y.notificationId&&D.add("notificationId"),V.token!==Y.token&&D.add("token"),qt(V.messageTypes,Y.messageTypes).length>0&&D.add("messageType"),[D.size>0,D]}var Je=function(V){Pe.default(D,V);var Y=Rt(D);function D(G){var B;return De.default(this,D),B=Y.call(this),Q.default(ge.default(B),"desiredState",new ve),Q.default(ge.default(B),"currentState",new ve),Q.default(ge.default(B),"_hasActiveAttempt",!1),B.channelType=G,B}return $e.default(D,[{key:"setNotificationId",value:function(B){this.desiredState.notificationId=B}},{key:"isActive",value:function(){return this.desiredState.notificationId!==""}},{key:"subscribe",value:function(B){if(this.desiredState.messageTypes.has(B)){xe.debug("message type '".concat(B,"' for channel ").concat(this.channelType," is already registered"));return}this.desiredState.messageTypes.add(B)}},{key:"unsubscribe",value:function(B){!this.desiredState.messageTypes.has(B)||this.desiredState.messageTypes.delete(B)}},{key:"updateToken",value:function(B){this.desiredState.token=B}},{key:"commitChanges",value:function(){var G=le.default(x.default.mark(function te(){var ae,de,Ae,Fe,Me,be;return x.default.wrap(function(Oe){for(;;)switch(Oe.prev=Oe.next){case 0:if(!this._hasActiveAttempt){Oe.next=3;break}throw xe.error("One registration attempt is already in progress"),new Error("One registration attempt is already in progress");case 3:if(ae=xt(this.desiredState,this.currentState),de=H.default(ae,2),Ae=de[0],Fe=de[1],Ae){Oe.next=6;break}return Oe.abrupt("return");case 6:if(this.currentState.notificationId||Fe.delete("notificationId"),xe.trace("Persisting ".concat(this.channelType," registration"),Fe,this.desiredState),Oe.prev=8,this._hasActiveAttempt=!0,Me=new ve,Me.token=this.desiredState.token,Me.notificationId=this.desiredState.notificationId,Me.messageTypes=new Set(this.desiredState.messageTypes),!(Me.messageTypes.size>0)){Oe.next=24;break}return Oe.next=17,this.updateRegistration(Me,Fe);case 17:be=Oe.sent,this.currentState.token=be.token,this.currentState.notificationId=be.notificationId,this.currentState.messageTypes=new Set(be.messageTypes),this.emit("stateChanged",this.channelType,"registered",this.currentState),Oe.next=30;break;case 24:return Oe.next=26,this.removeRegistration();case 26:this.currentState.token=Me.token,this.currentState.notificationId=Me.notificationId,this.currentState.messageTypes.clear(),this.emit("stateChanged",this.channelType,"unregistered",this.currentState);case 30:Oe.next=35;break;case 32:throw Oe.prev=32,Oe.t0=Oe.catch(8),Oe.t0;case 35:return Oe.prev=35,this._hasActiveAttempt=!1,Oe.finish(35);case 38:case"end":return Oe.stop()}},te,this,[[8,32,35,38]])}));function B(){return G.apply(this,arguments)}return B}()}]),D}(re);function pt(V){var Y=Ve();return function(){var G=ue.default(V),B;if(Y){var te=ue.default(this).constructor;B=Reflect.construct(G,arguments,te)}else B=G.apply(this,arguments);return L.default(this,B)}}function Ve(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var je={min:2e3,max:12e4,randomness:.2},vt=function(V){Pe.default(D,V);var Y=pt(D);function D(G,B,te,ae){var de;return De.default(this,D),de=Y.call(this,G),Q.default(ge.default(de),"registrationId",null),de.context=B,de.twilsock=te,de.registrarUrl=ae,de}return $e.default(D,[{key:"updateRegistration",value:function(){var G=le.default(x.default.mark(function te(ae,de){var Ae=this,Fe,Me,be,Wt,Oe;return x.default.wrap(function(ht){for(;;)switch(ht.prev=ht.next){case 0:if(!de.has("notificationId")){ht.next=3;break}return ht.next=3,this.removeRegistration();case 3:if(!(!ae.notificationId||!ae.notificationId.length)){ht.next=6;break}throw xe.error("No push notification ID for registration"),new Error("No push notification ID for registration");case 6:return xe.trace("Registering",this.channelType,ae),Fe={endpoint_platform:this.context.platform,channel_type:this.channelType,version:this.context.protocolVersion.toString(),message_types:Array.from(ae.messageTypes),data:{registration_id:ae.notificationId}},Me=this.context.productId,be="".concat(this.registrarUrl,"?productId=").concat(Me),Wt={"Content-Type":"application/json"},xe.trace("Creating registration for channel ".concat(this.channelType)),ht.prev=12,ht.next=15,new $.AsyncRetrier(je).run(function(){return Ae.twilsock.post(be,Wt,Fe,Me)});case 15:Oe=ht.sent,this.registrationId=Oe.body.id,xe.debug("Registration created: ",Oe),ht.next=24;break;case 20:throw ht.prev=20,ht.t0=ht.catch(12),xe.error("Registration failed: ",ht.t0),ht.t0;case 24:return ht.abrupt("return",ae);case 25:case"end":return ht.stop()}},te,this,[[12,20]])}));function B(te,ae){return G.apply(this,arguments)}return B}()},{key:"removeRegistration",value:function(){var G=le.default(x.default.mark(function te(){var ae=this,de,Ae,Fe;return x.default.wrap(function(be){for(;;)switch(be.prev=be.next){case 0:if(this.registrationId){be.next=2;break}return be.abrupt("return");case 2:return de=this.context.productId,Ae="".concat(this.registrarUrl,"/").concat(this.registrationId,"?productId=").concat(de),Fe={"Content-Type":"application/json"},xe.trace("Removing registration for ".concat(this.channelType)),be.prev=6,be.next=9,new $.AsyncRetrier(Object.assign(je,{maxAttemptsCount:3})).run(function(){return ae.twilsock.delete(Ae,Fe,{},de)});case 9:this.registrationId=null,this.currentState.notificationId="",xe.debug("Registration removed for ".concat(this.channelType)),be.next=18;break;case 14:throw be.prev=14,be.t0=be.catch(6),xe.error("Failed to remove registration ",this.channelType,be.t0),be.t0;case 18:case"end":return be.stop()}},te,this,[[6,14]])}));function B(){return G.apply(this,arguments)}return B}()},{key:"sendDeviceRemoveRequest",value:function(){var G=le.default(x.default.mark(function te(ae){var de=this,Ae,Fe,Me,be;return x.default.wrap(function(Oe){for(;;)switch(Oe.prev=Oe.next){case 0:if(ae!==""){Oe.next=2;break}throw new Error("Empty registration ID");case 2:return Ae=this.context.productId,Fe="".concat(this.registrarUrl,"?productId=").concat(Ae),Me={"Content-Type":"application/json"},be={binding_type:this.channelType,address:ae},Oe.prev=6,xe.trace("Removing old registrations for ".concat(this.channelType)),Oe.next=10,new $.AsyncRetrier(Object.assign(je,{maxAttemptsCount:3})).run(function(){return de.twilsock.delete(Fe,Me,be,Ae)});case 10:this.registrationId=null,this.currentState.notificationId="",xe.debug("Registration removed for ".concat(this.channelType)),Oe.next=19;break;case 15:throw Oe.prev=15,Oe.t0=Oe.catch(6),xe.error("Failed to remove registration ",this.channelType,Oe.t0),Oe.t0;case 19:case"end":return Oe.stop()}},te,this,[[6,15]])}));function B(te){return G.apply(this,arguments)}return B}()}]),D}(Je);function Et(V){var Y=bn();return function(){var G=ue.default(V),B;if(Y){var te=ue.default(this).constructor;B=Reflect.construct(G,arguments,te)}else B=G.apply(this,arguments);return L.default(this,B)}}function bn(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var wn=function(V){Pe.default(D,V);var Y=Et(D);function D(G,B,te){var ae;return De.default(this,D),ae=Y.call(this,"twilsock"),Q.default(ge.default(ae),"contextId",he.v4()),ae.productId=G,ae.platform=B,ae.twilsock=te,ae}return $e.default(D,[{key:"updateRegistration",value:function(){var G=le.default(x.default.mark(function te(ae,de){var Ae,Fe;return x.default.wrap(function(be){for(;;)switch(be.prev=be.next){case 0:if(de.has("messageType")){be.next=2;break}return be.abrupt("return",ae);case 2:return Ae=Array.from(ae.messageTypes),Fe={product_id:this.productId,notification_protocol_version:4,endpoint_platform:this.platform,message_types:Ae},be.prev=4,be.next=7,this.twilsock.setNotificationsContext(this.contextId,Fe);case 7:be.next=13;break;case 9:throw be.prev=9,be.t0=be.catch(4),xe.error("Failed to update twilsock notification context: ".concat(be.t0)),be.t0;case 13:return be.abrupt("return",ae);case 14:case"end":return be.stop()}},te,this,[[4,9]])}));function B(te,ae){return G.apply(this,arguments)}return B}()},{key:"removeRegistration",value:function(){var G=le.default(x.default.mark(function te(){return x.default.wrap(function(de){for(;;)switch(de.prev=de.next){case 0:return de.prev=0,de.next=3,this.twilsock.removeNotificationsContext(this.contextId);case 3:de.next=9;break;case 5:throw de.prev=5,de.t0=de.catch(0),xe.error("Failed to remove twilsock notification context: ".concat(de.t0)),de.t0;case 9:case"end":return de.stop()}},te,this,[[0,5]])}));function B(){return G.apply(this,arguments)}return B}()},{key:"sendDeviceRemoveRequest",value:function(){var G=le.default(x.default.mark(function te(ae){return x.default.wrap(function(Ae){for(;;)switch(Ae.prev=Ae.next){case 0:case"end":return Ae.stop()}},te)}));function B(te){return G.apply(this,arguments)}return B}()}]),D}(Je);function Sn(V){var Y=$n();return function(){var G=ue.default(V),B;if(Y){var te=ue.default(this).constructor;B=Reflect.construct(G,arguments,te)}else B=G.apply(this,arguments);return L.default(this,B)}}function $n(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var at,Rr=W.literal("apn","fcm","twilsock");e.Notifications=at=function(V){Pe.default(D,V);var Y=Sn(D);function D(G){var B,te,ae,de,Ae,Fe,Me,be=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};De.default(this,D),Me=Y.call(this),be.logLevel=(B=be.logLevel)!==null&&B!==void 0?B:"error",xe.setLevel(be.logLevel);var Wt=(te=be.productId)!==null&&te!==void 0?te:"notifications",Oe=!be.twilsockClient,bt=be.twilsockClient=(ae=be.twilsockClient)!==null&&ae!==void 0?ae:new h.TwilsockClient(G,Wt,be),ht=(de=be.notifications)!==null&&de!==void 0?de:{},_n=(Ae=(Fe=ht.region)!==null&&Fe!==void 0?Fe:be.region)!==null&&Ae!==void 0?Ae:"us1",Jr="https://ers.".concat(_n,".twilio.com/v1/registrations"),Fr=ht.ersUrl||Jr;Me.connectors=new Map;var it=at._detectPlatform();return Me.connectors.set("apn",new vt("apn",{protocolVersion:4,productId:Wt,platform:it},bt,Fr)),Me.connectors.set("fcm",new vt("fcm",{protocolVersion:3,productId:Wt,platform:it},bt,Fr)),Me.connectors.set("twilsock",new wn(Wt,it,bt)),bt.on("stateChanged",function(yt){return Me.emit("transportState",yt)}),Me._connector("twilsock").on("stateChanged",function(yt,er,Kt){return Me.emit("stateChanged",yt,er,Kt)}),Me._connector("apn").on("stateChanged",function(yt,er,Kt){return Me.emit("stateChanged",yt,er,Kt)}),Me._connector("fcm").on("stateChanged",function(yt,er,Kt){return Me.emit("stateChanged",yt,er,Kt)}),bt.on("message",function(yt,er){return Me._routeMessage(yt,er)}),Me.updateToken(G),Oe&&(bt.connect(),Me.twilsock=bt),Me}return $e.default(D,[{key:"shutdown",value:function(){var G=le.default(x.default.mark(function te(){return x.default.wrap(function(de){for(;;)switch(de.prev=de.next){case 0:if(this.connectors.clear(),!this.twilsock){de.next=4;break}return de.next=4,this.twilsock.disconnect();case 4:case"end":return de.stop()}},te,this)}));function B(){return G.apply(this,arguments)}return B}()},{key:"setPushRegistrationId",value:function(B,te){xe.debug("Set ".concat(B," push registration id '").concat(te,"'")),this._connector(B).setNotificationId(te)}},{key:"subscribe",value:function(B,te){xe.debug("Add ".concat(B," subscriptions for message type ").concat(te)),this._connector(B).subscribe(te)}},{key:"unsubscribe",value:function(B,te){xe.debug("Remove ".concat(B," subscriptions for message type ").concat(te)),this._connector(B).unsubscribe(te)}},{key:"updateToken",value:function(B){this.connectors.forEach(function(te){return te.updateToken(B)})}},{key:"commitChanges",value:function(){var G=le.default(x.default.mark(function te(){var ae;return x.default.wrap(function(Ae){for(;;)switch(Ae.prev=Ae.next){case 0:return ae=[],this.connectors.forEach(function(Fe){Fe.isActive()&&ae.push(Fe.commitChanges())}),Ae.next=4,Promise.all(ae);case 4:case"end":return Ae.stop()}},te,this)}));function B(){return G.apply(this,arguments)}return B}()},{key:"removeRegistrations",value:function(){var G=le.default(x.default.mark(function te(ae,de){return x.default.wrap(function(Fe){for(;;)switch(Fe.prev=Fe.next){case 0:return Fe.next=2,this._connector(ae).sendDeviceRemoveRequest(de);case 2:case"end":return Fe.stop()}},te,this)}));function B(te,ae){return G.apply(this,arguments)}return B}()},{key:"handlePushNotification",value:function(B){return{messageType:B.twi_message_type,payload:B.payload}}},{key:"_routeMessage",value:function(B,te){xe.debug("Notification message arrived: ",B,te),this.emit("message",B,te)}},{key:"_connector",value:function(B){var te=this.connectors.get(B);if(!te)throw new Error("Unknown channel type: ".concat(B));return te}}],[{key:"_detectPlatform",value:function(){var B="";return typeof navigator!="undefined"?(B="unknown",typeof navigator.product!="undefined"&&(B=navigator.product),typeof navigator.userAgent!="undefined"&&(B=navigator.userAgent)):B="web",B.substring(0,128)}}]),D}(re),E([W.validateTypes(Rr,W.nonEmptyString),Te("design:type",Function),Te("design:paramtypes",[String,String]),Te("design:returntype",void 0)],e.Notifications.prototype,"setPushRegistrationId",null),E([W.validateTypes(Rr,W.nonEmptyString),Te("design:type",Function),Te("design:paramtypes",[String,String]),Te("design:returntype",void 0)],e.Notifications.prototype,"subscribe",null),E([W.validateTypes(Rr,W.nonEmptyString),Te("design:type",Function),Te("design:paramtypes",[String,String]),Te("design:returntype",void 0)],e.Notifications.prototype,"unsubscribe",null),E([W.validateTypes(W.nonEmptyString),Te("design:type",Function),Te("design:paramtypes",[String]),Te("design:returntype",void 0)],e.Notifications.prototype,"updateToken",null),E([W.validateTypesAsync(Rr,W.nonEmptyString),Te("design:type",Function),Te("design:paramtypes",[String,String]),Te("design:returntype",Promise)],e.Notifications.prototype,"removeRegistrations",null),e.Notifications=at=E([W.validateConstructorTypes(W.nonEmptyString,[W.pureObject,"undefined",W.literal(null)]),Te("design:paramtypes",[String,Object])],e.Notifications)})(kS);var Zt={};/*
@license
The following license applies to all parts of this software except as
documented below.

    Copyright (c) 2016, Twilio, inc.
    All rights reserved.

    Redistribution and use in source and binary forms, with or without
    modification, are permitted provided that the following conditions are
    met:

      1. Redistributions of source code must retain the above copyright
         notice, this list of conditions and the following disclaimer.

      2. Redistributions in binary form must reproduce the above copyright
         notice, this list of conditions and the following disclaimer in
         the documentation and/or other materials provided with the
         distribution.

      3. Neither the name of Twilio nor the names of its contributors may
         be used to endorse or promote products derived from this software
         without specific prior written permission.

    THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
    "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
    LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
    A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
    HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
    SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
    LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
    DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
    THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
    (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
    OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

This software includes loglevel under the following license.

    Copyright (c) 2013 Tim Perry

    Permission is hereby granted, free of charge, to any person
    obtaining a copy of this software and associated documentation
    files (the "Software"), to deal in the Software without
    restriction, including without limitation the rights to use,
    copy, modify, merge, publish, distribute, sublicense, and/or sell
    copies of the Software, and to permit persons to whom the
    Software is furnished to do so, subject to the following
    conditions:

    The above copyright notice and this permission notice shall be
    included in all copies or substantial portions of the Software.

    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
    EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
    OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
    NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
    HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
    WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
    FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
    OTHER DEALINGS IN THE SOFTWARE.

This software includes Backoff library under the following license

    Copyright (C) 2012 Mathieu Turcotte

    Permission is hereby granted, free of charge, to any person obtaining a copy of
    this software and associated documentation files (the "Software"), to deal in
    the Software without restriction, including without limitation the rights to
    use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies
    of the Software, and to permit persons to whom the Software is furnished to do
    so, subject to the following conditions:

    The above copyright notice and this permission notice shall be included in all
    copies or substantial portions of the Software.

    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
    SOFTWARE.

This software includes Event-to-Promise library under the following license

    Copyright (c) 2014, Julien Fontanet <julien.fontanet@isonoe.net>.

    Permission to use, copy, modify, and/or distribute this software for any purpose
    with or without fee is hereby granted, provided that the above copyright notice
    and this permission notice appear in all copies.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND
    FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS
    OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER
    TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF
    THIS SOFTWARE.

*/Object.defineProperty(Zt,"__esModule",{value:!0});var CF=Ri.exports,OF=ra.exports,PF=Na.exports,AF=Qn.exports,MF=Xn.exports,NF=Zn.exports,LF=Yr.exports,xF=ta.exports,UF=Gs,jF=ea.exports,ne=Pt,ao=Do,DF=Xd.exports,FF=Oi.exports,BF=Hs.exports,IS=mn,RS=Fo,qF=jo.exports,WF=no.exports;function or(e){return e&&typeof e=="object"&&"default"in e?e:{default:e}}function Zd(e){if(e&&e.__esModule)return e;var n=Object.create(null);return e&&Object.keys(e).forEach(function(r){if(r!=="default"){var t=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(n,r,t.get?t:{enumerable:!0,get:function(){return e[r]}})}}),n.default=e,Object.freeze(n)}var ce=or(CF),Ke=or(OF),Xe=or(PF),Hr=or(AF),Vt=or(MF),aa=or(NF),kt=or(LF),tt=or(xF),A=or(UF),ES=or(jF),GF=or(DF),HF=Zd(FF),CS=or(BF),zF=Zd(RS),Ys=or(qF),Ru=Zd(WF);function Ye(e,n,r,t){var a=arguments.length,i=a<3?n:t===null?t=Object.getOwnPropertyDescriptor(n,r):t,s;if((typeof Reflect=="undefined"?"undefined":ES.default(Reflect))==="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,n,r,t);else for(var l=e.length-1;l>=0;l--)(s=e[l])&&(i=(a<3?s(i):a>3?s(n,r,i):s(n,r))||i);return a>3&&i&&Object.defineProperty(n,r,i),i}function ie(e,n){if((typeof Reflect=="undefined"?"undefined":ES.default(Reflect))==="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(e,n)}var VF;function qn(){}qn.prototype=Object.create(null);function nt(){nt.init.call(this)}nt.EventEmitter=nt;nt.usingDomains=!1;nt.prototype.domain=void 0;nt.prototype._events=void 0;nt.prototype._maxListeners=void 0;nt.defaultMaxListeners=10;nt.init=function(){this.domain=null,nt.usingDomains&&VF.active,(!this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=new qn,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};nt.prototype.setMaxListeners=function(n){if(typeof n!="number"||n<0||isNaN(n))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=n,this};function OS(e){return e._maxListeners===void 0?nt.defaultMaxListeners:e._maxListeners}nt.prototype.getMaxListeners=function(){return OS(this)};function KF(e,n,r){if(n)e.call(r);else for(var t=e.length,a=Js(e,t),i=0;i<t;++i)a[i].call(r)}function YF(e,n,r,t){if(n)e.call(r,t);else for(var a=e.length,i=Js(e,a),s=0;s<a;++s)i[s].call(r,t)}function JF(e,n,r,t,a){if(n)e.call(r,t,a);else for(var i=e.length,s=Js(e,i),l=0;l<i;++l)s[l].call(r,t,a)}function QF(e,n,r,t,a,i){if(n)e.call(r,t,a,i);else for(var s=e.length,l=Js(e,s),c=0;c<s;++c)l[c].call(r,t,a,i)}function XF(e,n,r,t){if(n)e.apply(r,t);else for(var a=e.length,i=Js(e,a),s=0;s<a;++s)i[s].apply(r,t)}nt.prototype.emit=function(n){var r,t,a,i,s,l,c,h=n==="error";if(l=this._events,l)h=h&&l.error==null;else if(!h)return!1;if(c=this.domain,h){if(r=arguments[1],c)r||(r=new Error('Uncaught, unspecified "error" event')),r.domainEmitter=this,r.domain=c,r.domainThrown=!1,c.emit("error",r);else{if(r instanceof Error)throw r;var g=new Error('Uncaught, unspecified "error" event. ('+r+")");throw g.context=r,g}return!1}if(t=l[n],!t)return!1;var b=typeof t=="function";switch(a=arguments.length,a){case 1:KF(t,b,this);break;case 2:YF(t,b,this,arguments[1]);break;case 3:JF(t,b,this,arguments[1],arguments[2]);break;case 4:QF(t,b,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(a-1),s=1;s<a;s++)i[s-1]=arguments[s];XF(t,b,this,i)}return!0};function PS(e,n,r,t){var a,i,s;if(typeof r!="function")throw new TypeError('"listener" argument must be a function');if(i=e._events,i?(i.newListener&&(e.emit("newListener",n,r.listener?r.listener:r),i=e._events),s=i[n]):(i=e._events=new qn,e._eventsCount=0),!s)s=i[n]=r,++e._eventsCount;else if(typeof s=="function"?s=i[n]=t?[r,s]:[s,r]:t?s.unshift(r):s.push(r),!s.warned&&(a=OS(e),a&&a>0&&s.length>a)){s.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+n+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=e,l.type=n,l.count=s.length,ZF(l)}return e}function ZF(e){typeof console.warn=="function"?console.warn(e):console.log(e)}nt.prototype.addListener=function(n,r){return PS(this,n,r,!1)};nt.prototype.on=nt.prototype.addListener;nt.prototype.prependListener=function(n,r){return PS(this,n,r,!0)};function AS(e,n,r){var t=!1;function a(){e.removeListener(n,a),t||(t=!0,r.apply(e,arguments))}return a.listener=r,a}nt.prototype.once=function(n,r){if(typeof r!="function")throw new TypeError('"listener" argument must be a function');return this.on(n,AS(this,n,r)),this};nt.prototype.prependOnceListener=function(n,r){if(typeof r!="function")throw new TypeError('"listener" argument must be a function');return this.prependListener(n,AS(this,n,r)),this};nt.prototype.removeListener=function(n,r){var t,a,i,s,l;if(typeof r!="function")throw new TypeError('"listener" argument must be a function');if(a=this._events,!a)return this;if(t=a[n],!t)return this;if(t===r||t.listener&&t.listener===r)--this._eventsCount===0?this._events=new qn:(delete a[n],a.removeListener&&this.emit("removeListener",n,t.listener||r));else if(typeof t!="function"){for(i=-1,s=t.length;s-- >0;)if(t[s]===r||t[s].listener&&t[s].listener===r){l=t[s].listener,i=s;break}if(i<0)return this;if(t.length===1){if(t[0]=void 0,--this._eventsCount===0)return this._events=new qn,this;delete a[n]}else eB(t,i);a.removeListener&&this.emit("removeListener",n,l||r)}return this};nt.prototype.off=function(e,n){return this.removeListener(e,n)};nt.prototype.removeAllListeners=function(n){var r,t;if(t=this._events,!t)return this;if(!t.removeListener)return arguments.length===0?(this._events=new qn,this._eventsCount=0):t[n]&&(--this._eventsCount===0?this._events=new qn:delete t[n]),this;if(arguments.length===0){for(var a=Object.keys(t),i=0,s;i<a.length;++i)s=a[i],s!=="removeListener"&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=new qn,this._eventsCount=0,this}if(r=t[n],typeof r=="function")this.removeListener(n,r);else if(r)do this.removeListener(n,r[r.length-1]);while(r[0]);return this};nt.prototype.listeners=function(n){var r,t,a=this._events;return a?(r=a[n],r?typeof r=="function"?t=[r.listener||r]:t=tB(r):t=[]):t=[],t};nt.listenerCount=function(e,n){return typeof e.listenerCount=="function"?e.listenerCount(n):MS.call(e,n)};nt.prototype.listenerCount=MS;function MS(e){var n=this._events;if(n){var r=n[e];if(typeof r=="function")return 1;if(r)return r.length}return 0}nt.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};function eB(e,n){for(var r=n,t=r+1,a=e.length;t<a;r+=1,t+=1)e[r]=e[t];e.pop()}function Js(e,n){for(var r=new Array(n);n--;)r[n]=e[n];return r}function tB(e){for(var n=new Array(e.length),r=0;r<n.length;++r)n[r]=e[r].listener||e[r];return n}var wi=function(){function e(n){Ke.default(this,e),this.base=n,this.args=new Array,this.paths=new Array}return Xe.default(e,[{key:"pathSegment",value:function(r){return this.paths.push(encodeURIComponent(r)),this}},{key:"queryParam",value:function(r,t){return typeof t!="undefined"&&this.args.push(encodeURIComponent(r)+"="+encodeURIComponent(t)),this}},{key:"build",value:function(){var r=this.base;return this.paths.length&&(r+="/"+this.paths.join("/")),this.args.length&&(r+="?"+this.args.join("&")),r}}]),e}();function NS(e){var n=rB();return function(){var t=kt.default(e),a;if(n){var i=kt.default(this).constructor;a=Reflect.construct(t,arguments,i)}else a=t.apply(this,arguments);return aa.default(this,a)}}function rB(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Xt=function(e){Vt.default(r,e);var n=NS(r);function r(t){var a,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return Ke.default(this,r),a=n.call(this),a.name=a.constructor.name,a.message="".concat(t," (status: ").concat(i,", code: ").concat(s,")"),a.status=i,a.code=s,a}return r}(GF.default(Error)),nB=function(e){Vt.default(r,e);var n=NS(r);function r(t){var a,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,l=arguments.length>3?arguments[3]:void 0;return Ke.default(this,r),a=n.call(this,t,i,s),a.body=l,a}return r}(Xt);function jr(e){return JSON.parse(JSON.stringify(e))}function LS(e){var n=e===void 0||ep(e);if(!n)throw new Xt("Invalid pageSize parameter. Expected a positive integer, was '".concat(e,"'."),400,20007)}function aB(e){return!isNaN(parseInt(e))&&isFinite(e)}function ep(e){return aB(e)&&e>0}var ei=HF.getLogger("twilio-sync");function rs(e,n){return["".concat(new Date().toISOString()," Sync ").concat(e,":")].concat(Array.from(n))}var Qe={setLevel:function(n){ei.setLevel(n)},trace:function(){for(var n=arguments.length,r=new Array(n),t=0;t<n;t++)r[t]=arguments[t];ei.trace.apply(null,rs("T",r))},debug:function(){for(var n=arguments.length,r=new Array(n),t=0;t<n;t++)r[t]=arguments[t];ei.debug.apply(null,rs("D",r))},info:function(){for(var n=arguments.length,r=new Array(n),t=0;t<n;t++)r[t]=arguments[t];ei.info.apply(null,rs("I",r))},warn:function(){for(var n=arguments.length,r=new Array(n),t=0;t<n;t++)r[t]=arguments[t];ei.warn.apply(null,rs("W",r))},error:function(){for(var n=arguments.length,r=new Array(n),t=0;t<n;t++)r[t]=arguments[t];ei.error.apply(null,rs("E",r))}},iB="/v4/Subscriptions",sB="/v3/Maps",uB="/v3/Lists",oB="/v3/Documents",cB="/v3/Streams",lB="/v3/Insights";function fB(e,n,r){return e&&typeof e[n]!="undefined"?e[n]:r}var dB=function(){function e(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Ke.default(this,e);var r=n.region||"us1",t="https://cds.".concat(r,".twilio.com"),a=n.cdsUri||t;this.settings={subscriptionsUri:a+iB,documentsUri:a+oB,listsUri:a+uB,mapsUri:a+sB,streamsUri:a+cB,insightsUri:a+lB,sessionStorageEnabled:fB(n.Sync,"enableSessionStorage",!0),productId:n.productId}}return Xe.default(e,[{key:"subscriptionsUri",get:function(){return this.settings.subscriptionsUri}},{key:"documentsUri",get:function(){return this.settings.documentsUri}},{key:"listsUri",get:function(){return this.settings.listsUri}},{key:"mapsUri",get:function(){return this.settings.mapsUri}},{key:"streamsUri",get:function(){return this.settings.streamsUri}},{key:"insightsUri",get:function(){return this.settings.insightsUri}},{key:"backoffConfig",get:function(){return this.settings.backoffConfig||{}}},{key:"sessionStorageEnabled",get:function(){return this.settings.sessionStorageEnabled}},{key:"productId",get:function(){return this.settings.productId}}]),e}();function ns(e,n){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=pB(e))||n&&e&&typeof e.length=="number"){r&&(e=r);var t=0,a=function(){};return{s:a,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(h){throw h},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,s=!1,l;return{s:function(){r=r.call(e)},n:function(){var h=r.next();return i=h.done,h},e:function(h){s=!0,l=h},f:function(){try{!i&&r.return!=null&&r.return()}finally{if(s)throw l}}}}function pB(e,n){if(!!e){if(typeof e=="string")return Fy(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Fy(e,n)}}function Fy(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,t=new Array(n);r<n;r++)t[r]=e[r];return t}var vB=function(){function e(n){Ke.default(this,e),this.localObject=n,this.pendingCorrelationId=null,this.pendingAction=null,this.established=!1,this.retryCount=0}return Xe.default(e,[{key:"sid",get:function(){return this.localObject.sid}},{key:"type",get:function(){return this.localObject.type}},{key:"lastEventId",get:function(){return this.localObject.lastEventId}},{key:"indexName",get:function(){return this.localObject.indexName}},{key:"queryString",get:function(){return this.localObject.queryString}},{key:"isEstablished",get:function(){return this.established}},{key:"update",value:function(r,t){this.localObject._update(r,t)}},{key:"updatePending",value:function(r,t){this.pendingAction=r,this.pendingCorrelationId=t}},{key:"reset",value:function(){this.updatePending(null,null),this.retryCount=0,this.established=!1,this.setSubscriptionState("none")}},{key:"markAsFailed",value:function(r){this.rejectedWithError=r.error,this.updatePending(null,null),this.localObject.reportFailure(new Xt("Failed to subscribe on service events: ".concat(r.error.message),r.error.status,r.error.code))}},{key:"complete",value:function(r){this.updatePending(null,null),this.established=!0,this.localObject._advanceLastEventId(r)}},{key:"setSubscriptionState",value:function(r){this.localObject._setSubscriptionState(r)}}]),e}(),hB=function(){function e(n){var r=this;Ke.default(this,e),tt.default(this,"isConnected",!1),tt.default(this,"maxBatchSize",100),tt.default(this,"subscriptionTtlTimer",null),tt.default(this,"pendingPokeReason",null),this.services=n,this.subscriptions=new Map,this.persisted=new Map,this.latestPokeResponseArrivalTimestampByCorrelationId=new Map;var t={randomisationFactor:.2,initialDelay:100,maxDelay:2*60*1e3};this.backoff=IS.Backoff.exponential(Object.assign(t,this.services.config.backoffConfig)),this.backoff.on("ready",function(){var a=r.getSubscriptionUpdateBatch(),i=a.action,s=a.subscriptions;i?r.applyNewSubscriptionUpdateBatch(i,s):(r.backoff.reset(),Qe.debug("All subscriptions resolved."))})}return Xe.default(e,[{key:"getSubscriptionUpdateBatch",value:function(){function r(i,s,l,c){var h=[],g=ns(i),b;try{for(g.s();!(b=g.n()).done;){var $=CS.default(b.value,2),S=$[0],R=$[1],N=s.get(S);if(!N&&l!==R.pendingAction&&!R.rejectedWithError&&(h.push(R),c&&h.length>=c))break}}catch(M){g.e(M)}finally{g.f()}return h}var t=r(this.subscriptions,this.persisted,"establish",this.maxBatchSize);if(t.length>0)return{action:"establish",subscriptions:t};var a=r(this.persisted,this.subscriptions,"cancel",this.maxBatchSize);return a.length>0?{action:"cancel",subscriptions:a}:{action:null,subscriptions:null}}},{key:"persist",value:function(){this.backoff.backoff()}},{key:"applyNewSubscriptionUpdateBatch",value:function(){var n=ce.default(A.default.mark(function t(a,i){var s=this,l,c,h,g,b,$,S,R,N,M,W,z,me,le,De,$e;return A.default.wrap(function(L){for(;;)switch(L.prev=L.next){case 0:if(this.isConnected){L.next=4;break}return Qe.debug("Twilsock connection (required for subscription) not ready; waiting\u2026"),this.backoff.reset(),L.abrupt("return");case 4:i=this.processLocalActions(a,i),l=new Date().getTime(),c=ns(i);try{for(c.s();!(h=c.n()).done;)g=h.value,this.recordActionAttemptOn(g,a,l)}catch(ue){c.e(ue)}finally{c.f()}return b=this.pendingPokeReason,this.pendingPokeReason=null,L.prev=10,L.next=13,this.request(a,l,b,i);case 13:$=L.sent,S=$.body.max_batch_size,!isNaN(parseInt(S))&&isFinite(S)&&S>0&&(this.maxBatchSize=S),this.subscriptionTtlTimer||(R=$.body.ttl_in_s,N=!isNaN(parseFloat(R))&&isFinite(R),M=N&&R>0,M&&(this.subscriptionTtlTimer=setTimeout(function(){return s.onSubscriptionTtlElapsed()},R*1e3))),a==="establish"&&(W=$.body.estimated_delivery_in_ms,z=!isNaN(parseFloat(W))&&isFinite(W),me=z&&W>0,me?setTimeout(function(){return s.verifyPokeDelivery(l,W,i)},W):Qe.error("Invalid timeout: ".concat(W)),i.filter(function(ue){return ue.pendingCorrelationId===l}).forEach(function(ue){return ue.setSubscriptionState("response_in_flight")})),this.backoff.reset(),L.next=26;break;case 21:L.prev=21,L.t0=L.catch(10),le=ns(i);try{for(le.s();!(De=le.n()).done;)$e=De.value,this.recordActionFailureOn($e,a)}catch(ue){le.e(ue)}finally{le.f()}L.t0 instanceof ao.TransportUnavailableError?(Qe.debug("Twilsock connection (required for subscription) not ready (c:".concat(l,"); waiting\u2026")),this.backoff.reset()):(Qe.debug("Failed an attempt to ".concat(a," subscriptions (c:").concat(l,"); retrying"),L.t0),this.persist());case 26:case"end":return L.stop()}},t,this,[[10,21]])}));function r(t,a){return n.apply(this,arguments)}return r}()},{key:"verifyPokeDelivery",value:function(r,t,a){var i=this,s=this.latestPokeResponseArrivalTimestampByCorrelationId.get(r),l=s?new Date().getTime()-s:t;if(l>=t)a.filter(function(h){return h.pendingCorrelationId===r}).forEach(function(h){h.updatePending(null,null),h.retryCount++,i.persisted.delete(h.sid)}),this.persist(),this.latestPokeResponseArrivalTimestampByCorrelationId.delete(r);else{var c=t-l;setTimeout(function(){return i.verifyPokeDelivery(r,t,a)},c)}}},{key:"processLocalActions",value:function(r,t){return r==="cancel"?t.filter(function(a){return!a.rejectedWithError}):t}},{key:"recordActionAttemptOn",value:function(r,t,a){if(r.setSubscriptionState("request_in_flight"),t==="establish")this.persisted.set(r.sid,r),r.updatePending(t,a);else{var i=this.persisted.get(r.sid);i&&i.updatePending(t,a)}}},{key:"recordActionFailureOn",value:function(r,t){r.setSubscriptionState("none"),r.updatePending(null,null),t==="establish"&&this.persisted.delete(r.sid)}},{key:"request",value:function(r,t,a,i){var s=i.map(function(h){return{object_sid:h.sid,object_type:h.type,last_event_id:r==="establish"?h.lastEventId:void 0,index_name:r==="establish"?h.indexName:void 0,query_string:r==="establish"?h.queryString:void 0}}),l=i.filter(function(h){return h.retryCount>0}).length;Qe.debug("Attempting '".concat(r,"' request (c:").concat(t,"):"),s);var c={event_protocol_version:4,action:r,correlation_id:t,retried_requests:l,ttl_in_s:-1,requests:s};return a==="ttl"&&(c.reason=a),this.services.network.post(this.services.config.subscriptionsUri,c)}},{key:"add",value:function(r,t){Qe.debug("Establishing intent to subscribe to ".concat(r));var a=this.subscriptions.get(r);a&&t&&a.lastEventId===t.lastEventId||(this.persisted.delete(r),this.subscriptions.set(r,new vB(t)),this.persist())}},{key:"remove",value:function(r){Qe.debug("Establishing intent to unsubscribe from ".concat(r));var t=this.subscriptions.delete(r);t&&this.persist()}},{key:"acceptMessage",value:function(r,t){Qe.trace("Subscriptions received",r);var a=r.event_type,i=typeof r.events!="undefined"?r.events:[r.event],s=r.correlation_id;s&&this.latestPokeResponseArrivalTimestampByCorrelationId.set(s,new Date().getTime());var l=ns(i),c;try{for(l.s();!(c=l.n()).done;){var h=c.value,g=void 0;switch(r.event_type){case"subscription_established":this.applySubscriptionEstablishedMessage(h,s);break;case"subscription_canceled":this.applySubscriptionCancelledMessage(h,s);break;case"subscription_failed":this.applySubscriptionFailedMessage(h,s);break;case(g=a.match(/^(?:map|list|document|stream|live_query)_/)||{}).input:{var b=void 0;switch(g[0]){case"map_":b=h.map_sid;break;case"list_":b=h.list_sid;break;case"document_":b=h.document_sid;break;case"stream_":b=h.stream_sid;break;case"live_query_":b=h.query_id,t=!1,r.strictly_ordered===!0&&(t=!0);break;default:b=void 0}this.applyEventToSubscribedEntity(b,h,a,t);break}default:Qe.debug("Dropping unknown message type ".concat(a));break}}}catch($){l.e($)}finally{l.f()}}},{key:"applySubscriptionEstablishedMessage",value:function(r,t){var a=r.object_sid,i=this.persisted.get(r.object_sid);i&&i.pendingCorrelationId===t?r.replay_status==="interrupted"?(Qe.debug("Event Replay for subscription to ".concat(a," (c:").concat(t,") interrupted; continuing eagerly.")),i.updatePending(null,null),this.persisted.delete(i.sid),this.backoff.reset()):r.replay_status==="completed"&&(Qe.debug("Event Replay for subscription to ".concat(a," (c:").concat(t,") completed. Subscription is ready.")),i.complete(r.last_event_id),this.persisted.set(r.object_sid,i),i.setSubscriptionState("established"),this.backoff.reset()):Qe.debug("Late message for ".concat(r.object_sid," (c:").concat(t,") dropped.")),this.persist()}},{key:"applySubscriptionCancelledMessage",value:function(r,t){var a=this.persisted.get(r.object_sid);a&&a.pendingCorrelationId===t?(a.updatePending(null,null),a.setSubscriptionState("none"),this.persisted.delete(r.object_sid)):Qe.debug("Late message for ".concat(r.object_sid," (c:").concat(t,") dropped.")),this.persist()}},{key:"applySubscriptionFailedMessage",value:function(r,t){var a=r.object_sid,i=this.subscriptions.get(a),s=this.persisted.get(a);i&&s?s.pendingCorrelationId===t&&(Qe.error("Failed to subscribe on ".concat(s.sid),r.error),s.markAsFailed(r),s.setSubscriptionState("none")):!i&&s&&(this.persisted.delete(a),s.setSubscriptionState("none")),this.persist()}},{key:"applyEventToSubscribedEntity",value:function(r,t,a,i){var s=this;if(!!r){i=i||function(){var c=s.persisted.get(r);return c&&c.isEstablished}();var l=this.subscriptions.get(r);l?(t.type=a,l.update(t,i)):Qe.debug("Message dropped for SID '".concat(r,"', for which there is no subscription."))}}},{key:"onConnectionStateChanged",value:function(r){this.isConnected=r,r&&this.poke("reconnect")}},{key:"onSubscriptionTtlElapsed",value:function(){this.isConnected&&this.poke("ttl")}},{key:"poke",value:function(r){Qe.debug("Triggering event replay for all subscriptions, reason=".concat(r)),this.pendingPokeReason=r,this.subscriptionTtlTimer&&(clearTimeout(this.subscriptionTtlTimer),this.subscriptionTtlTimer=null);var t=[],a=ns(this.persisted.values()),i;try{for(a.s();!(i=a.n()).done;){var s=i.value;s.reset(),s.rejectedWithError&&t.push(s)}}catch(g){a.e(g)}finally{a.f()}this.persisted.clear();for(var l=0,c=t;l<c.length;l++){var h=c[l];this.persisted.set(h.sid,h)}this.persist()}},{key:"shutdown",value:function(){this.backoff.reset(),this.subscriptions.clear()}}]),e}(),yB=4e3,gB=6e4,mB=9e4,bB=.2;function By(e){if(e.body&&e.body.message)return e.body.message;switch(e.status){case 429:return"Throttled by server";case 404:return"Not found from server";default:return"Error from server"}}function qy(e){return e.body?e.body.code:0}function as(e){return e.status===409?new nB(By(e),e.status,qy(e),e.body):e.status?new Xt(By(e),e.status,qy(e)):e instanceof ao.TransportUnavailableError?e:new Xt(e.message,0,0)}var wB=function(){function e(n,r,t){Ke.default(this,e),this.clientInfo=n,this.config=r,this.transport=t}return Xe.default(e,[{key:"createHeaders",value:function(){return{"Content-Type":"application/json","Twilio-Sync-Client-Info":JSON.stringify(this.clientInfo),"Twilio-Request-Id":"RQ"+zF.v4().replace(/-/g,"")}}},{key:"backoffConfig",value:function(){return Object.assign({min:yB,max:gB,maxAttemptsTime:mB,randomness:bB},this.config.backoffConfig)}},{key:"executeWithRetry",value:function(r){var t=this,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return new Promise(function(i,s){var l=[502,503,504];a&&l.push(429);var c=new IS.Retrier(t.backoffConfig());c.on("attempt",function(){r().then(function(h){return c.succeeded(h)}).catch(function(h){if(l.includes(h.status)){var g=parseInt(h.headers?h.headers["Retry-After"]:null);c.failed(as(h),isNaN(g)?null:g*1e3)}else h.message==="Twilsock disconnected"?c.failed(as(h)):(c.removeAllListeners(),c.cancel(),s(as(h)))})}),c.on("succeeded",function(h){i(h)}),c.on("cancelled",function(h){return s(as(h))}),c.on("failed",function(h){return s(as(h))}),c.start()})}},{key:"get",value:function(r){var t=this,a=this.createHeaders();return Qe.debug("GET",r,"ID:",a["Twilio-Request-Id"]),this.executeWithRetry(function(){return t.transport.get(r,a,t.config.productId)},!0)}},{key:"post",value:function(r,t,a){var i=this,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,l=this.createHeaders();return typeof a!="undefined"&&a!==null&&(l["If-Match"]=a),Qe.debug("POST",r,"ID:",l["Twilio-Request-Id"]),this.executeWithRetry(function(){return i.transport.post(r,l,t,i.config.productId)},s)}},{key:"put",value:function(r,t,a){var i=this,s=this.createHeaders();return typeof a!="undefined"&&a!==null&&(s["If-Match"]=a),Qe.debug("PUT",r,"ID:",s["Twilio-Request-Id"]),this.executeWithRetry(function(){return i.transport.put(r,s,t,i.config.productId)},!1)}},{key:"delete",value:function(r){var t=this,a=this.createHeaders();return Qe.debug("DELETE",r,"ID:",a["Twilio-Request-Id"]),this.executeWithRetry(function(){return t.transport.delete(r,a,t.config.productId)},!1)}}]),e}(),SB=function(){function e(n,r){Ke.default(this,e),this.config=n,this.storageId=null;try{this.storage=r||sessionStorage}catch{}}return Xe.default(e,[{key:"storageKey",value:function(r,t){return"".concat(this.storageId,"::").concat(r,"::").concat(t)}},{key:"isReady",get:function(){return this.config.sessionStorageEnabled&&!!this.storageId}},{key:"updateStorageId",value:function(r){this.storageId=r}},{key:"store",value:function(r,t,a){return this.isReady?this._store(this.storageKey(r,t),a):null}},{key:"read",value:function(r,t){return this.isReady?this._read(this.storageKey(r,t)):null}},{key:"remove",value:function(r,t,a){if(!this.isReady)return null;try{this.storage.removeItem(this.storageKey(r,t)),a&&this.storage.removeItem(this.storageKey(r,a))}catch{}}},{key:"update",value:function(r,t,a,i){if(!this.isReady)return null;this._apply(this.storageKey(r,t),i),a&&this._apply(this.storageKey(r,a),i)}},{key:"_store",value:function(r,t){try{this.storage.setItem(r,JSON.stringify(t))}catch{}}},{key:"_read",value:function(r){try{var t=this.storage.getItem(r);if(t)return JSON.parse(t)}catch{}return null}},{key:"_apply",value:function(r,t){var a=this._read(r);if(!a)return!1;this._store(r,Object.assign(a,t))}}]),e}();function $B(e,n){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=_B(e))||n&&e&&typeof e.length=="number"){r&&(e=r);var t=0,a=function(){};return{s:a,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(h){throw h},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,s=!1,l;return{s:function(){r=r.call(e)},n:function(){var h=r.next();return i=h.done,h},e:function(h){s=!0,l=h},f:function(){try{!i&&r.return!=null&&r.return()}finally{if(s)throw l}}}}function _B(e,n){if(!!e){if(typeof e=="string")return Wy(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Wy(e,n)}}function Wy(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,t=new Array(n);r<n;r++)t[r]=e[r];return t}var Qs=function(){function e(n,r){Ke.default(this,e),this.services=n,this.removalHandler=r,this.subscriptionState="none",this._attachedListeners=new Map}return Xe.default(e,[{key:"_advanceLastEventId",value:function(r,t){}},{key:"reportFailure",value:function(r){r.status===404?this.onRemoved(!1):this.broadcastEventToListeners("failure",r)}},{key:"_subscribe",value:function(){this.services.router._subscribe(this.sid,this)}},{key:"_unsubscribe",value:function(){this.services.router._unsubscribe(this.sid)}},{key:"_setSubscriptionState",value:function(r){this.subscriptionState=r,this.broadcastEventToListeners("_subscriptionStateChanged",r)}},{key:"close",value:function(){this._unsubscribe(),this.removalHandler!=null&&this.removalHandler(this.type,this.sid,this.uniqueName)}},{key:"attach",value:function(r){var t=r.listenerUuid,a=this._attachedListeners.get(t);a||(this._attachedListeners.size||this._subscribe(),this._attachedListeners.set(t,r))}},{key:"detach",value:function(r){this._attachedListeners.delete(r),this._attachedListeners.size||this.close()}},{key:"broadcastEventToListeners",value:function(r,t){var a=$B(this._attachedListeners.values()),i;try{for(a.s();!(i=a.n()).done;){var s=i.value;s.emit(r,t)}}catch(l){a.e(l)}finally{a.f()}}}]),e}(),xS=function(){function e(n){Ke.default(this,e),tt.default(this,"queuedRequests",[]),tt.default(this,"isRequestInFlight",!1),this.inputMergingFunction=n}return Xe.default(e,[{key:"add",value:function(r,t){var a=this,i=new Promise(function(s,l){return a.queuedRequests.push({input:r,requestFunction:t,resolve:s,reject:l})});return this.wakeupQueue(),i}},{key:"squashAndAdd",value:function(r,t){var a=this.queuedRequests;this.queuedRequests=[];var i;a.length>0?(i=a.map(function(l){return l.input}).reduce(this.inputMergingFunction),i=this.inputMergingFunction(i,r)):i=r;var s=this.add(i,t);return a.forEach(function(l){return s.then(l.resolve,l.reject)}),s}},{key:"isEmpty",value:function(){return this.queuedRequests.length===0&&!this.isRequestInFlight}},{key:"wakeupQueue",value:function(){var r=this;if(!(this.queuedRequests.length===0||this.isRequestInFlight)){var t=this.queuedRequests.shift();this.isRequestInFlight=!0,t.requestFunction(t.input).then(t.resolve,t.reject).then(function(a){r.isRequestInFlight=!1,r.wakeupQueue()})}}}]),e}(),US=function(){function e(n){Ke.default(this,e),tt.default(this,"queueByNamespaceKey",new Map),this.inputReducer=n}return Xe.default(e,[{key:"add",value:function(){var n=ce.default(A.default.mark(function t(a,i,s){return A.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",this.invokeQueueMethod(a,function(h){return h.add(i,s)}));case 1:case"end":return c.stop()}},t,this)}));function r(t,a,i){return n.apply(this,arguments)}return r}()},{key:"squashAndAdd",value:function(){var n=ce.default(A.default.mark(function t(a,i,s){return A.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",this.invokeQueueMethod(a,function(h){return h.squashAndAdd(i,s)}));case 1:case"end":return c.stop()}},t,this)}));function r(t,a,i){return n.apply(this,arguments)}return r}()},{key:"invokeQueueMethod",value:function(){var n=ce.default(A.default.mark(function t(a,i){var s,l;return A.default.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return this.queueByNamespaceKey.has(a)||this.queueByNamespaceKey.set(a,new xS(this.inputReducer)),s=this.queueByNamespaceKey.get(a),l=i(s),this.queueByNamespaceKey.get(a).isEmpty()&&this.queueByNamespaceKey.delete(a),h.abrupt("return",l);case 5:case"end":return h.stop()}},t,this)}));function r(t,a){return n.apply(this,arguments)}return r}()}]),e}();function kB(e){var n=TB();return function(){var t=kt.default(e),a;if(n){var i=kt.default(this).constructor;a=Reflect.construct(t,arguments,i)}else a=t.apply(this,arguments);return aa.default(this,a)}}function TB(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Xs=function(e){Vt.default(r,e);var n=kB(r);function r(){var t;return Ke.default(this,r),t=n.call(this),t.closed=!1,t.uuid=RS.v4(),t}return Xe.default(r,[{key:"listenerUuid",get:function(){return this.uuid}},{key:"close",value:function(){this.removeAllListeners(),this.closed=!0}},{key:"ensureNotClosed",value:function(){if(this.closed)throw new Error("Invalid operation on closed object")}}]),r}(nt);function jS(e){var n=IB();return function(){var t=kt.default(e),a;if(n){var i=kt.default(this).constructor;a=Reflect.construct(t,arguments,i)}else a=t.apply(this,arguments);return aa.default(this,a)}}function IB(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var mf=function(e){Vt.default(r,e);var n=jS(r);function r(t,a,i){var s;Ke.default(this,r),s=n.call(this,t,i),tt.default(Hr.default(s),"isDeleted",!1);var l=function(h,g){return typeof g.ttl=="number"?{ttl:g.ttl}:h};return s.updateMergingQueue=new xS(l),s.descriptor=a,s.descriptor.data=s.descriptor.data||{},s.descriptor.date_updated=new Date(s.descriptor.date_updated),s}return Xe.default(r,[{key:"uri",get:function(){return this.descriptor.url}},{key:"revision",get:function(){return this.descriptor.revision}},{key:"lastEventId",get:function(){return this.descriptor.last_event_id}},{key:"dateExpires",get:function(){return this.descriptor.date_expires}},{key:"type",get:function(){return"document"}},{key:"indexName",get:function(){}},{key:"queryString",get:function(){}},{key:"sid",get:function(){return this.descriptor.sid}},{key:"data",get:function(){return this.descriptor.data}},{key:"dateUpdated",get:function(){return this.descriptor.date_updated}},{key:"uniqueName",get:function(){return this.descriptor.unique_name||null}},{key:"_update",value:function(a){switch(a.date_created=new Date(a.date_created),a.type){case"document_updated":if(a.id<=this.lastEventId){Qe.trace("Document update skipped, current:",this.lastEventId,", remote:",a.id);break}var i=this.descriptor.data!==void 0?jr(this.descriptor.data):null;this.descriptor.last_event_id=a.id,this.descriptor.revision=a.document_revision,this.descriptor.date_updated=a.date_created,this.descriptor.data=a.document_data,this.broadcastEventToListeners("updated",{data:a.document_data,isLocal:!1,previousData:i}),this.services.storage.update(this.type,this.sid,this.uniqueName,{last_event_id:a.id,revision:a.document_revision,date_updated:a.date_created,data:a.document_data});break;case"document_removed":this.onRemoved(!1);break}}},{key:"set",value:function(){var t=ce.default(A.default.mark(function i(s,l){var c=this,h;return A.default.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return h=l||{},b.abrupt("return",this.updateMergingQueue.squashAndAdd(h,function($){return c._setUnconditionally(s,$.ttl)}));case 2:case"end":return b.stop()}},i,this)}));function a(i,s){return t.apply(this,arguments)}return a}()},{key:"mutate",value:function(){var t=ce.default(A.default.mark(function i(s,l){var c=this,h;return A.default.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return h=l||{},b.abrupt("return",this.updateMergingQueue.add(h,function($){return c._setWithIfMatch(s,$.ttl)}));case 2:case"end":return b.stop()}},i,this)}));function a(i,s){return t.apply(this,arguments)}return a}()},{key:"update",value:function(){var t=ce.default(A.default.mark(function i(s,l){return A.default.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.abrupt("return",this.mutate(function(g){return Object.assign(g,s)},l));case 1:case"end":return h.stop()}},i,this)}));function a(i,s){return t.apply(this,arguments)}return a}()},{key:"setTtl",value:function(){var t=ce.default(A.default.mark(function i(s){var l;return A.default.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,this._postUpdateToServer({ttl:s});case 2:l=h.sent,this.descriptor.date_expires=l.date_expires;case 4:case"end":return h.stop()}},i,this)}));function a(i){return t.apply(this,arguments)}return a}()},{key:"_setUnconditionally",value:function(){var t=ce.default(A.default.mark(function i(s,l){var c;return A.default.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,this._postUpdateToServer({data:s,revision:void 0,ttl:l});case 2:return c=g.sent,this._handleSuccessfulUpdateResult(c),g.abrupt("return",this.descriptor.data);case 5:case"end":return g.stop()}},i,this)}));function a(i,s){return t.apply(this,arguments)}return a}()},{key:"_setWithIfMatch",value:function(){var t=ce.default(A.default.mark(function i(s,l){var c,h,g;return A.default.wrap(function($){for(;;)switch($.prev=$.next){case 0:if(c=s(jr(this.descriptor.data)),!c){$.next=22;break}return h=this.revision,$.prev=3,$.next=6,this._postUpdateToServer({data:c,revision:h,ttl:l});case 6:return g=$.sent,this._handleSuccessfulUpdateResult(g),$.abrupt("return",this.descriptor.data);case 11:if($.prev=11,$.t0=$.catch(3),$.t0.status!==412){$.next=19;break}return $.next=16,this._softSync();case 16:return $.abrupt("return",this._setWithIfMatch(s));case 19:throw $.t0;case 20:$.next=23;break;case 22:return $.abrupt("return",this.descriptor.data);case 23:case"end":return $.stop()}},i,this,[[3,11]])}));function a(i,s){return t.apply(this,arguments)}return a}()},{key:"_handleSuccessfulUpdateResult",value:function(a){if(!(a.last_event_id<=this.descriptor.last_event_id)){var i=this.descriptor.data!==void 0?jr(this.descriptor.data):null;this.descriptor.revision=a.revision,this.descriptor.data=a.data,this.descriptor.last_event_id=a.last_event_id,this.descriptor.date_expires=a.date_expires,this.descriptor.date_updated=new Date(a.date_updated),this.services.storage.update(this.type,this.sid,this.uniqueName,{last_event_id:a.last_event_id,revision:a.revision,date_updated:a.date_updated,data:a.data}),this.broadcastEventToListeners("updated",{data:this.descriptor.data,isLocal:!0,previousData:i})}}},{key:"_postUpdateToServer",value:function(){var t=ce.default(A.default.mark(function i(s){var l,c,h;return A.default.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(this.isDeleted){b.next=17;break}return l={data:s.data},s.ttl!==void 0&&(l.ttl=s.ttl),c=s.revision,b.prev=4,b.next=7,this.services.network.post(this.uri,l,c);case 7:return h=b.sent,b.abrupt("return",{revision:h.body.revision,data:s.data,last_event_id:h.body.last_event_id,date_updated:h.body.date_updated,date_expires:h.body.date_expires});case 11:throw b.prev=11,b.t0=b.catch(4),b.t0.status===404&&this.onRemoved(!1),b.t0;case 15:b.next=18;break;case 17:return b.abrupt("return",Promise.reject(new Xt("The Document has been removed",404,54100)));case 18:case"end":return b.stop()}},i,this,[[4,11]])}));function a(i){return t.apply(this,arguments)}return a}()},{key:"_softSync",value:function(){var t=ce.default(A.default.mark(function i(){var s=this;return A.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",this.services.network.get(this.uri).then(function(h){var g={type:"document_updated",id:h.body.last_event_id,document_revision:h.body.revision,document_data:h.body.data,date_created:h.body.date_updated};return s._update(g),s}).catch(function(h){h.status===404?s.onRemoved(!1):Qe.error("Can't get updates for ".concat(s.sid,":"),h)}));case 1:case"end":return c.stop()}},i,this)}));function a(){return t.apply(this,arguments)}return a}()},{key:"onRemoved",value:function(a){if(!this.isDeleted){var i=this.descriptor.data!==void 0?jr(this.descriptor.data):null;this.isDeleted=!0,this._unsubscribe(),this.removalHandler(this.type,this.sid,this.uniqueName),this.broadcastEventToListeners("removed",{isLocal:a,previousData:i})}}},{key:"removeDocument",value:function(){var t=ce.default(A.default.mark(function i(){return A.default.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(this.isDeleted){l.next=6;break}return l.next=3,this.services.network.delete(this.uri);case 3:this.onRemoved(!0),l.next=7;break;case 6:return l.abrupt("return",Promise.reject(new Xt("The Document has been removed",404,54100)));case 7:case"end":return l.stop()}},i,this)}));function a(){return t.apply(this,arguments)}return a}()}],[{key:"type",get:function(){return"document"}}]),r}(Qs),$r=function(e){Vt.default(r,e);var n=jS(r);function r(t){var a;return Ke.default(this,r),a=n.call(this),a.syncDocumentImpl=t,a.syncDocumentImpl.attach(Hr.default(a)),a}return Xe.default(r,[{key:"uri",get:function(){return this.syncDocumentImpl.uri}},{key:"revision",get:function(){return this.syncDocumentImpl.revision}},{key:"lastEventId",get:function(){return this.syncDocumentImpl.lastEventId}},{key:"dateExpires",get:function(){return this.syncDocumentImpl.dateExpires}},{key:"type",get:function(){return mf.type}},{key:"sid",get:function(){return this.syncDocumentImpl.sid}},{key:"data",get:function(){return this.syncDocumentImpl.data}},{key:"dateUpdated",get:function(){return this.syncDocumentImpl.dateUpdated}},{key:"uniqueName",get:function(){return this.syncDocumentImpl.uniqueName}},{key:"set",value:function(){var t=ce.default(A.default.mark(function i(s,l){return A.default.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return this.ensureNotClosed(),h.abrupt("return",this.syncDocumentImpl.set(s,l));case 2:case"end":return h.stop()}},i,this)}));function a(i,s){return t.apply(this,arguments)}return a}()},{key:"mutate",value:function(){var t=ce.default(A.default.mark(function i(s,l){return A.default.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return this.ensureNotClosed(),h.abrupt("return",this.syncDocumentImpl.mutate(s,l));case 2:case"end":return h.stop()}},i,this)}));function a(i,s){return t.apply(this,arguments)}return a}()},{key:"update",value:function(){var t=ce.default(A.default.mark(function i(s,l){return A.default.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return this.ensureNotClosed(),h.abrupt("return",this.syncDocumentImpl.update(s,l));case 2:case"end":return h.stop()}},i,this)}));function a(i,s){return t.apply(this,arguments)}return a}()},{key:"setTtl",value:function(){var t=ce.default(A.default.mark(function i(s){return A.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return this.ensureNotClosed(),c.abrupt("return",this.syncDocumentImpl.setTtl(s));case 2:case"end":return c.stop()}},i,this)}));function a(i){return t.apply(this,arguments)}return a}()},{key:"removeDocument",value:function(){var t=ce.default(A.default.mark(function i(){return A.default.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.ensureNotClosed(),l.abrupt("return",this.syncDocumentImpl.removeDocument());case 2:case"end":return l.stop()}},i,this)}));function a(){return t.apply(this,arguments)}return a}()},{key:"close",value:function(){Ys.default(kt.default(r.prototype),"close",this).call(this),this.syncDocumentImpl.detach(this.listenerUuid)}}],[{key:"type",get:function(){return mf.type}}]),r}(Xs);tt.default($r,"removed","removed");tt.default($r,"updated","updated");Ye([ne.validateTypesAsync(ne.pureObject,["undefined",ne.objectSchema("document metadata",{ttl:[ne.nonNegativeInteger,"undefined"]})]),ie("design:type",Function),ie("design:paramtypes",[Object,Object]),ie("design:returntype",Promise)],$r.prototype,"set",null);Ye([ne.validateTypesAsync("function",["undefined",ne.objectSchema("document metadata",{ttl:[ne.nonNegativeInteger,"undefined"]})]),ie("design:type",Function),ie("design:paramtypes",[Function,Object]),ie("design:returntype",Promise)],$r.prototype,"mutate",null);Ye([ne.validateTypesAsync(ne.pureObject,["undefined",ne.objectSchema("document metadata",{ttl:[ne.nonNegativeInteger,"undefined"]})]),ie("design:type",Function),ie("design:paramtypes",[Object,Object]),ie("design:returntype",Promise)],$r.prototype,"update",null);Ye([ne.validateTypesAsync(ne.nonNegativeInteger),ie("design:type",Function),ie("design:paramtypes",[Number]),ie("design:returntype",Promise)],$r.prototype,"setTtl",null);var bf=function(){function e(n){Ke.default(this,e),this.descriptor=n}return Xe.default(e,[{key:"uri",get:function(){return this.descriptor.uri}},{key:"revision",get:function(){return this.descriptor.revision}},{key:"lastEventId",get:function(){return this.descriptor.lastEventId}},{key:"dateUpdated",get:function(){return this.descriptor.dateUpdated}},{key:"dateExpires",get:function(){return this.descriptor.dateExpires}},{key:"index",get:function(){return this.descriptor.index}},{key:"data",get:function(){return this.descriptor.data}},{key:"update",value:function(r,t,a,i){return this.descriptor.lastEventId=r,this.descriptor.revision=t,this.descriptor.data=a,this.descriptor.dateUpdated=i,this}},{key:"updateDateExpires",value:function(r){this.descriptor.dateExpires=r}}]),e}(),tp=function(){function e(n,r,t,a){Ke.default(this,e),this.prevToken=t,this.nextToken=a,this.items=n,this.source=r}return Xe.default(e,[{key:"hasNextPage",get:function(){return!!this.nextToken}},{key:"hasPrevPage",get:function(){return!!this.prevToken}},{key:"nextPage",value:function(){var n=ce.default(A.default.mark(function t(){return A.default.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(this.hasNextPage){i.next=2;break}throw new Error("No next page");case 2:return i.abrupt("return",this.source(this.nextToken));case 3:case"end":return i.stop()}},t,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"prevPage",value:function(){var n=ce.default(A.default.mark(function t(){return A.default.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(this.hasPrevPage){i.next=2;break}throw new Error("No previous page");case 2:return i.abrupt("return",this.source(this.prevToken));case 3:case"end":return i.stop()}},t,this)}));function r(){return n.apply(this,arguments)}return r}()}]),e}();function RB(e,n){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=EB(e))||n&&e&&typeof e.length=="number"){r&&(e=r);var t=0,a=function(){};return{s:a,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(h){throw h},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,s=!1,l;return{s:function(){r=r.call(e)},n:function(){var h=r.next();return i=h.done,h},e:function(h){s=!0,l=h},f:function(){try{!i&&r.return!=null&&r.return()}finally{if(s)throw l}}}}function EB(e,n){if(!!e){if(typeof e=="string")return Gy(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Gy(e,n)}}function Gy(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,t=new Array(n);r<n;r++)t[r]=e[r];return t}var CB=function(){function e(n,r){Ke.default(this,e),this.balanceFactor=0,this.key=n,this.value=r,this.parent=null,this.left=null,this.right=null}return Xe.default(e,[{key:"isRoot",get:function(){return this.parent===null}},{key:"isLeaf",get:function(){return this.left===null&&this.right===null}},{key:"isLeftChild",get:function(){return this.parent.left===this}},{key:"update",value:function(r){this.value=r}},{key:"replace",value:function(r,t){!r||(this.left===t?this.left=t:this.right===t&&(this.right=t))}}]),e}(),OB=function(){function e(n,r){Ke.default(this,e),this.isLessThan=n||function(t,a){return t<a},this.isEqual=r||function(t,a){return t===a},this.root=null,this.count=null}return Xe.default(e,[{key:"size",get:function(){return this.count}},{key:"clear",value:function(){this.root=null,this.count=0}},{key:"set",value:function(r,t){var a=this.getNode(r);a?a.update(t):this.insert(r,t)}},{key:"insert",value:function(r,t){var a=new CB(r,t);if(this.count++,!this.root){this.root=a;return}for(var i=this.root;;)if(this.isLessThan(r,i.key))if(i.left)i=i.left;else{i.left=a;break}else if(i.right)i=i.right;else{i.right=a;break}for(a.parent=i,i=a;i.parent;){var s=i.parent,l=s.balanceFactor;if(i.isLeftChild?s.balanceFactor++:s.balanceFactor--,Math.abs(s.balanceFactor)<Math.abs(l))break;if(s.balanceFactor<-1||s.balanceFactor>1){this.rebalance(s);break}i=s}}},{key:"get",value:function(r){for(var t=this.root;t;){if(this.isEqual(r,t.key))return t.value;this.isLessThan(r,t.key)?t=t.left:t=t.right}return null}},{key:"delete",value:function(r){var t=this.getNode(r);if(!t||t.key!==r)return null;var a=t.parent,i=t.left,s=t.right;if(!!i!=!!s){var l=i||s;!a&&!l?this.root=null:a&&!l?this.root=l:(a.replace(t,null),this.rebalance(a))}else{for(var c=t.left;c.right;)c=c.right;if(t.left===c)t.isRoot?(this.root=c,c.parent=null):(t.isLeftChild?t.parent.left=c:t.parent.right=c,c.parent=t.parent),c.right=t.right,c.right.parent=c,c.balanceFactor=t.balanceFactor,t={parent:c,isLeftChild:!0};else{var h=c.parent,g=c.left;h.right=g,g&&(g.parent=h),t.isRoot?(this.root=c,c.parent=null):(t.isLeftChild?t.parent.left=c:t.parent.right=c,c.parent=t.parent),c.right=t.right,c.right.parent=c,c.left=t.left,c.left.parent=c,c.balanceFactor=t.balanceFactor,t={parent:h,isLeftChild:!1}}}for(this.count--;t.parent;){var b=t.parent,$=b.balanceFactor;if(t.isLeftChild?b.balanceFactor-=1:b.balanceFactor+=1,Math.abs(b.balanceFactor)>Math.abs($))if(b.balanceFactor<-1||b.balanceFactor>1)if(this.rebalance(b),b.parent.balanceFactor===0)t=b.parent;else break;else break;else t=b}return null}},{key:"getNode",value:function(r){for(var t=this.root;t;){if(this.isEqual(r,t.key))return t;this.isLessThan(r,t.key)?t=t.left:t=t.right}return null}},{key:"rebalance",value:function(r){r.balanceFactor<0?r.right.balanceFactor>0?(this.rotateRight(r.right),this.rotateLeft(r)):this.rotateLeft(r):r.balanceFactor>0&&(r.left.balanceFactor<0?(this.rotateLeft(r.left),this.rotateRight(r)):this.rotateRight(r))}},{key:"rotateLeft",value:function(r){var t=r.right;r.right=t.left,t.left!==null&&(t.left.parent=r),t.parent=r.parent,t.parent===null?this.root=t:r.isLeftChild?t.parent.left=t:t.parent.right=t,t.left=r,r.parent=t,r.balanceFactor=r.balanceFactor+1-Math.min(t.balanceFactor,0),t.balanceFactor=t.balanceFactor+1-Math.max(r.balanceFactor,0)}},{key:"rotateRight",value:function(r){var t=r.left;r.left=t.right,t.right!==null&&(t.right.parent=r),t.parent=r.parent,t.parent===null?this.root=t:r.isLeftChild?t.parent.left=t:t.parent.right=t,t.right=r,r.parent=t,r.balanceFactor=r.balanceFactor-1-Math.min(t.balanceFactor,0),t.balanceFactor=t.balanceFactor-1-Math.max(r.balanceFactor,0)}},{key:Symbol.iterator,value:A.default.mark(function n(){var r,t,a;return A.default.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:r=RB(this.getIterator()),s.prev=1,r.s();case 3:if((t=r.n()).done){s.next=9;break}return a=t.value,s.next=7,a;case 7:s.next=3;break;case 9:s.next=14;break;case 11:s.prev=11,s.t0=s.catch(1),r.e(s.t0);case 14:return s.prev=14,r.f(),s.finish(14);case 17:case"end":return s.stop()}},n,this,[[1,11,14,17]])})},{key:"getIterator",value:A.default.mark(function n(){var r,t,a,i=arguments;return A.default.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:r=i.length>0&&i[0]!==void 0?i[0]:null,t=this.root;case 2:if(!t){l.next=8;break}if(!(this.isEqual(r,t.key)||r===null&&!t.left)){l.next=5;break}return l.abrupt("break",8);case 5:this.isLessThan(r,t.key)||r===null?t=t.left:t=t.right,l.next=2;break;case 8:if(t){l.next=10;break}return l.abrupt("return",null);case 10:a=!0;case 11:if(!a){l.next=29;break}return l.next=14,[t.key,t.value];case 14:if(a=!1,!t.right){l.next=21;break}for(t=t.right;t.left;)t=t.left;a=!0,l.next=27;break;case 21:if(!t.parent){l.next=26;break}a=t.parent.left===t,t=t.parent,l.next=27;break;case 26:return l.abrupt("break",37);case 27:l.next=35;break;case 29:if(!t.parent){l.next=34;break}a=t.parent.left===t,t=t.parent,l.next=35;break;case 34:return l.abrupt("break",37);case 35:l.next=11;break;case 37:return l.abrupt("return",null);case 38:case"end":return l.stop()}},n,this)})},{key:"getReverseIterator",value:A.default.mark(function n(){var r,t,a,i=arguments;return A.default.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:r=i.length>0&&i[0]!==void 0?i[0]:null,t=this.root;case 2:if(!t){l.next=8;break}if(!(this.isEqual(r,t.key)||r===null&&!t.right)){l.next=5;break}return l.abrupt("break",8);case 5:!this.isLessThan(r,t.key)||r===null?t=t.right:t=t.left,l.next=2;break;case 8:if(t){l.next=10;break}return l.abrupt("return",null);case 10:a=!0;case 11:if(!a){l.next=29;break}return l.next=14,[t.key,t.value];case 14:if(a=!1,!t.left){l.next=21;break}for(t=t.left;t.right;)t=t.right;a=!0,l.next=27;break;case 21:if(!t.parent){l.next=26;break}a=t.parent.right===t,t=t.parent,l.next=27;break;case 26:return l.abrupt("break",37);case 27:l.next=35;break;case 29:if(!t.parent){l.next=34;break}a=t.parent.right===t,t=t.parent,l.next=35;break;case 34:return l.abrupt("break",37);case 35:l.next=11;break;case 37:return l.abrupt("return",null);case 38:case"end":return l.stop()}},n,this)})}]),e}();function PB(e,n){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=AB(e))||n&&e&&typeof e.length=="number"){r&&(e=r);var t=0,a=function(){};return{s:a,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(h){throw h},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,s=!1,l;return{s:function(){r=r.call(e)},n:function(){var h=r.next();return i=h.done,h},e:function(h){s=!0,l=h},f:function(){try{!i&&r.return!=null&&r.return()}finally{if(s)throw l}}}}function AB(e,n){if(!!e){if(typeof e=="string")return Hy(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Hy(e,n)}}function Hy(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,t=new Array(n);r<n;r++)t[r]=e[r];return t}var MB=function(){function e(n,r){Ke.default(this,e),this.value=n,this.revision=r||0}return Xe.default(e,[{key:"isValid",get:function(){return!0}}]),e}(),NB=function(){function e(n){Ke.default(this,e),this.revision=n}return Xe.default(e,[{key:"isValid",get:function(){return!1}}]),e}(),rp=function(){function e(){Ke.default(this,e),this.items=new OB}return Xe.default(e,[{key:"store",value:function(r,t,a){var i=this.items.get(r);return i&&i.revision>a?i.isValid?i.value:null:(this.items.set(r,new MB(t,a)),t)}},{key:"delete",value:function(r,t){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=this.items.get(r);(!i||i.revision<t||i&&a===!0)&&this.items.set(r,new NB(t))}},{key:"isKnown",value:function(r,t){var a=this.items.get(r);return a&&a.revision>=t}},{key:"get",value:function(r){var t=this.items.get(r);return t&&t.isValid?t.value:null}},{key:"has",value:function(r){var t=this.items.get(r);return t&&t.isValid}},{key:"forEach",value:function(r){if(this.items){var t=PB(this.items),a;try{for(t.s();!(a=t.n()).done;){var i=CS.default(a.value,2),s=i[0],l=i[1];l.isValid&&r(s,l.value)}}catch(c){t.e(c)}finally{t.f()}}}}]),e}();function DS(e){var n=LB();return function(){var t=kt.default(e),a;if(n){var i=kt.default(this).constructor;a=Reflect.construct(t,arguments,i)}else a=t.apply(this,arguments);return aa.default(this,a)}}function LB(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var wf=function(e){Vt.default(r,e);var n=DS(r);function r(t,a,i){var s;Ke.default(this,r),s=n.call(this,t,i);var l=function(h,g){return typeof g.ttl=="number"?{ttl:g.ttl}:h};return s.updateMergingQueue=new US(l),s.cache=new rp,s.descriptor=a,s.descriptor.date_updated=new Date(s.descriptor.date_updated),s}return Xe.default(r,[{key:"uri",get:function(){return this.descriptor.url}},{key:"revision",get:function(){return this.descriptor.revision}},{key:"lastEventId",get:function(){return this.descriptor.last_event_id}},{key:"links",get:function(){return this.descriptor.links}},{key:"dateExpires",get:function(){return this.descriptor.date_expires}},{key:"type",get:function(){return"list"}},{key:"indexName",get:function(){}},{key:"queryString",get:function(){}},{key:"sid",get:function(){return this.descriptor.sid}},{key:"uniqueName",get:function(){return this.descriptor.unique_name||null}},{key:"dateUpdated",get:function(){return this.descriptor.date_updated}},{key:"_addOrUpdateItemOnServer",value:function(){var t=ce.default(A.default.mark(function i(s,l,c,h){var g,b;return A.default.wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return g={data:l},h!==void 0&&(g.ttl=h),S.next=4,this.services.network.post(s,g,c);case 4:return b=S.sent,b.body.data=l,b.body.date_updated=new Date(b.body.date_updated),S.abrupt("return",b.body);case 8:case"end":return S.stop()}},i,this)}));function a(i,s,l,c){return t.apply(this,arguments)}return a}()},{key:"push",value:function(){var t=ce.default(A.default.mark(function i(s,l){var c,h,g;return A.default.wrap(function($){for(;;)switch($.prev=$.next){case 0:return c=(l||{}).ttl,$.next=3,this._addOrUpdateItemOnServer(this.links.items,s,void 0,c);case 3:return h=$.sent,g=Number(h.index),this._handleItemMutated(g,h.url,h.last_event_id,h.revision,s,h.date_updated,h.date_expires,!0,!1),$.abrupt("return",this.cache.get(g));case 7:case"end":return $.stop()}},i,this)}));function a(i,s){return t.apply(this,arguments)}return a}()},{key:"set",value:function(){var t=ce.default(A.default.mark(function i(s,l,c){var h=this,g;return A.default.wrap(function($){for(;;)switch($.prev=$.next){case 0:return g=c||{},$.abrupt("return",this.updateMergingQueue.squashAndAdd(s,g,function(S){return h._updateItemUnconditionally(s,l,S.ttl)}));case 2:case"end":return $.stop()}},i,this)}));function a(i,s,l){return t.apply(this,arguments)}return a}()},{key:"_updateItemUnconditionally",value:function(){var t=ce.default(A.default.mark(function i(s,l,c){var h,g;return A.default.wrap(function($){for(;;)switch($.prev=$.next){case 0:return $.next=2,this.get(s);case 2:return h=$.sent,$.next=5,this._addOrUpdateItemOnServer(h.uri,l,void 0,c);case 5:return g=$.sent,this._handleItemMutated(s,g.url,g.last_event_id,g.revision,g.data,g.date_updated,g.date_expires,!1,!1),$.abrupt("return",this.cache.get(s));case 8:case"end":return $.stop()}},i,this)}));function a(i,s,l){return t.apply(this,arguments)}return a}()},{key:"_updateItemWithIfMatch",value:function(){var t=ce.default(A.default.mark(function i(s,l,c){var h,g,b,$;return A.default.wrap(function(R){for(;;)switch(R.prev=R.next){case 0:return R.next=2,this.get(s);case 2:if(h=R.sent,g=l(jr(h.data)),!g){R.next=25;break}return b=h.revision,R.prev=6,R.next=9,this._addOrUpdateItemOnServer(h.uri,g,b,c);case 9:return $=R.sent,this._handleItemMutated(s,$.url,$.last_event_id,$.revision,$.data,$.date_updated,$.date_expires,!1,!1),R.abrupt("return",this.cache.get(s));case 14:if(R.prev=14,R.t0=R.catch(6),R.t0.status!==412){R.next=22;break}return R.next=19,this._getItemFromServer(s);case 19:return R.abrupt("return",this._updateItemWithIfMatch(s,l,c));case 22:throw R.t0;case 23:R.next=26;break;case 25:return R.abrupt("return",h);case 26:case"end":return R.stop()}},i,this,[[6,14]])}));function a(i,s,l){return t.apply(this,arguments)}return a}()},{key:"mutate",value:function(){var t=ce.default(A.default.mark(function i(s,l,c){var h=this,g;return A.default.wrap(function($){for(;;)switch($.prev=$.next){case 0:return g=c||{},$.abrupt("return",this.updateMergingQueue.add(s,g,function(S){return h._updateItemWithIfMatch(s,l,S.ttl)}));case 2:case"end":return $.stop()}},i,this)}));function a(i,s,l){return t.apply(this,arguments)}return a}()},{key:"update",value:function(){var t=ce.default(A.default.mark(function i(s,l,c){return A.default.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.abrupt("return",this.mutate(s,function(b){return Object.assign(b,l)},c));case 1:case"end":return g.stop()}},i,this)}));function a(i,s,l){return t.apply(this,arguments)}return a}()},{key:"remove",value:function(){var t=ce.default(A.default.mark(function i(s){var l,c,h;return A.default.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.next=2,this.get(s);case 2:return l=b.sent,c=jr(l.data),b.next=6,this.services.network.delete(l.uri);case 6:h=b.sent,this._handleItemRemoved(s,h.body.last_event_id,c,new Date(h.body.date_updated),!1);case 8:case"end":return b.stop()}},i,this)}));function a(i){return t.apply(this,arguments)}return a}()},{key:"get",value:function(){var t=ce.default(A.default.mark(function i(s){var l;return A.default.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:if(l=this.cache.get(s),!l){h.next=5;break}return h.abrupt("return",l);case 5:return h.abrupt("return",this._getItemFromServer(s));case 6:case"end":return h.stop()}},i,this)}));function a(i){return t.apply(this,arguments)}return a}()},{key:"_getItemFromServer",value:function(){var t=ce.default(A.default.mark(function i(s){var l;return A.default.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,this.queryItems({index:s});case 2:if(l=h.sent,!(l.items.length<1)){h.next=7;break}throw new Xt("No item with index ".concat(s," found"),404,54151);case 7:return h.abrupt("return",l.items[0]);case 8:case"end":return h.stop()}},i,this)}));function a(i){return t.apply(this,arguments)}return a}()},{key:"queryItems",value:function(){var t=ce.default(A.default.mark(function i(s){var l=this,c,h,g,b;return A.default.wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return s=s||{},c=new wi(this.links.items).queryParam("From",s.from).queryParam("PageSize",s.limit).queryParam("Index",s.index).queryParam("PageToken",s.pageToken).queryParam("Order",s.order).build(),S.next=4,this.services.network.get(c);case 4:return h=S.sent,g=h.body.items.map(function(R){R.date_updated=new Date(R.date_updated);var N=l.cache.get(R.index);return N?l._handleItemMutated(R.index,R.url,R.last_event_id,R.revision,R.data,R.date_updated,R.date_expires,!1,!0):l.cache.store(Number(R.index),new bf({index:Number(R.index),uri:R.url,revision:R.revision,lastEventId:R.last_event_id,dateUpdated:R.date_updated,dateExpires:R.date_expires,data:R.data}),R.last_event_id),l.cache.get(R.index)}),b=h.body.meta,S.abrupt("return",new tp(g,function(R){return l.queryItems({pageToken:R})},b.previous_token,b.next_token));case 8:case"end":return S.stop()}},i,this)}));function a(i){return t.apply(this,arguments)}return a}()},{key:"getItems",value:function(){var t=ce.default(A.default.mark(function i(s){return A.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return s=s||{},LS(s.pageSize),s.limit=s.pageSize||s.limit||50,s.order=s.order||"asc",c.abrupt("return",this.queryItems(s));case 5:case"end":return c.stop()}},i,this)}));function a(i){return t.apply(this,arguments)}return a}()},{key:"getContext",value:function(){var t=ce.default(A.default.mark(function i(){var s;return A.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(this.context){c.next=5;break}return c.next=3,this.services.network.get(this.links.context);case 3:s=c.sent,this._updateContextIfRequired(s.body.data,s.body.last_event_id);case 5:return c.abrupt("return",this.context);case 6:case"end":return c.stop()}},i,this)}));function a(){return t.apply(this,arguments)}return a}()},{key:"setTtl",value:function(){var t=ce.default(A.default.mark(function i(s){var l,c;return A.default.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.prev=0,l={ttl:s},g.next=4,this.services.network.post(this.uri,l);case 4:c=g.sent,this.descriptor.date_expires=c.body.date_expires,g.next=12;break;case 8:throw g.prev=8,g.t0=g.catch(0),g.t0.status===404&&this.onRemoved(!1),g.t0;case 12:case"end":return g.stop()}},i,this,[[0,8]])}));function a(i){return t.apply(this,arguments)}return a}()},{key:"setItemTtl",value:function(){var t=ce.default(A.default.mark(function i(s,l){var c,h,g;return A.default.wrap(function($){for(;;)switch($.prev=$.next){case 0:return $.next=2,this.get(s);case 2:return c=$.sent,h={ttl:l},$.next=6,this.services.network.post(c.uri,h);case 6:g=$.sent,c.updateDateExpires(g.body.date_expires);case 8:case"end":return $.stop()}},i,this)}));function a(i,s){return t.apply(this,arguments)}return a}()},{key:"removeList",value:function(){var t=ce.default(A.default.mark(function i(){return A.default.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.services.network.delete(this.uri);case 2:this.onRemoved(!0);case 3:case"end":return l.stop()}},i,this)}));function a(){return t.apply(this,arguments)}return a}()},{key:"onRemoved",value:function(a){this._unsubscribe(),this.removalHandler(this.type,this.sid,this.uniqueName),this.broadcastEventToListeners("removed",{isLocal:a})}},{key:"shouldIgnoreEvent",value:function(a,i){return this.cache.isKnown(a,i)}},{key:"_update",value:function(a,i){var s=Number(a.item_index);switch(a.date_created=new Date(a.date_created),a.type){case"list_item_added":case"list_item_updated":this._handleItemMutated(s,a.item_url,a.id,a.item_revision,a.item_data,a.date_created,void 0,a.type==="list_item_added",!0);break;case"list_item_removed":this._handleItemRemoved(s,a.id,a.item_data,a.date_created,!0);break;case"list_context_updated":this._handleContextUpdate(a.context_data,a.id,a.date_created);break;case"list_removed":this.onRemoved(!1);break}i&&this._advanceLastEventId(a.id,a.list_revision)}},{key:"_advanceLastEventId",value:function(a,i){this.lastEventId<a&&(this.descriptor.last_event_id=a,i&&(this.descriptor.revision=i))}},{key:"_updateRootDateUpdated",value:function(a){(!this.descriptor.date_updated||a.getTime()>this.descriptor.date_updated.getTime())&&(this.descriptor.date_updated=a,this.services.storage.update(this.type,this.sid,this.uniqueName,{date_updated:a}))}},{key:"_handleItemMutated",value:function(a,i,s,l,c,h,g,b,$){if(this.shouldIgnoreEvent(a,s)){Qe.trace("Item ".concat(a," update skipped, current: ").concat(this.lastEventId,", remote: ").concat(s));return}this._updateRootDateUpdated(h);var S=this.cache.get(a);if(!S){var R=new bf({index:a,uri:i,lastEventId:s,revision:l,data:c,dateUpdated:h,dateExpires:g});this.cache.store(a,R,s),this.emitItemMutationEvent(R,$,b);return}var N=jr(S.data);S.update(s,l,c,h),this.cache.store(a,S,s),g!==void 0&&S.updateDateExpires(g),this.emitItemMutationEvent(S,$,!1,N)}},{key:"emitItemMutationEvent",value:function(a,i,s){var l=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,c=s?"itemAdded":"itemUpdated",h={item:a,isLocal:!i};s||(h.previousItemData=l),this.broadcastEventToListeners(c,h)}},{key:"_handleItemRemoved",value:function(a,i,s,l,c){this._updateRootDateUpdated(l),this.cache.delete(a,i),this.broadcastEventToListeners("itemRemoved",{index:a,isLocal:!c,previousItemData:s})}},{key:"_handleContextUpdate",value:function(a,i,s){this._updateRootDateUpdated(s),this._updateContextIfRequired(a,i)&&this.broadcastEventToListeners("contextUpdated",{context:a,isLocal:!1})}},{key:"_updateContextIfRequired",value:function(a,i){return!this.contextEventId||i>this.contextEventId?(this.context=a,this.contextEventId=i,!0):(Qe.trace("Context update skipped, current:",this.lastEventId,", remote:",i),!1)}}],[{key:"type",get:function(){return"list"}}]),r}(Qs),Ct=function(e){Vt.default(r,e);var n=DS(r);function r(t){var a;return Ke.default(this,r),a=n.call(this),a.syncListImpl=t,a.syncListImpl.attach(Hr.default(a)),a}return Xe.default(r,[{key:"uri",get:function(){return this.syncListImpl.uri}},{key:"revision",get:function(){return this.syncListImpl.revision}},{key:"lastEventId",get:function(){return this.syncListImpl.lastEventId}},{key:"links",get:function(){return this.syncListImpl.links}},{key:"dateExpires",get:function(){return this.syncListImpl.dateExpires}},{key:"type",get:function(){return wf.type}},{key:"sid",get:function(){return this.syncListImpl.sid}},{key:"uniqueName",get:function(){return this.syncListImpl.uniqueName}},{key:"dateUpdated",get:function(){return this.syncListImpl.dateUpdated}},{key:"push",value:function(){var t=ce.default(A.default.mark(function i(s,l){return A.default.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return this.ensureNotClosed(),h.abrupt("return",this.syncListImpl.push(s,l));case 2:case"end":return h.stop()}},i,this)}));function a(i,s){return t.apply(this,arguments)}return a}()},{key:"set",value:function(){var t=ce.default(A.default.mark(function i(s,l,c){return A.default.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return this.ensureNotClosed(),g.abrupt("return",this.syncListImpl.set(s,l,c));case 2:case"end":return g.stop()}},i,this)}));function a(i,s,l){return t.apply(this,arguments)}return a}()},{key:"mutate",value:function(){var t=ce.default(A.default.mark(function i(s,l,c){return A.default.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return this.ensureNotClosed(),g.abrupt("return",this.syncListImpl.mutate(s,l,c));case 2:case"end":return g.stop()}},i,this)}));function a(i,s,l){return t.apply(this,arguments)}return a}()},{key:"update",value:function(){var t=ce.default(A.default.mark(function i(s,l,c){return A.default.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return this.ensureNotClosed(),g.abrupt("return",this.syncListImpl.update(s,l,c));case 2:case"end":return g.stop()}},i,this)}));function a(i,s,l){return t.apply(this,arguments)}return a}()},{key:"remove",value:function(){var t=ce.default(A.default.mark(function i(s){return A.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return this.ensureNotClosed(),c.abrupt("return",this.syncListImpl.remove(s));case 2:case"end":return c.stop()}},i,this)}));function a(i){return t.apply(this,arguments)}return a}()},{key:"get",value:function(){var t=ce.default(A.default.mark(function i(s){return A.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return this.ensureNotClosed(),c.abrupt("return",this.syncListImpl.get(s));case 2:case"end":return c.stop()}},i,this)}));function a(i){return t.apply(this,arguments)}return a}()},{key:"getContext",value:function(){var t=ce.default(A.default.mark(function i(){return A.default.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.ensureNotClosed(),l.abrupt("return",this.syncListImpl.getContext());case 2:case"end":return l.stop()}},i,this)}));function a(){return t.apply(this,arguments)}return a}()},{key:"getItems",value:function(){var t=ce.default(A.default.mark(function i(s){return A.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return this.ensureNotClosed(),c.abrupt("return",this.syncListImpl.getItems(s));case 2:case"end":return c.stop()}},i,this)}));function a(i){return t.apply(this,arguments)}return a}()},{key:"setTtl",value:function(){var t=ce.default(A.default.mark(function i(s){return A.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return this.ensureNotClosed(),c.abrupt("return",this.syncListImpl.setTtl(s));case 2:case"end":return c.stop()}},i,this)}));function a(i){return t.apply(this,arguments)}return a}()},{key:"setItemTtl",value:function(){var t=ce.default(A.default.mark(function i(s,l){return A.default.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return this.ensureNotClosed(),h.abrupt("return",this.syncListImpl.setItemTtl(s,l));case 2:case"end":return h.stop()}},i,this)}));function a(i,s){return t.apply(this,arguments)}return a}()},{key:"removeList",value:function(){var t=ce.default(A.default.mark(function i(){return A.default.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.ensureNotClosed(),l.abrupt("return",this.syncListImpl.removeList());case 2:case"end":return l.stop()}},i,this)}));function a(){return t.apply(this,arguments)}return a}()},{key:"close",value:function(){Ys.default(kt.default(r.prototype),"close",this).call(this),this.syncListImpl.detach(this.listenerUuid)}}],[{key:"type",get:function(){return wf.type}}]),r}(Xs);tt.default(Ct,"itemAdded","itemAdded");tt.default(Ct,"itemUpdated","itemUpdated");tt.default(Ct,"itemRemoved","itemRemoved");tt.default(Ct,"removed","removed");Ye([ne.validateTypesAsync(ne.pureObject,["undefined",ne.objectSchema("item metadata",{ttl:[ne.nonNegativeInteger,"undefined"]})]),ie("design:type",Function),ie("design:paramtypes",[Object,Object]),ie("design:returntype",Promise)],Ct.prototype,"push",null);Ye([ne.validateTypesAsync(ne.nonNegativeInteger,ne.pureObject,["undefined",ne.objectSchema("item metadata",{ttl:[ne.nonNegativeInteger,"undefined"]})]),ie("design:type",Function),ie("design:paramtypes",[Number,Object,Object]),ie("design:returntype",Promise)],Ct.prototype,"set",null);Ye([ne.validateTypesAsync(ne.nonNegativeInteger,"function",["undefined",ne.objectSchema("item metadata",{ttl:[ne.nonNegativeInteger,"undefined"]})]),ie("design:type",Function),ie("design:paramtypes",[Number,Function,Object]),ie("design:returntype",Promise)],Ct.prototype,"mutate",null);Ye([ne.validateTypesAsync(ne.nonNegativeInteger,ne.pureObject,["undefined",ne.objectSchema("item metadata",{ttl:[ne.nonNegativeInteger,"undefined"]})]),ie("design:type",Function),ie("design:paramtypes",[Number,Object,Object]),ie("design:returntype",Promise)],Ct.prototype,"update",null);Ye([ne.validateTypesAsync(ne.nonNegativeInteger),ie("design:type",Function),ie("design:paramtypes",[Number]),ie("design:returntype",Promise)],Ct.prototype,"remove",null);Ye([ne.validateTypesAsync(ne.nonNegativeInteger),ie("design:type",Function),ie("design:paramtypes",[Number]),ie("design:returntype",Promise)],Ct.prototype,"get",null);Ye([ne.validateTypesAsync(["undefined",ne.objectSchema("query options",{from:[ne.nonNegativeInteger,"undefined"],pageSize:[ne.custom(function(e){return[ep(e),"a positive integer"]}),"undefined"]})]),ie("design:type",Function),ie("design:paramtypes",[Object]),ie("design:returntype",Promise)],Ct.prototype,"getItems",null);Ye([ne.validateTypesAsync(ne.nonNegativeInteger),ie("design:type",Function),ie("design:paramtypes",[Number]),ie("design:returntype",Promise)],Ct.prototype,"setTtl",null);Ye([ne.validateTypesAsync(ne.nonNegativeInteger,ne.nonNegativeInteger),ie("design:type",Function),ie("design:paramtypes",[Number,Number]),ie("design:returntype",Promise)],Ct.prototype,"setItemTtl",null);var cs=function(){function e(n){Ke.default(this,e),this.descriptor=n}return Xe.default(e,[{key:"uri",get:function(){return this.descriptor.url}},{key:"revision",get:function(){return this.descriptor.revision}},{key:"lastEventId",get:function(){return this.descriptor.last_event_id}},{key:"dateExpires",get:function(){return this.descriptor.date_expires}},{key:"key",get:function(){return this.descriptor.key}},{key:"data",get:function(){return this.descriptor.data}},{key:"dateUpdated",get:function(){return this.descriptor.date_updated}},{key:"update",value:function(r,t,a,i){return this.descriptor.last_event_id=r,this.descriptor.revision=t,this.descriptor.data=a,this.descriptor.date_updated=i,this}},{key:"updateDateExpires",value:function(r){this.descriptor.date_expires=r}}]),e}();function FS(e){var n=xB();return function(){var t=kt.default(e),a;if(n){var i=kt.default(this).constructor;a=Reflect.construct(t,arguments,i)}else a=t.apply(this,arguments);return aa.default(this,a)}}function xB(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Sf=function(e){Vt.default(r,e);var n=FS(r);function r(t,a,i){var s;Ke.default(this,r),s=n.call(this,t,i);var l=function(h,g){return typeof g.ttl=="number"?{ttl:g.ttl}:h};return s.updateMergingQueue=new US(l),s.cache=new rp,s.descriptor=a,s.descriptor.date_updated=new Date(s.descriptor.date_updated),a.items&&a.items.forEach(function(c){c.date_updated=new Date(c.date_updated),s.cache.store(c.key,new cs(c),c.last_event_id)}),s}return Xe.default(r,[{key:"uri",get:function(){return this.descriptor.url}},{key:"links",get:function(){return this.descriptor.links}},{key:"revision",get:function(){return this.descriptor.revision}},{key:"lastEventId",get:function(){return this.descriptor.last_event_id}},{key:"dateExpires",get:function(){return this.descriptor.date_expires}},{key:"type",get:function(){return"map"}},{key:"indexName",get:function(){}},{key:"queryString",get:function(){}},{key:"sid",get:function(){return this.descriptor.sid}},{key:"uniqueName",get:function(){return this.descriptor.unique_name||null}},{key:"dateUpdated",get:function(){return this.descriptor.date_updated}},{key:"set",value:function(){var t=ce.default(A.default.mark(function i(s,l,c){var h=this,g;return A.default.wrap(function($){for(;;)switch($.prev=$.next){case 0:return g=c||{},$.abrupt("return",this.updateMergingQueue.squashAndAdd(s,g,function(S){return h._putItemUnconditionally(s,l,S.ttl)}));case 2:case"end":return $.stop()}},i,this)}));function a(i,s,l){return t.apply(this,arguments)}return a}()},{key:"get",value:function(){var t=ce.default(A.default.mark(function i(s){return A.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(s!=null){c.next=2;break}throw new Xt("SyncMapItem key may not be empty",400,54209);case 2:if(!this.cache.has(s)){c.next=6;break}return c.abrupt("return",this.cache.get(s));case 6:return c.abrupt("return",this._getItemFromServer(s));case 7:case"end":return c.stop()}},i,this)}));function a(i){return t.apply(this,arguments)}return a}()},{key:"_getItemFromServer",value:function(){var t=ce.default(A.default.mark(function i(s){var l;return A.default.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,this.queryItems({key:s});case 2:if(l=h.sent,!(l.items.length<1)){h.next=7;break}throw new Xt("The specified Map Item does not exist",404,54201);case 7:return h.abrupt("return",l.items[0]);case 8:case"end":return h.stop()}},i,this)}));function a(i){return t.apply(this,arguments)}return a}()},{key:"mutate",value:function(){var t=ce.default(A.default.mark(function i(s,l,c){var h=this,g;return A.default.wrap(function($){for(;;)switch($.prev=$.next){case 0:return g=c||{},$.abrupt("return",this.updateMergingQueue.add(s,g,function(S){return h._putItemWithIfMatch(s,l,S.ttl)}));case 2:case"end":return $.stop()}},i,this)}));function a(i,s,l){return t.apply(this,arguments)}return a}()},{key:"update",value:function(){var t=ce.default(A.default.mark(function i(s,l,c){return A.default.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.abrupt("return",this.mutate(s,function(b){return Object.assign(b,l)},c));case 1:case"end":return g.stop()}},i,this)}));function a(i,s,l){return t.apply(this,arguments)}return a}()},{key:"_putItemUnconditionally",value:function(){var t=ce.default(A.default.mark(function i(s,l,c){var h,g;return A.default.wrap(function($){for(;;)switch($.prev=$.next){case 0:return $.next=2,this._putItemToServer(s,l,void 0,c);case 2:return h=$.sent,g=h.item,this._handleItemMutated(g.key,g.url,g.last_event_id,g.revision,g.data,g.date_updated,g.date_expires,h.added,!1),$.abrupt("return",this.cache.get(g.key));case 6:case"end":return $.stop()}},i,this)}));function a(i,s,l){return t.apply(this,arguments)}return a}()},{key:"_putItemWithIfMatch",value:function(){var t=ce.default(A.default.mark(function i(s,l,c){var h,g,b,$,S;return A.default.wrap(function(N){for(;;)switch(N.prev=N.next){case 0:return N.next=2,this.get(s).catch(function(M){if(M.status===404)return new cs({key:s,data:{},last_event_id:-1,revision:"-1",url:null,date_updated:null,date_expires:null});throw M});case 2:if(h=N.sent,g=l(jr(h.data)),!g){N.next=26;break}return b=h.revision,N.prev=6,N.next=9,this._putItemToServer(s,g,b,c);case 9:return $=N.sent,S=$.item,this._handleItemMutated(S.key,S.url,S.last_event_id,S.revision,S.data,S.date_updated,S.date_expires,$.added,!1),N.abrupt("return",this.cache.get(S.key));case 15:if(N.prev=15,N.t0=N.catch(6),N.t0.status!==412){N.next=23;break}return N.next=20,this._getItemFromServer(s);case 20:return N.abrupt("return",this._putItemWithIfMatch(s,l,c));case 23:throw N.t0;case 24:N.next=27;break;case 26:return N.abrupt("return",h);case 27:case"end":return N.stop()}},i,this,[[6,15]])}));function a(i,s,l){return t.apply(this,arguments)}return a}()},{key:"_putItemToServer",value:function(){var t=ce.default(A.default.mark(function i(s,l,c,h){var g,b,$,S,R;return A.default.wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return g=new wi(this.links.items).pathSegment(s).build(),b={data:l},h!==void 0&&(b.ttl=h),M.prev=3,M.next=6,this.services.network.put(g,b,c);case 6:return $=M.sent,S=$.body,S.data=l,S.date_updated=new Date(S.date_updated),R=$.status.code===201,M.abrupt("return",{added:R,item:S});case 14:throw M.prev=14,M.t0=M.catch(3),M.t0.status===404&&this.onRemoved(!1),M.t0;case 18:case"end":return M.stop()}},i,this,[[3,14]])}));function a(i,s,l,c){return t.apply(this,arguments)}return a}()},{key:"remove",value:function(){var t=ce.default(A.default.mark(function i(s){var l,c,h;return A.default.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.next=2,this.get(s);case 2:return l=b.sent,c=jr(l.data),b.next=6,this.services.network.delete(l.uri);case 6:h=b.sent,this._handleItemRemoved(s,h.body.last_event_id,c,new Date(h.body.date_updated),!1);case 8:case"end":return b.stop()}},i,this)}));function a(i){return t.apply(this,arguments)}return a}()},{key:"queryItems",value:function(){var t=ce.default(A.default.mark(function i(s){var l=this,c,h,g,b;return A.default.wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return s=s||{},c=new wi(this.links.items).queryParam("From",s.from).queryParam("PageSize",s.limit).queryParam("Key",s.key).queryParam("PageToken",s.pageToken).queryParam("Order",s.order).build(),S.next=4,this.services.network.get(c);case 4:return h=S.sent,g=h.body.items.map(function(R){R.date_updated=new Date(R.date_updated);var N=l.cache.get(R.key);return N?l._handleItemMutated(R.key,R.url,R.last_event_id,R.revision,R.data,R.date_updated,R.date_expires,!1,!0):l.cache.store(R.key,new cs(R),R.last_event_id),l.cache.get(R.key)}),b=h.body.meta,S.abrupt("return",new tp(g,function(R){return l.queryItems({pageToken:R})},b.previous_token,b.next_token));case 8:case"end":return S.stop()}},i,this)}));function a(i){return t.apply(this,arguments)}return a}()},{key:"getItems",value:function(){var t=ce.default(A.default.mark(function i(s){return A.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return s=s||{},LS(s.pageSize),s.limit=s.pageSize||s.limit||50,s.order=s.order||"asc",c.abrupt("return",this.queryItems(s));case 5:case"end":return c.stop()}},i,this)}));function a(i){return t.apply(this,arguments)}return a}()},{key:"shouldIgnoreEvent",value:function(a,i){return this.cache.isKnown(a,i)}},{key:"_update",value:function(a,i){switch(a.date_created=new Date(a.date_created),a.type){case"map_item_added":case"map_item_updated":this._handleItemMutated(a.item_key,a.item_url,a.id,a.item_revision,a.item_data,a.date_created,void 0,a.type==="map_item_added",!0);break;case"map_item_removed":this._handleItemRemoved(a.item_key,a.id,a.item_data,a.date_created,!0);break;case"map_removed":this.onRemoved(!1);break}i&&this._advanceLastEventId(a.id,a.map_revision)}},{key:"_advanceLastEventId",value:function(a,i){this.lastEventId<a&&(this.descriptor.last_event_id=a,i&&(this.descriptor.revision=i))}},{key:"_updateRootDateUpdated",value:function(a){(!this.descriptor.date_updated||a.getTime()>this.descriptor.date_updated.getTime())&&(this.descriptor.date_updated=a,this.services.storage.update(this.type,this.sid,this.uniqueName,{date_updated:a}))}},{key:"_handleItemMutated",value:function(a,i,s,l,c,h,g,b,$){if(this.shouldIgnoreEvent(a,s)){Qe.trace("SyncMapItem ",a," update skipped, current:",this.lastEventId,", remote:",s);return}this._updateRootDateUpdated(h);var S=this.cache.get(a);if(!S){var R=new cs({key:a,url:i,last_event_id:s,revision:l,data:c,date_updated:h,date_expires:g});this.cache.store(a,R,s),this.emitItemMutationEvent(R,$,b);return}var N=jr(S.data);S.update(s,l,c,h),this.cache.store(a,S,s),g!==void 0&&S.updateDateExpires(g),this.emitItemMutationEvent(S,$,!1,N)}},{key:"emitItemMutationEvent",value:function(a,i,s){var l=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,c=s?"itemAdded":"itemUpdated",h={item:a,isLocal:!i};s||(h.previousItemData=l),this.broadcastEventToListeners(c,h)}},{key:"_handleItemRemoved",value:function(a,i,s,l,c){this._updateRootDateUpdated(l),this.cache.delete(a,i),this.broadcastEventToListeners("itemRemoved",{key:a,isLocal:!c,previousItemData:s})}},{key:"onRemoved",value:function(a){this._unsubscribe(),this.removalHandler(this.type,this.sid,this.uniqueName),this.broadcastEventToListeners("removed",{isLocal:a})}},{key:"setTtl",value:function(){var t=ce.default(A.default.mark(function i(s){var l,c;return A.default.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.prev=0,l={ttl:s},g.next=4,this.services.network.post(this.uri,l);case 4:c=g.sent,this.descriptor.date_expires=c.body.date_expires,g.next=12;break;case 8:throw g.prev=8,g.t0=g.catch(0),g.t0.status===404&&this.onRemoved(!1),g.t0;case 12:case"end":return g.stop()}},i,this,[[0,8]])}));function a(i){return t.apply(this,arguments)}return a}()},{key:"setItemTtl",value:function(){var t=ce.default(A.default.mark(function i(s,l){var c,h,g;return A.default.wrap(function($){for(;;)switch($.prev=$.next){case 0:return $.next=2,this.get(s);case 2:return c=$.sent,h={ttl:l},$.next=6,this.services.network.post(c.uri,h);case 6:g=$.sent,c.updateDateExpires(g.body.date_expires);case 8:case"end":return $.stop()}},i,this)}));function a(i,s){return t.apply(this,arguments)}return a}()},{key:"removeMap",value:function(){var t=ce.default(A.default.mark(function i(){return A.default.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.services.network.delete(this.uri);case 2:this.onRemoved(!0);case 3:case"end":return l.stop()}},i,this)}));function a(){return t.apply(this,arguments)}return a}()}],[{key:"type",get:function(){return"map"}}]),r}(Qs),Ot=function(e){Vt.default(r,e);var n=FS(r);function r(t){var a;return Ke.default(this,r),a=n.call(this),a.syncMapImpl=t,a.syncMapImpl.attach(Hr.default(a)),a}return Xe.default(r,[{key:"uri",get:function(){return this.syncMapImpl.uri}},{key:"links",get:function(){return this.syncMapImpl.links}},{key:"revision",get:function(){return this.syncMapImpl.revision}},{key:"lastEventId",get:function(){return this.syncMapImpl.lastEventId}},{key:"dateExpires",get:function(){return this.syncMapImpl.dateExpires}},{key:"type",get:function(){return Sf.type}},{key:"sid",get:function(){return this.syncMapImpl.sid}},{key:"uniqueName",get:function(){return this.syncMapImpl.uniqueName}},{key:"dateUpdated",get:function(){return this.syncMapImpl.dateUpdated}},{key:"set",value:function(){var t=ce.default(A.default.mark(function i(s,l,c){return A.default.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return this.ensureNotClosed(),g.abrupt("return",this.syncMapImpl.set(s,l,c));case 2:case"end":return g.stop()}},i,this)}));function a(i,s,l){return t.apply(this,arguments)}return a}()},{key:"get",value:function(){var t=ce.default(A.default.mark(function i(s){return A.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return this.ensureNotClosed(),c.abrupt("return",this.syncMapImpl.get(s));case 2:case"end":return c.stop()}},i,this)}));function a(i){return t.apply(this,arguments)}return a}()},{key:"mutate",value:function(){var t=ce.default(A.default.mark(function i(s,l,c){return A.default.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return this.ensureNotClosed(),g.abrupt("return",this.syncMapImpl.mutate(s,l,c));case 2:case"end":return g.stop()}},i,this)}));function a(i,s,l){return t.apply(this,arguments)}return a}()},{key:"update",value:function(){var t=ce.default(A.default.mark(function i(s,l,c){return A.default.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return this.ensureNotClosed(),g.abrupt("return",this.syncMapImpl.update(s,l,c));case 2:case"end":return g.stop()}},i,this)}));function a(i,s,l){return t.apply(this,arguments)}return a}()},{key:"remove",value:function(){var t=ce.default(A.default.mark(function i(s){return A.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return this.ensureNotClosed(),c.abrupt("return",this.syncMapImpl.remove(s));case 2:case"end":return c.stop()}},i,this)}));function a(i){return t.apply(this,arguments)}return a}()},{key:"getItems",value:function(){var t=ce.default(A.default.mark(function i(s){return A.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return this.ensureNotClosed(),c.abrupt("return",this.syncMapImpl.getItems(s));case 2:case"end":return c.stop()}},i,this)}));function a(i){return t.apply(this,arguments)}return a}()},{key:"setTtl",value:function(){var t=ce.default(A.default.mark(function i(s){return A.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return this.ensureNotClosed(),c.abrupt("return",this.syncMapImpl.setTtl(s));case 2:case"end":return c.stop()}},i,this)}));function a(i){return t.apply(this,arguments)}return a}()},{key:"setItemTtl",value:function(){var t=ce.default(A.default.mark(function i(s,l){return A.default.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return this.ensureNotClosed(),h.abrupt("return",this.syncMapImpl.setItemTtl(s,l));case 2:case"end":return h.stop()}},i,this)}));function a(i,s){return t.apply(this,arguments)}return a}()},{key:"removeMap",value:function(){var t=ce.default(A.default.mark(function i(){return A.default.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.ensureNotClosed(),l.next=3,this.syncMapImpl.removeMap();case 3:case"end":return l.stop()}},i,this)}));function a(){return t.apply(this,arguments)}return a}()},{key:"close",value:function(){Ys.default(kt.default(r.prototype),"close",this).call(this),this.syncMapImpl.detach(this.listenerUuid)}}],[{key:"type",get:function(){return Sf.type}}]),r}(Xs);tt.default(Ot,"itemAdded","itemAdded");tt.default(Ot,"itemUpdated","itemUpdated");tt.default(Ot,"itemRemoved","itemRemoved");tt.default(Ot,"removed","removed");Ye([ne.validateTypesAsync("string",ne.pureObject,["undefined",ne.objectSchema("item metadata",{ttl:[ne.nonNegativeInteger,"undefined"]})]),ie("design:type",Function),ie("design:paramtypes",[String,Object,Object]),ie("design:returntype",Promise)],Ot.prototype,"set",null);Ye([ne.validateTypesAsync("string"),ie("design:type",Function),ie("design:paramtypes",[String]),ie("design:returntype",Promise)],Ot.prototype,"get",null);Ye([ne.validateTypesAsync("string","function",["undefined",ne.objectSchema("item metadata",{ttl:[ne.nonNegativeInteger,"undefined"]})]),ie("design:type",Function),ie("design:paramtypes",[String,Function,Object]),ie("design:returntype",Promise)],Ot.prototype,"mutate",null);Ye([ne.validateTypesAsync("string",ne.pureObject,["undefined",ne.objectSchema("item metadata",{ttl:[ne.nonNegativeInteger,"undefined"]})]),ie("design:type",Function),ie("design:paramtypes",[String,Object,Object]),ie("design:returntype",Promise)],Ot.prototype,"update",null);Ye([ne.validateTypesAsync("string"),ie("design:type",Function),ie("design:paramtypes",[String]),ie("design:returntype",Promise)],Ot.prototype,"remove",null);Ye([ne.validateTypesAsync(["undefined",ne.objectSchema("query options",{from:["string","undefined"],pageSize:[ne.custom(function(e){return[ep(e),"a positive integer"]}),"undefined"]})]),ie("design:type",Function),ie("design:paramtypes",[Object]),ie("design:returntype",Promise)],Ot.prototype,"getItems",null);Ye([ne.validateTypesAsync(ne.nonNegativeInteger),ie("design:type",Function),ie("design:paramtypes",[Number]),ie("design:returntype",Promise)],Ot.prototype,"setTtl",null);Ye([ne.validateTypesAsync("string",ne.nonNegativeInteger),ie("design:type",Function),ie("design:paramtypes",[String,Number]),ie("design:returntype",Promise)],Ot.prototype,"setItemTtl",null);function BS(e){var n=UB();return function(){var t=kt.default(e),a;if(n){var i=kt.default(this).constructor;a=Reflect.construct(t,arguments,i)}else a=t.apply(this,arguments);return aa.default(this,a)}}function UB(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var ks=function(e){Vt.default(r,e);var n=BS(r);function r(t,a,i){var s;return Ke.default(this,r),s=n.call(this,t,i),s.descriptor=a,s}return Xe.default(r,[{key:"uri",get:function(){return this.descriptor.url}},{key:"links",get:function(){return this.descriptor.links}},{key:"dateExpires",get:function(){return this.descriptor.date_expires}},{key:"type",get:function(){return"stream"}},{key:"lastEventId",get:function(){return null}},{key:"indexName",get:function(){}},{key:"queryString",get:function(){}},{key:"sid",get:function(){return this.descriptor.sid}},{key:"uniqueName",get:function(){return this.descriptor.unique_name||null}},{key:"publishMessage",value:function(){var t=ce.default(A.default.mark(function i(s){var l,c,h,g;return A.default.wrap(function($){for(;;)switch($.prev=$.next){case 0:return l={data:s},$.next=3,this.services.network.post(this.links.messages,l);case 3:return c=$.sent,h=c.body,g=this._handleMessagePublished(h.sid,s,!1),$.abrupt("return",g);case 7:case"end":return $.stop()}},i,this)}));function a(i){return t.apply(this,arguments)}return a}()},{key:"setTtl",value:function(){var t=ce.default(A.default.mark(function i(s){var l,c;return A.default.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.prev=0,l={ttl:s},g.next=4,this.services.network.post(this.uri,l);case 4:c=g.sent,this.descriptor.date_expires=c.body.date_expires,g.next=12;break;case 8:throw g.prev=8,g.t0=g.catch(0),g.t0.status===404&&this.onRemoved(!1),g.t0;case 12:case"end":return g.stop()}},i,this,[[0,8]])}));function a(i){return t.apply(this,arguments)}return a}()},{key:"removeStream",value:function(){var t=ce.default(A.default.mark(function i(){return A.default.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.services.network.delete(this.uri);case 2:this.onRemoved(!0);case 3:case"end":return l.stop()}},i,this)}));function a(){return t.apply(this,arguments)}return a}()},{key:"_update",value:function(a){switch(a.type){case"stream_message_published":{this._handleMessagePublished(a.message_sid,a.message_data,!0);break}case"stream_removed":{this.onRemoved(!1);break}}}},{key:"_handleMessagePublished",value:function(a,i,s){var l={sid:a,data:i};return this.broadcastEventToListeners("messagePublished",{message:l,isLocal:!s}),l}},{key:"onRemoved",value:function(a){this._unsubscribe(),this.removalHandler(this.type,this.sid,this.uniqueName),this.broadcastEventToListeners("removed",{isLocal:a})}}],[{key:"type",get:function(){return"stream"}}]),r}(Qs);Ye([ne.validateTypesAsync(ne.pureObject),ie("design:type",Function),ie("design:paramtypes",[Object]),ie("design:returntype",Promise)],ks.prototype,"publishMessage",null);Ye([ne.validateTypesAsync(ne.nonNegativeInteger),ie("design:type",Function),ie("design:paramtypes",[Number]),ie("design:returntype",Promise)],ks.prototype,"setTtl",null);var Wr=function(e){Vt.default(r,e);var n=BS(r);function r(t){var a;return Ke.default(this,r),a=n.call(this),a.syncStreamImpl=t,a.syncStreamImpl.attach(Hr.default(a)),a}return Xe.default(r,[{key:"uri",get:function(){return this.syncStreamImpl.uri}},{key:"links",get:function(){return this.syncStreamImpl.links}},{key:"dateExpires",get:function(){return this.syncStreamImpl.dateExpires}},{key:"type",get:function(){return ks.type}},{key:"lastEventId",get:function(){return null}},{key:"sid",get:function(){return this.syncStreamImpl.sid}},{key:"uniqueName",get:function(){return this.syncStreamImpl.uniqueName}},{key:"publishMessage",value:function(){var t=ce.default(A.default.mark(function i(s){return A.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return this.ensureNotClosed(),c.abrupt("return",this.syncStreamImpl.publishMessage(s));case 2:case"end":return c.stop()}},i,this)}));function a(i){return t.apply(this,arguments)}return a}()},{key:"setTtl",value:function(){var t=ce.default(A.default.mark(function i(s){return A.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return this.ensureNotClosed(),c.abrupt("return",this.syncStreamImpl.setTtl(s));case 2:case"end":return c.stop()}},i,this)}));function a(i){return t.apply(this,arguments)}return a}()},{key:"removeStream",value:function(){var t=ce.default(A.default.mark(function i(){return A.default.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.ensureNotClosed(),l.abrupt("return",this.syncStreamImpl.removeStream());case 2:case"end":return l.stop()}},i,this)}));function a(){return t.apply(this,arguments)}return a}()},{key:"close",value:function(){Ys.default(kt.default(r.prototype),"close",this).call(this),this.syncStreamImpl.detach(this.listenerUuid)}}],[{key:"type",get:function(){return ks.type}}]),r}(Xs);tt.default(Wr,"messagePublished","messagePublished");tt.default(Wr,"removed","removed");Ye([ne.validateTypesAsync(ne.pureObject),ie("design:type",Function),ie("design:paramtypes",[Object]),ie("design:returntype",Promise)],Wr.prototype,"publishMessage",null);Ye([ne.validateTypesAsync(ne.nonNegativeInteger),ie("design:type",Function),ie("design:paramtypes",[Number]),ie("design:returntype",Promise)],Wr.prototype,"setTtl",null);var jB=function e(n){Ke.default(this,e),this.sdk="js",this.sdkVer=n,this.os=Ru.os.family,this.osVer=Ru.os.version,this.pl=Ru.name,this.plVer=Ru.version},DB=function(){function e(){Ke.default(this,e),this.names=new Map,this.entities=new Map}return Xe.default(e,[{key:"store",value:function(r){var t=this.entities.get(r.sid);return t||(this.entities.set(r.sid,r),r.uniqueName&&this.names.set(r.type+"::"+r.uniqueName,r.sid),r)}},{key:"getResolved",value:function(r,t){var a=this.names.get(t+"::"+r);return a?this.entities.get(a):null}},{key:"get",value:function(r,t){return this.entities.get(r)||this.getResolved(r,t)||null}},{key:"remove",value:function(r){var t=this.entities.get(r);t&&(this.entities.delete(r),t.uniqueName&&this.names.delete(t.type+"::"+t.uniqueName))}}]),e}();function np(e){var n=FB();return function(){var t=kt.default(e),a;if(n){var i=kt.default(this).constructor;a=Reflect.construct(t,arguments,i)}else a=t.apply(this,arguments);return aa.default(this,a)}}function FB(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var BB=function e(){Ke.default(this,e)},$f=function(e){Vt.default(r,e);var n=np(r);function r(t,a,i,s){var l;return Ke.default(this,r),l=n.call(this,a,i),l.descriptor=t,l.cache=new rp,s&&s.forEach(function(c){l.cache.store(c.key,{key:c.key,value:c.data},c.revision)}),l}return Xe.default(r,[{key:"sid",get:function(){return this.descriptor.sid}},{key:"uniqueName",get:function(){return null}},{key:"type",get:function(){return r.type}},{key:"lastEventId",get:function(){return this.descriptor.last_event_id}},{key:"indexName",get:function(){return this.descriptor.indexName}},{key:"queryString",get:function(){return this.descriptor.queryExpression}},{key:"queryUri",get:function(){return this.descriptor.queryUri}},{key:"liveQueryDescriptor",get:function(){return this.descriptor}},{key:"onRemoved",value:function(){}},{key:"getItems",value:function(){var a={};return this.cache.forEach(function(i,s){a[i]=s.value}),a}},{key:"_update",value:function(a,i){switch(a.type){case"live_query_item_updated":this.handleItemMutated(a.item_key,a.item_data,a.item_revision);break;case"live_query_item_removed":this.handleItemRemoved(a.item_key,a.item_revision);break;case"live_query_updated":this.handleBatchUpdate(a.items);break}i&&this._advanceLastEventId(a.last_event_id)}},{key:"handleItemMutated",value:function(a,i,s){if(this.shouldIgnoreEvent(a,s))Qe.trace("Item ".concat(a," update skipped, revision: ").concat(s));else{var l={key:a,value:i};this.cache.store(a,l,s),this.broadcastEventToListeners("itemUpdated",l)}}},{key:"handleItemRemoved",value:function(a,i){var s=i===null;this.shouldIgnoreEvent(a,i)?Qe.trace("Item ".concat(a," delete skipped, revision: ").concat(i)):(this.cache.delete(a,i,s),this.broadcastEventToListeners("itemRemoved",{key:a}))}},{key:"handleBatchUpdate",value:function(a){var i=this,s={};a!=null&&a.forEach(function(c){s[c.key]={data:c.data,revision:c.revision}}),this.cache.forEach(function(c,h){var g=s[c];g!=null?i.handleItemMutated(c,g.data,g.revision):i.handleItemRemoved(c,null),delete s[c]});for(var l in s)this.handleItemMutated(l,s[l].data,s[l].revision)}},{key:"shouldIgnoreEvent",value:function(a,i){return a!=null&&i!=null&&this.cache.isKnown(a,i)}},{key:"_advanceLastEventId",value:function(a,i){this.lastEventId<a&&(this.descriptor.last_event_id=a)}}],[{key:"type",get:function(){return"live_query"}}]),r}(Qs);function qS(e){return _f.apply(this,arguments)}function _f(){return _f=ce.default(A.default.mark(function e(n){var r,t,a,i,s,l;return A.default.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:if(r=n.network,t=n.queryString,a=n.uri,i=n.type,t!=null){h.next=3;break}throw new Xt("Invalid query",400,54507);case 3:return s={query_string:t},i===un.type&&(s.type=i),h.next=7,r.post(a,s,void 0,!0);case 7:return l=h.sent,h.abrupt("return",l.body);case 9:case"end":return h.stop()}},e)})),_f.apply(this,arguments)}var un=function(e){Vt.default(r,e);var n=np(r);function r(t){var a;return Ke.default(this,r),a=n.call(this),a.liveQueryImpl=t,a.liveQueryImpl.attach(Hr.default(a)),a}return Xe.default(r,[{key:"type",get:function(){return $f.type}},{key:"lastEventId",get:function(){return this.liveQueryImpl.lastEventId}},{key:"sid",get:function(){return this.liveQueryImpl.sid}},{key:"close",value:function(){Ys.default(kt.default(r.prototype),"close",this).call(this),this.liveQueryImpl.detach(this.listenerUuid)}},{key:"getItems",value:function(){return this.ensureNotClosed(),this.liveQueryImpl.getItems()}}],[{key:"type",get:function(){return $f.type}}]),r}(Xs);tt.default(un,"itemUpdated","itemUpdated");tt.default(un,"itemRemoved","itemRemoved");var Zs=function(e){Vt.default(r,e);var n=np(r);function r(t){var a;return Ke.default(this,r),a=n.call(this),tt.default(Hr.default(a),"queryExpression",null),tt.default(Hr.default(a),"items",{}),Object.assign(Hr.default(a),t),a.updateIndexName(t.indexName),a}return Xe.default(r,[{key:"type",get:function(){return r.type}},{key:"search",value:function(){var t=ce.default(A.default.mark(function i(s){var l=this;return A.default.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return this.items={},h.abrupt("return",qS({network:this.network,uri:this.queryUri,queryString:s}).then(function(g){l.queryExpression=s,g.items&&g.items.forEach(function(b){l.items[b.key]=b.data}),l.emit("searchResult",l.getItems())}).catch(function(g){throw Qe.error("Error '".concat(g.message,"' while executing query '").concat(s,"'")),l.queryExpression=null,g}));case 2:case"end":return h.stop()}},i,this)}));function a(i){return t.apply(this,arguments)}return a}()},{key:"subscribe",value:function(){var t=ce.default(A.default.mark(function i(){return A.default.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(this.queryExpression!=null){l.next=2;break}return l.abrupt("return",Promise.reject(new Xt("Invalid query",400,54507)));case 2:return l.abrupt("return",this.liveQueryCreator(this.indexName,this.queryExpression));case 3:case"end":return l.stop()}},i,this)}));function a(){return t.apply(this,arguments)}return a}()},{key:"getItems",value:function(){return this.items}},{key:"updateIndexName",value:function(a){this.indexName=a,this.queryUri=this.generateQueryUri(this.indexName)}},{key:"generateQueryUri",value:function(a){return new wi(this.insightsUri).pathSegment(a).pathSegment("Items").build()}}],[{key:"type",get:function(){return"instant_query"}}]),r}(nt);tt.default(Zs,"searchResult","searchResult");Ye([ne.validateTypesAsync("string"),ie("design:type",Function),ie("design:paramtypes",[String]),ie("design:returntype",Promise)],Zs.prototype,"search",null);Ye([ne.validateTypes(ne.nonEmptyString),ie("design:type",Function),ie("design:paramtypes",[String]),ie("design:returntype",void 0)],Zs.prototype,"updateIndexName",null);var qB="3.1.0";function WB(e){var n=GB();return function(){var t=kt.default(e),a;if(n){var i=kt.default(this).constructor;a=Reflect.construct(t,arguments,i)}else a=t.apply(this,arguments);return aa.default(this,a)}}function GB(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function zy(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,t)}return r}function Vy(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?zy(Object(r),!0).forEach(function(t){tt.default(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):zy(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var HB="data_sync",ll=qB;function Eu(e){if(e){if(typeof e=="string")return{id:e,mode:"open_or_create"};var n=e.mode||(e.id?"open_or_create":"create_new");return Vy(Vy({},e),{},{mode:n})}else return{mode:"create_new"}}var Ky="com.twilio.rtd.cds.document",Yy="com.twilio.rtd.cds.list",Jy="com.twilio.rtd.cds.map",Qy="twilio.sync.event",cr=function(e){Vt.default(r,e);var n=WB(r);function r(t){var a,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(Ke.default(this,r),a=n.call(this),!t)throw new Error("Sync library needs a valid Twilio token to be passed");i.hasOwnProperty("logLevel")?Qe.setLevel(i.logLevel):Qe.setLevel("silent");var s=i.productId=i.productId||HB;i.clientMetadata=i.clientMetadata||{},i.clientMetadata.hasOwnProperty("type")||(i.clientMetadata.type="sync"),i.clientMetadata.hasOwnProperty("sdk")||(i.clientMetadata.sdk="JS",i.clientMetadata.sdkv=ll);var l=!i.twilsockClient;if(!i.initRegistrations){var c=new ao.InitRegistration(s);r.populateInitRegistrations(c),i.initRegistrations=[c]}var h=i.twilsockClient=i.twilsockClient||new ao.Twilsock(t,s,i);h.on("tokenAboutToExpire",function(S){return a.emit("tokenAboutToExpire",S)}),h.on("tokenExpired",function(){return a.emit("tokenExpired")}),h.on("connectionError",function(S){return a.emit("connectionError",S)}),h.on("stateChanged",function(S){a.emit("connectionStateChanged",S),a.services.subscriptions.onConnectionStateChanged(S==="connected")}),h.on("message",function(S,R){return a._routeMessage(S,R)});var g=new dB(i),b=new wB(new jB(ll),g,h),$=new SB(g);return a.services={config:g,twilsock:h,network:b,storage:$,router:Hr.default(a),subscriptions:null},a.services.subscriptions=new hB(a.services),a.entities=new DB,l&&h.connect(),a}return Xe.default(r,[{key:"_routeMessage",value:function(a,i){switch(Qe.trace("Notification type:",a,"content:",i),a){case Ky:case Yy:case Jy:this.services.subscriptions.acceptMessage(i,!1);break;case Qy:this.services.subscriptions.acceptMessage(i,!0);break}}},{key:"_subscribe",value:function(a,i){this.services.subscriptions.add(a,i)}},{key:"_unsubscribe",value:function(a){this.services.subscriptions.remove(a)}},{key:"connectionState",get:function(){return this.services.twilsock.state}},{key:"ensureReady",value:function(){var t=ce.default(A.default.mark(function i(){var s;return A.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(this.services.config.sessionStorageEnabled){c.next=2;break}return c.abrupt("return");case 2:return c.prev=2,c.next=5,this.services.twilsock.storageId();case 5:s=c.sent,this.services.storage.updateStorageId(s.id),c.next=12;break;case 9:c.prev=9,c.t0=c.catch(2),Qe.warn("Failed to initialize storage",c.t0);case 12:case"end":return c.stop()}},i,this,[[2,9]])}));function a(){return t.apply(this,arguments)}return a}()},{key:"storeRootInSessionCache",value:function(a,i,s){if(!(!this.services.config.sessionStorageEnabled||!i)){var l=jr(s);(a===Ct.type||a===Ot.type)&&(l.last_event_id=null,delete l.items),this.services.storage.store(a,i,l)}}},{key:"readRootFromSessionCache",value:function(a,i){return!this.services.config.sessionStorageEnabled||!i?null:this.services.storage.read(a,i)}},{key:"_get",value:function(){var t=ce.default(A.default.mark(function i(s,l){var c,h,g,b=arguments;return A.default.wrap(function(S){for(;;)switch(S.prev=S.next){case 0:if(c=b.length>2&&b[2]!==void 0?b[2]:!1,l){S.next=3;break}throw new Xt("Cannot get entity without id",404);case 3:return h=new wi(s).pathSegment(l).queryParam("Include",c?"items":void 0).build(),S.next=6,this.services.network.get(h);case 6:return g=S.sent,S.abrupt("return",g.body);case 8:case"end":return S.stop()}},i,this)}));function a(i,s){return t.apply(this,arguments)}return a}()},{key:"_createDocument",value:function(a,i,s){var l={unique_name:a,data:i||{}};return s!==void 0&&(l.ttl=s),this.services.network.post(this.services.config.documentsUri,l).then(function(c){return c.body.data=l.data,c.body})}},{key:"_getDocument",value:function(){var t=ce.default(A.default.mark(function i(s){return A.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",this.readRootFromSessionCache($r.type,s)||this._get(this.services.config.documentsUri,s));case 1:case"end":return c.stop()}},i,this)}));function a(i){return t.apply(this,arguments)}return a}()},{key:"_createList",value:function(a,i,s,l){var c={unique_name:a,purpose:i,context:s};return l!==void 0&&(c.ttl=l),this.services.network.post(this.services.config.listsUri,c).then(function(h){return h.body})}},{key:"_getList",value:function(){var t=ce.default(A.default.mark(function i(s){return A.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",this.readRootFromSessionCache(Ct.type,s)||this._get(this.services.config.listsUri,s));case 1:case"end":return c.stop()}},i,this)}));function a(i){return t.apply(this,arguments)}return a}()},{key:"_createMap",value:function(a,i){var s={unique_name:a};return i!==void 0&&(s.ttl=i),this.services.network.post(this.services.config.mapsUri,s).then(function(l){return l.body})}},{key:"_getMap",value:function(){var t=ce.default(A.default.mark(function i(s){var l,c=arguments;return A.default.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return l=c.length>1&&c[1]!==void 0?c[1]:!1,g.abrupt("return",this.readRootFromSessionCache(Ot.type,s)||this._get(this.services.config.mapsUri,s,l));case 2:case"end":return g.stop()}},i,this)}));function a(i){return t.apply(this,arguments)}return a}()},{key:"_getStream",value:function(){var t=ce.default(A.default.mark(function i(s){return A.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",this.readRootFromSessionCache(Wr.type,s)||this._get(this.services.config.streamsUri,s,!1));case 1:case"end":return c.stop()}},i,this)}));function a(i){return t.apply(this,arguments)}return a}()},{key:"_createStream",value:function(){var t=ce.default(A.default.mark(function i(s,l){var c,h;return A.default.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return c={unique_name:s},l!==void 0&&(c.ttl=l),b.next=4,this.services.network.post(this.services.config.streamsUri,c);case 4:return h=b.sent,b.abrupt("return",h.body);case 6:case"end":return b.stop()}},i,this)}));function a(i,s){return t.apply(this,arguments)}return a}()},{key:"_getLiveQuery",value:function(a){return this.readRootFromSessionCache(un.type,a)}},{key:"getCached",value:function(a,i){return a&&this.entities.get(a,i)||null}},{key:"removeFromCacheAndSession",value:function(a,i,s){this.entities.remove(i),this.services.config.sessionStorageEnabled&&this.services.storage.remove(a,i,s)}},{key:"document",value:function(){var t=ce.default(A.default.mark(function i(s){var l=this,c,h,g,b;return A.default.wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return S.next=2,this.ensureReady();case 2:if(c=Eu(s),c.mode!=="create_new"){S.next=9;break}return S.next=6,this._createDocument(c.id,c.data,c.ttl);case 6:h=S.sent,S.next=39;break;case 9:if(g=this.getCached(c.id,$r.type),!g){S.next=14;break}return S.abrupt("return",new $r(g));case 14:return S.prev=14,S.next=17,this._getDocument(c.id);case 17:h=S.sent,S.next=39;break;case 20:if(S.prev=20,S.t0=S.catch(14),!(S.t0.status!==404||c.mode==="open_existing")){S.next=26;break}throw S.t0;case 26:return S.prev=26,S.next=29,this._createDocument(c.id,c.data,c.ttl);case 29:h=S.sent,S.next=39;break;case 32:if(S.prev=32,S.t1=S.catch(26),S.t1.status!==409){S.next=38;break}return S.abrupt("return",this.document(s));case 38:throw S.t1;case 39:return this.storeRootInSessionCache($r.type,c.id,h),b=new mf(this.services,h,function(R,N,M){return l.removeFromCacheAndSession(R,N,M)}),b=this.entities.store(b),S.abrupt("return",new $r(b));case 43:case"end":return S.stop()}},i,this,[[14,20],[26,32]])}));function a(i){return t.apply(this,arguments)}return a}()},{key:"map",value:function(){var t=ce.default(A.default.mark(function i(s){var l=this,c,h,g,b;return A.default.wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return S.next=2,this.ensureReady();case 2:if(c=Eu(s),c.mode!=="create_new"){S.next=9;break}return S.next=6,this._createMap(c.id,c.ttl);case 6:h=S.sent,S.next=39;break;case 9:if(g=this.getCached(c.id,Ot.type),!g){S.next=14;break}return S.abrupt("return",new Ot(g));case 14:return S.prev=14,S.next=17,this._getMap(c.id,c.includeItems);case 17:h=S.sent,S.next=39;break;case 20:if(S.prev=20,S.t0=S.catch(14),!(S.t0.status!==404||c.mode==="open_existing")){S.next=26;break}throw S.t0;case 26:return S.prev=26,S.next=29,this._createMap(c.id,c.ttl);case 29:h=S.sent,S.next=39;break;case 32:if(S.prev=32,S.t1=S.catch(26),S.t1.status!==409){S.next=38;break}return S.abrupt("return",this.map(s));case 38:throw S.t1;case 39:return this.storeRootInSessionCache(Ot.type,c.id,h),b=new Sf(this.services,h,function(R,N,M){return l.removeFromCacheAndSession(R,N,M)}),b=this.entities.store(b),S.abrupt("return",new Ot(b));case 43:case"end":return S.stop()}},i,this,[[14,20],[26,32]])}));function a(i){return t.apply(this,arguments)}return a}()},{key:"list",value:function(){var t=ce.default(A.default.mark(function i(s){var l=this,c,h,g,b;return A.default.wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return S.next=2,this.ensureReady();case 2:if(c=Eu(s),c.mode!=="create_new"){S.next=9;break}return S.next=6,this._createList(c.id,c.purpose,c.context,c.ttl);case 6:h=S.sent,S.next=39;break;case 9:if(g=this.getCached(c.id,Ct.type),!g){S.next=14;break}return S.abrupt("return",new Ct(g));case 14:return S.prev=14,S.next=17,this._getList(c.id);case 17:h=S.sent,S.next=39;break;case 20:if(S.prev=20,S.t0=S.catch(14),!(S.t0.status!==404||c.mode==="open_existing")){S.next=26;break}throw S.t0;case 26:return S.prev=26,S.next=29,this._createList(c.id,c.purpose,c.context,c.ttl);case 29:h=S.sent,S.next=39;break;case 32:if(S.prev=32,S.t1=S.catch(26),S.t1.status!==409){S.next=38;break}return S.abrupt("return",this.list(s));case 38:throw S.t1;case 39:return this.storeRootInSessionCache(Ct.type,c.id,h),b=new wf(this.services,h,function(R,N,M){return l.removeFromCacheAndSession(R,N,M)}),b=this.entities.store(b),S.abrupt("return",new Ct(b));case 43:case"end":return S.stop()}},i,this,[[14,20],[26,32]])}));function a(i){return t.apply(this,arguments)}return a}()},{key:"stream",value:function(){var t=ce.default(A.default.mark(function i(s){var l=this,c,h,g,b,$;return A.default.wrap(function(R){for(;;)switch(R.prev=R.next){case 0:return R.next=2,this.ensureReady();case 2:if(c=Eu(s),c.mode!=="create_new"){R.next=9;break}return R.next=6,this._createStream(c.id,c.ttl);case 6:h=R.sent,R.next=39;break;case 9:if(g=this.getCached(c.id,Wr.type),!g){R.next=14;break}return R.abrupt("return",new Wr(g));case 14:return R.prev=14,R.next=17,this._getStream(c.id);case 17:h=R.sent,R.next=39;break;case 20:if(R.prev=20,R.t0=R.catch(14),!(R.t0.status!==404||c.mode==="open_existing")){R.next=26;break}throw R.t0;case 26:return R.prev=26,R.next=29,this._createStream(c.id,c.ttl);case 29:h=R.sent,R.next=39;break;case 32:if(R.prev=32,R.t1=R.catch(26),R.t1.status!==409){R.next=38;break}return R.abrupt("return",this.stream(s));case 38:throw R.t1;case 39:return this.storeRootInSessionCache(Wr.type,c.id,h),b=function(M,W,z){return l.removeFromCacheAndSession(M,W,z)},$=new ks(this.services,h,b),$=this.entities.store($),R.abrupt("return",new Wr($));case 44:case"end":return R.stop()}},i,this,[[14,20],[26,32]])}));function a(i){return t.apply(this,arguments)}return a}()},{key:"shutdown",value:function(){var t=ce.default(A.default.mark(function i(){return A.default.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.services.subscriptions.shutdown();case 2:return l.next=4,this.services.twilsock.disconnect();case 4:case"end":return l.stop()}},i,this)}));function a(){return t.apply(this,arguments)}return a}()},{key:"updateToken",value:function(){var t=ce.default(A.default.mark(function i(s){return A.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",this.services.twilsock.updateToken(s).catch(function(h){var g,b=h==null||(g=h.reply)===null||g===void 0?void 0:g.status;throw(b==null?void 0:b.code)===401&&(b==null?void 0:b.status)==="UNAUTHORIZED"?new Xt("Updated token was rejected by server",400,51130):h}));case 1:case"end":return c.stop()}},i,this)}));function a(i){return t.apply(this,arguments)}return a}()},{key:"liveQuery",value:function(){var t=ce.default(A.default.mark(function i(s,l){var c=this,h,g,b,$,S;return A.default.wrap(function(N){for(;;)switch(N.prev=N.next){case 0:return N.next=2,this.ensureReady();case 2:return h=new wi(this.services.config.insightsUri).pathSegment(s).pathSegment("Items").build(),N.next=5,qS({network:this.services.network,uri:h,queryString:l,type:un.type});case 5:return g=N.sent,b=this.getCached(g.query_id,un.type),b||($=this._getLiveQuery(g.query_id),$||($={indexName:s,queryExpression:l,sid:g.query_id,queryUri:h,last_event_id:g.last_event_id}),S=function(W,z,me){return c.removeFromCacheAndSession(W,z,me)},b=new $f($,this.services,S,g.items)),this.storeRootInSessionCache(un.type,g.query_id,b.liveQueryDescriptor),b=this.entities.store(b),N.abrupt("return",new un(b));case 11:case"end":return N.stop()}},i,this)}));function a(i,s){return t.apply(this,arguments)}return a}()},{key:"instantQuery",value:function(){var t=ce.default(A.default.mark(function i(s){var l=this,c;return A.default.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,this.ensureReady();case 2:return c=function($,S){return l.liveQuery($,S)},g.abrupt("return",new Zs({indexName:s,network:this.services.network,insightsUri:this.services.config.insightsUri,liveQueryCreator:c}));case 4:case"end":return g.stop()}},i,this)}));function a(i){return t.apply(this,arguments)}return a}()}],[{key:"populateInitRegistrations",value:function(a){a.populateInitRegistrations([Qy,Ky,Yy,Jy])}},{key:"version",get:function(){return ll}}]),r}(nt);tt.default(cr,"connectionStateChanged","connectionStateChanged");tt.default(cr,"connectionError","connectionError");tt.default(cr,"tokenAboutToExpire","tokenAboutToExpire");tt.default(cr,"tokenExpired","tokenExpired");Ye([ne.validateTypesAsync(["undefined","string",ne.objectSchema("open document options",{id:["string","undefined"],mode:[ne.literal("open_or_create","open_existing","create_new"),"undefined"],ttl:[ne.nonNegativeInteger,"undefined"],data:[ne.pureObject,"undefined",ne.literal(null)]})]),ie("design:type",Function),ie("design:paramtypes",[Object]),ie("design:returntype",Promise)],cr.prototype,"document",null);Ye([ne.validateTypesAsync(["undefined","string",ne.objectSchema("open map options",{id:["string","undefined"],mode:[ne.literal("open_or_create","open_existing","create_new"),"undefined"],ttl:[ne.nonNegativeInteger,"undefined"],data:[ne.pureObject,"undefined",ne.literal(null)],includeItems:["boolean","undefined"]})]),ie("design:type",Function),ie("design:paramtypes",[Object]),ie("design:returntype",Promise)],cr.prototype,"map",null);Ye([ne.validateTypesAsync(["undefined","string",ne.objectSchema("open list options",{id:["string","undefined"],mode:[ne.literal("open_or_create","open_existing","create_new"),"undefined"],ttl:[ne.nonNegativeInteger,"undefined"],data:[ne.pureObject,"undefined",ne.literal(null)],purpose:["string","undefined"],context:[ne.pureObject,"undefined"],includeItems:["boolean","undefined"]})]),ie("design:type",Function),ie("design:paramtypes",[Object]),ie("design:returntype",Promise)],cr.prototype,"list",null);Ye([ne.validateTypesAsync(["undefined","string",ne.objectSchema("open stream options",{id:["string","undefined"],mode:[ne.literal("open_or_create","open_existing","create_new"),"undefined"],ttl:[ne.nonNegativeInteger,"undefined"],data:[ne.pureObject,"undefined",ne.literal(null)]})]),ie("design:type",Function),ie("design:paramtypes",[Object]),ie("design:returntype",Promise)],cr.prototype,"stream",null);Ye([ne.validateTypesAsync(ne.nonEmptyString),ie("design:type",Function),ie("design:paramtypes",[String]),ie("design:returntype",Promise)],cr.prototype,"updateToken",null);Ye([ne.validateTypesAsync(ne.nonEmptyString,"string"),ie("design:type",Function),ie("design:paramtypes",[String,String]),ie("design:returntype",Promise)],cr.prototype,"liveQuery",null);Ye([ne.validateTypesAsync(ne.nonEmptyString),ie("design:type",Function),ie("design:paramtypes",[String]),ie("design:returntype",Promise)],cr.prototype,"instantQuery",null);Zt.Client=cr;Zt.InsightsItem=BB;Zt.InstantQuery=Zs;Zt.LiveQuery=un;Zt.Paginator=tp;Zt.SyncClient=cr;Zt.SyncDocument=$r;Zt.SyncList=Ct;Zt.SyncListItem=bf;Zt.SyncMap=Ot;Zt.SyncMapItem=cs;Zt.SyncStream=Wr;var WS={},zB=bS,VB=TypeError,GS=function(e){if(zB(e))throw VB("The method doesn't accept regular expressions");return e},KB=st,YB=KB("match"),HS=function(e){var n=/./;try{"/./"[e](n)}catch{try{return n[YB]=!1,"/./"[e](n)}catch{}}return!1},JB=We,zS=Le,QB=Vr.f,XB=hn,Xy=Lt,ZB=GS,e3=Kr,t3=HS,Zy=zS("".startsWith),r3=zS("".slice),n3=Math.min,VS=t3("startsWith"),a3=!VS&&!!function(){var e=QB(String.prototype,"startsWith");return e&&!e.writable}();JB({target:"String",proto:!0,forced:!a3&&!VS},{startsWith:function(n){var r=Xy(e3(this));ZB(n);var t=XB(n3(arguments.length>1?arguments[1]:void 0,r.length)),a=Xy(n);return Zy?Zy(r,a,t):r3(r,t,t+a.length)===a}});var i3=We,s3=Kd.left,u3=Ws,eg=Ca,o3=ko,c3=u3("reduce"),l3=!o3&&eg>79&&eg<83;i3({target:"Array",proto:!0,forced:!c3||l3},{reduce:function(n){var r=arguments.length;return s3(this,n,r,r>1?arguments[1]:void 0)}});var f3=Ne,d3=st,p3=Q$,v3=d3("iterator"),KS=!f3(function(){var e=new URL("b?a=1&b=2&c=3","http://a"),n=e.searchParams,r="";return e.pathname="c%20d",n.forEach(function(t,a){n.delete("b"),r+=a+t}),p3&&!e.toJSON||!n.sort||e.href!=="http://a/c%20d?a=1&c=3"||n.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!n[v3]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("http://\u0442\u0435\u0441\u0442").host!=="xn--e1aybc"||new URL("http://a#\u0431").hash!=="#%D0%B1"||r!=="a1c3"||new URL("http://x",void 0).host!=="x"}),tg=Lf.exports,h3=Tt,y3=function(e,n,r){return r.get&&tg(r.get,n,{getter:!0}),r.set&&tg(r.set,n,{setter:!0}),h3.f(e,n,r)},ja=Le,fl=2147483647,hs=36,YS=1,kf=26,g3=38,m3=700,b3=72,w3=128,S3="-",$3=/[^\0-\u007E]/,JS=/[.\u3002\uFF0E\uFF61]/g,rg="Overflow: input needs wider integers to process",dl=hs-YS,ng=RangeError,_3=ja(JS.exec),li=Math.floor,pl=String.fromCharCode,ag=ja("".charCodeAt),QS=ja([].join),Un=ja([].push),k3=ja("".replace),T3=ja("".split),I3=ja("".toLowerCase),R3=function(e){for(var n=[],r=0,t=e.length;r<t;){var a=ag(e,r++);if(a>=55296&&a<=56319&&r<t){var i=ag(e,r++);(i&64512)==56320?Un(n,((a&1023)<<10)+(i&1023)+65536):(Un(n,a),r--)}else Un(n,a)}return n},ig=function(e){return e+22+75*(e<26)},E3=function(e,n,r){var t=0;for(e=r?li(e/m3):e>>1,e+=li(e/n);e>dl*kf>>1;)e=li(e/dl),t+=hs;return li(t+(dl+1)*e/(e+g3))},C3=function(e){var n=[];e=R3(e);var r=e.length,t=w3,a=0,i=b3,s,l;for(s=0;s<e.length;s++)l=e[s],l<128&&Un(n,pl(l));var c=n.length,h=c;for(c&&Un(n,S3);h<r;){var g=fl;for(s=0;s<e.length;s++)l=e[s],l>=t&&l<g&&(g=l);var b=h+1;if(g-t>li((fl-a)/b))throw ng(rg);for(a+=(g-t)*b,t=g,s=0;s<e.length;s++){if(l=e[s],l<t&&++a>fl)throw ng(rg);if(l==t){for(var $=a,S=hs;;){var R=S<=i?YS:S>=i+kf?kf:S-i;if($<R)break;var N=$-R,M=hs-R;Un(n,pl(ig(R+N%M))),$=li(N/M),S+=hs}Un(n,pl(ig($))),i=E3(a,b,h==c),a=0,h++}}a++,t++}return QS(n,"")},O3=function(e){var n=[],r=T3(k3(I3(e),JS,"."),"."),t,a;for(t=0;t<r.length;t++)a=r[t],Un(n,_3($3,a)?"xn--"+C3(a):a);return QS(n,".")},Tf=We,Si=He,Cu=lt,zr=Le,P3=mt,XS=KS,ZS=Ft,A3=Od,M3=Jn,N3=gb,ap=Tr,e$=La,vl=ft,L3=St,x3=yn,U3=Kn,j3=It,t$=_t,ar=Lt,D3=Yn,sg=Ra,If=Eo,F3=qs,ti=Xf,B3=st,q3=Jd,W3=B3("iterator"),eu="URLSearchParams",r$=eu+"Iterator",n$=ap.set,Mr=ap.getterFor(eu),G3=ap.getterFor(r$),H3=Object.getOwnPropertyDescriptor,ip=function(e){if(!P3)return Si[e];var n=H3(Si,e);return n&&n.value},ug=ip("fetch"),io=ip("Request"),ys=ip("Headers"),hl=io&&io.prototype,og=ys&&ys.prototype,z3=Si.RegExp,V3=Si.TypeError,a$=Si.decodeURIComponent,K3=Si.encodeURIComponent,Y3=zr("".charAt),cg=zr([].join),wa=zr([].push),Rf=zr("".replace),J3=zr([].shift),lg=zr([].splice),fg=zr("".split),Q3=zr("".slice),X3=/\+/g,dg=Array(4),Z3=function(e){return dg[e-1]||(dg[e-1]=z3("((?:%[\\da-f]{2}){"+e+"})","gi"))},e4=function(e){try{return a$(e)}catch{return e}},pg=function(e){var n=Rf(e,X3," "),r=4;try{return a$(n)}catch{for(;r;)n=Rf(n,Z3(r--),e4);return n}},t4=/[!'()~]|%20/g,r4={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},n4=function(e){return r4[e]},vg=function(e){return Rf(K3(e),t4,n4)},yl=N3(function(n,r){n$(this,{type:r$,iterator:If(Mr(n).entries),kind:r})},"Iterator",function(){var n=G3(this),r=n.kind,t=n.iterator.next(),a=t.value;return t.done||(t.value=r==="keys"?a.key:r==="values"?a.value:[a.key,a.value]),t},!0),i$=function(e){this.entries=[],this.url=null,e!==void 0&&(t$(e)?this.parseObject(e):this.parseQuery(typeof e=="string"?Y3(e,0)==="?"?Q3(e,1):e:ar(e)))};i$.prototype={type:eu,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var n=F3(e),r,t,a,i,s,l,c;if(n)for(r=If(e,n),t=r.next;!(a=Cu(t,r)).done;){if(i=If(j3(a.value)),s=i.next,(l=Cu(s,i)).done||(c=Cu(s,i)).done||!Cu(s,i).done)throw V3("Expected sequence with length 2");wa(this.entries,{key:ar(l.value),value:ar(c.value)})}else for(var h in e)L3(e,h)&&wa(this.entries,{key:h,value:ar(e[h])})},parseQuery:function(e){if(e)for(var n=fg(e,"&"),r=0,t,a;r<n.length;)t=n[r++],t.length&&(a=fg(t,"="),wa(this.entries,{key:pg(J3(a)),value:pg(cg(a,"="))}))},serialize:function(){for(var e=this.entries,n=[],r=0,t;r<e.length;)t=e[r++],wa(n,vg(t.key)+"="+vg(t.value));return cg(n,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var Vo=function(){e$(this,Ts);var n=arguments.length>0?arguments[0]:void 0;n$(this,new i$(n))},Ts=Vo.prototype;A3(Ts,{append:function(n,r){ti(arguments.length,2);var t=Mr(this);wa(t.entries,{key:ar(n),value:ar(r)}),t.updateURL()},delete:function(e){ti(arguments.length,1);for(var n=Mr(this),r=n.entries,t=ar(e),a=0;a<r.length;)r[a].key===t?lg(r,a,1):a++;n.updateURL()},get:function(n){ti(arguments.length,1);for(var r=Mr(this).entries,t=ar(n),a=0;a<r.length;a++)if(r[a].key===t)return r[a].value;return null},getAll:function(n){ti(arguments.length,1);for(var r=Mr(this).entries,t=ar(n),a=[],i=0;i<r.length;i++)r[i].key===t&&wa(a,r[i].value);return a},has:function(n){ti(arguments.length,1);for(var r=Mr(this).entries,t=ar(n),a=0;a<r.length;)if(r[a++].key===t)return!0;return!1},set:function(n,r){ti(arguments.length,1);for(var t=Mr(this),a=t.entries,i=!1,s=ar(n),l=ar(r),c=0,h;c<a.length;c++)h=a[c],h.key===s&&(i?lg(a,c--,1):(i=!0,h.value=l));i||wa(a,{key:s,value:l}),t.updateURL()},sort:function(){var n=Mr(this);q3(n.entries,function(r,t){return r.key>t.key?1:-1}),n.updateURL()},forEach:function(n){for(var r=Mr(this).entries,t=x3(n,arguments.length>1?arguments[1]:void 0),a=0,i;a<r.length;)i=r[a++],t(i.value,i.key,this)},keys:function(){return new yl(this,"keys")},values:function(){return new yl(this,"values")},entries:function(){return new yl(this,"entries")}},{enumerable:!0});ZS(Ts,W3,Ts.entries,{name:"entries"});ZS(Ts,"toString",function(){return Mr(this).serialize()},{enumerable:!0});M3(Vo,eu);Tf({global:!0,constructor:!0,forced:!XS},{URLSearchParams:Vo});if(!XS&&vl(ys)){var a4=zr(og.has),i4=zr(og.set),hg=function(e){if(t$(e)){var n=e.body,r;if(U3(n)===eu)return r=e.headers?new ys(e.headers):new ys,a4(r,"content-type")||i4(r,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),D3(e,{body:sg(0,ar(n)),headers:sg(0,r)})}return e};if(vl(ug)&&Tf({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(n){return ug(n,arguments.length>1?hg(arguments[1]):{})}}),vl(io)){var gl=function(n){return e$(this,hl),new io(n,arguments.length>1?hg(arguments[1]):{})};hl.constructor=gl,gl.prototype=hl,Tf({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:gl})}}var s4={URLSearchParams:Vo,getState:Mr},u4=We,sp=mt,o4=KS,up=He,yg=yn,Ir=Le,so=Ft,mr=y3,c4=La,Ef=St,op=TS,ri=vb,Pr=xs,l4=cd.codeAt,f4=O3,tn=Lt,d4=Jn,p4=Xf,s$=s4,u$=Tr,v4=u$.set,uo=u$.getterFor("URL"),h4=s$.URLSearchParams,y4=s$.getState,is=up.URL,Cf=up.TypeError,oo=up.parseInt,g4=Math.floor,gg=Math.pow,Sr=Ir("".charAt),Lr=Ir(/./.exec),ls=Ir([].join),m4=Ir(1 .toString),b4=Ir([].pop),ui=Ir([].push),mg=Ir("".replace),w4=Ir([].shift),S4=Ir("".split),gs=Ir("".slice),co=Ir("".toLowerCase),$4=Ir([].unshift),_4="Invalid authority",ml="Invalid scheme",ya="Invalid host",bg="Invalid port",o$=/[a-z]/i,k4=/[\d+-.a-z]/i,Of=/\d/,T4=/^0x/i,I4=/^[0-7]+$/,R4=/^\d+$/,c$=/^[\da-f]+$/i,E4=/[\0\t\n\r #%/:<>?@[\\\]^|]/,C4=/[\0\t\n\r #/:<>?@[\\\]^|]/,O4=/^[\u0000-\u0020]+|[\u0000-\u0020]+$/g,P4=/[\t\n\r]/g,br,A4=function(e){var n=S4(e,"."),r,t,a,i,s,l,c;if(n.length&&n[n.length-1]==""&&n.length--,r=n.length,r>4)return e;for(t=[],a=0;a<r;a++){if(i=n[a],i=="")return e;if(s=10,i.length>1&&Sr(i,0)=="0"&&(s=Lr(T4,i)?16:8,i=gs(i,s==8?1:2)),i==="")l=0;else{if(!Lr(s==10?R4:s==8?I4:c$,i))return e;l=oo(i,s)}ui(t,l)}for(a=0;a<r;a++)if(l=t[a],a==r-1){if(l>=gg(256,5-r))return null}else if(l>255)return null;for(c=b4(t),a=0;a<t.length;a++)c+=t[a]*gg(256,3-a);return c},M4=function(e){var n=[0,0,0,0,0,0,0,0],r=0,t=null,a=0,i,s,l,c,h,g,b,$=function(){return Sr(e,a)};if($()==":"){if(Sr(e,1)!=":")return;a+=2,r++,t=r}for(;$();){if(r==8)return;if($()==":"){if(t!==null)return;a++,r++,t=r;continue}for(i=s=0;s<4&&Lr(c$,$());)i=i*16+oo($(),16),a++,s++;if($()=="."){if(s==0||(a-=s,r>6))return;for(l=0;$();){if(c=null,l>0)if($()=="."&&l<4)a++;else return;if(!Lr(Of,$()))return;for(;Lr(Of,$());){if(h=oo($(),10),c===null)c=h;else{if(c==0)return;c=c*10+h}if(c>255)return;a++}n[r]=n[r]*256+c,l++,(l==2||l==4)&&r++}if(l!=4)return;break}else if($()==":"){if(a++,!$())return}else if($())return;n[r++]=i}if(t!==null)for(g=r-t,r=7;r!=0&&g>0;)b=n[r],n[r--]=n[t+g-1],n[t+--g]=b;else if(r!=8)return;return n},N4=function(e){for(var n=null,r=1,t=null,a=0,i=0;i<8;i++)e[i]!==0?(a>r&&(n=t,r=a),t=null,a=0):(t===null&&(t=i),++a);return a>r&&(n=t,r=a),n},ss=function(e){var n,r,t,a;if(typeof e=="number"){for(n=[],r=0;r<4;r++)$4(n,e%256),e=g4(e/256);return ls(n,".")}else if(typeof e=="object"){for(n="",t=N4(e),r=0;r<8;r++)a&&e[r]===0||(a&&(a=!1),t===r?(n+=r?":":"::",a=!0):(n+=m4(e[r],16),r<7&&(n+=":")));return"["+n+"]"}return e},Fu={},l$=op({},Fu,{" ":1,'"':1,"<":1,">":1,"`":1}),f$=op({},l$,{"#":1,"?":1,"{":1,"}":1}),bl=op({},f$,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),An=function(e,n){var r=l4(e,0);return r>32&&r<127&&!Ef(n,e)?e:encodeURIComponent(e)},Ou={ftp:21,file:null,http:80,https:443,ws:80,wss:443},fs=function(e,n){var r;return e.length==2&&Lr(o$,Sr(e,0))&&((r=Sr(e,1))==":"||!n&&r=="|")},wg=function(e){var n;return e.length>1&&fs(gs(e,0,2))&&(e.length==2||(n=Sr(e,2))==="/"||n==="\\"||n==="?"||n==="#")},L4=function(e){return e==="."||co(e)==="%2e"},x4=function(e){return e=co(e),e===".."||e==="%2e."||e===".%2e"||e==="%2e%2e"},wl={},Sg={},Sl={},$g={},_g={},$l={},kg={},Tg={},Pu={},Au={},_l={},kl={},Tl={},Il={},Ig={},Rl={},ni={},Br={},Rg={},ga={},en={},cp=function(e,n,r){var t=tn(e),a,i,s;if(n){if(i=this.parse(t),i)throw Cf(i);this.searchParams=null}else{if(r!==void 0&&(a=new cp(r,!0)),i=this.parse(t,null,a),i)throw Cf(i);s=y4(new h4),s.bindURL(this),this.searchParams=s}};cp.prototype={type:"URL",parse:function(e,n,r){var t=this,a=n||wl,i=0,s="",l=!1,c=!1,h=!1,g,b,$,S;for(e=tn(e),n||(t.scheme="",t.username="",t.password="",t.host=null,t.port=null,t.path=[],t.query=null,t.fragment=null,t.cannotBeABaseURL=!1,e=mg(e,O4,"")),e=mg(e,P4,""),g=ri(e);i<=g.length;){switch(b=g[i],a){case wl:if(b&&Lr(o$,b))s+=co(b),a=Sg;else{if(n)return ml;a=Sl;continue}break;case Sg:if(b&&(Lr(k4,b)||b=="+"||b=="-"||b=="."))s+=co(b);else if(b==":"){if(n&&(t.isSpecial()!=Ef(Ou,s)||s=="file"&&(t.includesCredentials()||t.port!==null)||t.scheme=="file"&&!t.host))return;if(t.scheme=s,n){t.isSpecial()&&Ou[t.scheme]==t.port&&(t.port=null);return}s="",t.scheme=="file"?a=Il:t.isSpecial()&&r&&r.scheme==t.scheme?a=$g:t.isSpecial()?a=Tg:g[i+1]=="/"?(a=_g,i++):(t.cannotBeABaseURL=!0,ui(t.path,""),a=Rg)}else{if(n)return ml;s="",a=Sl,i=0;continue}break;case Sl:if(!r||r.cannotBeABaseURL&&b!="#")return ml;if(r.cannotBeABaseURL&&b=="#"){t.scheme=r.scheme,t.path=Pr(r.path),t.query=r.query,t.fragment="",t.cannotBeABaseURL=!0,a=en;break}a=r.scheme=="file"?Il:$l;continue;case $g:if(b=="/"&&g[i+1]=="/")a=Pu,i++;else{a=$l;continue}break;case _g:if(b=="/"){a=Au;break}else{a=Br;continue}case $l:if(t.scheme=r.scheme,b==br)t.username=r.username,t.password=r.password,t.host=r.host,t.port=r.port,t.path=Pr(r.path),t.query=r.query;else if(b=="/"||b=="\\"&&t.isSpecial())a=kg;else if(b=="?")t.username=r.username,t.password=r.password,t.host=r.host,t.port=r.port,t.path=Pr(r.path),t.query="",a=ga;else if(b=="#")t.username=r.username,t.password=r.password,t.host=r.host,t.port=r.port,t.path=Pr(r.path),t.query=r.query,t.fragment="",a=en;else{t.username=r.username,t.password=r.password,t.host=r.host,t.port=r.port,t.path=Pr(r.path),t.path.length--,a=Br;continue}break;case kg:if(t.isSpecial()&&(b=="/"||b=="\\"))a=Pu;else if(b=="/")a=Au;else{t.username=r.username,t.password=r.password,t.host=r.host,t.port=r.port,a=Br;continue}break;case Tg:if(a=Pu,b!="/"||Sr(s,i+1)!="/")continue;i++;break;case Pu:if(b!="/"&&b!="\\"){a=Au;continue}break;case Au:if(b=="@"){l&&(s="%40"+s),l=!0,$=ri(s);for(var R=0;R<$.length;R++){var N=$[R];if(N==":"&&!h){h=!0;continue}var M=An(N,bl);h?t.password+=M:t.username+=M}s=""}else if(b==br||b=="/"||b=="?"||b=="#"||b=="\\"&&t.isSpecial()){if(l&&s=="")return _4;i-=ri(s).length+1,s="",a=_l}else s+=b;break;case _l:case kl:if(n&&t.scheme=="file"){a=Rl;continue}else if(b==":"&&!c){if(s=="")return ya;if(S=t.parseHost(s),S)return S;if(s="",a=Tl,n==kl)return}else if(b==br||b=="/"||b=="?"||b=="#"||b=="\\"&&t.isSpecial()){if(t.isSpecial()&&s=="")return ya;if(n&&s==""&&(t.includesCredentials()||t.port!==null))return;if(S=t.parseHost(s),S)return S;if(s="",a=ni,n)return;continue}else b=="["?c=!0:b=="]"&&(c=!1),s+=b;break;case Tl:if(Lr(Of,b))s+=b;else if(b==br||b=="/"||b=="?"||b=="#"||b=="\\"&&t.isSpecial()||n){if(s!=""){var W=oo(s,10);if(W>65535)return bg;t.port=t.isSpecial()&&W===Ou[t.scheme]?null:W,s=""}if(n)return;a=ni;continue}else return bg;break;case Il:if(t.scheme="file",b=="/"||b=="\\")a=Ig;else if(r&&r.scheme=="file")if(b==br)t.host=r.host,t.path=Pr(r.path),t.query=r.query;else if(b=="?")t.host=r.host,t.path=Pr(r.path),t.query="",a=ga;else if(b=="#")t.host=r.host,t.path=Pr(r.path),t.query=r.query,t.fragment="",a=en;else{wg(ls(Pr(g,i),""))||(t.host=r.host,t.path=Pr(r.path),t.shortenPath()),a=Br;continue}else{a=Br;continue}break;case Ig:if(b=="/"||b=="\\"){a=Rl;break}r&&r.scheme=="file"&&!wg(ls(Pr(g,i),""))&&(fs(r.path[0],!0)?ui(t.path,r.path[0]):t.host=r.host),a=Br;continue;case Rl:if(b==br||b=="/"||b=="\\"||b=="?"||b=="#"){if(!n&&fs(s))a=Br;else if(s==""){if(t.host="",n)return;a=ni}else{if(S=t.parseHost(s),S)return S;if(t.host=="localhost"&&(t.host=""),n)return;s="",a=ni}continue}else s+=b;break;case ni:if(t.isSpecial()){if(a=Br,b!="/"&&b!="\\")continue}else if(!n&&b=="?")t.query="",a=ga;else if(!n&&b=="#")t.fragment="",a=en;else if(b!=br&&(a=Br,b!="/"))continue;break;case Br:if(b==br||b=="/"||b=="\\"&&t.isSpecial()||!n&&(b=="?"||b=="#")){if(x4(s)?(t.shortenPath(),b!="/"&&!(b=="\\"&&t.isSpecial())&&ui(t.path,"")):L4(s)?b!="/"&&!(b=="\\"&&t.isSpecial())&&ui(t.path,""):(t.scheme=="file"&&!t.path.length&&fs(s)&&(t.host&&(t.host=""),s=Sr(s,0)+":"),ui(t.path,s)),s="",t.scheme=="file"&&(b==br||b=="?"||b=="#"))for(;t.path.length>1&&t.path[0]==="";)w4(t.path);b=="?"?(t.query="",a=ga):b=="#"&&(t.fragment="",a=en)}else s+=An(b,f$);break;case Rg:b=="?"?(t.query="",a=ga):b=="#"?(t.fragment="",a=en):b!=br&&(t.path[0]+=An(b,Fu));break;case ga:!n&&b=="#"?(t.fragment="",a=en):b!=br&&(b=="'"&&t.isSpecial()?t.query+="%27":b=="#"?t.query+="%23":t.query+=An(b,Fu));break;case en:b!=br&&(t.fragment+=An(b,l$));break}i++}},parseHost:function(e){var n,r,t;if(Sr(e,0)=="["){if(Sr(e,e.length-1)!="]"||(n=M4(gs(e,1,-1)),!n))return ya;this.host=n}else if(this.isSpecial()){if(e=f4(e),Lr(E4,e)||(n=A4(e),n===null))return ya;this.host=n}else{if(Lr(C4,e))return ya;for(n="",r=ri(e),t=0;t<r.length;t++)n+=An(r[t],Fu);this.host=n}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme=="file"},includesCredentials:function(){return this.username!=""||this.password!=""},isSpecial:function(){return Ef(Ou,this.scheme)},shortenPath:function(){var e=this.path,n=e.length;n&&(this.scheme!="file"||n!=1||!fs(e[0],!0))&&e.length--},serialize:function(){var e=this,n=e.scheme,r=e.username,t=e.password,a=e.host,i=e.port,s=e.path,l=e.query,c=e.fragment,h=n+":";return a!==null?(h+="//",e.includesCredentials()&&(h+=r+(t?":"+t:"")+"@"),h+=ss(a),i!==null&&(h+=":"+i)):n=="file"&&(h+="//"),h+=e.cannotBeABaseURL?s[0]:s.length?"/"+ls(s,"/"):"",l!==null&&(h+="?"+l),c!==null&&(h+="#"+c),h},setHref:function(e){var n=this.parse(e);if(n)throw Cf(n);this.searchParams.update()},getOrigin:function(){var e=this.scheme,n=this.port;if(e=="blob")try{return new $i(e.path[0]).origin}catch{return"null"}return e=="file"||!this.isSpecial()?"null":e+"://"+ss(this.host)+(n!==null?":"+n:"")},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(tn(e)+":",wl)},getUsername:function(){return this.username},setUsername:function(e){var n=ri(tn(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var r=0;r<n.length;r++)this.username+=An(n[r],bl)}},getPassword:function(){return this.password},setPassword:function(e){var n=ri(tn(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var r=0;r<n.length;r++)this.password+=An(n[r],bl)}},getHost:function(){var e=this.host,n=this.port;return e===null?"":n===null?ss(e):ss(e)+":"+n},setHost:function(e){this.cannotBeABaseURL||this.parse(e,_l)},getHostname:function(){var e=this.host;return e===null?"":ss(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,kl)},getPort:function(){var e=this.port;return e===null?"":tn(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||(e=tn(e),e==""?this.port=null:this.parse(e,Tl))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+ls(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,ni))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){e=tn(e),e==""?this.query=null:(Sr(e,0)=="?"&&(e=gs(e,1)),this.query="",this.parse(e,ga)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){if(e=tn(e),e==""){this.fragment=null;return}Sr(e,0)=="#"&&(e=gs(e,1)),this.fragment="",this.parse(e,en)},update:function(){this.query=this.searchParams.serialize()||null}};var $i=function(n){var r=c4(this,Ht),t=p4(arguments.length,1)>1?arguments[1]:void 0,a=v4(r,new cp(n,!1,t));sp||(r.href=a.serialize(),r.origin=a.getOrigin(),r.protocol=a.getProtocol(),r.username=a.getUsername(),r.password=a.getPassword(),r.host=a.getHost(),r.hostname=a.getHostname(),r.port=a.getPort(),r.pathname=a.getPathname(),r.search=a.getSearch(),r.searchParams=a.getSearchParams(),r.hash=a.getHash())},Ht=$i.prototype,wr=function(e,n){return{get:function(){return uo(this)[e]()},set:n&&function(r){return uo(this)[n](r)},configurable:!0,enumerable:!0}};sp&&(mr(Ht,"href",wr("serialize","setHref")),mr(Ht,"origin",wr("getOrigin")),mr(Ht,"protocol",wr("getProtocol","setProtocol")),mr(Ht,"username",wr("getUsername","setUsername")),mr(Ht,"password",wr("getPassword","setPassword")),mr(Ht,"host",wr("getHost","setHost")),mr(Ht,"hostname",wr("getHostname","setHostname")),mr(Ht,"port",wr("getPort","setPort")),mr(Ht,"pathname",wr("getPathname","setPathname")),mr(Ht,"search",wr("getSearch","setSearch")),mr(Ht,"searchParams",wr("getSearchParams")),mr(Ht,"hash",wr("getHash","setHash")));so(Ht,"toJSON",function(){return uo(this).serialize()},{enumerable:!0});so(Ht,"toString",function(){return uo(this).serialize()},{enumerable:!0});if(is){var Eg=is.createObjectURL,Cg=is.revokeObjectURL;Eg&&so($i,"createObjectURL",yg(Eg,is)),Cg&&so($i,"revokeObjectURL",yg(Cg,is))}d4($i,"URL");u4({global:!0,constructor:!0,forced:!o4,sham:!sp},{URL:$i});/*
@license
Copyright (c) 2018, Twilio, Inc.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted, provided that the above
copyright notice and this permission notice appear in all copies.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY
SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION
OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN
CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.

*/(function(e){var n=typeof n!="undefined"?n:typeof self!="undefined"?self:typeof window!="undefined"?window:{};Object.defineProperty(e,"__esModule",{value:!0});var r=Ri.exports,t=ta.exports,a=Gs,i=Oi.exports,s=mn,l=Pt;function c(re){return re&&typeof re=="object"&&"default"in re?re:{default:re}}function h(re){if(re&&re.__esModule)return re;var F=Object.create(null);return re&&Object.keys(re).forEach(function(q){if(q!=="default"){var I=Object.getOwnPropertyDescriptor(re,q);Object.defineProperty(F,q,I.get?I:{enumerable:!0,get:function(){return re[q]}})}}),F.default=re,Object.freeze(F)}var g=c(r),b=c(t),$=c(a),S=h(i);/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function R(re,F,q,I){var O=arguments.length,pe=O<3?F:I===null?I=Object.getOwnPropertyDescriptor(F,q):I,se;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")pe=Reflect.decorate(re,F,q,I);else for(var _e=re.length-1;_e>=0;_e--)(se=re[_e])&&(pe=(O<3?se(pe):O>3?se(F,q,pe):se(F,q))||pe);return O>3&&pe&&Object.defineProperty(F,q,pe),pe}function N(re,F){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(re,F)}function M(re,F){return["".concat(new Date().toISOString()," MCS Client ").concat(re,":")].concat(Array.from(F))}class W{constructor(F){b.default(this,"prefix",""),this.prefix=F!=null&&F.length>0?F+" ":""}static scope(F){return new W(F)}setLevel(F){S.setLevel(F)}static setLevel(F){S.setLevel(F)}trace(){for(var F=arguments.length,q=new Array(F),I=0;I<F;I++)q[I]=arguments[I];S.trace.apply(null,M(this.prefix+"T",q))}debug(){for(var F=arguments.length,q=new Array(F),I=0;I<F;I++)q[I]=arguments[I];S.debug.apply(null,M(this.prefix+"D",q))}info(){for(var F=arguments.length,q=new Array(F),I=0;I<F;I++)q[I]=arguments[I];S.info.apply(null,M(this.prefix+"I",q))}warn(){for(var F=arguments.length,q=new Array(F),I=0;I<F;I++)q[I]=arguments[I];S.warn.apply(null,M(this.prefix+"W",q))}error(){for(var F=arguments.length,q=new Array(F),I=0;I<F;I++)q[I]=arguments[I];S.error.apply(null,M(this.prefix+"E",q))}static trace(){for(var F=arguments.length,q=new Array(F),I=0;I<F;I++)q[I]=arguments[I];S.trace.apply(null,M("T",q))}static debug(){for(var F=arguments.length,q=new Array(F),I=0;I<F;I++)q[I]=arguments[I];S.debug.apply(null,M("D",q))}static info(){for(var F=arguments.length,q=new Array(F),I=0;I<F;I++)q[I]=arguments[I];S.info.apply(null,M("I",q))}static warn(){for(var F=arguments.length,q=new Array(F),I=0;I<F;I++)q[I]=arguments[I];S.warn.apply(null,M("W",q))}static error(){for(var F=arguments.length,q=new Array(F),I=0;I<F;I++)q[I]=arguments[I];S.error.apply(null,M("E",q))}}var z=1e3,me=4e3,le=3,De=!0,$e=re=>"https://mcs.".concat(re!=null?re:"us1",".twilio.com"),Pe=re=>re.startsWith("http"),L=(re,F)=>"".concat(Pe(re)?"":$e(F)).concat(re);class ue{constructor(F,q,I,O){var pe,se,_e,Ge,fe,Ee,ke=(pe=(se=O.MCS)!==null&&se!==void 0?se:O)!==null&&pe!==void 0?pe:{};this.region=(_e=(Ge=ke.region)!==null&&Ge!==void 0?Ge:O.region)!==null&&_e!==void 0?_e:"us1",this.mediaUrl=L(q,this.region),this.mediaSetUrl=I?L(I):"".concat(this.mediaUrl,"Set"),this.token=F,this.retryWhenThrottledOverride=(fe=ke.retryWhenThrottledOverride)!==null&&fe!==void 0?fe:De,this.backoffConfigOverride=(Ee=ke.backoffConfigOverride)!==null&&Ee!==void 0?Ee:ue.backoffConfigDefault}static get backoffConfigDefault(){return{min:z,max:me,maxAttemptsCount:le}}static get retryWhenThrottledDefault(){return De}updateToken(F){this.token=F}}class x{constructor(F,q,I){this.config=F,this.network=q,this._update(I)}get sid(){return this.state.sid}get serviceSid(){return this.state.serviceSid}get dateCreated(){return this.state.dateCreated}get dateUpdated(){return this.state.dateUpdated}get contentType(){return this.state.contentType}get size(){return this.state.size}get fileName(){return this.state.filename}get filename(){return this.state.filename}get category(){return this.state.category}getContentUrl(){var F=this;return g.default($.default.mark(function q(){var I;return $.default.wrap(function(pe){for(;;)switch(pe.prev=pe.next){case 0:return pe.next=2,F.network.get("".concat(F.config.mediaUrl,"/").concat(F.sid));case 2:return I=pe.sent,F._update(I.body),pe.abrupt("return",Promise.resolve(F.state.contentDirectUrl));case 5:case"end":return pe.stop()}},q)}))()}getCachedContentUrl(){var F=this;return g.default($.default.mark(function q(){return $.default.wrap(function(O){for(;;)switch(O.prev=O.next){case 0:if(!F.state.contentDirectUrl){O.next=2;break}return O.abrupt("return",Promise.resolve(F.state.contentDirectUrl));case 2:return O.next=4,F.getContentUrl();case 4:return O.abrupt("return",O.sent);case 5:case"end":return O.stop()}},q)}))()}_update(F){var q,I,O,pe;this.state={sid:F.sid,serviceSid:F.service_sid,channelSid:F.channel_sid,messageSid:F.message_sid,dateCreated:F.date_created?new Date(F.date_created):null,dateUploadUpdated:F.date_upload_updated?new Date(F.date_upload_updated):null,dateUpdated:F.date_updated?new Date(F.date_updated):null,size:F.size,contentType:F.content_type,author:F.author,url:F.url,contentUrl:F.links.content,contentDirectUrl:(q=F.links.content_direct_temporary)!==null&&q!==void 0?q:null,filename:(I=F.filename)!==null&&I!==void 0?I:null,category:(O=F.category)!==null&&O!==void 0?O:"media",isMultipartUpstream:(pe=F.is_multipart_upstream)!==null&&pe!==void 0?pe:!1}}}class ye extends Error{constructor(F,q,I,O,pe){super(F),this.code=q,this.body=I,this.status=O,this.headers=pe}}var ge=n.XMLHttpRequest||{};function Q(re){return re?re.split(`\r
`).map(F=>F.split(": ")).filter(F=>F.length===2&&F[1].length>0).reduce((F,q)=>(F[q[0]]=q[1],F),{}):{}}function H(re){var F=re.getResponseHeader("Content-Type");if(!F||F.indexOf("application/json")!==0||re.responseText.length===0)return re.responseText;try{return JSON.parse(re.responseText)}catch{return re.responseText}}class J{static request(F,q,I,O){return g.default($.default.mark(function pe(){return $.default.wrap(function(_e){for(;;)switch(_e.prev=_e.next){case 0:return _e.abrupt("return",new Promise((Ge,fe)=>{var Ee=new ge;Ee.open(F,q,!0),Ee.onreadystatechange=function(){if(Ee.readyState===4){var Ce=Q(Ee.getAllResponseHeaders()),Ie=H(Ee);if(200<=Ee.status&&Ee.status<300)Ge({status:Ee.status,headers:Ce,body:Ie});else{var oe,lr=(oe=Ee.statusText)!==null&&oe!==void 0?oe:"NONE",xe;typeof Ie=="string"?xe=Ie&&Ie.split(`
`,2).length===1?Ie:"":xe=JSON.stringify(Ie);var Rt="".concat(Ee.status,": [").concat(lr,"] ").concat(xe);fe(new ye(Rt,Ee.status,Ie,lr,Ce))}}};for(var ke in I)Ee.setRequestHeader(ke,I[ke]),ke==="Content-Type"&&I[ke]==="application/json"&&(O=JSON.stringify(O));Ee.send(O)}));case 1:case"end":return _e.stop()}},pe)}))()}get(F,q){return g.default($.default.mark(function I(){return $.default.wrap(function(pe){for(;;)switch(pe.prev=pe.next){case 0:return pe.abrupt("return",J.request("GET",F,q));case 1:case"end":return pe.stop()}},I)}))()}post(F,q,I){return g.default($.default.mark(function O(){return $.default.wrap(function(se){for(;;)switch(se.prev=se.next){case 0:return se.abrupt("return",J.request("POST",F,q,I));case 1:case"end":return se.stop()}},O)}))()}}var K=W.scope("Network");class he{constructor(F,q){this.config=F,this.transport=q}backoffConfig(){return Object.assign(ue.backoffConfigDefault,this.config.backoffConfigOverride)}retryWhenThrottled(){var F,q;return(F=(q=this.config.retryWhenThrottledOverride)!==null&&q!==void 0?q:ue.retryWhenThrottledDefault)!==null&&F!==void 0?F:!1}executeWithRetry(F,q){var I=this;return g.default($.default.mark(function O(){return $.default.wrap(function(se){for(;;)switch(se.prev=se.next){case 0:return se.abrupt("return",new Promise((_e,Ge)=>{var fe=[502,503,504];q&&fe.push(429);var Ee=new s.Retrier(I.backoffConfig());Ee.on("attempt",g.default($.default.mark(function ke(){var Z;return $.default.wrap(function(Ie){for(;;)switch(Ie.prev=Ie.next){case 0:return Ie.prev=0,Ie.next=3,F();case 3:Z=Ie.sent,Ee.succeeded(Z),Ie.next=10;break;case 7:Ie.prev=7,Ie.t0=Ie.catch(0),fe.indexOf(Ie.t0.status)>-1||Ie.t0.message==="Twilsock disconnected"?Ee.failed(Ie.t0):(Ee.removeAllListeners(),Ee.cancel(),Ge(Ie.t0));case 10:case"end":return Ie.stop()}},ke,null,[[0,7]])}))),Ee.on("succeeded",ke=>{_e(ke)}),Ee.on("cancelled",ke=>Ge(ke)),Ee.on("failed",ke=>Ge(ke)),Ee.start()}));case 1:case"end":return se.stop()}},O)}))()}get(F){var q=this;return g.default($.default.mark(function I(){var O,pe;return $.default.wrap(function(_e){for(;;)switch(_e.prev=_e.next){case 0:return O={"X-Twilio-Token":q.config.token},K.trace("sending GET request to ",F," headers ",O),_e.prev=2,_e.next=5,q.executeWithRetry(()=>q.transport.get(F,O),q.retryWhenThrottled());case 5:return pe=_e.sent,K.trace("response",pe),_e.abrupt("return",pe);case 10:throw _e.prev=10,_e.t0=_e.catch(2),K.debug("get() error ".concat(_e.t0)),_e.t0;case 14:case"end":return _e.stop()}},I,null,[[2,10]])}))()}post(F,q,I,O,pe){var se=this;return g.default($.default.mark(function _e(){var Ge,fe,Ee;return $.default.wrap(function(Z){for(;;)switch(Z.prev=Z.next){case 0:return Ge={"X-Twilio-Token":se.config.token},(typeof FormData=="undefined"||!(I instanceof FormData))&&O&&Object.assign(Ge,{"Content-Type":O}),fe=new URL(F),q&&fe.searchParams.append("Category",q),pe&&fe.searchParams.append("Filename",pe),K.trace("sending POST request to ".concat(F," with headers ").concat(Ge)),Z.prev=6,Z.next=9,se.transport.post(fe.href,Ge,I);case 9:Ee=Z.sent,Z.next=18;break;case 12:if(Z.prev=12,Z.t0=Z.catch(6),!(n.XMLHttpRequest===void 0&&I instanceof FormData)){Z.next=16;break}throw new TypeError("Posting FormData supported only with browser engine's FormData");case 16:throw K.debug("post() error ".concat(Z.t0)),Z.t0;case 18:return K.trace("response",Ee),Z.abrupt("return",Ee);case 20:case"end":return Z.stop()}},_e,null,[[6,12]])}))()}}var E="0.5.3",Te,ut,ze=W.scope("");e.default=(ut=Te=class{constructor(F,q,I){var O,pe,se=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};this.options=se,this.options.logLevel=(O=this.options.logLevel)!==null&&O!==void 0?O:"silent",this.config=new ue(F,q,I,this.options),ze.setLevel(this.options.logLevel),this.options.transport=(pe=this.options.transport)!==null&&pe!==void 0?pe:new J,this.transport=this.options.transport,this.network=new he(this.config,this.transport)}updateToken(F){ze.info("updateToken"),this.config.updateToken(F)}get(F){var q=this;return g.default($.default.mark(function I(){var O;return $.default.wrap(function(se){for(;;)switch(se.prev=se.next){case 0:return se.next=2,q.network.get("".concat(q.config.mediaUrl,"/").concat(F));case 2:return O=se.sent,se.abrupt("return",new x(q.config,q.network,O.body));case 4:case"end":return se.stop()}},I)}))()}post(F,q,I,O){var pe=this;return g.default($.default.mark(function se(){var _e;return $.default.wrap(function(fe){for(;;)switch(fe.prev=fe.next){case 0:return fe.next=2,pe.network.post(pe.config.mediaUrl,I!=null?I:"media",q,F,O);case 2:return _e=fe.sent,fe.abrupt("return",new x(pe.config,pe.network,_e.body));case 4:case"end":return fe.stop()}},se)}))()}postFormData(F,q){var I=this;return g.default($.default.mark(function O(){var pe;return $.default.wrap(function(_e){for(;;)switch(_e.prev=_e.next){case 0:return _e.next=2,I.network.post(I.config.mediaUrl,q!=null?q:"media",F);case 2:return pe=_e.sent,_e.abrupt("return",new x(I.config,I.network,pe.body));case 4:case"end":return _e.stop()}},O)}))()}mediaSetGet(F){var q=this;return g.default($.default.mark(function I(){var O,pe;return $.default.wrap(function(_e){for(;;)switch(_e.prev=_e.next){case 0:return O={command:"get",list:F.map(Ge=>({media_sid:Ge}))},_e.next=3,q.network.post("".concat(q.config.mediaSetUrl),null,O,"application/json");case 3:return pe=_e.sent,_e.abrupt("return",pe.body.map(Ge=>{if(Ge.code!==200)throw new Error("Failed to obtain detailed information about Media items (failed SID ".concat(Ge.media_record.sid,")"));return new x(q.config,q.network,Ge.media_record)}));case 5:case"end":return _e.stop()}},I)}))()}},b.default(Te,"version",E),ut),R([l.validateTypes(l.nonEmptyString),N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",void 0)],e.default.prototype,"updateToken",null),R([l.validateTypesAsync(l.nonEmptyString),N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",Promise)],e.default.prototype,"get",null),e.default=R([l.validateConstructorTypes(l.nonEmptyString,l.nonEmptyString,[l.nonEmptyString,l.literal(null)],[l.pureObject,"undefined"]),N("design:paramtypes",[String,String,Object,Object])],e.default),e.Client=e.default,e.McsClient=e.default,e.McsMedia=x,e.Media=x,e.default=e.default})(WS);var U4=We,j4=He,D4=Pw,F4=To,lp="ArrayBuffer",Og=D4[lp],B4=j4[lp];U4({global:!0,constructor:!0,forced:B4!==Og},{ArrayBuffer:Og});F4(lp);var q4=We,d$=Le,W4=Dr,G4=Dt,H4=Bt,z4=Wd,Pg=Lt,fp=Ne,V4=Jd,K4=Ws,Ag=dS,Y4=pS,Mg=Ca,Ng=vS,jn=[],Lg=d$(jn.sort),J4=d$(jn.push),Q4=fp(function(){jn.sort(void 0)}),X4=fp(function(){jn.sort(null)}),Z4=K4("sort"),p$=!fp(function(){if(Mg)return Mg<70;if(!(Ag&&Ag>3)){if(Y4)return!0;if(Ng)return Ng<603;var e="",n,r,t,a;for(n=65;n<76;n++){switch(r=String.fromCharCode(n),n){case 66:case 69:case 70:case 72:t=3;break;case 68:case 71:t=4;break;default:t=2}for(a=0;a<47;a++)jn.push({k:r+a,v:t})}for(jn.sort(function(i,s){return s.v-i.v}),a=0;a<jn.length;a++)r=jn[a].k.charAt(0),e.charAt(e.length-1)!==r&&(e+=r);return e!=="DGBEFHACIJK"}}),eq=Q4||!X4||!Z4||!p$,tq=function(e){return function(n,r){return r===void 0?-1:n===void 0?1:e!==void 0?+e(n,r)||0:Pg(n)>Pg(r)?1:-1}};q4({target:"Array",proto:!0,forced:eq},{sort:function(n){n!==void 0&&W4(n);var r=G4(this);if(p$)return n===void 0?Lg(r):Lg(r,n);var t=[],a=H4(r),i,s;for(s=0;s<a;s++)s in r&&J4(t,r[s]);for(V4(t,tq(n)),i=t.length,s=0;s<i;)r[s]=t[s++];for(;s<a;)z4(r,s++);return r}});var rq=We,nq=Le,aq=GS,iq=Kr,xg=Lt,sq=HS,uq=nq("".indexOf);rq({target:"String",proto:!0,forced:!sq("includes")},{includes:function(n){return!!~uq(xg(iq(this)),xg(aq(n)),arguments.length>1?arguments[1]:void 0)}});var oq=We,cq=ur.find,lq=pd,Pf="find",v$=!0;Pf in[]&&Array(1)[Pf](function(){v$=!1});oq({target:"Array",proto:!0,forced:v$},{find:function(n){return cq(this,n,arguments.length>1?arguments[1]:void 0)}});lq(Pf);/*
@license
The following license applies to all parts of this software except as
documented below.

    Copyright (c) 2019, Twilio, inc.
    All rights reserved.

    Redistribution and use in source and binary forms, with or without
    modification, are permitted provided that the following conditions are
    met:

      1. Redistributions of source code must retain the above copyright
         notice, this list of conditions and the following disclaimer.

      2. Redistributions in binary form must reproduce the above copyright
         notice, this list of conditions and the following disclaimer in
         the documentation and/or other materials provided with the
         distribution.

      3. Neither the name of Twilio nor the names of its contributors may
         be used to endorse or promote products derived from this software
         without specific prior written permission.

    THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
    "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
    LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
    A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
    HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
    SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
    LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
    DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
    THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
    (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
    OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

This software includes javascript-state-machine under the following license.

    Copyright (c) 2012, 2013, 2014, 2015, Jake Gordon and contributors

    Permission is hereby granted, free of charge, to any person obtaining a copy
    of this software and associated documentation files (the "Software"), to deal
    in the Software without restriction, including without limitation the rights
    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
    copies of the Software, and to permit persons to whom the Software is
    furnished to do so, subject to the following conditions:

    The above copyright notice and this permission notice shall be included in all
    copies or substantial portions of the Software.

    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE

This software includes loglevel under the following license.

    Copyright (c) 2013 Tim Perry

    Permission is hereby granted, free of charge, to any person
    obtaining a copy of this software and associated documentation
    files (the "Software"), to deal in the Software without
    restriction, including without limitation the rights to use,
    copy, modify, merge, publish, distribute, sublicense, and/or sell
    copies of the Software, and to permit persons to whom the
    Software is furnished to do so, subject to the following
    conditions:

    The above copyright notice and this permission notice shall be
    included in all copies or substantial portions of the Software.

    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
    EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
    OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
    NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
    HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
    WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
    FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
    OTHER DEALINGS IN THE SOFTWARE.

This software includes q under the following license.

    Copyright 20092014 Kristopher Michael Kowal. All rights reserved.
    Permission is hereby granted, free of charge, to any person obtaining a copy
    of this software and associated documentation files (the "Software"), to
    deal in the Software without restriction, including without limitation the
    rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
    sell copies of the Software, and to permit persons to whom the Software is
    furnished to do so, subject to the following conditions:

    The above copyright notice and this permission notice shall be included in
    all copies or substantial portions of the Software.

    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
    FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
    IN THE SOFTWARE.

This software includes platform.js under the following license.

    Copyright 2014 Benjamin Tan <https://d10.github.io/>
    Copyright 2011-2015 John-David Dalton <http://allyoucanleet.com/>

    Permission is hereby granted, free of charge, to any person obtaining
    a copy of this software and associated documentation files (the
    "Software"), to deal in the Software without restriction, including
    without limitation the rights to use, copy, modify, merge, publish,
    distribute, sublicense, and/or sell copies of the Software, and to
    permit persons to whom the Software is furnished to do so, subject to
    the following conditions:

    The above copyright notice and this permission notice shall be
    included in all copies or substantial portions of the Software.

    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
    EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
    MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
    NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
    LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
    OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
    WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

*/(function(e){Object.defineProperty(e,"__esModule",{value:!0});var n=Ri.exports,r=Na.exports,t=Qn.exports,a=Xn.exports,i=Zn.exports,s=Yr.exports,l=ta.exports,c=ra.exports,h=Gs,g=ea.exports,b=Oi.exports,$=fP,S=Pt,R=Td,N=nf.exports,M=Hs.exports,W=mn,z=Do,me=kS,le=Zt,De=WS,$e=zs.exports,Pe=Fo;function L(_){return _&&typeof _=="object"&&"default"in _?_:{default:_}}function ue(_){if(_&&_.__esModule)return _;var T=Object.create(null);return _&&Object.keys(_).forEach(function(y){if(y!=="default"){var p=Object.getOwnPropertyDescriptor(_,y);Object.defineProperty(T,y,p.get?p:{enumerable:!0,get:function(){return _[y]}})}}),T.default=_,Object.freeze(T)}var x=L(n),ye=L(r),ge=L(t),Q=L(a),H=L(i),J=L(s),K=L(l),he=L(c),E=L(h),Te=L(g),ut=ue(b),ze=L(N),re=L(M),F=L($e);function q(_,T,y,p){var u=arguments.length,f=u<3?T:p===null?p=Object.getOwnPropertyDescriptor(T,y):p,o;if((typeof Reflect=="undefined"?"undefined":Te.default(Reflect))==="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(_,T,y,p);else for(var v=_.length-1;v>=0;v--)(o=_[v])&&(f=(u<3?o(f):u>3?o(T,y,f):o(T,y))||f);return u>3&&f&&Object.defineProperty(T,y,f),f}function I(_,T){if((typeof Reflect=="undefined"?"undefined":Te.default(Reflect))==="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(_,T)}function O(_,T){return["".concat(new Date().toISOString()," Conversations ").concat(_,":")].concat(Array.from(T))}var pe=ut.getLogger("twilio-conversations"),se=function(){function _(T){he.default(this,_),K.default(this,"prefix",""),this.prefix=T!=null&&T.length>0?T+" ":""}return ye.default(_,[{key:"setLevel",value:function(y){pe.setLevel(y)}},{key:"trace",value:function(){for(var y=arguments.length,p=new Array(y),u=0;u<y;u++)p[u]=arguments[u];pe.trace.apply(null,O(this.prefix+"T",p))}},{key:"debug",value:function(){for(var y=arguments.length,p=new Array(y),u=0;u<y;u++)p[u]=arguments[u];pe.debug.apply(null,O(this.prefix+"D",p))}},{key:"info",value:function(){for(var y=arguments.length,p=new Array(y),u=0;u<y;u++)p[u]=arguments[u];pe.info.apply(null,O(this.prefix+"I",p))}},{key:"warn",value:function(){for(var y=arguments.length,p=new Array(y),u=0;u<y;u++)p[u]=arguments[u];pe.warn.apply(null,O(this.prefix+"W",p))}},{key:"error",value:function(){for(var y=arguments.length,p=new Array(y),u=0;u<y;u++)p[u]=arguments[u];pe.error.apply(null,O(this.prefix+"E",p))}}],[{key:"scope",value:function(y){return new _(y)}},{key:"setLevel",value:function(y){pe.setLevel(y)}},{key:"trace",value:function(){for(var y=arguments.length,p=new Array(y),u=0;u<y;u++)p[u]=arguments[u];pe.trace.apply(null,O("T",p))}},{key:"debug",value:function(){for(var y=arguments.length,p=new Array(y),u=0;u<y;u++)p[u]=arguments[u];pe.debug.apply(null,O("D",p))}},{key:"info",value:function(){for(var y=arguments.length,p=new Array(y),u=0;u<y;u++)p[u]=arguments[u];pe.info.apply(null,O("I",p))}},{key:"warn",value:function(){for(var y=arguments.length,p=new Array(y),u=0;u<y;u++)p[u]=arguments[u];pe.warn.apply(null,O("W",p))}},{key:"error",value:function(){for(var y=arguments.length,p=new Array(y),u=0;u<y;u++)p[u]=arguments[u];pe.error.apply(null,O("E",p))}}]),_}();function _e(_,T){var y=Object.keys(_);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(_);T&&(p=p.filter(function(u){return Object.getOwnPropertyDescriptor(_,u).enumerable})),y.push.apply(y,p)}return y}function Ge(_){for(var T=1;T<arguments.length;T++){var y=arguments[T]!=null?arguments[T]:{};T%2?_e(Object(y),!0).forEach(function(p){K.default(_,p,y[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_,Object.getOwnPropertyDescriptors(y)):_e(Object(y)).forEach(function(p){Object.defineProperty(_,p,Object.getOwnPropertyDescriptor(y,p))})}return _}var fe=5,Ee="PT5S",ke="PT5S",Z=100,Ce=1e3,Ie=4e3,oe=3,lr=!0,xe=function _(){var T,y,p,u,f,o,v=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d=arguments.length>1?arguments[1]:void 0,m=arguments.length>2?arguments[2]:void 0;he.default(this,_),K.default(this,"typingIndicatorTimeoutDefault",fe*1e3);var w=v.Chat||v.IPMessaging||v||{};this.productId=w.productId,this.links={myConversations:d.links.my_conversations,conversations:d.links.conversations,users:d.links.users,currentUser:d.links.current_user,typing:d.links.typing,mediaService:d.links.media_service,mediaSetService:d.links.media_set_service,messagesReceipts:d.links.messages_receipts},this.limits={mediaAttachmentsCountLimit:d.options.media_attachments_count_limit,mediaAttachmentSizeLimitInMb:d.options.media_attachment_size_limit_in_mb,mediaAttachmentsTotalSizeLimitInMb:d.options.media_attachments_total_size_limit_in_mb,emailHistoriesAllowedMimeTypes:d.options.email_histories_allowed_mime_types,emailBodiesAllowedMimeTypes:d.options.email_bodies_allowed_mime_types},this.typingIndicatorTimeoutOverride=w.typingIndicatorTimeoutOverride,this.backoffConfiguration=Ge({min:Ce,max:Ie,maxAttemptsCount:oe},w.backoffConfigOverride),this.retryWhenThrottled=w.retryWhenThrottledOverride!==void 0?w.retryWhenThrottledOverride:lr,this.userInfosToSubscribe=(T=(y=w.userInfosToSubscribeOverride)!==null&&y!==void 0?y:d.options.user_infos_to_subscribe)!==null&&T!==void 0?T:Z,this.reachabilityEnabled=d.options.reachability_enabled,this.userIdentity=d.identity,this.userInfo=d.sync_objects.my_user_info,this.myConversations=d.sync_objects.my_conversations;var C=(p=(u=w.httpCacheIntervalOverride)!==null&&u!==void 0?u:d.options.http_cache_interval)!==null&&p!==void 0?p:Ee;try{this.httpCacheInterval=$.toSeconds($.parse(C))}catch{m.error("Failed to parse http cache interval ".concat(C,", using default value ").concat(Ee)),this.httpCacheInterval=$.toSeconds($.parse(Ee))}var P=(f=(o=w.consumptionReportIntervalOverride)!==null&&o!==void 0?o:d.options.consumption_report_interval)!==null&&f!==void 0?f:ke;try{this.consumptionReportInterval=$.toSeconds($.parse(P))}catch{m.error("Failed to parse consumption report interval ".concat(P,", using default value ").concat(ke)),this.consumptionReportInterval=$.toSeconds($.parse(ke))}};function Rt(_){return JSON.parse(JSON.stringify(_))}function fr(_){return typeof _!="undefined"&&!isNaN(Number(_))?Number(_):null}function ve(_){try{return new Date(_)}catch{return null}}function qt(_,T,y){var p={};if(_)try{p=JSON.parse(_)}catch(u){y.warn(T,u)}return p}var xt=function(){function _(T){he.default(this,_),this.base=T.replace(/\/$/,""),this.args=[],this.paths=[]}return ye.default(_,[{key:"arg",value:function(y,p){return typeof p!="undefined"&&this.args.push(encodeURIComponent(y)+"="+encodeURIComponent(p)),this}},{key:"path",value:function(y){return this.paths.push(encodeURIComponent(y)),this}},{key:"build",value:function(){var y=this.base;return this.paths.length&&(y+="/"+this.paths.join("/")),this.args.length&&(y+="?"+this.args.join("&")),y}}]),_}(),Je=S.custom(function(_){return[["string","number","boolean","object"].includes(Te.default(_)),"a JSON type"]}),pt=S.custom(function(_){return[["undefined","string","number","boolean","object"].includes(Te.default(_)),"an optional JSON type"]});function Ve(_){var T=je();return function(){var p=J.default(_),u;if(T){var f=J.default(this).constructor;u=Reflect.construct(p,arguments,f)}else u=p.apply(this,arguments);return H.default(this,u)}}function je(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var vt=se.scope("User"),Et=function(_){Q.default(y,_);var T=Ve(y);function y(p,u,f,o){var v;return he.default(this,y),v=T.call(this),K.default(ge.default(v),"promiseToFetch",null),K.default(ge.default(v),"updated","updated"),K.default(ge.default(v),"userSubscribed","userSubscribed"),K.default(ge.default(v),"userUnsubscribed","userUnsubscribed"),v.services=o,v.subscribed="initializing",v.setMaxListeners(0),v.state={identity:p,entityName:u,friendlyName:null,attributes:{},online:null,notifiable:null},v._initializationPromise=new Promise(function(d){v._resolveInitializationPromise=d}),f!==null&&v._resolveInitialization(f,p,u,!1),v}return ye.default(y,[{key:"identity",get:function(){return this.state.identity},set:function(u){this.state.identity=u}},{key:"entityName",set:function(u){this.state.entityName=u}},{key:"attributes",get:function(){return this.state.attributes}},{key:"friendlyName",get:function(){return this.state.friendlyName}},{key:"isOnline",get:function(){return this.state.online}},{key:"isNotifiable",get:function(){return this.state.notifiable}},{key:"isSubscribed",get:function(){return this.subscribed=="subscribed"}},{key:"_update",value:function(){var p=x.default(E.default.mark(function f(o,v){var d,m;return E.default.wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return C.next=2,this._initializationPromise;case 2:d=[],vt.debug("User for",this.state.identity,"updated:",o,v),C.t0=o,C.next=C.t0==="friendlyName"?7:C.t0==="attributes"?9:C.t0==="reachability"?12:15;break;case 7:return this.state.friendlyName!==v.value&&(d.push("friendlyName"),this.state.friendlyName=v.value),C.abrupt("break",16);case 9:return m=qt(v.value,"Retrieved malformed attributes from the server for user: ".concat(this.state.identity),vt),ze.default(this.state.attributes,m)||(this.state.attributes=m,d.push("attributes")),C.abrupt("break",16);case 12:return this.state.online!==v.online&&(this.state.online=v.online,d.push("reachabilityOnline")),this.state.notifiable!==v.notifiable&&(this.state.notifiable=v.notifiable,d.push("reachabilityNotifiable")),C.abrupt("break",16);case 15:return C.abrupt("return");case 16:d.length>0&&this.emit("updated",{user:this,updateReasons:d});case 17:case"end":return C.stop()}},f,this)}));function u(f,o){return p.apply(this,arguments)}return u}()},{key:"_updateReachabilityInfo",value:function(){var p=x.default(E.default.mark(function f(o,v){var d=this;return E.default.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return w.next=2,this._initializationPromise;case 2:if(this.configuration.reachabilityEnabled){w.next=4;break}return w.abrupt("return",Promise.resolve());case 4:return w.abrupt("return",o.get("reachability").then(v).catch(function(C){vt.warn("Failed to get reachability info for ",d.state.identity,C)}));case 5:case"end":return w.stop()}},f,this)}));function u(f,o){return p.apply(this,arguments)}return u}()},{key:"_fetch",value:function(){var p=x.default(E.default.mark(function f(){var o=this;return E.default.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,this._initializationPromise;case 2:if(this.state.entityName){d.next=4;break}return d.abrupt("return",this);case 4:return this.promiseToFetch=this.services.syncClient.map({id:this.state.entityName,mode:"open_existing",includeItems:!0}).then(function(m){return o.entity=m,m.on("itemUpdated",function(w){return vt.debug(o.state.entityName+" ("+o.state.identity+") itemUpdated: "+w.item.key),o._update(w.item.key,w.item.data)}),Promise.all([m.get("friendlyName").then(function(w){return o._update(w.key,w.data)}),m.get("attributes").then(function(w){return o._update(w.key,w.data)}),o._updateReachabilityInfo(m,function(w){return o._update(w.key,w.data)})])}).then(function(){return vt.debug("Fetched for",o.identity),o.subscribed="subscribed",o.emit("userSubscribed",o),o}).catch(function(m){throw o.promiseToFetch=null,m}),d.abrupt("return",this.promiseToFetch);case 6:case"end":return d.stop()}},f,this)}));function u(){return p.apply(this,arguments)}return u}()},{key:"_ensureFetched",value:function(){var p=x.default(E.default.mark(function f(){return E.default.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,this._initializationPromise;case 2:return v.abrupt("return",this.promiseToFetch||this._fetch());case 3:case"end":return v.stop()}},f,this)}));function u(){return p.apply(this,arguments)}return u}()},{key:"updateAttributes",value:function(){var p=x.default(E.default.mark(function f(o){return E.default.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,this._initializationPromise;case 2:if(this.subscribed!="unsubscribed"){d.next=4;break}throw new Error("Can't modify unsubscribed object");case 4:return d.next=6,this.services.commandExecutor.mutateResource("post",this.links.self,{attributes:JSON.stringify(o)});case 6:return d.abrupt("return",this);case 7:case"end":return d.stop()}},f,this)}));function u(f){return p.apply(this,arguments)}return u}()},{key:"updateFriendlyName",value:function(){var p=x.default(E.default.mark(function f(o){return E.default.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,this._initializationPromise;case 2:if(this.subscribed!="unsubscribed"){d.next=4;break}throw new Error("Can't modify unsubscribed object");case 4:return d.next=6,this.services.commandExecutor.mutateResource("post",this.links.self,{friendly_name:o});case 6:return d.abrupt("return",this);case 7:case"end":return d.stop()}},f,this)}));function u(f){return p.apply(this,arguments)}return u}()},{key:"unsubscribe",value:function(){var p=x.default(E.default.mark(function f(){return E.default.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,this._initializationPromise;case 2:if(!this.promiseToFetch){v.next=9;break}return v.next=5,this.promiseToFetch;case 5:this.entity.close(),this.promiseToFetch=null,this.subscribed="unsubscribed",this.emit("userUnsubscribed",this);case 9:case"end":return v.stop()}},f,this)}));function u(){return p.apply(this,arguments)}return u}()},{key:"_resolveInitialization",value:function(u,f,o,v){this.configuration=u,this.identity=f,this.entityName=o,this.links={self:"".concat(this.configuration.links.users,"/").concat(this.identity)},this._resolveInitializationPromise(),v&&this.emit("updated",{user:this,updateReasons:["friendlyName","attributes","reachabilityOnline","reachabilityNotifiable"]})}}]),y}(R.ReplayEventEmitter);q([S.validateTypesAsync(Je),I("design:type",Function),I("design:paramtypes",[Object]),I("design:returntype",Promise)],Et.prototype,"updateAttributes",null),q([S.validateTypesAsync(["string"]),I("design:type",Function),I("design:paramtypes",[String]),I("design:returntype",Promise)],Et.prototype,"updateFriendlyName",null);function bn(_,T){var y=typeof Symbol!="undefined"&&_[Symbol.iterator]||_["@@iterator"];if(!y){if(Array.isArray(_)||(y=wn(_))||T&&_&&typeof _.length=="number"){y&&(_=y);var p=0,u=function(){};return{s:u,n:function(){return p>=_.length?{done:!0}:{done:!1,value:_[p++]}},e:function(m){throw m},f:u}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var f=!0,o=!1,v;return{s:function(){y=y.call(_)},n:function(){var m=y.next();return f=m.done,m},e:function(m){o=!0,v=m},f:function(){try{!f&&y.return!=null&&y.return()}finally{if(o)throw v}}}}function wn(_,T){if(!!_){if(typeof _=="string")return Sn(_,T);var y=Object.prototype.toString.call(_).slice(8,-1);if(y==="Object"&&_.constructor&&(y=_.constructor.name),y==="Map"||y==="Set")return Array.from(_);if(y==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(y))return Sn(_,T)}}function Sn(_,T){(T==null||T>_.length)&&(T=_.length);for(var y=0,p=new Array(T);y<T;y++)p[y]=_[y];return p}var $n=function(){function _(T,y){he.default(this,_),this.configuration=T,this.services=y,this.cache=new Map,this.cacheLifetime=this.configuration.httpCacheInterval*100,this.cleanupCache()}return ye.default(_,[{key:"isExpired",value:function(y){return!this.cacheLifetime||Date.now()-y>this.cacheLifetime}},{key:"cleanupCache",value:function(){var y=bn(this.cache),p;try{for(y.s();!(p=y.n()).done;){var u=re.default(p.value,2),f=u[0],o=u[1];this.isExpired(o.timestamp)&&this.cache.delete(f)}}catch(v){y.e(v)}finally{y.f()}this.cache.size===0&&clearInterval(this.timer)}},{key:"pokeTimer",value:function(){var y=this;this.timer=this.timer||setInterval(function(){return y.cleanupCache()},this.cacheLifetime*2)}},{key:"executeWithRetry",value:function(y){var p=this,u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return new Promise(function(f,o){var v=[502,503,504];u&&v.push(429);var d=new W.Retrier(p.configuration.backoffConfiguration);d.on("attempt",function(){y().then(function(m){return d.succeeded(m)}).catch(function(m){v.indexOf(m.status)>-1||m.message==="Twilsock disconnected"?d.failed(m):(d.removeAllListeners(),d.cancel(),o(m))})}),d.on("succeeded",function(m){f(m)}),d.on("cancelled",function(m){return o(m)}),d.on("failed",function(m){return o(m)}),d.start()})}},{key:"get",value:function(){var T=x.default(E.default.mark(function p(u){var f=this,o,v,d;return E.default.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:if(o=this.cache.get(u),!(o&&!this.isExpired(o.timestamp))){w.next=3;break}return w.abrupt("return",o.response);case 3:return v={},w.next=6,this.executeWithRetry(function(){return f.services.transport.get(u,v,f.configuration.productId)},this.configuration.retryWhenThrottled);case 6:return d=w.sent,this.cache.set(u,{response:d,timestamp:Date.now()}),this.pokeTimer(),w.abrupt("return",d);case 10:case"end":return w.stop()}},p,this)}));function y(p){return T.apply(this,arguments)}return y}()}]),_}(),at=function _(){he.default(this,_)};K.default(at,"TYPING_INDICATOR","twilio.ipmsg.typing_indicator"),K.default(at,"NEW_MESSAGE","twilio.conversations.new_message"),K.default(at,"ADDED_TO_CONVERSATION","twilio.conversations.added_to_conversation"),K.default(at,"REMOVED_FROM_CONVERSATION","twilio.conversations.removed_from_conversation"),K.default(at,"CONSUMPTION_UPDATE","twilio.channel.consumption_update");function Rr(_){var T=V();return function(){var p=J.default(_),u;if(T){var f=J.default(this).constructor;u=Reflect.construct(p,arguments,f)}else u=p.apply(this,arguments);return H.default(this,u)}}function V(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Y=se.scope("Participant"),D=function(_){Q.default(y,_);var T=Rr(y);function y(p,u,f,o,v){var d,m,w;if(he.default(this,y),w=T.call(this),w.conversation=f,w.links=o,w.services=v,w.state={attributes:qt(p.attributes,"Retrieved malformed attributes from the server for participant: "+u,Y),dateCreated:p.dateCreated?ve(p.dateCreated):null,dateUpdated:p.dateCreated?ve(p.dateUpdated):null,sid:u,typingTimeout:null,isTyping:!1,identity:p.identity,roleSid:(d=p.roleSid)!==null&&d!==void 0?d:"",lastReadMessageIndex:Number.isInteger(p.lastConsumedMessageIndex)?p.lastConsumedMessageIndex:null,lastReadTimestamp:p.lastConsumptionTimestamp?ve(p.lastConsumptionTimestamp):null,type:p.type||"chat",userInfo:p.userInfo,bindings:(m=p.bindings)!==null&&m!==void 0?m:{}},!p.identity&&!p.type)throw new Error("Received invalid Participant object from server: Missing identity or type of Participant.");return w}return ye.default(y,[{key:"sid",get:function(){return this.state.sid}},{key:"attributes",get:function(){return this.state.attributes}},{key:"dateCreated",get:function(){return this.state.dateCreated}},{key:"dateUpdated",get:function(){return this.state.dateUpdated}},{key:"identity",get:function(){return this.state.identity}},{key:"isTyping",get:function(){return this.state.isTyping}},{key:"lastReadMessageIndex",get:function(){return this.state.lastReadMessageIndex}},{key:"lastReadTimestamp",get:function(){return this.state.lastReadTimestamp}},{key:"roleSid",get:function(){return this.state.roleSid}},{key:"type",get:function(){return this.state.type}},{key:"bindings",get:function(){var u;return(u=this.state.bindings)!==null&&u!==void 0?u:{}}},{key:"_startTyping",value:function(u){var f=this;return this.state.typingTimeout&&clearTimeout(this.state.typingTimeout),this.state.isTyping=!0,this.emit("typingStarted",this),this.conversation.emit("typingStarted",this),this.state.typingTimeout=Number(setTimeout(function(){return f._endTyping()},u)),this}},{key:"_endTyping",value:function(){!this.state.typingTimeout||(this.state.isTyping=!1,this.emit("typingEnded",this),this.conversation.emit("typingEnded",this),clearInterval(this.state.typingTimeout),this.state.typingTimeout=null)}},{key:"_update",value:function(u){var f=[],o=qt(u.attributes,"Retrieved malformed attributes from the server for participant: "+this.state.sid,Y);u.attributes&&!ze.default(this.state.attributes,o)&&(this.state.attributes=o,f.push("attributes"));var v=ve(u.dateUpdated);u.dateUpdated&&(v==null?void 0:v.getTime())!==(this.state.dateUpdated&&this.state.dateUpdated.getTime())&&(this.state.dateUpdated=v,f.push("dateUpdated"));var d=ve(u.dateCreated);if(u.dateCreated&&(d==null?void 0:d.getTime())!==(this.state.dateCreated&&this.state.dateCreated.getTime())&&(this.state.dateCreated=d,f.push("dateCreated")),u.roleSid&&this.state.roleSid!==u.roleSid&&(this.state.roleSid=u.roleSid,f.push("roleSid")),(Number.isInteger(u.lastConsumedMessageIndex)||u.lastConsumedMessageIndex===null)&&this.state.lastReadMessageIndex!==u.lastConsumedMessageIndex&&(this.state.lastReadMessageIndex=u.lastConsumedMessageIndex,f.push("lastReadMessageIndex")),u.lastConsumptionTimestamp){var m=new Date(u.lastConsumptionTimestamp);(!this.state.lastReadTimestamp||this.state.lastReadTimestamp.getTime()!==m.getTime())&&(this.state.lastReadTimestamp=m,f.push("lastReadTimestamp"))}return u.bindings&&!ze.default(this.state.bindings,u.bindings)&&(this.state.bindings=u.bindings,f.push("bindings")),f.length>0&&this.emit("updated",{participant:this,updateReasons:f}),this}},{key:"getUser",value:function(){var p=x.default(E.default.mark(function f(){return E.default.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(this.type=="chat"){v.next=2;break}throw new Error("Getting User is not supported for this Participant type: "+this.type);case 2:return v.abrupt("return",this.services.users.getUser(this.state.identity,this.state.userInfo));case 3:case"end":return v.stop()}},f,this)}));function u(){return p.apply(this,arguments)}return u}()},{key:"remove",value:function(){var p=x.default(E.default.mark(function f(){return E.default.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.abrupt("return",this.conversation.removeParticipant(this));case 1:case"end":return v.stop()}},f,this)}));function u(){return p.apply(this,arguments)}return u}()},{key:"updateAttributes",value:function(){var p=x.default(E.default.mark(function f(o){return E.default.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,this.services.commandExecutor.mutateResource("post",this.links.self,{attributes:JSON.stringify(o)});case 2:return d.abrupt("return",this);case 3:case"end":return d.stop()}},f,this)}));function u(f){return p.apply(this,arguments)}return u}()}]),y}(R.ReplayEventEmitter);K.default(D,"typingStarted","typingStarted"),K.default(D,"typingEnded","typingEnded"),K.default(D,"updated","updated"),q([S.validateTypesAsync(Je),I("design:type",Function),I("design:paramtypes",[Object]),I("design:returntype",Promise)],D.prototype,"updateAttributes",null);function G(_){var T=B();return function(){var p=J.default(_),u;if(T){var f=J.default(this).constructor;u=Reflect.construct(p,arguments,f)}else u=p.apply(this,arguments);return H.default(this,u)}}function B(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var te=se.scope("Participants"),ae=function(_){Q.default(y,_);var T=G(y);function y(p,u,f,o,v){var d;return he.default(this,y),d=T.call(this),K.default(ge.default(d),"rosterEntityPromise",null),d.conversation=p,d.participants=u,d.links=f,d.configuration=o,d.services=v,d}return ye.default(y,[{key:"unsubscribe",value:function(){var p=x.default(E.default.mark(function f(){var o;return E.default.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(!this.rosterEntityPromise){d.next=6;break}return d.next=3,this.rosterEntityPromise;case 3:o=d.sent,o.close(),this.rosterEntityPromise=null;case 6:case"end":return d.stop()}},f,this)}));function u(){return p.apply(this,arguments)}return u}()},{key:"subscribe",value:function(u){var f=this;return this.rosterEntityPromise=this.rosterEntityPromise||this.services.syncClient.map({id:u,mode:"open_existing"}).then(function(o){o.on("itemAdded",function(m){te.debug(f.conversation.sid+" itemAdded: "+m.item.key),f.upsertParticipant(m.item.key,m.item.data).then(function(w){f.emit("participantJoined",w)})}),o.on("itemRemoved",function(m){te.debug(f.conversation.sid+" itemRemoved: "+m.key);var w=m.key;if(!!f.participants.has(w)){var C=f.participants.get(w);f.participants.delete(w),C&&f.emit("participantLeft",C)}}),o.on("itemUpdated",function(m){te.debug(f.conversation.sid+" itemUpdated: "+m.item.key),f.upsertParticipant(m.item.key,m.item.data)});var v=[],d=function m(w){return w.items.forEach(function(C){v.push(f.upsertParticipant(C.key,C.data))}),w.hasNextPage?w.nextPage().then(m):null};return o.getItems().then(d).then(function(){return Promise.all(v)}).then(function(){return o})}).catch(function(o){throw f.rosterEntityPromise=null,f.services.syncClient.connectionState!="disconnected"&&te.error("Failed to get roster object for conversation",f.conversation.sid,o),te.debug("ERROR: Failed to get roster object for conversation",f.conversation.sid,o),o})}},{key:"upsertParticipant",value:function(){var p=x.default(E.default.mark(function f(o,v){var d=this,m,w;return E.default.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:if(m=this.participants.get(o),!m){P.next=3;break}return P.abrupt("return",m._update(v));case 3:return w={self:"".concat(this.links.participants,"/").concat(o)},m=new D(v,o,this.conversation,w,this.services),this.participants.set(o,m),m.on("updated",function(U){return d.emit("participantUpdated",U)}),P.abrupt("return",m);case 8:case"end":return P.stop()}},f,this)}));function u(f,o){return p.apply(this,arguments)}return u}()},{key:"getParticipants",value:function(){var p=x.default(E.default.mark(function f(){var o=this;return E.default.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.abrupt("return",this.rosterEntityPromise?this.rosterEntityPromise.then(function(){var m=[];return o.participants.forEach(function(w){return m.push(w)}),m}):[]);case 1:case"end":return d.stop()}},f,this)}));function u(){return p.apply(this,arguments)}return u}()},{key:"getParticipantBySid",value:function(){var p=x.default(E.default.mark(function f(o){var v=this;return E.default.wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.abrupt("return",this.rosterEntityPromise?this.rosterEntityPromise.then(function(){var w=v.participants.get(o);if(!w)throw new Error("Participant with SID "+o+" was not found");return w}):null);case 1:case"end":return m.stop()}},f,this)}));function u(f){return p.apply(this,arguments)}return u}()},{key:"getParticipantByIdentity",value:function(){var p=x.default(E.default.mark(function f(o){var v=this,d;return E.default.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return d=null,w.abrupt("return",this.rosterEntityPromise?this.rosterEntityPromise.then(function(){if(v.participants.forEach(function(C){C.identity===o&&(d=C)}),!d)throw new Error("Participant with identity "+o+" was not found");return d}):null);case 2:case"end":return w.stop()}},f,this)}));function u(f){return p.apply(this,arguments)}return u}()},{key:"add",value:function(){var p=x.default(E.default.mark(function f(o,v){return E.default.wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,this.services.commandExecutor.mutateResource("post",this.links.participants,{identity:o,attributes:typeof v!="undefined"?JSON.stringify(v):void 0});case 2:return m.abrupt("return",m.sent);case 3:case"end":return m.stop()}},f,this)}));function u(f,o){return p.apply(this,arguments)}return u}()},{key:"addNonChatParticipant",value:function(u,f){var o,v,d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},m=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return this.services.commandExecutor.mutateResource("post",this.links.participants,{attributes:typeof d!="undefined"?JSON.stringify(d):void 0,messaging_binding:{address:f,proxy_address:u,name:m==null||(o=m.email)===null||o===void 0?void 0:o.name,level:m==null||(v=m.email)===null||v===void 0?void 0:v.level}})}},{key:"remove",value:function(u){return this.services.commandExecutor.mutateResource("delete","".concat(this.links.participants,"/").concat(u))}}]),y}(R.ReplayEventEmitter),de=function(){function _(T,y){he.default(this,_),K.default(this,"mcsMedia",null),this.services=y,T instanceof De.McsMedia&&(this.mcsMedia=T),this.state={sid:T.sid,category:T.category,filename:T.filename,contentType:T.contentType,size:T.size}}return ye.default(_,[{key:"sid",get:function(){return this.state.sid}},{key:"filename",get:function(){return this.state.filename}},{key:"contentType",get:function(){return this.state.contentType}},{key:"size",get:function(){return this.state.size}},{key:"category",get:function(){return this.state.category}},{key:"getContentTemporaryUrl",value:function(){var T=x.default(E.default.mark(function p(){var u,f;return E.default.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,this._fetchMcsMedia();case 2:return v.abrupt("return",(u=(f=this.mcsMedia)===null||f===void 0?void 0:f.getContentUrl())!==null&&u!==void 0?u:null);case 3:case"end":return v.stop()}},p,this)}));function y(){return T.apply(this,arguments)}return y}()},{key:"getCachedTemporaryUrl",value:function(){var T=x.default(E.default.mark(function p(){var u,f;return E.default.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,this._fetchMcsMedia();case 2:return v.abrupt("return",(u=(f=this.mcsMedia)===null||f===void 0?void 0:f.getCachedContentUrl())!==null&&u!==void 0?u:null);case 3:case"end":return v.stop()}},p,this)}));function y(){return T.apply(this,arguments)}return y}()},{key:"_fetchMcsMedia",value:function(){var T=x.default(E.default.mark(function p(){return E.default.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(this.mcsMedia){f.next=8;break}if(!this.services.mcsClient){f.next=7;break}return f.next=4,this.services.mcsClient.get(this.state.sid);case 4:this.mcsMedia=f.sent,f.next=8;break;case 7:throw new Error("Media Content Service is unavailable");case 8:case"end":return f.stop()}},p,this)}));function y(){return T.apply(this,arguments)}return y}()}]),_}(),Ae=function(){function _(T){he.default(this,_),this.state=T}return ye.default(_,[{key:"total",get:function(){return this.state.total}},{key:"sent",get:function(){return this.state.sent}},{key:"delivered",get:function(){return this.state.delivered}},{key:"read",get:function(){return this.state.read}},{key:"undelivered",get:function(){return this.state.undelivered}},{key:"failed",get:function(){return this.state.failed}},{key:"_update",value:function(y){this.state=y}},{key:"_isEquals",value:function(y){var p=this.total===y.total,u=this.sent===y.sent,f=this.delivered===y.delivered,o=this.read===y.read,v=this.undelivered===y.undelivered,d=this.failed===y.failed;return p&&u&&f&&o&&v&&d}}]),_}(),Fe=function(){function _(T,y,p,u){he.default(this,_),this.state={prevToken:p,nextToken:u,source:y,items:T}}return ye.default(_,[{key:"hasNextPage",get:function(){return!!this.state.nextToken}},{key:"hasPrevPage",get:function(){return!!this.state.prevToken}},{key:"items",get:function(){return this.state.items}},{key:"nextPage",value:function(){return this.hasNextPage?this.state.source(this.state.nextToken):Promise.reject(new Error("No next page"))}},{key:"prevPage",value:function(){return this.hasPrevPage?this.state.source(this.state.prevToken):Promise.reject(new Error("No previous page"))}}]),_}(),Me=function _(T){he.default(this,_),this.sid=T.sid,this.messageSid=T.message_sid,this.conversationSid=T.conversation_sid,this.channelMessageSid=T.channel_message_sid,this.participantSid=T.participant_sid,this.status=T.status||"queued",this.errorCode=T.error_code||0,this.dateCreated=T.date_created,this.dateUpdated=T.date_updated};function be(_){var T=Wt();return function(){var p=J.default(_),u;if(T){var f=J.default(this).constructor;u=Reflect.construct(p,arguments,f)}else u=p.apply(this,arguments);return H.default(this,u)}}function Wt(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Oe=se.scope("Message"),bt=function(_){Q.default(y,_);var T=be(y);function y(p,u,f,o,v,d){var m,w,C,P,U;return he.default(this,y),U=T.call(this),U.conversation=f,U.links=o,U.configuration=v,U.services=d,U.state={sid:u.sid,index:p,author:u.author,subject:u.subject,body:(m=u.text)!==null&&m!==void 0?m:null,timestamp:u.timestamp?new Date(u.timestamp):null,dateUpdated:u.dateUpdated?new Date(u.dateUpdated):null,lastUpdatedBy:(w=u.lastUpdatedBy)!==null&&w!==void 0?w:null,attributes:qt(u.attributes,"Got malformed attributes for the message ".concat(u.sid),Oe),type:(C=u.type)!==null&&C!==void 0?C:"text",media:u.type&&u.type==="media"&&u.media?new de(u.media,U.services):null,medias:u.type&&u.type==="media"&&u.medias?u.medias.map(function(ee){return new de(ee,U.services)}):null,participantSid:(P=u.memberSid)!==null&&P!==void 0?P:null,aggregatedDeliveryReceipt:u.delivery?new Ae(u.delivery):null},U}return ye.default(y,[{key:"sid",get:function(){return this.state.sid}},{key:"author",get:function(){return this.state.author}},{key:"subject",get:function(){return this.state.subject}},{key:"body",get:function(){return this.state.body}},{key:"dateUpdated",get:function(){return this.state.dateUpdated}},{key:"index",get:function(){return this.state.index}},{key:"lastUpdatedBy",get:function(){return this.state.lastUpdatedBy}},{key:"dateCreated",get:function(){return this.state.timestamp}},{key:"attributes",get:function(){return this.state.attributes}},{key:"type",get:function(){return this.state.type}},{key:"media",get:function(){return this.state.media}},{key:"attachedMedia",get:function(){return this.getMediaByCategory(["media"])}},{key:"participantSid",get:function(){return this.state.participantSid}},{key:"aggregatedDeliveryReceipt",get:function(){return this.state.aggregatedDeliveryReceipt}},{key:"getMediaByCategory",value:function(u){var f;return((f=this.state.medias)!==null&&f!==void 0?f:[]).filter(function(o){return u.includes(o.category)})}},{key:"getEmailBody",value:function(){var u,f,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"text/plain";return(u=(f=this.getMediaByCategory(["body"]))===null||f===void 0?void 0:f.filter(function(v){return v.contentType==o}).shift())!==null&&u!==void 0?u:null}},{key:"getEmailHistory",value:function(){var u,f,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"text/plain";return(u=(f=this.getMediaByCategory(["history"]))===null||f===void 0?void 0:f.filter(function(v){return v.contentType==o}).shift())!==null&&u!==void 0?u:null}},{key:"_update",value:function(u){var f=[];(u.text||typeof u.text=="string")&&u.text!==this.state.body&&(this.state.body=u.text,f.push("body")),u.subject&&u.subject!==this.state.subject&&(this.state.subject=u.subject,f.push("subject")),u.lastUpdatedBy&&u.lastUpdatedBy!==this.state.lastUpdatedBy&&(this.state.lastUpdatedBy=u.lastUpdatedBy,f.push("lastUpdatedBy")),u.author&&u.author!==this.state.author&&(this.state.author=u.author,f.push("author")),u.dateUpdated&&new Date(u.dateUpdated).getTime()!==(this.state.dateUpdated&&this.state.dateUpdated.getTime())&&(this.state.dateUpdated=new Date(u.dateUpdated),f.push("dateUpdated")),u.timestamp&&new Date(u.timestamp).getTime()!==(this.state.timestamp&&this.state.timestamp.getTime())&&(this.state.timestamp=new Date(u.timestamp),f.push("dateCreated"));var o=qt(u.attributes,"Got malformed attributes for the message ".concat(this.sid),Oe);ze.default(this.state.attributes,o)||(this.state.attributes=o,f.push("attributes"));var v=u.delivery,d=this.state.aggregatedDeliveryReceipt,m=!!v&&!!v.total&&!!v.delivered&&!!v.failed&&!!v.read&&!!v.sent&&!!v.undelivered;m&&(d?d._isEquals(v)||(d._update(v),f.push("deliveryReceipt")):(this.state.aggregatedDeliveryReceipt=new Ae(v),f.push("deliveryReceipt"))),f.length>0&&this.emit("updated",{message:this,updateReasons:f})}},{key:"getParticipant",value:function(){var p=x.default(E.default.mark(function f(){var o=this,v,d;return E.default.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:if(v=null,!this.state.participantSid){w.next=5;break}return w.next=4,this.conversation.getParticipantBySid(this.state.participantSid).catch(function(){return Oe.debug('Participant with sid "'.concat(o.participantSid,'" not found for message ').concat(o.sid)),null});case 4:v=w.sent;case 5:if(!(!v&&this.state.author)){w.next=9;break}return w.next=8,this.conversation.getParticipantByIdentity(this.state.author).catch(function(){return Oe.debug('Participant with identity "'.concat(o.author,'" not found for message ').concat(o.sid)),null});case 8:v=w.sent;case 9:if(!v){w.next=11;break}return w.abrupt("return",v);case 11:throw d="Participant with ",this.state.participantSid&&(d+="SID '"+this.state.participantSid+"' "),this.state.author&&(this.state.participantSid&&(d+="or "),d+="identity '"+this.state.author+"' "),d==="Participant with "&&(d="Participant "),d+="was not found",new Error(d);case 17:case"end":return w.stop()}},f,this)}));function u(){return p.apply(this,arguments)}return u}()},{key:"getDetailedDeliveryReceipts",value:function(){var p=x.default(E.default.mark(function f(){var o,v;return E.default.wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,this._getDetailedDeliveryReceiptsPaginator();case 2:o=m.sent,v=[];case 4:if(v=[].concat(F.default(v),F.default(o.items)),o.hasNextPage){m.next=8;break}return m.abrupt("break",13);case 8:return m.next=10,o.nextPage();case 10:o=m.sent,m.next=4;break;case 13:return m.abrupt("return",v);case 14:case"end":return m.stop()}},f,this)}));function u(){return p.apply(this,arguments)}return u}()},{key:"remove",value:function(){var p=x.default(E.default.mark(function f(){return E.default.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,this.services.commandExecutor.mutateResource("delete",this.links.self);case 2:return v.abrupt("return",this);case 3:case"end":return v.stop()}},f,this)}));function u(){return p.apply(this,arguments)}return u}()},{key:"updateBody",value:function(){var p=x.default(E.default.mark(function f(o){return E.default.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,this.services.commandExecutor.mutateResource("post",this.links.self,{body:o});case 2:return d.abrupt("return",this);case 3:case"end":return d.stop()}},f,this)}));function u(f){return p.apply(this,arguments)}return u}()},{key:"updateAttributes",value:function(){var p=x.default(E.default.mark(function f(o){return E.default.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,this.services.commandExecutor.mutateResource("post",this.links.self,{attributes:typeof o!="undefined"?JSON.stringify(o):void 0});case 2:return d.abrupt("return",this);case 3:case"end":return d.stop()}},f,this)}));function u(f){return p.apply(this,arguments)}return u}()},{key:"attachTemporaryUrlsFor",value:function(){var p=x.default(E.default.mark(function f(o){var v=this,d;return E.default.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:if(d=o==null?void 0:o.map(function(C){return C.sid}),!(this.services.mcsClient&&d)){w.next=7;break}return w.next=4,this.services.mcsClient.mediaSetGet(d);case 4:return w.abrupt("return",w.sent.map(function(C){return new de(C,v.services)}));case 7:throw new Error("Media Content Service is unavailable");case 8:case"end":return w.stop()}},f,this)}));function u(f){return p.apply(this,arguments)}return u}()},{key:"_getDetailedDeliveryReceiptsPaginator",value:function(){var p=x.default(E.default.mark(function f(o){var v=this,d,m,w;return E.default.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return d=this.configuration.links.messagesReceipts.replace("%s",this.conversation.sid).replace("%s",this.sid),m=new xt(d).arg("PageToken",o==null?void 0:o.pageToken).arg("PageSize",o==null?void 0:o.pageSize).build(),P.next=4,this.services.network.get(m);case 4:return w=P.sent,P.abrupt("return",new Fe(w.body.delivery_receipts.map(function(U){return new Me(U)}),function(U,ee){return v._getDetailedDeliveryReceiptsPaginator({pageToken:U,pageSize:ee})},w.body.meta.previous_token,w.body.meta.next_token));case 6:case"end":return P.stop()}},f,this)}));function u(f){return p.apply(this,arguments)}return u}()}]),y}(R.ReplayEventEmitter);K.default(bt,"updated","updated"),q([S.validateTypes([S.nonEmptyString,"undefined"]),I("design:type",Function),I("design:paramtypes",[Object]),I("design:returntype",de)],bt.prototype,"getEmailBody",null),q([S.validateTypes([S.nonEmptyString,"undefined"]),I("design:type",Function),I("design:paramtypes",[Object]),I("design:returntype",de)],bt.prototype,"getEmailHistory",null),q([S.validateTypesAsync("string"),I("design:type",Function),I("design:paramtypes",[String]),I("design:returntype",Promise)],bt.prototype,"updateBody",null),q([S.validateTypesAsync(Je),I("design:type",Function),I("design:paramtypes",[Object]),I("design:returntype",Promise)],bt.prototype,"updateAttributes",null),q([S.validateTypesAsync(S.custom(function(_){return[_ instanceof Array&&_.length>0&&_.reduce(function(T,y){return T&&y instanceof de},!0),"a non-empty array of Media"]})),I("design:type",Function),I("design:paramtypes",[Array]),I("design:returntype",Promise)],bt.prototype,"attachTemporaryUrlsFor",null);function ht(_,T){var y=typeof Symbol!="undefined"&&_[Symbol.iterator]||_["@@iterator"];if(!y){if(Array.isArray(_)||(y=_n(_))||T&&_&&typeof _.length=="number"){y&&(_=y);var p=0,u=function(){};return{s:u,n:function(){return p>=_.length?{done:!0}:{done:!1,value:_[p++]}},e:function(m){throw m},f:u}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var f=!0,o=!1,v;return{s:function(){y=y.call(_)},n:function(){var m=y.next();return f=m.done,m},e:function(m){o=!0,v=m},f:function(){try{!f&&y.return!=null&&y.return()}finally{if(o)throw v}}}}function _n(_,T){if(!!_){if(typeof _=="string")return Jr(_,T);var y=Object.prototype.toString.call(_).slice(8,-1);if(y==="Object"&&_.constructor&&(y=_.constructor.name),y==="Map"||y==="Set")return Array.from(_);if(y==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(y))return Jr(_,T)}}function Jr(_,T){(T==null||T>_.length)&&(T=_.length);for(var y=0,p=new Array(T);y<T;y++)p[y]=_[y];return p}function Fr(_){var T=it();return function(){var p=J.default(_),u;if(T){var f=J.default(this).constructor;u=Reflect.construct(p,arguments,f)}else u=p.apply(this,arguments);return H.default(this,u)}}function it(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var yt=se.scope("Messages"),er=function(_){Q.default(y,_);var T=Fr(y);function y(p,u,f){var o;return he.default(this,y),o=T.call(this),o.conversation=p,o.configuration=u,o.services=f,o.messagesByIndex=new Map,o.messagesListPromise=null,o}return ye.default(y,[{key:"subscribe",value:function(){var p=x.default(E.default.mark(function f(o){var v=this,d;return E.default.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:if(!this.messagesListPromise){w.next=2;break}return w.abrupt("return",this.messagesListPromise);case 2:return this.messagesListPromise=this.services.syncClient.list({id:o,mode:"open_existing"}),w.prev=3,w.next=6,this.messagesListPromise;case 6:return d=w.sent,d.on("itemAdded",function(C){yt.debug("".concat(v.conversation.sid," itemAdded: ").concat(C.item.index));var P={self:"".concat(v.conversation.links.messages,"/").concat(C.item.data.sid),conversation:v.conversation.links.self,messages_receipts:"".concat(v.conversation.links.messages,"/").concat(C.item.data.sid,"/Receipts")},U=new bt(C.item.index,C.item.data,v.conversation,P,v.configuration,v.services);if(v.messagesByIndex.has(U.index)){yt.debug("Message arrived, but is already known and ignored",v.conversation.sid,U.index);return}v.messagesByIndex.set(U.index,U),U.on("updated",function(ee){return v.emit("messageUpdated",ee)}),v.emit("messageAdded",U)}),d.on("itemRemoved",function(C){yt.debug("#{this.conversation.sid} itemRemoved: ".concat(C.index));var P=C.index;if(v.messagesByIndex.has(P)){var U=v.messagesByIndex.get(P);if(!U)return;v.messagesByIndex.delete(U.index),U.removeAllListeners("updated"),v.emit("messageRemoved",U)}}),d.on("itemUpdated",function(C){yt.debug("".concat(v.conversation.sid," itemUpdated: ").concat(C.item.index));var P=v.messagesByIndex.get(C.item.index);P&&P._update(C.item.data)}),w.abrupt("return",d);case 13:throw w.prev=13,w.t0=w.catch(3),this.messagesListPromise=null,this.services.syncClient.connectionState!=="disconnected"&&yt.error("Failed to get messages object for conversation",this.conversation.sid,w.t0),yt.debug("ERROR: Failed to get messages object for conversation",this.conversation.sid,w.t0),w.t0;case 19:case"end":return w.stop()}},f,this,[[3,13]])}));function u(f){return p.apply(this,arguments)}return u}()},{key:"unsubscribe",value:function(){var p=x.default(E.default.mark(function f(){var o;return E.default.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(this.messagesListPromise){d.next=2;break}return d.abrupt("return");case 2:return d.next=4,this.messagesListPromise;case 4:o=d.sent,o.close(),this.messagesListPromise=null;case 7:case"end":return d.stop()}},f,this)}));function u(){return p.apply(this,arguments)}return u}()},{key:"sendV2",value:function(){var p=x.default(E.default.mark(function f(o){var v,d,m,w,C,P,U,ee,Se;return E.default.wrap(function(Re){for(;;)switch(Re.prev=Re.next){case 0:yt.debug("Sending message V2",o.mediaContent,o.attributes,o.emailOptions),d=[],m=ht(o.mediaContent),Re.prev=3,m.s();case 5:if((w=m.n()).done){Re.next=22;break}if(U=re.default(w.value,2),ee=U[0],Se=U[1],yt.debug("Adding media to a message as ".concat(Se instanceof FormData?"FormData":"SendMediaOptions"),Se),Re.t0=d,!(Se instanceof FormData)){Re.next=15;break}return Re.next=12,this.services.mcsClient.postFormData(Se,ee);case 12:Re.t1=Re.sent,Re.next=18;break;case 15:return Re.next=17,this.services.mcsClient.post((C=Se.contentType)!==null&&C!==void 0?C:"",(P=Se.media)!==null&&P!==void 0?P:"",ee,Se.filename);case 17:Re.t1=Re.sent;case 18:Re.t2=Re.t1,Re.t0.push.call(Re.t0,Re.t2);case 20:Re.next=5;break;case 22:Re.next=27;break;case 24:Re.prev=24,Re.t3=Re.catch(3),m.e(Re.t3);case 27:return Re.prev=27,m.f(),Re.finish(27);case 30:return Re.next=32,this.services.commandExecutor.mutateResource("post",this.conversation.links.messages,{body:o.text,subject:(v=o.emailOptions)===null||v===void 0?void 0:v.subject,media_sids:d.map(function(Be){return Be.sid}),attributes:typeof o.attributes!="undefined"?JSON.stringify(o.attributes):void 0});case 32:return Re.abrupt("return",Re.sent);case 33:case"end":return Re.stop()}},f,this,[[3,24,27,30]])}));function u(f){return p.apply(this,arguments)}return u}()},{key:"send",value:function(){var p=x.default(E.default.mark(function f(o){var v,d,m=arguments;return E.default.wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return v=m.length>1&&m[1]!==void 0?m[1]:{},d=m.length>2?m[2]:void 0,yt.debug("Sending text message",o,v,d),C.next=5,this.services.commandExecutor.mutateResource("post",this.conversation.links.messages,{body:o!=null?o:"",attributes:typeof v!="undefined"?JSON.stringify(v):void 0,subject:d==null?void 0:d.subject});case 5:return C.abrupt("return",C.sent);case 6:case"end":return C.stop()}},f,this)}));function u(f){return p.apply(this,arguments)}return u}()},{key:"sendMedia",value:function(){var p=x.default(E.default.mark(function f(o){var v,d,m,w,C,P=arguments;return E.default.wrap(function(ee){for(;;)switch(ee.prev=ee.next){case 0:if(m=P.length>1&&P[1]!==void 0?P[1]:{},w=P.length>2?P[2]:void 0,yt.debug("Sending media message",o,m,w),yt.debug("Sending media message as ".concat(o instanceof FormData?"FormData":"SendMediaOptions"),o,m),!(o instanceof FormData)){ee.next=10;break}return ee.next=7,this.services.mcsClient.postFormData(o);case 7:ee.t0=ee.sent,ee.next=13;break;case 10:return ee.next=12,this.services.mcsClient.post((v=o.contentType)!==null&&v!==void 0?v:"",(d=o.media)!==null&&d!==void 0?d:"","media",o.filename);case 12:ee.t0=ee.sent;case 13:return C=ee.t0,ee.next=16,this.services.commandExecutor.mutateResource("post",this.conversation.links.messages,{media_sids:[C.sid],attributes:typeof m!="undefined"?JSON.stringify(m):void 0});case 16:return ee.abrupt("return",ee.sent);case 17:case"end":return ee.stop()}},f,this)}));function u(f){return p.apply(this,arguments)}return u}()},{key:"getMessages",value:function(){var p=x.default(E.default.mark(function f(o,v){var d,m=arguments;return E.default.wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return d=m.length>2&&m[2]!==void 0?m[2]:"backwards",C.abrupt("return",this._getMessages(o,v,d));case 2:case"end":return C.stop()}},f,this)}));function u(f,o){return p.apply(this,arguments)}return u}()},{key:"_wrapPaginator",value:function(u,f,o){var v=this,d=u==="desc",m=function(){return f.nextPage().then(function(P){return v._wrapPaginator(u,P,o)})},w=function(){return f.prevPage().then(function(P){return v._wrapPaginator(u,P,o)})};return o(f.items).then(function(C){return{items:C.sort(function(P,U){return P.index-U.index}),hasPrevPage:d?f.hasNextPage:f.hasPrevPage,hasNextPage:d?f.hasPrevPage:f.hasNextPage,prevPage:d?m:w,nextPage:d?w:m}})}},{key:"_upsertMessage",value:function(u,f){var o=this,v=this.messagesByIndex.get(u);if(v)return v;var d={self:"".concat(this.conversation.links.messages,"/").concat(f.sid),conversation:this.conversation.links.self,messages_receipts:"".concat(this.conversation.links.messages,"/").concat(f.sid,"/Receipts")},m=new bt(u,f,this.conversation,d,this.configuration,this.services);return this.messagesByIndex.set(m.index,m),m.on("updated",function(w){return o.emit("messageUpdated",w)}),m}},{key:"_getMessages",value:function(){var p=x.default(E.default.mark(function f(){var o=this,v,d,m,w,C,P,U=arguments;return E.default.wrap(function(Se){for(;;)switch(Se.prev=Se.next){case 0:return v=U.length>0&&U[0]!==void 0?U[0]:30,d=U.length>1&&U[1]!==void 0?U[1]:"end",m=U.length>2&&U[2]!==void 0?U[2]:"forward",w=m==="backwards"?"desc":"asc",Se.next=6,this.messagesListPromise;case 6:return C=Se.sent,Se.next=9,C==null?void 0:C.getItems({from:d!=="end"?d:void 0,pageSize:v,order:w,limit:v});case 9:return P=Se.sent,Se.next=12,this._wrapPaginator(w,P,function(Ue){return Promise.all(Ue.map(function(Re){return o._upsertMessage(Re.index,Re.data)}))});case 12:return Se.abrupt("return",Se.sent);case 13:case"end":return Se.stop()}},f,this)}));function u(){return p.apply(this,arguments)}return u}()}]),y}(R.ReplayEventEmitter),Kt=function(){function _(T){he.default(this,_),K.default(this,"attributes",{}),K.default(this,"mediaContent",[]),K.default(this,"emailOptions",{}),this.messagesEntity=T}return ye.default(_,[{key:"send",value:function(){var T=x.default(E.default.mark(function p(){var u;return E.default.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.messagesEntity.sendV2(this);case 2:return u=o.sent,o.abrupt("return",fr(u.index));case 4:case"end":return o.stop()}},p,this)}));function y(){return T.apply(this,arguments)}return y}()}]),_}(),ia=function(){function _(T,y){he.default(this,_),this.limits=T,this.message=new Kt(y),this.emailBodies=new Map,this.emailHistories=new Map}return ye.default(_,[{key:"setBody",value:function(y){return this.message.text=y,this}},{key:"setSubject",value:function(y){return this.message.emailOptions.subject=y,this}},{key:"setAttributes",value:function(y){return this.message.attributes=y,this}},{key:"setEmailBody",value:function(y,p){return this.emailBodies.set(y,p),this}},{key:"setEmailHistory",value:function(y,p){return this.emailHistories.set(y,p),this}},{key:"addMedia",value:function(y){if(typeof FormData=="undefined"&&y instanceof FormData)throw new Error("Could not add FormData content whilst not in a browser");if(!(y instanceof FormData)){var p=y;if(!p.contentType||!p.media)throw new Error("Media content in SendMediaOptions must contain non-empty contentType and media")}return this.message.mediaContent.push(["media",y]),this}},{key:"build",value:function(){var y=this;if(this.emailBodies.forEach(function(p,u){if(!y.limits.emailBodiesAllowedMimeTypes.includes(u))throw new Error("Unsupported email body MIME type ".concat(u))}),this.emailHistories.forEach(function(p,u){if(!y.limits.emailHistoriesAllowedMimeTypes.includes(u))throw new Error("Unsupported email history MIME type ".concat(u))}),this.emailBodies.size>this.limits.emailBodiesAllowedMimeTypes.length)throw new Error("Too many email bodies attached to the message (".concat(this.emailBodies.size," > ").concat(this.limits.emailBodiesAllowedMimeTypes.length,")"));if(this.emailHistories.size>this.limits.emailHistoriesAllowedMimeTypes.length)throw new Error("Too many email histories attached to the message (".concat(this.emailHistories.size," > ").concat(this.limits.emailHistoriesAllowedMimeTypes.length,")"));if(this.message.mediaContent.length>this.limits.mediaAttachmentsCountLimit)throw new Error("Too many media attachments in the message (".concat(this.message.mediaContent.length," > ").concat(this.limits.mediaAttachmentsCountLimit,")"));return this.emailBodies.forEach(function(p){y.message.mediaContent.push(["body",p])}),this.emailHistories.forEach(function(p){y.message.mediaContent.push(["history",p])}),this.message}},{key:"getPayloadContentType",value:function(y){return typeof FormData!="undefined"&&y instanceof FormData?y.get("Content-Type"):y.contentType}}]),_}();function Da(_,T){var y=typeof Symbol!="undefined"&&_[Symbol.iterator]||_["@@iterator"];if(!y){if(Array.isArray(_)||(y=tr(_))||T&&_&&typeof _.length=="number"){y&&(_=y);var p=0,u=function(){};return{s:u,n:function(){return p>=_.length?{done:!0}:{done:!1,value:_[p++]}},e:function(m){throw m},f:u}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var f=!0,o=!1,v;return{s:function(){y=y.call(_)},n:function(){var m=y.next();return f=m.done,m},e:function(m){o=!0,v=m},f:function(){try{!f&&y.return!=null&&y.return()}finally{if(o)throw v}}}}function tr(_,T){if(!!_){if(typeof _=="string")return Fa(_,T);var y=Object.prototype.toString.call(_).slice(8,-1);if(y==="Object"&&_.constructor&&(y=_.constructor.name),y==="Map"||y==="Set")return Array.from(_);if(y==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(y))return Fa(_,T)}}function Fa(_,T){(T==null||T>_.length)&&(T=_.length);for(var y=0,p=new Array(T);y<T;y++)p[y]=_[y];return p}function Mi(_){var T=Ni();return function(){var p=J.default(_),u;if(T){var f=J.default(this).constructor;u=Reflect.construct(p,arguments,f)}else u=p.apply(this,arguments);return H.default(this,u)}}function Ni(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Ut=se.scope("Conversation"),Er={lastMessage:"lastMessage",attributes:"attributes",createdBy:"createdBy",dateCreated:"dateCreated",dateUpdated:"dateUpdated",friendlyName:"friendlyName",lastConsumedMessageIndex:"lastConsumedMessageIndex",notificationLevel:"notificationLevel",sid:"sid",status:"status",uniqueName:"uniqueName",state:"state",bindings:"bindings"};function dr(_){try{return new Date(_)}catch{return null}}var Ze=function(_){Q.default(y,_);var T=Mi(y);function y(p,u,f,o,v){var d,m;he.default(this,y),m=T.call(this),m.sid=u,m.links=f,m.configuration=o,m.services=v;var w=p.attributes||{},C=p.createdBy,P=dr(p.dateCreated),U=dr(p.dateUpdated),ee=p.friendlyName||null,Se=Number.isInteger(p.lastConsumedMessageIndex)?p.lastConsumedMessageIndex:null,Ue=p.uniqueName||null;try{JSON.stringify(w)}catch{throw new Error("Attributes must be a valid JSON object.")}m.entityName=p.channel,m.channelState={uniqueName:Ue,status:"notParticipating",attributes:w,createdBy:C,dateCreated:P,dateUpdated:U,friendlyName:ee,lastReadMessageIndex:Se,bindings:(d=p.bindings)!==null&&d!==void 0?d:{}},p.notificationLevel&&(m.channelState.notificationLevel=p.notificationLevel);var Re={participants:m.links.participants};return m.participants=new Map,m.participantsEntity=new ae(ge.default(m),m.participants,Re,m.configuration,m.services),m.participantsEntity.on("participantJoined",function(Be){return m.emit("participantJoined",Be)}),m.participantsEntity.on("participantLeft",function(Be){return m.emit("participantLeft",Be)}),m.participantsEntity.on("participantUpdated",function(Be){return m.emit("participantUpdated",Be)}),m.messagesEntity=new er(ge.default(m),o,v),m.messagesEntity.on("messageAdded",function(Be){return m._onMessageAdded(Be)}),m.messagesEntity.on("messageUpdated",function(Be){return m.emit("messageUpdated",Be)}),m.messagesEntity.on("messageRemoved",function(Be){return m.emit("messageRemoved",Be)}),m}return ye.default(y,[{key:"uniqueName",get:function(){return this.channelState.uniqueName}},{key:"status",get:function(){return this.channelState.status}},{key:"friendlyName",get:function(){return this.channelState.friendlyName}},{key:"dateUpdated",get:function(){return this.channelState.dateUpdated}},{key:"dateCreated",get:function(){return this.channelState.dateCreated}},{key:"createdBy",get:function(){var u;return(u=this.channelState.createdBy)!==null&&u!==void 0?u:""}},{key:"attributes",get:function(){return this.channelState.attributes}},{key:"lastReadMessageIndex",get:function(){return this.channelState.lastReadMessageIndex}},{key:"lastMessage",get:function(){var u;return(u=this.channelState.lastMessage)!==null&&u!==void 0?u:void 0}},{key:"notificationLevel",get:function(){var u;return(u=this.channelState.notificationLevel)!==null&&u!==void 0?u:"default"}},{key:"bindings",get:function(){return this.channelState.bindings}},{key:"limits",get:function(){return this.configuration.limits}},{key:"state",get:function(){return this.channelState.state}},{key:"_subscribe",value:function(){var u,f=this;return this.entityPromise=(u=this.entityPromise)!==null&&u!==void 0?u:this.services.syncClient.document({id:this.entityName,mode:"open_existing"}).then(function(o){return f.entity=o,f.entity.on("updated",function(v){f._update(v.data)}),f.entity.on("removed",function(){return f.emit("removed",f)}),f._update(f.entity.data),o}).catch(function(o){throw f.entity=null,f.entityPromise=null,f.services.syncClient.connectionState!="disconnected"&&Ut.error("Failed to get conversation object",o),Ut.debug("ERROR: Failed to get conversation object",o),o})}},{key:"_subscribeStreams",value:function(){var p=x.default(E.default.mark(function f(){var o,v,d,m,w;return E.default.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return P.prev=0,P.next=3,this._subscribe();case 3:return Ut.trace("_subscribeStreams, this.entity.data=",(o=this.entity)===null||o===void 0?void 0:o.data),m=(v=this.entity)===null||v===void 0?void 0:v.data.messages,w=(d=this.entity)===null||d===void 0?void 0:d.data.roster,P.next=8,Promise.all([this.messagesEntity.subscribe(m),this.participantsEntity.subscribe(w)]);case 8:P.next=15;break;case 10:throw P.prev=10,P.t0=P.catch(0),this.services.syncClient.connectionState!=="disconnected"&&Ut.error("Failed to subscribe on conversation objects",this.sid,P.t0),Ut.debug("ERROR: Failed to subscribe on conversation objects",this.sid,P.t0),P.t0;case 15:case"end":return P.stop()}},f,this,[[0,10]])}));function u(){return p.apply(this,arguments)}return u}()},{key:"_unsubscribe",value:function(){var p=x.default(E.default.mark(function f(){return E.default.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(!this.entity){v.next=5;break}return v.next=3,this.entity.close();case 3:this.entity=null,this.entityPromise=null;case 5:return v.abrupt("return",Promise.all([this.participantsEntity.unsubscribe(),this.messagesEntity.unsubscribe()]));case 6:case"end":return v.stop()}},f,this)}));function u(){return p.apply(this,arguments)}return u}()},{key:"_setStatus",value:function(u,f){var o=this;this.statusSource=f,this.channelState.status!==u&&(this.channelState.status=u,u==="joined"?this._subscribeStreams().catch(function(v){if(Ut.debug("ERROR while setting conversation status "+u,v),o.services.syncClient.connectionState!=="disconnected")throw v}):this.entityPromise&&this._unsubscribe().catch(function(v){if(Ut.debug("ERROR while setting conversation status "+u,v),o.services.syncClient.connectionState!=="disconnected")throw v}))}},{key:"_statusSource",value:function(){return this.statusSource}},{key:"_update",value:function(u){var f,o,v,d,m;Ut.trace("_update",u),y.preprocessUpdate(u,this.sid);for(var w=new Set,C=0,P=Object.keys(u);C<P.length;C++){var U=P[C],ee=Er[U];if(!!ee)switch(ee){case Er.status:if(!u.status||u.status==="unknown"||this.channelState.status===u.status)break;this.channelState.status=u.status,w.add(ee);break;case Er.attributes:if(ze.default(this.channelState.attributes,u.attributes))break;this.channelState.attributes=u.attributes,w.add(ee);break;case Er.lastConsumedMessageIndex:if(u.lastConsumedMessageIndex===void 0||u.lastConsumedMessageIndex===this.channelState.lastReadMessageIndex)break;this.channelState.lastReadMessageIndex=u.lastConsumedMessageIndex,w.add("lastReadMessageIndex");break;case Er.lastMessage:if(this.channelState.lastMessage&&!u.lastMessage){delete this.channelState.lastMessage,w.add(ee);break}this.channelState.lastMessage=this.channelState.lastMessage||{},((f=u.lastMessage)===null||f===void 0?void 0:f.index)!==void 0&&u.lastMessage.index!==this.channelState.lastMessage.index&&(this.channelState.lastMessage.index=u.lastMessage.index,w.add(ee)),((o=u.lastMessage)===null||o===void 0?void 0:o.timestamp)!==void 0&&((v=this.channelState.lastMessage)===null||v===void 0||(d=v.dateCreated)===null||d===void 0?void 0:d.getTime())!==u.lastMessage.timestamp.getTime()&&(this.channelState.lastMessage.dateCreated=u.lastMessage.timestamp,w.add(ee)),ze.default(this.channelState.lastMessage,{})&&delete this.channelState.lastMessage;break;case Er.state:var Se=u.state||void 0;if(Se!==void 0&&(Se.dateUpdated=new Date(Se.dateUpdated)),ze.default(this.channelState.state,Se))break;this.channelState.state=Se,w.add(ee);break;case Er.bindings:if(ze.default(this.channelState.bindings,u.bindings))break;this.channelState.bindings=u.bindings,w.add(ee);break;default:var Ue=u[U]instanceof Date,Re=Ue&&((m=this.channelState[ee])===null||m===void 0?void 0:m.getTime())===u[U].getTime(),Be=!Ue&&this[ee]===u[U];if(Re||Be)break;this.channelState[ee]=u[U],w.add(ee)}}w.size>0&&this.emit("updated",{conversation:this,updateReasons:F.default(w)})}},{key:"_onMessageAdded",value:function(u){var f=Da(this.participants.values()),o;try{for(f.s();!(o=f.n()).done;){var v=o.value;if(v.identity===u.author){v._endTyping();break}}}catch(d){f.e(d)}finally{f.f()}this.emit("messageAdded",u)}},{key:"_setLastReadMessageIndex",value:function(){var p=x.default(E.default.mark(function f(o){var v;return E.default.wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,this.services.commandExecutor.mutateResource("post","".concat(this.configuration.links.myConversations,"/").concat(this.sid),{last_read_message_index:o});case 2:return v=m.sent,m.abrupt("return",v.unread_messages_count);case 4:case"end":return m.stop()}},f,this)}));function u(f){return p.apply(this,arguments)}return u}()},{key:"add",value:function(){var p=x.default(E.default.mark(function f(o,v){return E.default.wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.abrupt("return",this.participantsEntity.add(o,v!=null?v:{}));case 1:case"end":return m.stop()}},f,this)}));function u(f,o){return p.apply(this,arguments)}return u}()},{key:"addNonChatParticipant",value:function(){var p=x.default(E.default.mark(function f(o,v){var d,m,w=arguments;return E.default.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return d=w.length>2&&w[2]!==void 0?w[2]:{},m=w.length>3&&w[3]!==void 0?w[3]:{},P.abrupt("return",this.participantsEntity.addNonChatParticipant(o,v,d!=null?d:{},m!=null?m:{}));case 3:case"end":return P.stop()}},f,this)}));function u(f,o){return p.apply(this,arguments)}return u}()},{key:"advanceLastReadMessageIndex",value:function(){var p=x.default(E.default.mark(function f(o){return E.default.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,this._subscribeStreams();case 2:if(!(o<(this.lastReadMessageIndex||0))){d.next=6;break}return d.next=5,this._setLastReadMessageIndex(this.lastReadMessageIndex);case 5:return d.abrupt("return",d.sent);case 6:return d.next=8,this._setLastReadMessageIndex(o);case 8:return d.abrupt("return",d.sent);case 9:case"end":return d.stop()}},f,this)}));function u(f){return p.apply(this,arguments)}return u}()},{key:"delete",value:function(){var p=x.default(E.default.mark(function f(){return E.default.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,this.services.commandExecutor.mutateResource("delete",this.links.self);case 2:return v.abrupt("return",this);case 3:case"end":return v.stop()}},f,this)}));function u(){return p.apply(this,arguments)}return u}()},{key:"getAttributes",value:function(){var p=x.default(E.default.mark(function f(){return E.default.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,this._subscribe();case 2:return v.abrupt("return",this.attributes);case 3:case"end":return v.stop()}},f,this)}));function u(){return p.apply(this,arguments)}return u}()},{key:"getMessages",value:function(){var p=x.default(E.default.mark(function f(o,v,d){return E.default.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return w.next=2,this._subscribeStreams();case 2:return w.abrupt("return",this.messagesEntity.getMessages(o,v,d));case 3:case"end":return w.stop()}},f,this)}));function u(f,o,v){return p.apply(this,arguments)}return u}()},{key:"getParticipants",value:function(){var p=x.default(E.default.mark(function f(){return E.default.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,this._subscribeStreams();case 2:return v.abrupt("return",this.participantsEntity.getParticipants());case 3:case"end":return v.stop()}},f,this)}));function u(){return p.apply(this,arguments)}return u}()},{key:"getParticipantsCount",value:function(){var p=x.default(E.default.mark(function f(){var o,v,d;return E.default.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return v=new xt(this.configuration.links.conversations).path(this.sid).build(),w.next=3,this.services.network.get(v);case 3:return d=w.sent,w.abrupt("return",(o=d.body.participants_count)!==null&&o!==void 0?o:0);case 5:case"end":return w.stop()}},f,this)}));function u(){return p.apply(this,arguments)}return u}()},{key:"getParticipantBySid",value:function(){var p=x.default(E.default.mark(function f(o){return E.default.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.abrupt("return",this.participantsEntity.getParticipantBySid(o));case 1:case"end":return d.stop()}},f,this)}));function u(f){return p.apply(this,arguments)}return u}()},{key:"getParticipantByIdentity",value:function(){var p=x.default(E.default.mark(function f(){var o,v=arguments;return E.default.wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return o=v.length>0&&v[0]!==void 0?v[0]:"",m.abrupt("return",this.participantsEntity.getParticipantByIdentity(o!=null?o:""));case 2:case"end":return m.stop()}},f,this)}));function u(){return p.apply(this,arguments)}return u}()},{key:"getMessagesCount",value:function(){var p=x.default(E.default.mark(function f(){var o,v,d;return E.default.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return v=new xt(this.configuration.links.conversations).path(this.sid).build(),w.next=3,this.services.network.get(v);case 3:return d=w.sent,w.abrupt("return",(o=d.body.messages_count)!==null&&o!==void 0?o:0);case 5:case"end":return w.stop()}},f,this)}));function u(){return p.apply(this,arguments)}return u}()},{key:"getUnreadMessagesCount",value:function(){var p=x.default(E.default.mark(function f(){var o,v,d;return E.default.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return o=new xt(this.configuration.links.myConversations).path(this.sid).build(),w.next=3,this.services.network.get(o);case 3:if(v=w.sent,v.body.conversation_sid===this.sid){w.next=6;break}throw new Error("Conversation was not found in the user conversations list");case 6:if(d=v.body.unread_messages_count,typeof d!="number"){w.next=9;break}return w.abrupt("return",d);case 9:return w.abrupt("return",null);case 10:case"end":return w.stop()}},f,this)}));function u(){return p.apply(this,arguments)}return u}()},{key:"join",value:function(){var p=x.default(E.default.mark(function f(){return E.default.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,this.services.commandExecutor.mutateResource("post",this.links.participants,{identity:this.configuration.userIdentity});case 2:return v.abrupt("return",this);case 3:case"end":return v.stop()}},f,this)}));function u(){return p.apply(this,arguments)}return u}()},{key:"leave",value:function(){var p=x.default(E.default.mark(function f(){return E.default.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(this.channelState.status!=="joined"){v.next=3;break}return v.next=3,this.services.commandExecutor.mutateResource("delete","".concat(this.links.participants,"/").concat(this.configuration.userIdentity));case 3:return v.abrupt("return",this);case 4:case"end":return v.stop()}},f,this)}));function u(){return p.apply(this,arguments)}return u}()},{key:"removeParticipant",value:function(){var p=x.default(E.default.mark(function f(o){return E.default.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,this.participantsEntity.remove(typeof o=="string"?o:o.sid);case 2:case"end":return d.stop()}},f,this)}));function u(f){return p.apply(this,arguments)}return u}()},{key:"sendMessage",value:function(){var p=x.default(E.default.mark(function f(o,v,d){var m,w,C,P;return E.default.wrap(function(ee){for(;;)switch(ee.prev=ee.next){case 0:if(!(typeof o=="string"||o===null)){ee.next=5;break}return ee.next=3,this.messagesEntity.send(o,v,d);case 3:return C=ee.sent,ee.abrupt("return",(w=fr(C.index))!==null&&w!==void 0?w:0);case 5:return ee.next=7,this.messagesEntity.sendMedia(o,v,d);case 7:return P=ee.sent,ee.abrupt("return",(m=fr(P.index))!==null&&m!==void 0?m:0);case 9:case"end":return ee.stop()}},f,this)}));function u(f,o,v){return p.apply(this,arguments)}return u}()},{key:"prepareMessage",value:function(){return new ia(this.limits,this.messagesEntity)}},{key:"setAllMessagesRead",value:function(){var p=x.default(E.default.mark(function f(){var o;return E.default.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,this._subscribeStreams();case 2:return d.next=4,this.getMessages(1);case 4:if(o=d.sent,!(o.items.length>0)){d.next=7;break}return d.abrupt("return",this.advanceLastReadMessageIndex(o.items[0].index));case 7:return d.abrupt("return",Promise.resolve(0));case 8:case"end":return d.stop()}},f,this)}));function u(){return p.apply(this,arguments)}return u}()},{key:"setAllMessagesUnread",value:function(){var p=x.default(E.default.mark(function f(){return E.default.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,this._subscribeStreams();case 2:return v.next=4,this._setLastReadMessageIndex(null);case 4:return v.abrupt("return",v.sent);case 5:case"end":return v.stop()}},f,this)}));function u(){return p.apply(this,arguments)}return u}()},{key:"setUserNotificationLevel",value:function(){var p=x.default(E.default.mark(function f(o){return E.default.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,this.services.commandExecutor.mutateResource("post","".concat(this.configuration.links.myConversations,"/").concat(this.sid),{notification_level:o});case 2:case"end":return d.stop()}},f,this)}));function u(f){return p.apply(this,arguments)}return u}()},{key:"typing",value:function(){return this.services.typingIndicator.send(this.sid)}},{key:"updateAttributes",value:function(){var p=x.default(E.default.mark(function f(o){return E.default.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,this.services.commandExecutor.mutateResource("post",this.links.self,{attributes:o!==void 0?JSON.stringify(o):void 0});case 2:return d.abrupt("return",this);case 3:case"end":return d.stop()}},f,this)}));function u(f){return p.apply(this,arguments)}return u}()},{key:"updateFriendlyName",value:function(){var p=x.default(E.default.mark(function f(o){return E.default.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(this.channelState.friendlyName===o){d.next=3;break}return d.next=3,this.services.commandExecutor.mutateResource("post",this.links.self,{friendly_name:o});case 3:return d.abrupt("return",this);case 4:case"end":return d.stop()}},f,this)}));function u(f){return p.apply(this,arguments)}return u}()},{key:"updateLastReadMessageIndex",value:function(){var p=x.default(E.default.mark(function f(o){return E.default.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,this._subscribeStreams();case 2:return d.abrupt("return",this._setLastReadMessageIndex(o));case 3:case"end":return d.stop()}},f,this)}));function u(f){return p.apply(this,arguments)}return u}()},{key:"updateUniqueName",value:function(){var p=x.default(E.default.mark(function f(o){return E.default.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(this.channelState.uniqueName===o){d.next=4;break}return o||(o=""),d.next=4,this.services.commandExecutor.mutateResource("post",this.links.self,{unique_name:o});case 4:return d.abrupt("return",this);case 5:case"end":return d.stop()}},f,this)}));function u(f){return p.apply(this,arguments)}return u}()}],[{key:"preprocessUpdate",value:function(u,f){try{typeof u.attributes=="string"?u.attributes=JSON.parse(u.attributes):u.attributes&&JSON.stringify(u.attributes)}catch{Ut.warn("Retrieved malformed attributes from the server for conversation: "+f),u.attributes={}}try{u.dateCreated&&(u.dateCreated=new Date(u.dateCreated))}catch{Ut.warn("Retrieved malformed dateCreated from the server for conversation: "+f),delete u.dateCreated}try{u.dateUpdated&&(u.dateUpdated=new Date(u.dateUpdated))}catch{Ut.warn("Retrieved malformed dateUpdated from the server for conversation: "+f),delete u.dateUpdated}try{u.lastMessage&&u.lastMessage.timestamp&&(u.lastMessage.timestamp=new Date(u.lastMessage.timestamp))}catch{Ut.warn("Retrieved malformed lastMessage.timestamp from the server for conversation: "+f),delete u.lastMessage.timestamp}}}]),y}(R.ReplayEventEmitter);K.default(Ze,"participantJoined","participantJoined"),K.default(Ze,"participantLeft","participantLeft"),K.default(Ze,"participantUpdated","participantUpdated"),K.default(Ze,"messageAdded","messageAdded"),K.default(Ze,"messageRemoved","messageRemoved"),K.default(Ze,"messageUpdated","messageUpdated"),K.default(Ze,"typingEnded","typingEnded"),K.default(Ze,"typingStarted","typingStarted"),K.default(Ze,"updated","updated"),K.default(Ze,"removed","removed"),q([S.validateTypesAsync(S.nonEmptyString,pt),I("design:type",Function),I("design:paramtypes",[String,Object]),I("design:returntype",Promise)],Ze.prototype,"add",null),q([S.validateTypesAsync(S.nonEmptyString,S.nonEmptyString,pt),I("design:type",Function),I("design:paramtypes",[String,String,Object,Object]),I("design:returntype",Promise)],Ze.prototype,"addNonChatParticipant",null),q([S.validateTypesAsync(S.nonNegativeInteger),I("design:type",Function),I("design:paramtypes",[Number]),I("design:returntype",Promise)],Ze.prototype,"advanceLastReadMessageIndex",null),q([S.validateTypesAsync(["undefined",S.nonNegativeInteger],["undefined",S.nonNegativeInteger],["undefined",S.literal("backwards","forward")]),I("design:type",Function),I("design:paramtypes",[Number,Number,String]),I("design:returntype",Promise)],Ze.prototype,"getMessages",null),q([S.validateTypesAsync(S.nonEmptyString),I("design:type",Function),I("design:paramtypes",[String]),I("design:returntype",Promise)],Ze.prototype,"getParticipantBySid",null),q([S.validateTypesAsync(S.nonEmptyString),I("design:type",Function),I("design:paramtypes",[String]),I("design:returntype",Promise)],Ze.prototype,"getParticipantByIdentity",null),q([S.validateTypesAsync([S.nonEmptyString,D]),I("design:type",Function),I("design:paramtypes",[Object]),I("design:returntype",Promise)],Ze.prototype,"removeParticipant",null),q([S.validateTypesAsync(["string",S.literal(null),S.custom(function(_){return[_ instanceof FormData,"an instance of FormData"]}),S.objectSchema("media options",{contentType:S.nonEmptyString,media:S.custom(function(_){var T=typeof _=="string"&&_.length>0||_ instanceof Uint8Array||_ instanceof ArrayBuffer;return typeof Blob=="function"&&(T=T||_ instanceof Blob),[T,"a non-empty string, an instance of Buffer or an instance of Blob"]})})],pt,["undefined",S.literal(null),S.objectSchema("email attributes",{subject:[S.nonEmptyString,"undefined"]})]),I("design:type",Function),I("design:paramtypes",[Object,Object,Object]),I("design:returntype",Promise)],Ze.prototype,"sendMessage",null),q([S.validateTypesAsync(S.literal("default","muted")),I("design:type",Function),I("design:paramtypes",[String]),I("design:returntype",Promise)],Ze.prototype,"setUserNotificationLevel",null),q([S.validateTypesAsync(Je),I("design:type",Function),I("design:paramtypes",[Object]),I("design:returntype",Promise)],Ze.prototype,"updateAttributes",null),q([S.validateTypesAsync(["string"]),I("design:type",Function),I("design:paramtypes",[String]),I("design:returntype",Promise)],Ze.prototype,"updateFriendlyName",null),q([S.validateTypesAsync([S.literal(null),S.nonNegativeInteger]),I("design:type",Function),I("design:paramtypes",[Number]),I("design:returntype",Promise)],Ze.prototype,"updateLastReadMessageIndex",null),q([S.validateTypesAsync(["string",S.literal(null)]),I("design:type",Function),I("design:paramtypes",[String]),I("design:returntype",Promise)],Ze.prototype,"updateUniqueName",null);var Li=function(){function _(){var T=this;he.default(this,_),this._promise=new Promise(function(y,p){T._resolve=y,T._reject=p})}return ye.default(_,[{key:"promise",get:function(){return this._promise}},{key:"update",value:function(y){this._resolve(y)}},{key:"set",value:function(y){this.current=y,this._resolve(y)}},{key:"fail",value:function(y){this._reject(y)}}]),_}();function xi(_,T){var y=typeof Symbol!="undefined"&&_[Symbol.iterator]||_["@@iterator"];if(!y){if(Array.isArray(_)||(y=Ui(_))||T&&_&&typeof _.length=="number"){y&&(_=y);var p=0,u=function(){};return{s:u,n:function(){return p>=_.length?{done:!0}:{done:!1,value:_[p++]}},e:function(m){throw m},f:u}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var f=!0,o=!1,v;return{s:function(){y=y.call(_)},n:function(){var m=y.next();return f=m.done,m},e:function(m){o=!0,v=m},f:function(){try{!f&&y.return!=null&&y.return()}finally{if(o)throw v}}}}function Ui(_,T){if(!!_){if(typeof _=="string")return Ba(_,T);var y=Object.prototype.toString.call(_).slice(8,-1);if(y==="Object"&&_.constructor&&(y=_.constructor.name),y==="Map"||y==="Set")return Array.from(_);if(y==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(y))return Ba(_,T)}}function Ba(_,T){(T==null||T>_.length)&&(T=_.length);for(var y=0,p=new Array(T);y<T;y++)p[y]=_[y];return p}function Qr(_,T){var y=Object.keys(_);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(_);T&&(p=p.filter(function(u){return Object.getOwnPropertyDescriptor(_,u).enumerable})),y.push.apply(y,p)}return y}function ji(_){for(var T=1;T<arguments.length;T++){var y=arguments[T]!=null?arguments[T]:{};T%2?Qr(Object(y),!0).forEach(function(p){K.default(_,p,y[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_,Object.getOwnPropertyDescriptors(y)):Qr(Object(y)).forEach(function(p){Object.defineProperty(_,p,Object.getOwnPropertyDescriptor(y,p))})}return _}function Di(_){var T=pr();return function(){var p=J.default(_),u;if(T){var f=J.default(this).constructor;u=Reflect.construct(p,arguments,f)}else u=p.apply(this,arguments);return H.default(this,u)}}function pr(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Gt=se.scope("Conversations"),Fi=function(_){Q.default(y,_);var T=Di(y);function y(p,u){var f;return he.default(this,y),f=T.call(this),K.default(ge.default(f),"conversations",new Map),K.default(ge.default(f),"myConversationsRead",new Li),K.default(ge.default(f),"tombstones",new Set),K.default(ge.default(f),"myConversationsFetched",!1),f.configuration=p,f.services=u,f}return ye.default(y,[{key:"addConversation",value:function(){var p=x.default(E.default.mark(function f(o){var v,d,m,w,C,P,U,ee,Se,Ue;return E.default.wrap(function(Be){for(;;)switch(Be.prev=Be.next){case 0:return w=typeof(o==null?void 0:o.attributes)!="undefined"?o.attributes:{},Be.next=3,this.services.commandExecutor.mutateResource("post",this.configuration.links.conversations,{friendly_name:o.friendlyName,unique_name:o.uniqueName,attributes:typeof w!="undefined"?JSON.stringify(w):void 0});case 3:if(C=Be.sent,P=(v=C.sid)!==null&&v!==void 0?v:null,U=(d=(m=C.sync_objects)===null||m===void 0?void 0:m.conversation)!==null&&d!==void 0?d:null,ee=ji({self:C.url},C.links),Se=this.conversations.get(P),!Se){Be.next=12;break}return Be.next=11,Se._subscribe();case 11:return Be.abrupt("return",Se);case 12:return Ue=new Ze({channel:U,entityName:"",uniqueName:"",attributes:null,createdBy:"",friendlyName:"",lastConsumedMessageIndex:0,dateCreated:null,dateUpdated:null},P,ee,this.configuration,this.services),this.conversations.set(Ue.sid,Ue),this._registerForEvents(Ue),Be.next=17,Ue._subscribe();case 17:return this.emit("conversationAdded",Ue),Be.abrupt("return",Ue);case 19:case"end":return Be.stop()}},f,this)}));function u(f){return p.apply(this,arguments)}return u}()},{key:"fetchConversations",value:function(){var p=x.default(E.default.mark(function f(){var o=this,v,d,m,w,C,P,U;return E.default.wrap(function(Se){for(;;)switch(Se.prev=Se.next){case 0:return Se.prev=0,Se.next=3,this._getMap();case 3:return v=Se.sent,v.on("itemAdded",function(Ue){Gt.debug("itemAdded: ".concat(Ue.item.key)),o._upsertConversation("sync",Ue.item.key,Ue.item.data)}),v.on("itemRemoved",function(Ue){Gt.debug("itemRemoved: ".concat(Ue.key));var Re=Ue.key;o.myConversationsFetched||o.tombstones.add(Re);var Be=o.conversations.get(Re);!Be||(Be.status==="joined"&&(Be._setStatus("notParticipating","sync"),o.emit("conversationLeft",Be)),o.conversations.delete(Re),o.emit("conversationRemoved",Be),Be.emit("removed",Be))}),v.on("itemUpdated",function(Ue){Gt.debug("itemUpdated: ".concat(Ue.item.key)),o._upsertConversation("sync",Ue.item.key,Ue.item.data)}),Se.next=9,this._fetchMyConversations();case 9:d=Se.sent,m=[],w=xi(d);try{for(w.s();!(C=w.n()).done;)P=C.value,m.push(this._upsertConversation("rest",P.channel_sid,P))}catch(Ue){w.e(Ue)}finally{w.f()}return this.myConversationsRead.set(!0),Se.next=16,Promise.all(m);case 16:return this.myConversationsFetched=!0,this.tombstones.clear(),Gt.debug("The conversations list has been successfully fetched"),Se.abrupt("return",this);case 22:throw Se.prev=22,Se.t0=Se.catch(0),U="Failed to fetch the conversations list",this.services.syncClient.connectionState!=="disconnected"&&Gt.error(U,Se.t0),Gt.debug("ERROR: ".concat(U),Se.t0),Se.t0;case 28:case"end":return Se.stop()}},f,this,[[0,22]])}));function u(){return p.apply(this,arguments)}return u}()},{key:"getConversations",value:function(){var p=x.default(E.default.mark(function f(){var o=this,v,d;return E.default.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return w.next=2,this._getMap();case 2:return v=w.sent,w.next=5,v.getItems();case 5:return d=w.sent,w.abrupt("return",this._wrapPaginator(d,function(C){return Promise.all(C.map(function(P){return o._upsertConversation("sync",P.key,P.data)}))}));case 7:case"end":return w.stop()}},f,this)}));function u(){return p.apply(this,arguments)}return u}()},{key:"getConversation",value:function(){var p=x.default(E.default.mark(function f(o){var v=this,d,m,w;return E.default.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return P.next=2,this._getMap();case 2:return d=P.sent,P.next=5,d.getItems({key:o});case 5:return m=P.sent,w=m.items.map(function(U){return v._upsertConversation("sync",U.key,U.data)}),P.abrupt("return",w.length>0?w[0]:null);case 8:case"end":return P.stop()}},f,this)}));function u(f){return p.apply(this,arguments)}return u}()},{key:"getConversationByUniqueName",value:function(){var p=x.default(E.default.mark(function f(o){var v,d,m,w,C;return E.default.wrap(function(U){for(;;)switch(U.prev=U.next){case 0:return v=new xt(this.configuration.links.myConversations).path(o).build(),U.next=3,this.services.network.get(v);case 3:return d=U.sent,m=d.body,w=m.conversation_sid,C={entityName:null,lastConsumedMessageIndex:m.last_read_message_index,status:(m==null?void 0:m.status)||"unknown",friendlyName:m.friendly_name,dateUpdated:m.date_updated,dateCreated:m.date_created,uniqueName:m.unique_name,createdBy:m.created_by,attributes:m.attributes,channel:m.sync_objects.conversation,notificationLevel:m==null?void 0:m.notification_level,sid:w},U.abrupt("return",w?this._upsertConversation("sync",w,C):null);case 8:case"end":return U.stop()}},f,this)}));function u(f){return p.apply(this,arguments)}return u}()},{key:"peekConversation",value:function(){var p=x.default(E.default.mark(function f(o){var v,d,m,w;return E.default.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return v=new xt(this.configuration.links.conversations).path(o).build(),P.next=3,this.services.network.get(v);case 3:return d=P.sent,m=d.body,w={entityName:null,status:(m==null?void 0:m.status)||"unknown",friendlyName:m.friendly_name,dateUpdated:m.date_updated,dateCreated:m.date_created,uniqueName:m.unique_name,createdBy:m.created_by,attributes:m.attributes,channel:"".concat(o,".channel"),sid:o},P.abrupt("return",this._upsertConversation("sync",o,w));case 7:case"end":return P.stop()}},f,this)}));function u(f){return p.apply(this,arguments)}return u}()},{key:"_getMap",value:function(){var p=x.default(E.default.mark(function f(){return E.default.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,this.services.syncClient.map({id:this.configuration.myConversations,mode:"open_existing"});case 2:return v.abrupt("return",v.sent);case 3:case"end":return v.stop()}},f,this)}));function u(){return p.apply(this,arguments)}return u}()},{key:"_wrapPaginator",value:function(){var p=x.default(E.default.mark(function f(o,v){var d=this,m;return E.default.wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return C.next=2,v(o.items);case 2:return m=C.sent,C.abrupt("return",{items:m,hasNextPage:o.hasNextPage,hasPrevPage:o.hasPrevPage,nextPage:function(){return o.nextPage().then(function(U){return d._wrapPaginator(U,v)})},prevPage:function(){return o.prevPage().then(function(U){return d._wrapPaginator(U,v)})}});case 4:case"end":return C.stop()}},f)}));function u(f,o){return p.apply(this,arguments)}return u}()},{key:"_updateConversation",value:function(){var p=x.default(E.default.mark(function f(o,v,d){var m=this,w,C,P;return E.default.wrap(function(ee){for(;;)switch(ee.prev=ee.next){case 0:if(w=v._statusSource()!==void 0&&o!==v._statusSource(),C=o!=="rest"||v._statusSource()==="sync",!(w&&C&&o!=="sync")){ee.next=5;break}return Gt.trace("upsertConversation: conversation is known from sync and came from chat, ignoring",{sid:v.sid,data:d.status,conversation:v.status}),ee.abrupt("return");case 5:if(!(d.status==="joined"&&v.status!=="joined")){ee.next=13;break}return v._setStatus("joined",o),P={},typeof d.notificationLevel!="undefined"&&(P.notificationLevel=d.notificationLevel),typeof d.lastConsumedMessageIndex!="undefined"&&(P.lastConsumedMessageIndex=d.lastConsumedMessageIndex),ze.default(P,{})||v._update(P),v._subscribe().then(function(){m.emit("conversationJoined",v)}),ee.abrupt("return");case 13:if(!(d.status==="notParticipating"&&v.status==="joined")){ee.next=20;break}return v._setStatus("notParticipating",o),v._update(d),ee.next=18,v._subscribe();case 18:return this.emit("conversationLeft",v),ee.abrupt("return");case 20:if(d.status!=="notParticipating"){ee.next=24;break}return ee.next=23,v._subscribe();case 23:return ee.abrupt("return");case 24:v._update(d);case 25:case"end":return ee.stop()}},f,this)}));function u(f,o,v){return p.apply(this,arguments)}return u}()},{key:"_upsertConversation",value:function(){var p=x.default(E.default.mark(function f(o,v,d){var m,w,C,P;return E.default.wrap(function(ee){for(;;)switch(ee.prev=ee.next){case 0:if(Gt.trace("upsertConversation called for ".concat(v),d),m=this.conversations.get(v),!m){ee.next=9;break}return Gt.trace("upsertConversation: the conversation ".concat(m.sid," is known;")+"its status is known from the source ".concat(m._statusSource()," ")+"and the update came from the source ".concat(o),m),ee.next=6,this._updateConversation(o,m,d);case 6:return ee.next=8,m._subscribe();case 8:return ee.abrupt("return",m);case 9:if(!(["chat","rest"].includes(o)&&this.tombstones.has(v))){ee.next=12;break}return Gt.trace("upsertChannel: the channel is deleted but reappeared again from chat, ignoring",v),ee.abrupt("return",null);case 12:return Gt.trace("upsertConversation: creating a local conversation object with sid "+v,d),w="".concat(this.configuration.links.conversations,"/").concat(v),C={self:w,messages:"".concat(w,"/Messages"),participants:"".concat(w,"/Participants")},P=new Ze(d,v,C,this.configuration,this.services),this.conversations.set(v,P),ee.next=19,P._subscribe();case 19:return this._registerForEvents(P),this.emit("conversationAdded",P),d.status==="joined"&&(P._setStatus("joined",o),this.emit("conversationJoined",P)),ee.abrupt("return",P);case 23:case"end":return ee.stop()}},f,this)}));function u(f,o,v){return p.apply(this,arguments)}return u}()},{key:"_fetchMyConversations",value:function(){var p=x.default(E.default.mark(function f(){var o,v,d,m,w,C;return E.default.wrap(function(U){for(;;)switch(U.prev=U.next){case 0:o=[],v=null;case 2:return m=new xt(this.configuration.links.myConversations),v&&m.arg("PageToken",v),U.next=6,this.services.network.get(m.build());case 6:w=U.sent,C=(d=w.body)===null||d===void 0?void 0:d.conversations.map(function(ee){return{descriptor:ee,channel_sid:ee.conversation_sid,status:ee.status,channel:ee.sync_objects.conversation,messages:ee.sync_objects.messages,roster:"".concat(ee.conversation_sid,".roster"),lastConsumedMessageIndex:ee.last_read_message_index,notificationLevel:ee.notification_level}}),v=w.body.meta.next_token,o=[].concat(F.default(o),F.default(C));case 10:if(v){U.next=2;break}case 11:return U.abrupt("return",o);case 12:case"end":return U.stop()}},f,this)}));function u(){return p.apply(this,arguments)}return u}()},{key:"_onConversationRemoved",value:function(u){var f=this.conversations.get(u);f&&(this.conversations.delete(u),this.emit("conversationRemoved",f))}},{key:"_registerForEvents",value:function(u){var f=this;u.on("removed",function(){return f._onConversationRemoved(u.sid)}),u.on("updated",function(o){return f.emit("conversationUpdated",o)}),u.on("participantJoined",function(o){return f.emit("participantJoined",o)}),u.on("participantLeft",function(o){return f.emit("participantLeft",o)}),u.on("participantUpdated",function(o){return f.emit("participantUpdated",o)}),u.on("messageAdded",function(o){return f.emit("messageAdded",o)}),u.on("messageUpdated",function(o){return f.emit("messageUpdated",o)}),u.on("messageRemoved",function(o){return f.emit("messageRemoved",o)}),u.on("typingStarted",function(o){return f.emit("typingStarted",o)}),u.on("typingEnded",function(o){return f.emit("typingEnded",o)})}}]),y}(R.ReplayEventEmitter);function Bi(_){var T=qi();return function(){var p=J.default(_),u;if(T){var f=J.default(this).constructor;u=Reflect.construct(p,arguments,f)}else u=p.apply(this,arguments);return H.default(this,u)}}function qi(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Wi=function(_){Q.default(y,_);var T=Bi(y);function y(p,u,f){var o;return he.default(this,y),o=T.call(this),o.configuration=u,o.services=f,o.fifoStack=[],o.myself=p,o.myself.on("updated",function(v){return o.emit("userUpdated",v)}),o.myself.on("userSubscribed",function(){return o.emit("userSubscribed",o.myself)}),o.myself.on("userUnsubscribed",function(){o.emit("userUnsubscribed",o.myself),o.myself._ensureFetched()}),o.subscribedUsers=new Map,o}return ye.default(y,[{key:"handleUnsubscribeUser",value:function(u){this.subscribedUsers.has(u.identity)&&this.subscribedUsers.delete(u.identity);var f=0,o=this.fifoStack.find(function(v,d){return v==u.identity?(f=d,!0):!1});o&&this.fifoStack.splice(f,1),this.emit("userUnsubscribed",u)}},{key:"handleSubscribeUser",value:function(u){if(!this.subscribedUsers.has(u.identity)){if(this.fifoStack.length>=this.configuration.userInfosToSubscribe){var f,o,v=this.fifoStack.shift();(f=this.subscribedUsers)===null||f===void 0||(o=f.get(v))===null||o===void 0||o.unsubscribe()}this.fifoStack.push(u.identity),this.subscribedUsers.set(u.identity,u),this.emit("userSubscribed",u)}}},{key:"getUser",value:function(){var p=x.default(E.default.mark(function f(){var o=this,v,d,m,w,C=arguments;return E.default.wrap(function(U){for(;;)switch(U.prev=U.next){case 0:return v=C.length>0&&C[0]!==void 0?C[0]:"",d=C.length>1&&C[1]!==void 0?C[1]:"",U.next=4,this.myself._ensureFetched();case 4:if(v!=this.myself.identity){U.next=6;break}return U.abrupt("return",this.myself);case 6:if(m=this.subscribedUsers.get(v),!m){U.next=9;break}return U.abrupt("return",m);case 9:if(U.t0=d,U.t0){U.next=14;break}return U.next=13,this.getSyncUniqueName(v);case 13:U.t0=U.sent;case 14:return d=U.t0,w=new Et(v,d,this.configuration,this.services),w.on("updated",function(ee){return o.emit("userUpdated",ee)}),w.on("userSubscribed",function(){return o.handleSubscribeUser(w)}),w.on("userUnsubscribed",function(){return o.handleUnsubscribeUser(w)}),U.next=21,w._ensureFetched();case 21:return U.abrupt("return",w);case 22:case"end":return U.stop()}},f,this)}));function u(){return p.apply(this,arguments)}return u}()},{key:"getSubscribedUsers",value:function(){var p=x.default(E.default.mark(function f(){var o;return E.default.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,this.myself._ensureFetched();case 2:return o=[this.myself],this.subscribedUsers.forEach(function(m){return o.push(m)}),d.abrupt("return",o);case 5:case"end":return d.stop()}},f,this)}));function u(){return p.apply(this,arguments)}return u}()},{key:"getSyncUniqueName",value:function(){var p=x.default(E.default.mark(function f(o){var v,d,m,w;return E.default.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return m=new xt(this.configuration.links.users).path(o).build(),P.next=3,this.services.network.get(m);case 3:return w=P.sent,P.abrupt("return",(v=(d=w.body)===null||d===void 0?void 0:d.sync_objects.user_info_map)!==null&&v!==void 0?v:"");case 5:case"end":return P.stop()}},f,this)}));function u(f){return p.apply(this,arguments)}return u}()}]),y}(R.ReplayEventEmitter),kn=se.scope("TypingIndicator"),Tn=function(){function _(T,y,p){he.default(this,_),this.configuration=y,this.services=p,this.getConversation=T,this.serviceTypingTimeout=null,this.sentUpdates=new Map}return ye.default(_,[{key:"typingTimeout",get:function(){return this.configuration.typingIndicatorTimeoutOverride||this.serviceTypingTimeout||this.configuration.typingIndicatorTimeoutDefault}},{key:"initialize",value:function(){var y=this;this.services.notificationClient.on("message",function(){var p=x.default(E.default.mark(function u(f,o){return E.default.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(f!==at.TYPING_INDICATOR){d.next=3;break}return d.next=3,y._handleRemoteTyping(o);case 3:case"end":return d.stop()}},u)}));return function(u,f){return p.apply(this,arguments)}}())}},{key:"_handleRemoteTyping",value:function(){var T=x.default(E.default.mark(function p(u){var f=this;return E.default.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:kn.trace("Got new typing indicator ",u),this.getConversation(u.channel_sid).then(function(d){!d||d.participants.forEach(function(m){if(m.identity===u.identity){var w=f.configuration.typingIndicatorTimeoutOverride?f.configuration.typingIndicatorTimeoutOverride+1e3:u.typing_timeout*1e3;m._startTyping(w)}})}).catch(function(d){throw kn.error(d),d});case 2:case"end":return v.stop()}},p,this)}));function y(p){return T.apply(this,arguments)}return y}()},{key:"send",value:function(y){var p=this.sentUpdates.get(y);return p&&p>Date.now()-this.typingTimeout?Promise.resolve():(this.sentUpdates.set(y,Date.now()),this._send(y))}},{key:"_send",value:function(y){var p=this;kn.trace("Sending typing indicator");var u=this.configuration.links.typing,f={"Content-Type":"application/x-www-form-urlencoded"},o="ChannelSid=".concat(y);return this.services.twilsockClient.post(u,f,o,this.configuration.productId).then(function(v){v.body.hasOwnProperty("typing_timeout")&&(p.serviceTypingTimeout=v.body.typing_timeout*1e3)}).catch(function(v){throw kn.error("Failed to send typing indicator:",v),v})}}]),_}(),In=function _(T){he.default(this,_),this.title=T.title||null,this.body=T.body||null,this.sound=T.sound||null,this.badge=T.badge||null,this.action=T.action||null,this.type=T.type||null,this.data=T.data||{}},Cr="2.1.0";function sa(_,T){var y=Object.keys(_);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(_);T&&(p=p.filter(function(u){return Object.getOwnPropertyDescriptor(_,u).enumerable})),y.push.apply(y,p)}return y}function qa(_){for(var T=1;T<arguments.length;T++){var y=arguments[T]!=null?arguments[T]:{};T%2?sa(Object(y),!0).forEach(function(p){K.default(_,p,y[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_,Object.getOwnPropertyDescriptors(y)):sa(Object(y)).forEach(function(p){Object.defineProperty(_,p,Object.getOwnPropertyDescriptor(y,p))})}return _}var Wa=function(T){return T.replace(/(^\/+|\/+$)/g,"")},Gi=function(T){return T.status.code===202},Hi=function(){function _(T,y,p){he.default(this,_),this._serviceUrl=T,this._services=y,this._productId=p}return ye.default(_,[{key:"_preProcessUrl",value:function(y){var p=Wa(y);return/^https?:\/\//.test(y)?p:"".concat(Wa(this._serviceUrl),"/").concat(p)}},{key:"_makeRequest",value:function(){var T=x.default(E.default.mark(function p(u,f,o,v){var d,m,w,C;return E.default.wrap(function(U){for(;;)switch(U.prev=U.next){case 0:d=this._preProcessUrl(f),m=qa({"Content-Type":"application/json; charset=utf-8"},v||{}),U.t0=u,U.next=U.t0==="get"?5:U.t0==="post"?11:U.t0==="delete"?15:19;break;case 5:return C=d,o&&(C+="?"+Object.entries(o).map(function(ee){return ee.map(encodeURIComponent).join("=")}).join("&")),U.next=9,this._services.transport.get(C,m,this._productId);case 9:return w=U.sent,U.abrupt("break",19);case 11:return U.next=13,this._services.transport.post(d,m,JSON.stringify(o),this._productId);case 13:return w=U.sent,U.abrupt("break",19);case 15:return U.next=17,this._services.transport.delete(d,m,{},this._productId);case 17:return w=U.sent,U.abrupt("break",19);case 19:if(!(w.status.code<200||w.status.code>=300)){U.next=21;break}throw new Error("Request responded with a non-success code ".concat(w.status.code));case 21:return U.abrupt("return",w);case 22:case"end":return U.stop()}},p,this)}));function y(p,u,f,o){return T.apply(this,arguments)}return y}()},{key:"fetchResource",value:function(){var T=x.default(E.default.mark(function p(u,f){var o=this,v,d;return E.default.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return v=6,w.prev=1,w.next=4,new W.AsyncRetrier({min:50,max:1600,maxAttemptsCount:v}).run(function(){return o._makeRequest("get",u,f)});case 4:return d=w.sent,w.abrupt("return",d.body);case 8:throw w.prev=8,w.t0=w.catch(1),new Error('Fetch resource from "'.concat(u,'" failed.'));case 11:case"end":return w.stop()}},p,null,[[1,8]])}));function y(p,u){return T.apply(this,arguments)}return y}()},{key:"mutateResource",value:function(){var T=x.default(E.default.mark(function p(u,f,o){var v;return E.default.wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,this._makeRequest(u,f,o,{"X-Twilio-Mutation-Id":Pe.v4()});case 2:if(v=m.sent,!Gi(v)){m.next=7;break}return m.next=6,this.fetchResource(v.body.resource_url);case 6:return m.abrupt("return",m.sent);case 7:return m.abrupt("return",v.body);case 8:case"end":return m.stop()}},p,this)}));function y(p,u,f){return T.apply(this,arguments)}return y}()}]),_}(),et,ua;function Ga(_,T){var y=Object.keys(_);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(_);T&&(p=p.filter(function(u){return Object.getOwnPropertyDescriptor(_,u).enumerable})),y.push.apply(y,p)}return y}function Rn(_){for(var T=1;T<arguments.length;T++){var y=arguments[T]!=null?arguments[T]:{};T%2?Ga(Object(y),!0).forEach(function(p){K.default(_,p,y[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_,Object.getOwnPropertyDescriptors(y)):Ga(Object(y)).forEach(function(p){Object.defineProperty(_,p,Object.getOwnPropertyDescriptor(y,p))})}return _}function oa(_){var T=Xr();return function(){var p=J.default(_),u;if(T){var f=J.default(this).constructor;u=Reflect.construct(p,arguments,f)}else u=p.apply(this,arguments);return H.default(this,u)}}function Xr(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var ot,vr=se.scope("Client"),ca=Cr,hr=function _(){he.default(this,_)};e.Client=ot=(ua=et=function(_){Q.default(y,_);var T=oa(y);function y(p){var u,f,o,v,d,m,w=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(he.default(this,y),m=T.call(this),K.default(ge.default(m),"connectionState","unknown"),K.default(ge.default(m),"version",ca),K.default(ge.default(m),"parsePushNotification",ot.parsePushNotification),m.fpaToken=p!=null?p:"",m.options=w!=null?w:{},!m.options.disableDeepClone){var C=Rn(Rn({},m.options),{},{transport:void 0,twilsockClient:void 0});C=Rt(C),C.transport=m.options.transport,C.twilsockClient=m.options.twilsockClient,m.options=C}m.options.logLevel=(u=m.options.logLevel)!==null&&u!==void 0?u:"silent",vr.setLevel(m.options.logLevel);var P=m.options.productId="ip_messaging";if(m.options.clientMetadata=m.options.clientMetadata||{},m.options.clientMetadata.hasOwnProperty("type")||(m.options.clientMetadata.type="conversations"),m.options.clientMetadata.hasOwnProperty("sdk")||(m.options.clientMetadata.sdk="JS",m.options.clientMetadata.sdkv=ca),m.options.Sync=m.options.Sync||{},typeof m.options.Sync.enableSessionStorage=="undefined"&&(m.options.Sync.enableSessionStorage=!0),m.options.region&&(m.options.Sync.region=m.options.region),!p)throw new Error("A valid Twilio token should be provided");m.services=new hr,m._myself=new Et("","",null,m.services);var U=!m.options.twilsockClient;if(!m.options.initRegistrations){var ee=new z.InitRegistration(P);ot.populateInitRegistrations(ee),m.options.initRegistrations=[ee]}m.services.twilsockClient=m.options.twilsockClient=(f=m.options.twilsockClient)!==null&&f!==void 0?f:new z.TwilsockClient(p,P,m.options),m.services.twilsockClient.on("tokenAboutToExpire",function(Yt){return m.emit("tokenAboutToExpire",Yt)}),m.services.twilsockClient.on("tokenExpired",function(){return m.emit("tokenExpired")}),m.services.twilsockClient.on("connectionError",function(Yt){return m.emit("connectionError",Yt)}),m.services.twilsockClient.on("stateChanged",function(Yt){vr.debug("Handling stateChanged for ConversationsClient: new state ".concat(Yt)),Yt!==m.connectionState&&(m.connectionState=Yt,m.emit("connectionStateChanged",m.connectionState))}),m.services.transport=m.options.transport=(o=m.options.transport)!==null&&o!==void 0?o:m.options.twilsockClient,m.services.notificationClient=m.options.notificationsClient=(v=m.options.notificationsClient)!==null&&v!==void 0?v:new me.Notifications(p,m.options),m.services.syncClient=m.options.syncClient=(d=m.options.syncClient)!==null&&d!==void 0?d:new le.SyncClient(p,m.options);var Se=(w==null?void 0:w.Chat)||(w==null?void 0:w.IPMessaging)||w||{},Ue=Se.region||(w==null?void 0:w.region),Re=Se.apiUri||Se.typingUri||"https://aim.".concat(Ue||"us1",".twilio.com");m.services.commandExecutor=new Hi(Re,{transport:m.options.transport},P);var Be=function(k){m._rejectEnsureReady(k),m.emit("stateChanged","failed")};return m.services.twilsockClient.once("connectionError",Be),m.services.twilsockClient.once("disconnected",Be),m.services.twilsockClient.once("connected",x.default(E.default.mark(function Yt(){var k;return E.default.wrap(function(X){for(;;)switch(X.prev=X.next){case 0:return vr.debug("ConversationsClient started INITIALIZING"),m.services.twilsockClient.off("connectionError",Be),m.services.twilsockClient.off("disconnected",Be),X.prev=3,k="conversations.client.startup",m.services.twilsockClient.addPartialTelemetryEvent(new z.TelemetryEventDescription(k,"Conversations client startup",new Date),k,z.TelemetryPoint.Start),X.next=8,m._initialize();case 8:m.services.twilsockClient.addPartialTelemetryEvent(new z.TelemetryEventDescription("","",new Date),k,z.TelemetryPoint.End),X.next=15;break;case 11:X.prev=11,X.t0=X.catch(3),m._rejectEnsureReady(X.t0),m.emit("stateChanged","failed");case 15:case"end":return X.stop()}},Yt,null,[[3,11]])}))),m._ensureReady=new Promise(function(Yt,k){m._resolveEnsureReady=Yt,m._rejectEnsureReady=k}).catch(function(){}),U&&m.services.twilsockClient.connect(),m}return ye.default(y,[{key:"user",get:function(){return this._myself}},{key:"reachabilityEnabled",get:function(){if(!this.configuration)throw new Error("Reachability information could not yet be accessed as the client has not yet been initialized. Subscribe to the 'stateChanged' event to properly react to the client initialization.");return this.configuration.reachabilityEnabled}},{key:"token",get:function(){return this.fpaToken}},{key:"_subscribeToPushNotifications",value:function(u){var f=this;[at.NEW_MESSAGE,at.ADDED_TO_CONVERSATION,at.REMOVED_FROM_CONVERSATION,at.TYPING_INDICATOR,at.CONSUMPTION_UPDATE].forEach(function(o){f.services.notificationClient.subscribe(u,o)})}},{key:"_unsubscribeFromPushNotifications",value:function(u){var f=this;[at.NEW_MESSAGE,at.ADDED_TO_CONVERSATION,at.REMOVED_FROM_CONVERSATION,at.TYPING_INDICATOR,at.CONSUMPTION_UPDATE].forEach(function(o){f.services.notificationClient.unsubscribe(u,o)})}},{key:"_initialize",value:function(){var p=x.default(E.default.mark(function f(){var o=this,v;return E.default.wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,this.services.commandExecutor.fetchResource("Client/v2/Configuration");case 2:return v=m.sent,this.configuration=new xe(this.options,v,vr),this._myself._resolveInitialization(this.configuration,this.configuration.userIdentity,this.configuration.userInfo,!0),this.services.typingIndicator=new Tn(this.getConversationBySid.bind(this),this.configuration,this.services),this.services.network=new $n(this.configuration,this.services),this.services.users=new Wi(this._myself,this.configuration,this.services),this.services.users.on("userSubscribed",function(w){o.emit("userSubscribed",w)}),this.services.users.on("userUpdated",function(w){return o.emit("userUpdated",w)}),this.services.users.on("userUnsubscribed",function(w){o.emit("userUnsubscribed",w)}),this.conversations=new Fi(this.configuration,this.services),this.conversations.on("conversationAdded",function(w){o.emit("conversationAdded",w)}),this.conversations.on("conversationRemoved",function(w){o.emit("conversationRemoved",w)}),this.conversations.on("conversationJoined",function(w){o.emit("conversationJoined",w)}),this.conversations.on("conversationLeft",function(w){o.emit("conversationLeft",w)}),this.conversations.on("conversationUpdated",function(w){return o.emit("conversationUpdated",w)}),this.conversations.on("participantJoined",function(w){o.emit("participantJoined",w)}),this.conversations.on("participantLeft",function(w){o.emit("participantLeft",w)}),this.conversations.on("participantUpdated",function(w){return o.emit("participantUpdated",w)}),this.conversations.on("messageAdded",function(w){return o.emit("messageAdded",w)}),this.conversations.on("messageUpdated",function(w){return o.emit("messageUpdated",w)}),this.conversations.on("messageRemoved",function(w){return o.emit("messageRemoved",w)}),this.conversations.on("typingStarted",function(w){return o.emit("typingStarted",w)}),this.conversations.on("typingEnded",function(w){return o.emit("typingEnded",w)}),this.conversationsPromise=this.conversations.fetchConversations().then(function(){return o.conversations}).catch(function(w){throw w}),m.next=28,this.services.users.myself._ensureFetched();case 28:ot.supportedPushChannels.forEach(function(w){return o._subscribeToPushNotifications(w)}),this.services.typingIndicator.initialize(),this.services.mcsClient=new De.McsClient(this.fpaToken,this.configuration.links.mediaService,this.configuration.links.mediaSetService,Rn(Rn({},this.options),{},{transport:void 0})),this._resolveEnsureReady(),this.emit("stateChanged","initialized");case 33:case"end":return m.stop()}},f,this)}));function u(){return p.apply(this,arguments)}return u}()},{key:"shutdown",value:function(){var p=x.default(E.default.mark(function f(){return E.default.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,this._ensureReady;case 2:return v.next=4,this.services.twilsockClient.disconnect();case 4:case"end":return v.stop()}},f,this)}));function u(){return p.apply(this,arguments)}return u}()},{key:"updateToken",value:function(){var p=x.default(E.default.mark(function f(o){return E.default.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,this._ensureReady;case 2:if(vr.info("updateToken"),this.fpaToken!==o){d.next=5;break}return d.abrupt("return",this);case 5:return d.next=7,this.services.twilsockClient.updateToken(o);case 7:return d.next=9,this.services.notificationClient.updateToken(o);case 9:return d.next=11,this.services.mcsClient.updateToken(o);case 11:return this.fpaToken=o,d.abrupt("return",this);case 13:case"end":return d.stop()}},f,this)}));function u(f){return p.apply(this,arguments)}return u}()},{key:"getConversationBySid",value:function(){var p=x.default(E.default.mark(function f(o){var v;return E.default.wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,this._ensureReady;case 2:return m.next=4,this.conversations.myConversationsRead.promise;case 4:return m.next=6,this.conversations.getConversation(o);case 6:if(v=m.sent,v){m.next=11;break}return m.next=10,this.conversations.peekConversation(o);case 10:v=m.sent;case 11:if(v){m.next=13;break}throw new Error("Conversation with SID ".concat(o," is not found."));case 13:return m.abrupt("return",v);case 14:case"end":return m.stop()}},f,this)}));function u(f){return p.apply(this,arguments)}return u}()},{key:"getConversationByUniqueName",value:function(){var p=x.default(E.default.mark(function f(o){var v;return E.default.wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,this._ensureReady;case 2:return m.next=4,this.conversations.myConversationsRead.promise;case 4:return m.next=6,this.conversations.getConversationByUniqueName(o);case 6:if(v=m.sent,v){m.next=9;break}throw new Error("Conversation with unique name ".concat(o," is not found."));case 9:return m.abrupt("return",v);case 10:case"end":return m.stop()}},f,this)}));function u(f){return p.apply(this,arguments)}return u}()},{key:"getSubscribedConversations",value:function(){var p=x.default(E.default.mark(function f(){return E.default.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,this._ensureReady;case 2:return v.abrupt("return",this.conversationsPromise.then(function(d){return d.getConversations()}));case 3:case"end":return v.stop()}},f,this)}));function u(){return p.apply(this,arguments)}return u}()},{key:"createConversation",value:function(){var p=x.default(E.default.mark(function f(o){return E.default.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,this._ensureReady;case 2:return o=o||{},d.abrupt("return",this.conversationsPromise.then(function(m){return m.addConversation(o)}));case 4:case"end":return d.stop()}},f,this)}));function u(f){return p.apply(this,arguments)}return u}()},{key:"setPushRegistrationId",value:function(){var p=x.default(E.default.mark(function f(o,v){return E.default.wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,this._ensureReady;case 2:return this._subscribeToPushNotifications(o),this.services.notificationClient.setPushRegistrationId(o,v),m.next=6,this.services.notificationClient.commitChanges();case 6:case"end":return m.stop()}},f,this)}));function u(f,o){return p.apply(this,arguments)}return u}()},{key:"unsetPushRegistrationId",value:function(){var p=x.default(E.default.mark(function f(o){return E.default.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,this._ensureReady;case 2:return this._unsubscribeFromPushNotifications(o),d.next=5,this.services.notificationClient.commitChanges();case 5:case"end":return d.stop()}},f,this)}));function u(f){return p.apply(this,arguments)}return u}()},{key:"removePushRegistrations",value:function(){var p=x.default(E.default.mark(function f(o,v){return E.default.wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,this.services.notificationClient.removeRegistrations(o,v);case 2:case"end":return m.stop()}},f,this)}));function u(f,o){return p.apply(this,arguments)}return u}()},{key:"handlePushNotification",value:function(){var p=x.default(E.default.mark(function f(o){return E.default.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,this._ensureReady;case 2:vr.debug("handlePushNotification, notificationPayload=",o),this.emit("pushNotification",ot.parsePushNotification(o));case 4:case"end":return d.stop()}},f,this)}));function u(f){return p.apply(this,arguments)}return u}()},{key:"getUser",value:function(){var p=x.default(E.default.mark(function f(o){return E.default.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,this._ensureReady;case 2:return d.abrupt("return",this.services.users.getUser(o));case 3:case"end":return d.stop()}},f,this)}));function u(f){return p.apply(this,arguments)}return u}()},{key:"getSubscribedUsers",value:function(){var p=x.default(E.default.mark(function f(){return E.default.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,this._ensureReady;case 2:return v.abrupt("return",this.services.users.getSubscribedUsers());case 3:case"end":return v.stop()}},f,this)}));function u(){return p.apply(this,arguments)}return u}()}],[{key:"populateInitRegistrations",value:function(u){u.populateInitRegistrations([at.TYPING_INDICATOR]),le.SyncClient.populateInitRegistrations(u)}},{key:"create",value:function(){var p=x.default(E.default.mark(function f(o,v){var d;return E.default.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:if(!(v!=null&&v.twilsockClient)){w.next=2;break}throw new Error("Obsolete usage of ConversationsClient.create() factory method: if you pass twilsock from the outside then you must use ConversationsClient constructor and be prepared to work with uninitialized client.");case 2:return d=new ot(o,v),w.next=5,d._ensureReady;case 5:return w.abrupt("return",d);case 6:case"end":return w.stop()}},f)}));function u(f,o){return p.apply(this,arguments)}return u}()},{key:"parsePushNotificationChatData",value:function(u){var f={};for(var o in ot.supportedPushDataFields)if(!(typeof u[o]=="undefined"||u[o]===null)){if(o!=="message_index"){f[ot.supportedPushDataFields[o]]=u[o];continue}fr(u[o])!==null&&(f[ot.supportedPushDataFields[o]]=Number(u[o]))}return f}},{key:"parsePushNotification",value:function(u){if(vr.debug("parsePushNotification, notificationPayload=",u),typeof u.aps!="undefined"){if(!u.twi_message_type)throw new Error("Provided push notification payload does not contain Programmable Chat push notification type");var f=ot.parsePushNotificationChatData(u),o=u.aps,v,d=null;return typeof o.alert=="string"?v=o.alert||null:(v=o.alert.body||null,d=o.alert.title||null),new In({title:d,body:v,sound:o.sound||null,badge:o.badge||null,action:o.category||null,type:u.twi_message_type,data:f})}if(typeof u.data!="undefined"){var m=u.data;if(!m.twi_message_type)throw new Error("Provided push notification payload does not contain Programmable Chat push notification type");var w=ot.parsePushNotificationChatData(u.data);return new In({title:m.twi_title||null,body:m.twi_body||null,sound:m.twi_sound||null,badge:null,action:m.twi_action||null,type:m.twi_message_type,data:w})}throw new Error("Provided push notification payload is not Programmable Chat notification")}}]),y}(R.ReplayEventEmitter),K.default(et,"version",ca),K.default(et,"supportedPushChannels",["fcm","apn"]),K.default(et,"supportedPushDataFields",{conversation_sid:"conversationSid",message_sid:"messageSid",message_index:"messageIndex"}),K.default(et,"conversationAdded","conversationAdded"),K.default(et,"conversationJoined","conversationJoined"),K.default(et,"conversationLeft","conversationLeft"),K.default(et,"conversationRemoved","conversationRemoved"),K.default(et,"conversationUpdated","conversationUpdated"),K.default(et,"participantJoined","participantJoined"),K.default(et,"participantLeft","participantLeft"),K.default(et,"participantUpdated","participantUpdated"),K.default(et,"messageAdded","messageAdded"),K.default(et,"messageRemoved","messageRemoved"),K.default(et,"messageUpdated","messageUpdated"),K.default(et,"tokenAboutToExpire","tokenAboutToExpire"),K.default(et,"tokenExpired","tokenExpired"),K.default(et,"typingEnded","typingEnded"),K.default(et,"typingStarted","typingStarted"),K.default(et,"pushNotification","pushNotification"),K.default(et,"userSubscribed","userSubscribed"),K.default(et,"userUnsubscribed","userUnsubscribed"),K.default(et,"userUpdated","userUpdated"),K.default(et,"stateChanged","stateChanged"),K.default(et,"connectionStateChanged","connectionStateChanged"),K.default(et,"connectionError","connectionError"),ua),q([S.validateTypesAsync(S.nonEmptyString),I("design:type",Function),I("design:paramtypes",[String]),I("design:returntype",Promise)],e.Client.prototype,"updateToken",null),q([S.validateTypesAsync(S.nonEmptyString),I("design:type",Function),I("design:paramtypes",[String]),I("design:returntype",Promise)],e.Client.prototype,"getConversationBySid",null),q([S.validateTypesAsync(S.nonEmptyString),I("design:type",Function),I("design:paramtypes",[String]),I("design:returntype",Promise)],e.Client.prototype,"getConversationByUniqueName",null),q([S.validateTypesAsync(["undefined",S.objectSchema("conversation options",{friendlyName:["string","undefined"],isPrivate:["boolean","undefined"],uniqueName:["string","undefined"]})]),I("design:type",Function),I("design:paramtypes",[Object]),I("design:returntype",Promise)],e.Client.prototype,"createConversation",null),q([S.validateTypesAsync(S.literal("fcm","apn"),"string"),I("design:type",Function),I("design:paramtypes",[String,String]),I("design:returntype",Promise)],e.Client.prototype,"setPushRegistrationId",null),q([S.validateTypesAsync(S.literal("fcm","apn")),I("design:type",Function),I("design:paramtypes",[String]),I("design:returntype",Promise)],e.Client.prototype,"unsetPushRegistrationId",null),q([S.validateTypesAsync(S.literal("fcm","apn"),S.nonEmptyString),I("design:type",Function),I("design:paramtypes",[String,String]),I("design:returntype",Promise)],e.Client.prototype,"removePushRegistrations",null),q([S.validateTypesAsync(S.pureObject),I("design:type",Function),I("design:paramtypes",[Object]),I("design:returntype",Promise)],e.Client.prototype,"handlePushNotification",null),q([S.validateTypesAsync(S.nonEmptyString),I("design:type",Function),I("design:paramtypes",[String]),I("design:returntype",Promise)],e.Client.prototype,"getUser",null),q([S.validateTypesAsync("string",["undefined",S.pureObject]),I("design:type",Function),I("design:paramtypes",[String,Object]),I("design:returntype",Promise)],e.Client,"create",null),q([S.validateTypes(S.pureObject),I("design:type",Function),I("design:paramtypes",[Object]),I("design:returntype",In)],e.Client,"parsePushNotification",null),e.Client=ot=q([S.validateConstructorTypes(S.nonEmptyString,[S.pureObject,"undefined"]),I("design:paramtypes",[String,Object])],e.Client),e.AggregatedDeliveryReceipt=Ae,e.Conversation=Ze,e.DetailedDeliveryReceipt=Me,e.Media=de,e.Message=bt,e.MessageBuilder=ia,e.NotificationTypes=at,e.Participant=D,e.PushNotification=In,e.RestPaginator=Fe,e.UnsentMessage=Kt,e.User=Et})(y$);export{y$ as b};
